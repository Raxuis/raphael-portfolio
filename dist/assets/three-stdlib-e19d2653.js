import{C as q,p as An,u as ac,V as P,v as fn,w as dn,Q as er,P as bt,O as mn,x as Qs,c as H,o as or,r as oe,y as vn,z as lc,F as tr,G as ni,H as $t,I as rt,J as cc,K as uc,X as hc,Y as gt,Z as Ft,_ as fc,m as fa,k as dc,$ as pc,a0 as Qn,a1 as mc,a2 as Cn,a3 as ri,a4 as Zt,n as Ac,M as Mi,a5 as gc,a6 as da,D as Tc,a7 as vc,B as Mn,a8 as Cc,l as He,a9 as Ec,aa as Rc,ab as Bc,ac as pa,ad as Ii,ae as yc,af as ma,ag as Sc,ah as xc,R as Pt,ai as Aa,aj as ga,ak as Ta,al as va,am as Ca,an as Ea,ao as Ra,ap as Ba,aq as ya,ar as Mc,as as Yi,at as Sa,au as se,av as fe,aw as Ic,ax as bc,ay as Be,az as Me,aA as ne,aB as ii,aC as vs,aD as Pc,aE as _c,aF as Y,aG as Cs,aH as $i,aI as xa,aJ as Hr,aK as En,aL as Ma,aM as wc,aN as Oc,aO as Fc,aP as zt,aQ as Dc,aR as Nc,aS as Lc,aT as Gc,T as Zi,aU as kc,aV as zs,aW as Uc,aX as Hc,aY as Kc,aZ as zn,N as Ia,a_ as Kr,a$ as bi,b0 as ba,b1 as Jc,b2 as jc,q as Pi,b3 as Wc,b4 as Vc,b5 as Xc,b6 as Qc,b7 as zc,b8 as Kn,b9 as Yn,ba as Ys,bb as $s,bc as _i,bd as Yc,be as $c,U as At,bf as Jr,bg as Rr,h as Zc}from"./three-de21513e.js";import"./mmd-parser-06216fd5.js";import{K as Zs,a as qc,r as eu,V as tu,b as nu,c as ru,d as Pa,e as _a,f as wa,g as Es,h as Oa,i as Fa,j as Da,k as Rs,l as Na,m as La,n as Bs,o as Ga}from"./ktx-parse-b17e1334.js";import{Q as iu}from"./zstddec-5cb485fa.js";import"./opentype.js-95d064b1.js";var su=Object.defineProperty,ou=(t,e,n)=>e in t?su(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,M=(t,e,n)=>(ou(t,typeof e!="symbol"?e+"":e,n),n);function qs(t,e){if(e===Mc)return console.warn("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Geometry already defined as triangles."),t;if(e===Yi||e===Sa){let n=t.getIndex();if(n===null){const o=[],a=t.getAttribute("position");if(a!==void 0){for(let l=0;l<a.count;l++)o.push(l);t.setIndex(o),n=t.getIndex()}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),t}const r=n.count-2,i=[];if(n)if(e===Yi)for(let o=1;o<=r;o++)i.push(n.getX(0)),i.push(n.getX(o)),i.push(n.getX(o+1));else for(let o=0;o<r;o++)o%2===0?(i.push(n.getX(o)),i.push(n.getX(o+1)),i.push(n.getX(o+2))):(i.push(n.getX(o+2)),i.push(n.getX(o+1)),i.push(n.getX(o)));i.length/3!==r&&console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const s=t.clone();return s.setIndex(i),s.clearGroups(),s}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unknown draw mode:",e),t}new q;const ka=class{parse(t,e={decodeSpeed:5,encodeSpeed:5,encoderMethod:ka.MESH_EDGEBREAKER_ENCODING,quantization:[16,8,8,8,8],exportUvs:!0,exportNormals:!0,exportColor:!1}){if(t instanceof Mn&&t.isBufferGeometry)throw new Error("DRACOExporter: The first parameter of parse() is now an instance of Mesh or Points.");if(DracoEncoderModule===void 0)throw new Error("THREE.DRACOExporter: required the draco_encoder to work.");const n=t.geometry,r=DracoEncoderModule(),i=new r.Encoder;let s,o;if(!n.isBufferGeometry)throw new Error("THREE.DRACOExporter.parse(geometry, options): geometry is not a THREE.BufferGeometry instance.");if(t instanceof He&&t.isMesh){s=new r.MeshBuilder,o=new r.Mesh;const f=n.getAttribute("position");s.AddFloatAttributeToMesh(o,r.POSITION,f.count,f.itemSize,f.array);const T=n.getIndex();if(T!==null)s.AddFacesToMesh(o,T.count/3,T.array);else{const g=new(f.count>65535?Uint32Array:Uint16Array)(f.count);for(let d=0;d<g.length;d++)g[d]=d;s.AddFacesToMesh(o,f.count,g)}if(e.exportNormals){const g=n.getAttribute("normal");g!==void 0&&s.AddFloatAttributeToMesh(o,r.NORMAL,g.count,g.itemSize,g.array)}if(e.exportUvs){const g=n.getAttribute("uv");g!==void 0&&s.AddFloatAttributeToMesh(o,r.TEX_COORD,g.count,g.itemSize,g.array)}if(e.exportColor){const g=n.getAttribute("color");g!==void 0&&s.AddFloatAttributeToMesh(o,r.COLOR,g.count,g.itemSize,g.array)}}else if(t instanceof pa&&t.isPoints){s=new r.PointCloudBuilder,o=new r.PointCloud;const f=n.getAttribute("position");if(s.AddFloatAttribute(o,r.POSITION,f.count,f.itemSize,f.array),e.exportColor){const T=n.getAttribute("color");T!==void 0&&s.AddFloatAttribute(o,r.COLOR,T.count,T.itemSize,T.array)}}else throw new Error("DRACOExporter: Unsupported object type.");const a=new r.DracoInt8Array,l=e.encodeSpeed!==void 0?e.encodeSpeed:5,c=e.decodeSpeed!==void 0?e.decodeSpeed:5;if(i.SetSpeedOptions(l,c),e.encoderMethod!==void 0&&i.SetEncodingMethod(e.encoderMethod),e.quantization!==void 0)for(let f=0;f<5;f++)e.quantization[f]!==void 0&&i.SetAttributeQuantization(f,e.quantization[f]);let u;if(t instanceof He&&t.isMesh?u=i.EncodeMeshToDracoBuffer(o,a):u=i.EncodePointCloudToDracoBuffer(o,!0,a),r.destroy(o),u===0)throw new Error("THREE.DRACOExporter: Draco encoding failed.");const h=new Int8Array(new ArrayBuffer(u));for(let f=0;f<u;f++)h[f]=a.GetValue(f);return r.destroy(a),r.destroy(i),r.destroy(s),h}};let ot=ka;M(ot,"MESH_EDGEBREAKER_ENCODING",1);M(ot,"MESH_SEQUENTIAL_ENCODING",0);M(ot,"POINT_CLOUD",0);M(ot,"TRIANGULAR_MESH",1);M(ot,"INVALID",-1);M(ot,"POSITION",0);M(ot,"NORMAL",1);M(ot,"COLOR",2);M(ot,"TEX_COORD",3);M(ot,"GENERIC",4);const Ua=class extends He{constructor(t,e={}){super(t),this.isReflector=!0,this.type="Reflector",this.camera=new bt;const n=this,r=e.color!==void 0?new q(e.color):new q(8355711),i=e.textureWidth||512,s=e.textureHeight||512,o=e.clipBias||0,a=e.shader||Ua.ReflectorShader,l=e.multisample!==void 0?e.multisample:4,c=new tr,u=new P,h=new P,f=new P,T=new oe,g=new P(0,0,-1),d=new vn,A=new P,v=new P,m=new vn,p=new oe,C=this.camera,R=new Be(i,s,{samples:l,type:Me}),y=new se({uniforms:fe.clone(a.uniforms),fragmentShader:a.fragmentShader,vertexShader:a.vertexShader});y.uniforms.tDiffuse.value=R.texture,y.uniforms.color.value=r,y.uniforms.textureMatrix.value=p,this.material=y,this.onBeforeRender=function(B,x,I){if(h.setFromMatrixPosition(n.matrixWorld),f.setFromMatrixPosition(I.matrixWorld),T.extractRotation(n.matrixWorld),u.set(0,0,1),u.applyMatrix4(T),A.subVectors(h,f),A.dot(u)>0)return;A.reflect(u).negate(),A.add(h),T.extractRotation(I.matrixWorld),g.set(0,0,-1),g.applyMatrix4(T),g.add(f),v.subVectors(h,g),v.reflect(u).negate(),v.add(h),C.position.copy(A),C.up.set(0,1,0),C.up.applyMatrix4(T),C.up.reflect(u),C.lookAt(v),C.far=I.far,C.updateMatrixWorld(),C.projectionMatrix.copy(I.projectionMatrix),p.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),p.multiply(C.projectionMatrix),p.multiply(C.matrixWorldInverse),p.multiply(n.matrixWorld),c.setFromNormalAndCoplanarPoint(u,h),c.applyMatrix4(C.matrixWorldInverse),d.set(c.normal.x,c.normal.y,c.normal.z,c.constant);const S=C.projectionMatrix;m.x=(Math.sign(d.x)+S.elements[8])/S.elements[0],m.y=(Math.sign(d.y)+S.elements[9])/S.elements[5],m.z=-1,m.w=(1+S.elements[10])/S.elements[14],d.multiplyScalar(2/d.dot(m)),S.elements[2]=d.x,S.elements[6]=d.y,S.elements[10]=d.z+1-o,S.elements[14]=d.w,n.visible=!1;const b=B.getRenderTarget(),O=B.xr.enabled,w=B.shadowMap.autoUpdate,k=B.toneMapping;let U=!1;"outputColorSpace"in B?U=B.outputColorSpace==="srgb":U=B.outputEncoding===3001,B.xr.enabled=!1,B.shadowMap.autoUpdate=!1,"outputColorSpace"in B?B.outputColorSpace="linear-srgb":B.outputEncoding=3e3,B.toneMapping=Ia,B.setRenderTarget(R),B.state.buffers.depth.setMask(!0),B.autoClear===!1&&B.clear(),B.render(x,C),B.xr.enabled=O,B.shadowMap.autoUpdate=w,B.toneMapping=k,"outputColorSpace"in B?B.outputColorSpace=U?"srgb":"srgb-linear":B.outputEncoding=U?3001:3e3,B.setRenderTarget(b);const j=I.viewport;j!==void 0&&B.state.viewport(j),n.visible=!0},this.getRenderTarget=function(){return R},this.dispose=function(){R.dispose(),n.material.dispose()}}};let qi=Ua;M(qi,"ReflectorShader",{uniforms:{color:{value:null},tDiffuse:{value:null},textureMatrix:{value:null}},vertexShader:`
		uniform mat4 textureMatrix;
		varying vec4 vUv;

		#include <common>
		#include <logdepthbuf_pars_vertex>

		void main() {

			vUv = textureMatrix * vec4( position, 1.0 );

			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

			#include <logdepthbuf_vertex>

		}`,fragmentShader:`
		uniform vec3 color;
		uniform sampler2D tDiffuse;
		varying vec4 vUv;

		#include <logdepthbuf_pars_fragment>

		float blendOverlay( float base, float blend ) {

			return( base < 0.5 ? ( 2.0 * base * blend ) : ( 1.0 - 2.0 * ( 1.0 - base ) * ( 1.0 - blend ) ) );

		}

		vec3 blendOverlay( vec3 base, vec3 blend ) {

			return vec3( blendOverlay( base.r, blend.r ), blendOverlay( base.g, blend.g ), blendOverlay( base.b, blend.b ) );

		}

		void main() {

			#include <logdepthbuf_fragment>

			vec4 base = texture2DProj( tDiffuse, vUv );
			gl_FragColor = vec4( blendOverlay( base.rgb, color ), 1.0 );

			#include <tonemapping_fragment>
			#include <${parseInt(or.replace(/\D+/g,""))>=154?"colorspace_fragment":"encodings_fragment"}>

		}`});const Ha=class extends He{constructor(t,e={}){super(t),this.isRefractor=!0,this.type="Refractor",this.camera=new bt;const n=this,r=e.color!==void 0?new q(e.color):new q(8355711),i=e.textureWidth||512,s=e.textureHeight||512,o=e.clipBias||0,a=e.shader||Ha.RefractorShader,l=e.multisample!==void 0?e.multisample:4,c=this.camera;c.matrixAutoUpdate=!1,c.userData.refractor=!0;const u=new tr,h=new oe,f=new Be(i,s,{samples:l,type:Me});this.material=new se({uniforms:fe.clone(a.uniforms),vertexShader:a.vertexShader,fragmentShader:a.fragmentShader,transparent:!0}),this.material.uniforms.color.value=r,this.material.uniforms.tDiffuse.value=f.texture,this.material.uniforms.textureMatrix.value=h;const T=function(){const m=new P,p=new P,C=new oe,R=new P,y=new P;return function(x){return m.setFromMatrixPosition(n.matrixWorld),p.setFromMatrixPosition(x.matrixWorld),R.subVectors(m,p),C.extractRotation(n.matrixWorld),y.set(0,0,1),y.applyMatrix4(C),R.dot(y)<0}}(),g=function(){const m=new P,p=new P,C=new er,R=new P;return function(){n.matrixWorld.decompose(p,C,R),m.set(0,0,1).applyQuaternion(C).normalize(),m.negate(),u.setFromNormalAndCoplanarPoint(m,p)}}(),d=function(){const m=new tr,p=new vn,C=new vn;return function(y){c.matrixWorld.copy(y.matrixWorld),c.matrixWorldInverse.copy(c.matrixWorld).invert(),c.projectionMatrix.copy(y.projectionMatrix),c.far=y.far,m.copy(u),m.applyMatrix4(c.matrixWorldInverse),p.set(m.normal.x,m.normal.y,m.normal.z,m.constant);const B=c.projectionMatrix;C.x=(Math.sign(p.x)+B.elements[8])/B.elements[0],C.y=(Math.sign(p.y)+B.elements[9])/B.elements[5],C.z=-1,C.w=(1+B.elements[10])/B.elements[14],p.multiplyScalar(2/p.dot(C)),B.elements[2]=p.x,B.elements[6]=p.y,B.elements[10]=p.z+1-o,B.elements[14]=p.w}}();function A(m){h.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),h.multiply(m.projectionMatrix),h.multiply(m.matrixWorldInverse),h.multiply(n.matrixWorld)}function v(m,p,C){n.visible=!1;const R=m.getRenderTarget(),y=m.xr.enabled,B=m.shadowMap.autoUpdate,x=m.toneMapping;let I=!1;"outputColorSpace"in m?I=m.outputColorSpace==="srgb":I=m.outputEncoding===3001,m.xr.enabled=!1,m.shadowMap.autoUpdate=!1,"outputColorSpace"in m?m.outputColorSpace="linear-srgb":m.outputEncoding=3e3,m.toneMapping=Ia,m.setRenderTarget(f),m.autoClear===!1&&m.clear(),m.render(p,c),m.xr.enabled=y,m.shadowMap.autoUpdate=B,m.toneMapping=x,m.setRenderTarget(R),"outputColorSpace"in m?m.outputColorSpace=I?"srgb":"srgb-linear":m.outputEncoding=I?3001:3e3;const S=C.viewport;S!==void 0&&m.state.viewport(S),n.visible=!0}this.onBeforeRender=function(m,p,C){C.userData.refractor!==!0&&T(C)&&(g(),A(C),d(C),v(m,p,C))},this.getRenderTarget=function(){return f},this.dispose=function(){f.dispose(),n.material.dispose()}}};let es=Ha;M(es,"RefractorShader",{uniforms:{color:{value:null},tDiffuse:{value:null},textureMatrix:{value:null}},vertexShader:`

		uniform mat4 textureMatrix;

		varying vec4 vUv;

		void main() {

			vUv = textureMatrix * vec4( position, 1.0 );
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform vec3 color;
		uniform sampler2D tDiffuse;

		varying vec4 vUv;

		float blendOverlay( float base, float blend ) {

			return( base < 0.5 ? ( 2.0 * base * blend ) : ( 1.0 - 2.0 * ( 1.0 - base ) * ( 1.0 - blend ) ) );

		}

		vec3 blendOverlay( vec3 base, vec3 blend ) {

			return vec3( blendOverlay( base.r, blend.r ), blendOverlay( base.g, blend.g ), blendOverlay( base.b, blend.b ) );

		}

		void main() {

			vec4 base = texture2DProj( tDiffuse, vUv );
			gl_FragColor = vec4( blendOverlay( base.rgb, color ), 1.0 );

			#include <tonemapping_fragment>
			#include <${parseInt(or.replace(/\D+/g,""))>=154?"colorspace_fragment":"encodings_fragment"}>

		}`});const au=new Mn,ts=class extends He{constructor(){super(ts.Geometry,new gt({opacity:0,transparent:!0})),this.isLensflare=!0,this.type="Lensflare",this.frustumCulled=!1,this.renderOrder=1/0;const t=new P,e=new P,n=new Kr(new Uint8Array(16*16*3),16,16,Pt);n.minFilter=ne,n.magFilter=ne,n.wrapS=zt,n.wrapT=zt;const r=new Kr(new Uint8Array(16*16*3),16,16,Pt);r.minFilter=ne,r.magFilter=ne,r.wrapS=zt,r.wrapT=zt;const i=ts.Geometry,s=new bi({uniforms:{scale:{value:null},screenPosition:{value:null}},vertexShader:`

				precision highp float;

				uniform vec3 screenPosition;
				uniform vec2 scale;

				attribute vec3 position;

				void main() {

					gl_Position = vec4( position.xy * scale + screenPosition.xy, screenPosition.z, 1.0 );

				}`,fragmentShader:`

				precision highp float;

				void main() {

					gl_FragColor = vec4( 1.0, 0.0, 1.0, 1.0 );

				}`,depthTest:!0,depthWrite:!1,transparent:!1}),o=new bi({uniforms:{map:{value:n},scale:{value:null},screenPosition:{value:null}},vertexShader:`

				precision highp float;

				uniform vec3 screenPosition;
				uniform vec2 scale;

				attribute vec3 position;
				attribute vec2 uv;

				varying vec2 vUV;

				void main() {

					vUV = uv;

					gl_Position = vec4( position.xy * scale + screenPosition.xy, screenPosition.z, 1.0 );

				}`,fragmentShader:`

				precision highp float;

				uniform sampler2D map;

				varying vec2 vUV;

				void main() {

					gl_FragColor = texture2D( map, vUV );

				}`,depthTest:!1,depthWrite:!1,transparent:!1}),a=new He(i,s),l=[],c=Ka.Shader,u=new bi({uniforms:{map:{value:null},occlusionMap:{value:r},color:{value:new q(16777215)},scale:{value:new H},screenPosition:{value:new P}},vertexShader:c.vertexShader,fragmentShader:c.fragmentShader,blending:ba,transparent:!0,depthWrite:!1}),h=new He(i,u);this.addElement=function(A){l.push(A)};const f=new H,T=new H,g=new Jc,d=new vn;this.onBeforeRender=function(A,v,m){A.getCurrentViewport(d);const p=d.w/d.z,C=d.z/2,R=d.w/2;let y=16/d.w;if(f.set(y*p,y),g.min.set(d.x,d.y),g.max.set(d.x+(d.z-16),d.y+(d.w-16)),e.setFromMatrixPosition(this.matrixWorld),e.applyMatrix4(m.matrixWorldInverse),!(e.z>0)&&(t.copy(e).applyMatrix4(m.projectionMatrix),T.x=d.x+t.x*C+C-8,T.y=d.y+t.y*R+R-8,g.containsPoint(T))){A.copyFramebufferToTexture(T,n);let B=s.uniforms;B.scale.value=f,B.screenPosition.value=t,A.renderBufferDirect(m,null,i,s,a,null),A.copyFramebufferToTexture(T,r),B=o.uniforms,B.scale.value=f,B.screenPosition.value=t,A.renderBufferDirect(m,null,i,o,a,null);const x=-t.x*2,I=-t.y*2;for(let S=0,b=l.length;S<b;S++){const O=l[S],w=u.uniforms;w.color.value.copy(O.color),w.map.value=O.texture,w.screenPosition.value.x=t.x+x*O.distance,w.screenPosition.value.y=t.y+I*O.distance,y=O.size/d.w;const k=d.w/d.z;w.scale.value.set(y*k,y),u.uniformsNeedUpdate=!0,A.renderBufferDirect(m,null,i,u,h,null)}}},this.dispose=function(){s.dispose(),o.dispose(),u.dispose(),n.dispose(),r.dispose();for(let A=0,v=l.length;A<v;A++)l[A].texture.dispose()}}};let lu=ts;M(lu,"Geometry",au);class Ka{constructor(e,n=1,r=0,i=new q(16777215)){this.texture=e,this.size=n,this.distance=r,this.color=i}}M(Ka,"Shader",{uniforms:{map:{value:null},occlusionMap:{value:null},color:{value:null},scale:{value:null},screenPosition:{value:null}},vertexShader:`

		precision highp float;

		uniform vec3 screenPosition;
		uniform vec2 scale;

		uniform sampler2D occlusionMap;

		attribute vec3 position;
		attribute vec2 uv;

		varying vec2 vUV;
		varying float vVisibility;

		void main() {

			vUV = uv;

			vec2 pos = position.xy;

			vec4 visibility = texture2D( occlusionMap, vec2( 0.1, 0.1 ) );
			visibility += texture2D( occlusionMap, vec2( 0.5, 0.1 ) );
			visibility += texture2D( occlusionMap, vec2( 0.9, 0.1 ) );
			visibility += texture2D( occlusionMap, vec2( 0.9, 0.5 ) );
			visibility += texture2D( occlusionMap, vec2( 0.9, 0.9 ) );
			visibility += texture2D( occlusionMap, vec2( 0.5, 0.9 ) );
			visibility += texture2D( occlusionMap, vec2( 0.1, 0.9 ) );
			visibility += texture2D( occlusionMap, vec2( 0.1, 0.5 ) );
			visibility += texture2D( occlusionMap, vec2( 0.5, 0.5 ) );

			vVisibility =        visibility.r / 9.0;
			vVisibility *= 1.0 - visibility.g / 9.0;
			vVisibility *=       visibility.b / 9.0;

			gl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );

		}`,fragmentShader:`

		precision highp float;

		uniform sampler2D map;
		uniform vec3 color;

		varying vec2 vUV;
		varying float vVisibility;

		void main() {

			vec4 texture = texture2D( map, vUV );
			texture.a *= vVisibility;
			gl_FragColor = texture;
			gl_FragColor.rgb *= color;

		}`});class $n{constructor(e=Math){M(this,"grad3",[[1,1,0],[-1,1,0],[1,-1,0],[-1,-1,0],[1,0,1],[-1,0,1],[1,0,-1],[-1,0,-1],[0,1,1],[0,-1,1],[0,1,-1],[0,-1,-1]]),M(this,"grad4",[[0,1,1,1],[0,1,1,-1],[0,1,-1,1],[0,1,-1,-1],[0,-1,1,1],[0,-1,1,-1],[0,-1,-1,1],[0,-1,-1,-1],[1,0,1,1],[1,0,1,-1],[1,0,-1,1],[1,0,-1,-1],[-1,0,1,1],[-1,0,1,-1],[-1,0,-1,1],[-1,0,-1,-1],[1,1,0,1],[1,1,0,-1],[1,-1,0,1],[1,-1,0,-1],[-1,1,0,1],[-1,1,0,-1],[-1,-1,0,1],[-1,-1,0,-1],[1,1,1,0],[1,1,-1,0],[1,-1,1,0],[1,-1,-1,0],[-1,1,1,0],[-1,1,-1,0],[-1,-1,1,0],[-1,-1,-1,0]]),M(this,"p",[]),M(this,"perm",[]),M(this,"simplex",[[0,1,2,3],[0,1,3,2],[0,0,0,0],[0,2,3,1],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,2,3,0],[0,2,1,3],[0,0,0,0],[0,3,1,2],[0,3,2,1],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,3,2,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,2,0,3],[0,0,0,0],[1,3,0,2],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,3,0,1],[2,3,1,0],[1,0,2,3],[1,0,3,2],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,0,3,1],[0,0,0,0],[2,1,3,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,0,1,3],[0,0,0,0],[0,0,0,0],[0,0,0,0],[3,0,1,2],[3,0,2,1],[0,0,0,0],[3,1,2,0],[2,1,0,3],[0,0,0,0],[0,0,0,0],[0,0,0,0],[3,1,0,2],[0,0,0,0],[3,2,0,1],[3,2,1,0]]),M(this,"dot",(n,r,i)=>n[0]*r+n[1]*i),M(this,"dot3",(n,r,i,s)=>n[0]*r+n[1]*i+n[2]*s),M(this,"dot4",(n,r,i,s,o)=>n[0]*r+n[1]*i+n[2]*s+n[3]*o),M(this,"noise",(n,r)=>{let i,s,o;const a=.5*(Math.sqrt(3)-1),l=(n+r)*a,c=Math.floor(n+l),u=Math.floor(r+l),h=(3-Math.sqrt(3))/6,f=(c+u)*h,T=c-f,g=u-f,d=n-T,A=r-g;let v=0,m=1;d>A&&(v=1,m=0);const p=d-v+h,C=A-m+h,R=d-1+2*h,y=A-1+2*h,B=c&255,x=u&255,I=this.perm[B+this.perm[x]]%12,S=this.perm[B+v+this.perm[x+m]]%12,b=this.perm[B+1+this.perm[x+1]]%12;let O=.5-d*d-A*A;O<0?i=0:(O*=O,i=O*O*this.dot(this.grad3[I],d,A));let w=.5-p*p-C*C;w<0?s=0:(w*=w,s=w*w*this.dot(this.grad3[S],p,C));let k=.5-R*R-y*y;return k<0?o=0:(k*=k,o=k*k*this.dot(this.grad3[b],R,y)),70*(i+s+o)}),M(this,"noise3d",(n,r,i)=>{let s,o,a,l;const c=.3333333333333333,u=(n+r+i)*c,h=Math.floor(n+u),f=Math.floor(r+u),T=Math.floor(i+u),g=1/6,d=(h+f+T)*g,A=h-d,v=f-d,m=T-d,p=n-A,C=r-v,R=i-m;let y,B,x,I,S,b;p>=C?C>=R?(y=1,B=0,x=0,I=1,S=1,b=0):p>=R?(y=1,B=0,x=0,I=1,S=0,b=1):(y=0,B=0,x=1,I=1,S=0,b=1):C<R?(y=0,B=0,x=1,I=0,S=1,b=1):p<R?(y=0,B=1,x=0,I=0,S=1,b=1):(y=0,B=1,x=0,I=1,S=1,b=0);const O=p-y+g,w=C-B+g,k=R-x+g,U=p-I+2*g,j=C-S+2*g,V=R-b+2*g,X=p-1+3*g,Q=C-1+3*g,z=R-1+3*g,ve=h&255,Ce=f&255,Pe=T&255,pe=this.perm[ve+this.perm[Ce+this.perm[Pe]]]%12,Xe=this.perm[ve+y+this.perm[Ce+B+this.perm[Pe+x]]]%12,re=this.perm[ve+I+this.perm[Ce+S+this.perm[Pe+b]]]%12,de=this.perm[ve+1+this.perm[Ce+1+this.perm[Pe+1]]]%12;let Te=.6-p*p-C*C-R*R;Te<0?s=0:(Te*=Te,s=Te*Te*this.dot3(this.grad3[pe],p,C,R));let ee=.6-O*O-w*w-k*k;ee<0?o=0:(ee*=ee,o=ee*ee*this.dot3(this.grad3[Xe],O,w,k));let ue=.6-U*U-j*j-V*V;ue<0?a=0:(ue*=ue,a=ue*ue*this.dot3(this.grad3[re],U,j,V));let he=.6-X*X-Q*Q-z*z;return he<0?l=0:(he*=he,l=he*he*this.dot3(this.grad3[de],X,Q,z)),32*(s+o+a+l)}),M(this,"noise4d",(n,r,i,s)=>{const o=this.grad4,a=this.simplex,l=this.perm,c=(Math.sqrt(5)-1)/4,u=(5-Math.sqrt(5))/20;let h,f,T,g,d;const A=(n+r+i+s)*c,v=Math.floor(n+A),m=Math.floor(r+A),p=Math.floor(i+A),C=Math.floor(s+A),R=(v+m+p+C)*u,y=v-R,B=m-R,x=p-R,I=C-R,S=n-y,b=r-B,O=i-x,w=s-I,k=S>b?32:0,U=S>O?16:0,j=b>O?8:0,V=S>w?4:0,X=b>w?2:0,Q=O>w?1:0,z=k+U+j+V+X+Q;let ve,Ce,Pe,pe,Xe,re,de,Te,ee,ue,he,Re;ve=a[z][0]>=3?1:0,Ce=a[z][1]>=3?1:0,Pe=a[z][2]>=3?1:0,pe=a[z][3]>=3?1:0,Xe=a[z][0]>=2?1:0,re=a[z][1]>=2?1:0,de=a[z][2]>=2?1:0,Te=a[z][3]>=2?1:0,ee=a[z][0]>=1?1:0,ue=a[z][1]>=1?1:0,he=a[z][2]>=1?1:0,Re=a[z][3]>=1?1:0;const _e=S-ve+u,dt=b-Ce+u,Bt=O-Pe+u,on=w-pe+u,an=S-Xe+2*u,ln=b-re+2*u,Pn=O-de+2*u,_n=w-Te+2*u,cn=S-ee+3*u,Gt=b-ue+3*u,kt=O-he+3*u,un=w-Re+3*u,wn=S-1+4*u,On=b-1+4*u,hn=O-1+4*u,Ut=w-1+4*u,Ht=v&255,Kt=m&255,yt=p&255,Jt=C&255,Tr=l[Ht+l[Kt+l[yt+l[Jt]]]]%32,vr=l[Ht+ve+l[Kt+Ce+l[yt+Pe+l[Jt+pe]]]]%32,Fn=l[Ht+Xe+l[Kt+re+l[yt+de+l[Jt+Te]]]]%32,E=l[Ht+ee+l[Kt+ue+l[yt+he+l[Jt+Re]]]]%32,_=l[Ht+1+l[Kt+1+l[yt+1+l[Jt+1]]]]%32;let D=.6-S*S-b*b-O*O-w*w;D<0?h=0:(D*=D,h=D*D*this.dot4(o[Tr],S,b,O,w));let K=.6-_e*_e-dt*dt-Bt*Bt-on*on;K<0?f=0:(K*=K,f=K*K*this.dot4(o[vr],_e,dt,Bt,on));let ie=.6-an*an-ln*ln-Pn*Pn-_n*_n;ie<0?T=0:(ie*=ie,T=ie*ie*this.dot4(o[Fn],an,ln,Pn,_n));let Se=.6-cn*cn-Gt*Gt-kt*kt-un*un;Se<0?g=0:(Se*=Se,g=Se*Se*this.dot4(o[E],cn,Gt,kt,un));let we=.6-wn*wn-On*On-hn*hn-Ut*Ut;return we<0?d=0:(we*=we,d=we*we*this.dot4(o[_],wn,On,hn,Ut)),27*(h+f+T+g+d)});for(let n=0;n<256;n++)this.p[n]=Math.floor(e.random()*256);for(let n=0;n<512;n++)this.perm[n]=this.p[n&255]}}const xe=class extends Mn{constructor(t={}){super(),this.isLightningStrike=!0,this.type="LightningStrike",this.init(xe.copyParameters(t,t)),this.createMesh()}static createRandomGenerator(){const e=[];for(let r=0;r<2053;r++)e.push(Math.random());const n={currentSeed:0,random:function(){const r=e[n.currentSeed];return n.currentSeed=(n.currentSeed+1)%2053,r},getSeed:function(){return n.currentSeed/2053},setSeed:function(r){n.currentSeed=Math.floor(r*2053)%2053}};return n}static copyParameters(t={},e={}){const n=function(r){return e===t?r:r.clone()};return t.sourceOffset=e.sourceOffset!==void 0?n(e.sourceOffset):new P(0,100,0),t.destOffset=e.destOffset!==void 0?n(e.destOffset):new P(0,0,0),t.timeScale=e.timeScale!==void 0?e.timeScale:1,t.roughness=e.roughness!==void 0?e.roughness:.9,t.straightness=e.straightness!==void 0?e.straightness:.7,t.up0=e.up0!==void 0?n(e.up0):new P(0,0,1),t.up1=e.up1!==void 0?n(e.up1):new P(0,0,1),t.radius0=e.radius0!==void 0?e.radius0:1,t.radius1=e.radius1!==void 0?e.radius1:1,t.radius0Factor=e.radius0Factor!==void 0?e.radius0Factor:.5,t.radius1Factor=e.radius1Factor!==void 0?e.radius1Factor:.2,t.minRadius=e.minRadius!==void 0?e.minRadius:.2,t.isEternal=e.isEternal!==void 0?e.isEternal:e.birthTime===void 0||e.deathTime===void 0,t.birthTime=e.birthTime,t.deathTime=e.deathTime,t.propagationTimeFactor=e.propagationTimeFactor!==void 0?e.propagationTimeFactor:.1,t.vanishingTimeFactor=e.vanishingTimeFactor!==void 0?e.vanishingTimeFactor:.9,t.subrayPeriod=e.subrayPeriod!==void 0?e.subrayPeriod:4,t.subrayDutyCycle=e.subrayDutyCycle!==void 0?e.subrayDutyCycle:.6,t.maxIterations=e.maxIterations!==void 0?e.maxIterations:9,t.isStatic=e.isStatic!==void 0?e.isStatic:!1,t.ramification=e.ramification!==void 0?e.ramification:5,t.maxSubrayRecursion=e.maxSubrayRecursion!==void 0?e.maxSubrayRecursion:3,t.recursionProbability=e.recursionProbability!==void 0?e.recursionProbability:.6,t.generateUVs=e.generateUVs!==void 0?e.generateUVs:!1,t.randomGenerator=e.randomGenerator,t.noiseSeed=e.noiseSeed,t.onDecideSubrayCreation=e.onDecideSubrayCreation,t.onSubrayCreation=e.onSubrayCreation,t}update(t){this.isStatic||(this.rayParameters.isEternal||this.rayParameters.birthTime<=t&&t<=this.rayParameters.deathTime?(this.updateMesh(t),t<this.subrays[0].endPropagationTime?this.state=xe.RAY_PROPAGATING:t>this.subrays[0].beginVanishingTime?this.state=xe.RAY_VANISHING:this.state=xe.RAY_STEADY,this.visible=!0):(this.visible=!1,t<this.rayParameters.birthTime?this.state=xe.RAY_UNBORN:this.state=xe.RAY_EXTINGUISHED))}init(t){this.rayParameters=t,this.maxIterations=t.maxIterations!==void 0?Math.floor(t.maxIterations):9,t.maxIterations=this.maxIterations,this.isStatic=t.isStatic!==void 0?t.isStatic:!1,t.isStatic=this.isStatic,this.ramification=t.ramification!==void 0?Math.floor(t.ramification):5,t.ramification=this.ramification,this.maxSubrayRecursion=t.maxSubrayRecursion!==void 0?Math.floor(t.maxSubrayRecursion):3,t.maxSubrayRecursion=this.maxSubrayRecursion,this.recursionProbability=t.recursionProbability!==void 0?t.recursionProbability:.6,t.recursionProbability=this.recursionProbability,this.generateUVs=t.generateUVs!==void 0?t.generateUVs:!1,t.generateUVs=this.generateUVs,t.randomGenerator!==void 0?(this.randomGenerator=t.randomGenerator,this.seedGenerator=t.randomGenerator,t.noiseSeed!==void 0&&this.seedGenerator.setSeed(t.noiseSeed)):(this.randomGenerator=xe.createRandomGenerator(),this.seedGenerator=Math),t.onDecideSubrayCreation!==void 0?this.onDecideSubrayCreation=t.onDecideSubrayCreation:(this.createDefaultSubrayCreationCallbacks(),t.onSubrayCreation!==void 0&&(this.onSubrayCreation=t.onSubrayCreation)),this.state=xe.RAY_INITIALIZED,this.maxSubrays=Math.ceil(1+Math.pow(this.ramification,Math.max(0,this.maxSubrayRecursion-1))),t.maxSubrays=this.maxSubrays,this.maxRaySegments=2*(1<<this.maxIterations),this.subrays=[];for(let e=0;e<this.maxSubrays;e++)this.subrays.push(this.createSubray());this.raySegments=[];for(let e=0;e<this.maxRaySegments;e++)this.raySegments.push(this.createSegment());this.time=0,this.timeFraction=0,this.currentSegmentCallback=null,this.currentCreateTriangleVertices=this.generateUVs?this.createTriangleVerticesWithUVs:this.createTriangleVerticesWithoutUVs,this.numSubrays=0,this.currentSubray=null,this.currentSegmentIndex=0,this.isInitialSegment=!1,this.subrayProbability=0,this.currentVertex=0,this.currentIndex=0,this.currentCoordinate=0,this.currentUVCoordinate=0,this.vertices=null,this.uvs=null,this.indices=null,this.positionAttribute=null,this.uvsAttribute=null,this.simplexX=new $n(this.seedGenerator),this.simplexY=new $n(this.seedGenerator),this.simplexZ=new $n(this.seedGenerator),this.forwards=new P,this.forwardsFill=new P,this.side=new P,this.down=new P,this.middlePos=new P,this.middleLinPos=new P,this.newPos=new P,this.vPos=new P,this.cross1=new P}createMesh(){const t=1<<this.maxIterations,e=3*(t+1)*this.maxSubrays,n=18*t*this.maxSubrays;this.vertices=new Float32Array(e*3),this.indices=new Uint32Array(n),this.generateUVs&&(this.uvs=new Float32Array(e*2)),this.fillMesh(0),this.setIndex(new jc(this.indices,1)),this.positionAttribute=new zn(this.vertices,3),this.setAttribute("position",this.positionAttribute),this.generateUVs&&(this.uvsAttribute=new zn(new Float32Array(this.uvs),2),this.setAttribute("uv",this.uvsAttribute)),this.isStatic||(this.index.usage=Pi,this.positionAttribute.usage=Pi,this.generateUVs&&(this.uvsAttribute.usage=Pi)),this.vertices=this.positionAttribute.array,this.indices=this.index.array,this.generateUVs&&(this.uvs=this.uvsAttribute.array)}updateMesh(t){this.fillMesh(t),this.drawRange.count=this.currentIndex,this.index.needsUpdate=!0,this.positionAttribute.needsUpdate=!0,this.generateUVs&&(this.uvsAttribute.needsUpdate=!0)}fillMesh(t){const e=this;this.currentVertex=0,this.currentIndex=0,this.currentCoordinate=0,this.currentUVCoordinate=0,this.fractalRay(t,function(r){const i=e.currentSubray;t<i.birthTime||(this.rayParameters.isEternal&&e.currentSubray.recursion==0?(e.createPrism(r),e.onDecideSubrayCreation(r,e)):t<i.endPropagationTime?e.timeFraction>=r.fraction0*i.propagationTimeFactor&&(e.createPrism(r),e.onDecideSubrayCreation(r,e)):t<i.beginVanishingTime?(e.createPrism(r),e.onDecideSubrayCreation(r,e)):(e.timeFraction<=i.vanishingTimeFactor+r.fraction1*(1-i.vanishingTimeFactor)&&e.createPrism(r),e.onDecideSubrayCreation(r,e)))})}addNewSubray(){return this.subrays[this.numSubrays++]}initSubray(t,e){t.pos0.copy(e.sourceOffset),t.pos1.copy(e.destOffset),t.up0.copy(e.up0),t.up1.copy(e.up1),t.radius0=e.radius0,t.radius1=e.radius1,t.birthTime=e.birthTime,t.deathTime=e.deathTime,t.timeScale=e.timeScale,t.roughness=e.roughness,t.straightness=e.straightness,t.propagationTimeFactor=e.propagationTimeFactor,t.vanishingTimeFactor=e.vanishingTimeFactor,t.maxIterations=this.maxIterations,t.seed=e.noiseSeed!==void 0?e.noiseSeed:0,t.recursion=0}fractalRay(t,e){this.time=t,this.currentSegmentCallback=e,this.numSubrays=0,this.initSubray(this.addNewSubray(),this.rayParameters);for(let n=0;n<this.numSubrays;n++){const r=this.subrays[n];this.currentSubray=r,this.randomGenerator.setSeed(r.seed),r.endPropagationTime=An.lerp(r.birthTime,r.deathTime,r.propagationTimeFactor),r.beginVanishingTime=An.lerp(r.deathTime,r.birthTime,1-r.vanishingTimeFactor);const i=this.randomGenerator.random;r.linPos0.set(i(),i(),i()).multiplyScalar(1e3),r.linPos1.set(i(),i(),i()).multiplyScalar(1e3),this.timeFraction=(t-r.birthTime)/(r.deathTime-r.birthTime),this.currentSegmentIndex=0,this.isInitialSegment=!0;const s=this.getNewSegment();s.iteration=0,s.pos0.copy(r.pos0),s.pos1.copy(r.pos1),s.linPos0.copy(r.linPos0),s.linPos1.copy(r.linPos1),s.up0.copy(r.up0),s.up1.copy(r.up1),s.radius0=r.radius0,s.radius1=r.radius1,s.fraction0=0,s.fraction1=1,s.positionVariationFactor=1-r.straightness,this.subrayProbability=this.ramification*Math.pow(this.recursionProbability,r.recursion)/(1<<r.maxIterations),this.fractalRayRecursive(s)}this.currentSegmentCallback=null,this.currentSubray=null}fractalRayRecursive(t){if(t.iteration>=this.currentSubray.maxIterations){this.currentSegmentCallback(t);return}this.forwards.subVectors(t.pos1,t.pos0);let e=this.forwards.length();e<1e-6&&(this.forwards.set(0,0,.01),e=this.forwards.length());const n=(t.radius0+t.radius1)*.5,r=(t.fraction0+t.fraction1)*.5,i=this.time*this.currentSubray.timeScale*Math.pow(2,t.iteration);this.middlePos.lerpVectors(t.pos0,t.pos1,.5),this.middleLinPos.lerpVectors(t.linPos0,t.linPos1,.5);const s=this.middleLinPos;this.newPos.set(this.simplexX.noise4d(s.x,s.y,s.z,i),this.simplexY.noise4d(s.x,s.y,s.z,i),this.simplexZ.noise4d(s.x,s.y,s.z,i)),this.newPos.multiplyScalar(t.positionVariationFactor*e),this.newPos.add(this.middlePos);const o=this.getNewSegment();o.pos0.copy(t.pos0),o.pos1.copy(this.newPos),o.linPos0.copy(t.linPos0),o.linPos1.copy(this.middleLinPos),o.up0.copy(t.up0),o.up1.copy(t.up1),o.radius0=t.radius0,o.radius1=n,o.fraction0=t.fraction0,o.fraction1=r,o.positionVariationFactor=t.positionVariationFactor*this.currentSubray.roughness,o.iteration=t.iteration+1;const a=this.getNewSegment();a.pos0.copy(this.newPos),a.pos1.copy(t.pos1),a.linPos0.copy(this.middleLinPos),a.linPos1.copy(t.linPos1),this.cross1.crossVectors(t.up0,this.forwards.normalize()),a.up0.crossVectors(this.forwards,this.cross1).normalize(),a.up1.copy(t.up1),a.radius0=n,a.radius1=t.radius1,a.fraction0=r,a.fraction1=t.fraction1,a.positionVariationFactor=t.positionVariationFactor*this.currentSubray.roughness,a.iteration=t.iteration+1,this.fractalRayRecursive(o),this.fractalRayRecursive(a)}createPrism(t){this.forwardsFill.subVectors(t.pos1,t.pos0).normalize(),this.isInitialSegment&&(this.currentCreateTriangleVertices(t.pos0,t.up0,this.forwardsFill,t.radius0,0),this.isInitialSegment=!1),this.currentCreateTriangleVertices(t.pos1,t.up0,this.forwardsFill,t.radius1,t.fraction1),this.createPrismFaces()}createTriangleVerticesWithoutUVs(t,e,n,r){this.side.crossVectors(e,n).multiplyScalar(r*xe.COS30DEG),this.down.copy(e).multiplyScalar(-r*xe.SIN30DEG);const i=this.vPos,s=this.vertices;i.copy(t).sub(this.side).add(this.down),s[this.currentCoordinate++]=i.x,s[this.currentCoordinate++]=i.y,s[this.currentCoordinate++]=i.z,i.copy(t).add(this.side).add(this.down),s[this.currentCoordinate++]=i.x,s[this.currentCoordinate++]=i.y,s[this.currentCoordinate++]=i.z,i.copy(e).multiplyScalar(r).add(t),s[this.currentCoordinate++]=i.x,s[this.currentCoordinate++]=i.y,s[this.currentCoordinate++]=i.z,this.currentVertex+=3}createTriangleVerticesWithUVs(t,e,n,r,i){this.side.crossVectors(e,n).multiplyScalar(r*xe.COS30DEG),this.down.copy(e).multiplyScalar(-r*xe.SIN30DEG);const s=this.vPos,o=this.vertices,a=this.uvs;s.copy(t).sub(this.side).add(this.down),o[this.currentCoordinate++]=s.x,o[this.currentCoordinate++]=s.y,o[this.currentCoordinate++]=s.z,a[this.currentUVCoordinate++]=i,a[this.currentUVCoordinate++]=0,s.copy(t).add(this.side).add(this.down),o[this.currentCoordinate++]=s.x,o[this.currentCoordinate++]=s.y,o[this.currentCoordinate++]=s.z,a[this.currentUVCoordinate++]=i,a[this.currentUVCoordinate++]=.5,s.copy(e).multiplyScalar(r).add(t),o[this.currentCoordinate++]=s.x,o[this.currentCoordinate++]=s.y,o[this.currentCoordinate++]=s.z,a[this.currentUVCoordinate++]=i,a[this.currentUVCoordinate++]=1,this.currentVertex+=3}createPrismFaces(t){const e=this.indices;t=this.currentVertex-6,e[this.currentIndex++]=t+1,e[this.currentIndex++]=t+2,e[this.currentIndex++]=t+5,e[this.currentIndex++]=t+1,e[this.currentIndex++]=t+5,e[this.currentIndex++]=t+4,e[this.currentIndex++]=t+0,e[this.currentIndex++]=t+1,e[this.currentIndex++]=t+4,e[this.currentIndex++]=t+0,e[this.currentIndex++]=t+4,e[this.currentIndex++]=t+3,e[this.currentIndex++]=t+2,e[this.currentIndex++]=t+0,e[this.currentIndex++]=t+3,e[this.currentIndex++]=t+2,e[this.currentIndex++]=t+3,e[this.currentIndex++]=t+5}createDefaultSubrayCreationCallbacks(){const t=this.randomGenerator.random;this.onDecideSubrayCreation=function(s,o){const a=o.currentSubray,l=o.rayParameters.subrayPeriod,c=o.rayParameters.subrayDutyCycle,u=o.rayParameters.isEternal&&a.recursion==0?-t()*l:An.lerp(a.birthTime,a.endPropagationTime,s.fraction0)-t()*l,h=o.time-u,f=Math.floor(h/l),T=t()*(f+1),g=h%l<=c*l;let d=0;if(g&&(d=o.subrayProbability),a.recursion<o.maxSubrayRecursion&&o.numSubrays<o.maxSubrays&&t()<d){const A=o.addNewSubray(),v=o.randomGenerator.getSeed();A.seed=T,o.randomGenerator.setSeed(T),A.recursion=a.recursion+1,A.maxIterations=Math.max(1,a.maxIterations-1),A.linPos0.set(t(),t(),t()).multiplyScalar(1e3),A.linPos1.set(t(),t(),t()).multiplyScalar(1e3),A.up0.copy(a.up0),A.up1.copy(a.up1),A.radius0=s.radius0*o.rayParameters.radius0Factor,A.radius1=Math.min(o.rayParameters.minRadius,s.radius1*o.rayParameters.radius1Factor),A.birthTime=u+f*l,A.deathTime=A.birthTime+l*c,!o.rayParameters.isEternal&&a.recursion==0&&(A.birthTime=Math.max(A.birthTime,a.birthTime),A.deathTime=Math.min(A.deathTime,a.deathTime)),A.timeScale=a.timeScale*2,A.roughness=a.roughness,A.straightness=a.straightness,A.propagationTimeFactor=a.propagationTimeFactor,A.vanishingTimeFactor=a.vanishingTimeFactor,o.onSubrayCreation(s,a,A,o),o.randomGenerator.setSeed(v)}};const e=new P,n=new P,r=new P,i=new P;this.onSubrayCreation=function(s,o,a,l){l.subrayCylinderPosition(s,o,a,.5,.6,.2)},this.subrayConePosition=function(s,o,a,l,c,u){a.pos0.copy(s.pos0),e.subVectors(o.pos1,o.pos0),n.copy(e).normalize(),e.multiplyScalar(s.fraction0+(1-s.fraction0)*(t()*l));const h=e.length();r.crossVectors(o.up0,n);const f=2*Math.PI*t();r.multiplyScalar(Math.cos(f)),i.copy(o.up0).multiplyScalar(Math.sin(f)),a.pos1.copy(r).add(i).multiplyScalar(h*c*(u+t()*(1-u))).add(e).add(o.pos0)},this.subrayCylinderPosition=function(s,o,a,l,c,u){a.pos0.copy(s.pos0),e.subVectors(o.pos1,o.pos0),n.copy(e).normalize(),e.multiplyScalar(s.fraction0+(1-s.fraction0)*((2*t()-1)*l));const h=e.length();r.crossVectors(o.up0,n);const f=2*Math.PI*t();r.multiplyScalar(Math.cos(f)),i.copy(o.up0).multiplyScalar(Math.sin(f)),a.pos1.copy(r).add(i).multiplyScalar(h*c*(u+t()*(1-u))).add(e).add(o.pos0)}}createSubray(){return{seed:0,maxIterations:0,recursion:0,pos0:new P,pos1:new P,linPos0:new P,linPos1:new P,up0:new P,up1:new P,radius0:0,radius1:0,birthTime:0,deathTime:0,timeScale:0,roughness:0,straightness:0,propagationTimeFactor:0,vanishingTimeFactor:0,endPropagationTime:0,beginVanishingTime:0}}createSegment(){return{iteration:0,pos0:new P,pos1:new P,linPos0:new P,linPos1:new P,up0:new P,up1:new P,radius0:0,radius1:0,fraction0:0,fraction1:0,positionVariationFactor:0}}getNewSegment(){return this.raySegments[this.currentSegmentIndex++]}copy(t){return super.copy(t),this.init(xe.copyParameters({},t.rayParameters)),this}clone(){return new this.constructor(xe.copyParameters({},this.rayParameters))}};let Dt=xe;M(Dt,"RAY_INITIALIZED",0);M(Dt,"RAY_UNBORN",1);M(Dt,"RAY_PROPAGATING",2);M(Dt,"RAY_STEADY",3);M(Dt,"RAY_VANISHING",4);M(Dt,"RAY_EXTINGUISHED",5);M(Dt,"COS30DEG",Math.cos(30*Math.PI/180));M(Dt,"SIN30DEG",Math.sin(30*Math.PI/180));const Wt=class extends He{constructor(t,e={}){super(t),this.isReflectorForSSRPass=!0,this.type="ReflectorForSSRPass";const n=this,r=e.color!==void 0?new q(e.color):new q(8355711),i=e.textureWidth||512,s=e.textureHeight||512,o=e.clipBias||0,a=e.shader||Wt.ReflectorShader,l=e.useDepthTexture===!0,c=new P(0,1,0),u=new P,h=new P;n.needsUpdate=!1,n.maxDistance=Wt.ReflectorShader.uniforms.maxDistance.value,n.opacity=Wt.ReflectorShader.uniforms.opacity.value,n.color=r,n.resolution=e.resolution||new H(window.innerWidth,window.innerHeight),n._distanceAttenuation=Wt.ReflectorShader.defines.DISTANCE_ATTENUATION,Object.defineProperty(n,"distanceAttenuation",{get(){return n._distanceAttenuation},set(b){n._distanceAttenuation!==b&&(n._distanceAttenuation=b,n.material.defines.DISTANCE_ATTENUATION=b,n.material.needsUpdate=!0)}}),n._fresnel=Wt.ReflectorShader.defines.FRESNEL,Object.defineProperty(n,"fresnel",{get(){return n._fresnel},set(b){n._fresnel!==b&&(n._fresnel=b,n.material.defines.FRESNEL=b,n.material.needsUpdate=!0)}});const f=new P,T=new P,g=new P,d=new oe,A=new P(0,0,-1),v=new P,m=new P,p=new oe,C=new bt;let R;l&&(R=new ii,R.type=vs,R.minFilter=ne,R.magFilter=ne);const y={depthTexture:l?R:null,type:Me},B=new Be(i,s,y),x=new se({transparent:l,defines:Object.assign({},Wt.ReflectorShader.defines,{useDepthTexture:l}),uniforms:fe.clone(a.uniforms),fragmentShader:a.fragmentShader,vertexShader:a.vertexShader});x.uniforms.tDiffuse.value=B.texture,x.uniforms.color.value=n.color,x.uniforms.textureMatrix.value=p,l&&(x.uniforms.tDepth.value=B.depthTexture),this.material=x;const S=[new tr(new P(0,1,0),o)];this.doRender=function(b,O,w){if(x.uniforms.maxDistance.value=n.maxDistance,x.uniforms.color.value=n.color,x.uniforms.opacity.value=n.opacity,u.copy(w.position).normalize(),h.copy(u).reflect(c),x.uniforms.fresnelCoe.value=(u.dot(h)+1)/2,T.setFromMatrixPosition(n.matrixWorld),g.setFromMatrixPosition(w.matrixWorld),d.extractRotation(n.matrixWorld),f.set(0,0,1),f.applyMatrix4(d),v.subVectors(T,g),v.dot(f)>0)return;v.reflect(f).negate(),v.add(T),d.extractRotation(w.matrixWorld),A.set(0,0,-1),A.applyMatrix4(d),A.add(g),m.subVectors(T,A),m.reflect(f).negate(),m.add(T),C.position.copy(v),C.up.set(0,1,0),C.up.applyMatrix4(d),C.up.reflect(f),C.lookAt(m),C.far=w.far,C.updateMatrixWorld(),C.projectionMatrix.copy(w.projectionMatrix),x.uniforms.virtualCameraNear.value=w.near,x.uniforms.virtualCameraFar.value=w.far,x.uniforms.virtualCameraMatrixWorld.value=C.matrixWorld,x.uniforms.virtualCameraProjectionMatrix.value=w.projectionMatrix,x.uniforms.virtualCameraProjectionMatrixInverse.value=w.projectionMatrixInverse,x.uniforms.resolution.value=n.resolution,p.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),p.multiply(C.projectionMatrix),p.multiply(C.matrixWorldInverse),p.multiply(n.matrixWorld);const k=b.getRenderTarget(),U=b.xr.enabled,j=b.shadowMap.autoUpdate,V=b.clippingPlanes;b.xr.enabled=!1,b.shadowMap.autoUpdate=!1,b.clippingPlanes=S,b.setRenderTarget(B),b.state.buffers.depth.setMask(!0),b.autoClear===!1&&b.clear(),b.render(O,C),b.xr.enabled=U,b.shadowMap.autoUpdate=j,b.clippingPlanes=V,b.setRenderTarget(k);const X=w.viewport;X!==void 0&&b.state.viewport(X)},this.getRenderTarget=function(){return B}}};let cu=Wt;M(cu,"ReflectorShader",{defines:{DISTANCE_ATTENUATION:!0,FRESNEL:!0},uniforms:{color:{value:null},tDiffuse:{value:null},tDepth:{value:null},textureMatrix:{value:new oe},maxDistance:{value:180},opacity:{value:.5},fresnelCoe:{value:null},virtualCameraNear:{value:null},virtualCameraFar:{value:null},virtualCameraProjectionMatrix:{value:new oe},virtualCameraMatrixWorld:{value:new oe},virtualCameraProjectionMatrixInverse:{value:new oe},resolution:{value:new H}},vertexShader:`
		uniform mat4 textureMatrix;
		varying vec4 vUv;

		void main() {

			vUv = textureMatrix * vec4( position, 1.0 );

			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`
		uniform vec3 color;
		uniform sampler2D tDiffuse;
		uniform sampler2D tDepth;
		uniform float maxDistance;
		uniform float opacity;
		uniform float fresnelCoe;
		uniform float virtualCameraNear;
		uniform float virtualCameraFar;
		uniform mat4 virtualCameraProjectionMatrix;
		uniform mat4 virtualCameraProjectionMatrixInverse;
		uniform mat4 virtualCameraMatrixWorld;
		uniform vec2 resolution;
		varying vec4 vUv;
		#include <packing>
		float blendOverlay( float base, float blend ) {
			return( base < 0.5 ? ( 2.0 * base * blend ) : ( 1.0 - 2.0 * ( 1.0 - base ) * ( 1.0 - blend ) ) );
		}
		vec3 blendOverlay( vec3 base, vec3 blend ) {
			return vec3( blendOverlay( base.r, blend.r ), blendOverlay( base.g, blend.g ), blendOverlay( base.b, blend.b ) );
		}
		float getDepth( const in vec2 uv ) {
			return texture2D( tDepth, uv ).x;
		}
		float getViewZ( const in float depth ) {
			return perspectiveDepthToViewZ( depth, virtualCameraNear, virtualCameraFar );
		}
		vec3 getViewPosition( const in vec2 uv, const in float depth/*clip space*/, const in float clipW ) {
			vec4 clipPosition = vec4( ( vec3( uv, depth ) - 0.5 ) * 2.0, 1.0 );//ndc
			clipPosition *= clipW; //clip
			return ( virtualCameraProjectionMatrixInverse * clipPosition ).xyz;//view
		}
		void main() {
			vec4 base = texture2DProj( tDiffuse, vUv );
			#ifdef useDepthTexture
				vec2 uv=(gl_FragCoord.xy-.5)/resolution.xy;
				uv.x=1.-uv.x;
				float depth = texture2DProj( tDepth, vUv ).r;
				float viewZ = getViewZ( depth );
				float clipW = virtualCameraProjectionMatrix[2][3] * viewZ+virtualCameraProjectionMatrix[3][3];
				vec3 viewPosition=getViewPosition( uv, depth, clipW );
				vec3 worldPosition=(virtualCameraMatrixWorld*vec4(viewPosition,1)).xyz;
				if(worldPosition.y>maxDistance) discard;
				float op=opacity;
				#ifdef DISTANCE_ATTENUATION
					float ratio=1.-(worldPosition.y/maxDistance);
					float attenuation=ratio*ratio;
					op=opacity*attenuation;
				#endif
				#ifdef FRESNEL
					op*=fresnelCoe;
				#endif
				gl_FragColor = vec4( blendOverlay( base.rgb, color ), op );
			#else
				gl_FragColor = vec4( blendOverlay( base.rgb, color ), 1.0 );
			#endif
		}
	`});const Fr={uniforms:{turbidity:{value:2},rayleigh:{value:1},mieCoefficient:{value:.005},mieDirectionalG:{value:.8},sunPosition:{value:new P},up:{value:new P(0,1,0)}},vertexShader:`
      uniform vec3 sunPosition;
      uniform float rayleigh;
      uniform float turbidity;
      uniform float mieCoefficient;
      uniform vec3 up;

      varying vec3 vWorldPosition;
      varying vec3 vSunDirection;
      varying float vSunfade;
      varying vec3 vBetaR;
      varying vec3 vBetaM;
      varying float vSunE;

      // constants for atmospheric scattering
      const float e = 2.71828182845904523536028747135266249775724709369995957;
      const float pi = 3.141592653589793238462643383279502884197169;

      // wavelength of used primaries, according to preetham
      const vec3 lambda = vec3( 680E-9, 550E-9, 450E-9 );
      // this pre-calcuation replaces older TotalRayleigh(vec3 lambda) function:
      // (8.0 * pow(pi, 3.0) * pow(pow(n, 2.0) - 1.0, 2.0) * (6.0 + 3.0 * pn)) / (3.0 * N * pow(lambda, vec3(4.0)) * (6.0 - 7.0 * pn))
      const vec3 totalRayleigh = vec3( 5.804542996261093E-6, 1.3562911419845635E-5, 3.0265902468824876E-5 );

      // mie stuff
      // K coefficient for the primaries
      const float v = 4.0;
      const vec3 K = vec3( 0.686, 0.678, 0.666 );
      // MieConst = pi * pow( ( 2.0 * pi ) / lambda, vec3( v - 2.0 ) ) * K
      const vec3 MieConst = vec3( 1.8399918514433978E14, 2.7798023919660528E14, 4.0790479543861094E14 );

      // earth shadow hack
      // cutoffAngle = pi / 1.95;
      const float cutoffAngle = 1.6110731556870734;
      const float steepness = 1.5;
      const float EE = 1000.0;

      float sunIntensity( float zenithAngleCos ) {
        zenithAngleCos = clamp( zenithAngleCos, -1.0, 1.0 );
        return EE * max( 0.0, 1.0 - pow( e, -( ( cutoffAngle - acos( zenithAngleCos ) ) / steepness ) ) );
      }

      vec3 totalMie( float T ) {
        float c = ( 0.2 * T ) * 10E-18;
        return 0.434 * c * MieConst;
      }

      void main() {

        vec4 worldPosition = modelMatrix * vec4( position, 1.0 );
        vWorldPosition = worldPosition.xyz;

        gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
        gl_Position.z = gl_Position.w; // set z to camera.far

        vSunDirection = normalize( sunPosition );

        vSunE = sunIntensity( dot( vSunDirection, up ) );

        vSunfade = 1.0 - clamp( 1.0 - exp( ( sunPosition.y / 450000.0 ) ), 0.0, 1.0 );

        float rayleighCoefficient = rayleigh - ( 1.0 * ( 1.0 - vSunfade ) );

      // extinction (absorbtion + out scattering)
      // rayleigh coefficients
        vBetaR = totalRayleigh * rayleighCoefficient;

      // mie coefficients
        vBetaM = totalMie( turbidity ) * mieCoefficient;

      }
    `,fragmentShader:`
      varying vec3 vWorldPosition;
      varying vec3 vSunDirection;
      varying float vSunfade;
      varying vec3 vBetaR;
      varying vec3 vBetaM;
      varying float vSunE;

      uniform float mieDirectionalG;
      uniform vec3 up;

      const vec3 cameraPos = vec3( 0.0, 0.0, 0.0 );

      // constants for atmospheric scattering
      const float pi = 3.141592653589793238462643383279502884197169;

      const float n = 1.0003; // refractive index of air
      const float N = 2.545E25; // number of molecules per unit volume for air at 288.15K and 1013mb (sea level -45 celsius)

      // optical length at zenith for molecules
      const float rayleighZenithLength = 8.4E3;
      const float mieZenithLength = 1.25E3;
      // 66 arc seconds -> degrees, and the cosine of that
      const float sunAngularDiameterCos = 0.999956676946448443553574619906976478926848692873900859324;

      // 3.0 / ( 16.0 * pi )
      const float THREE_OVER_SIXTEENPI = 0.05968310365946075;
      // 1.0 / ( 4.0 * pi )
      const float ONE_OVER_FOURPI = 0.07957747154594767;

      float rayleighPhase( float cosTheta ) {
        return THREE_OVER_SIXTEENPI * ( 1.0 + pow( cosTheta, 2.0 ) );
      }

      float hgPhase( float cosTheta, float g ) {
        float g2 = pow( g, 2.0 );
        float inverse = 1.0 / pow( 1.0 - 2.0 * g * cosTheta + g2, 1.5 );
        return ONE_OVER_FOURPI * ( ( 1.0 - g2 ) * inverse );
      }

      void main() {

        vec3 direction = normalize( vWorldPosition - cameraPos );

      // optical length
      // cutoff angle at 90 to avoid singularity in next formula.
        float zenithAngle = acos( max( 0.0, dot( up, direction ) ) );
        float inverse = 1.0 / ( cos( zenithAngle ) + 0.15 * pow( 93.885 - ( ( zenithAngle * 180.0 ) / pi ), -1.253 ) );
        float sR = rayleighZenithLength * inverse;
        float sM = mieZenithLength * inverse;

      // combined extinction factor
        vec3 Fex = exp( -( vBetaR * sR + vBetaM * sM ) );

      // in scattering
        float cosTheta = dot( direction, vSunDirection );

        float rPhase = rayleighPhase( cosTheta * 0.5 + 0.5 );
        vec3 betaRTheta = vBetaR * rPhase;

        float mPhase = hgPhase( cosTheta, mieDirectionalG );
        vec3 betaMTheta = vBetaM * mPhase;

        vec3 Lin = pow( vSunE * ( ( betaRTheta + betaMTheta ) / ( vBetaR + vBetaM ) ) * ( 1.0 - Fex ), vec3( 1.5 ) );
        Lin *= mix( vec3( 1.0 ), pow( vSunE * ( ( betaRTheta + betaMTheta ) / ( vBetaR + vBetaM ) ) * Fex, vec3( 1.0 / 2.0 ) ), clamp( pow( 1.0 - dot( up, vSunDirection ), 5.0 ), 0.0, 1.0 ) );

      // nightsky
        float theta = acos( direction.y ); // elevation --> y-axis, [-pi/2, pi/2]
        float phi = atan( direction.z, direction.x ); // azimuth --> x-axis [-pi/2, pi/2]
        vec2 uv = vec2( phi, theta ) / vec2( 2.0 * pi, pi ) + vec2( 0.5, 0.0 );
        vec3 L0 = vec3( 0.1 ) * Fex;

      // composition + solar disc
        float sundisk = smoothstep( sunAngularDiameterCos, sunAngularDiameterCos + 0.00002, cosTheta );
        L0 += ( vSunE * 19000.0 * Fex ) * sundisk;

        vec3 texColor = ( Lin + L0 ) * 0.04 + vec3( 0.0, 0.0003, 0.00075 );

        vec3 retColor = pow( texColor, vec3( 1.0 / ( 1.2 + ( 1.2 * vSunfade ) ) ) );

        gl_FragColor = vec4( retColor, 1.0 );

      #include <tonemapping_fragment>
      #include <${parseInt(or.replace(/\D+/g,""))>=154?"colorspace_fragment":"encodings_fragment"}>

      }
    `},Ja=new se({name:"SkyShader",fragmentShader:Fr.fragmentShader,vertexShader:Fr.vertexShader,uniforms:fe.clone(Fr.uniforms),side:Ic,depthWrite:!1});class ja extends He{constructor(){super(new bc(1,1,1),Ja)}}M(ja,"SkyShader",Fr);M(ja,"material",Ja);const Wa=class extends He{constructor(t,e={}){super(t),this.isWater=!0,this.type="Water";const n=this,r=e.color!==void 0?new q(e.color):new q(16777215),i=e.textureWidth||512,s=e.textureHeight||512,o=e.clipBias||0,a=e.flowDirection||new H(1,0),l=e.flowSpeed||.03,c=e.reflectivity||.02,u=e.scale||1,h=e.shader||Wa.WaterShader,f=e.encoding!==void 0?e.encoding:3e3,T=e.flowMap||void 0,g=e.normalMap0,d=e.normalMap1,A=.15,v=A*.5,m=new oe,p=new Zc;if(qi===void 0){console.error("THREE.Water: Required component Reflector not found.");return}if(es===void 0){console.error("THREE.Water: Required component Refractor not found.");return}const C=new qi(t,{textureWidth:i,textureHeight:s,clipBias:o,encoding:f}),R=new es(t,{textureWidth:i,textureHeight:s,clipBias:o,encoding:f});C.matrixAutoUpdate=!1,R.matrixAutoUpdate=!1,this.material=new se({uniforms:fe.merge([Wc.fog,h.uniforms]),vertexShader:h.vertexShader,fragmentShader:h.fragmentShader,transparent:!0,fog:!0}),T!==void 0?(this.material.defines.USE_FLOWMAP="",this.material.uniforms.tFlowMap={type:"t",value:T}):this.material.uniforms.flowDirection={type:"v2",value:a},g.wrapS=g.wrapT=Zt,d.wrapS=d.wrapT=Zt,this.material.uniforms.tReflectionMap.value=C.getRenderTarget().texture,this.material.uniforms.tRefractionMap.value=R.getRenderTarget().texture,this.material.uniforms.tNormalMap0.value=g,this.material.uniforms.tNormalMap1.value=d,this.material.uniforms.color.value=r,this.material.uniforms.reflectivity.value=c,this.material.uniforms.textureMatrix.value=m,this.material.uniforms.config.value.x=0,this.material.uniforms.config.value.y=v,this.material.uniforms.config.value.z=v,this.material.uniforms.config.value.w=u;function y(x){m.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),m.multiply(x.projectionMatrix),m.multiply(x.matrixWorldInverse),m.multiply(n.matrixWorld)}function B(){const x=p.getDelta(),I=n.material.uniforms.config;I.value.x+=l*x,I.value.y=I.value.x+v,I.value.x>=A?(I.value.x=0,I.value.y=v):I.value.y>=A&&(I.value.y=I.value.y-A)}this.onBeforeRender=function(x,I,S){y(S),B(),n.visible=!1,C.matrixWorld.copy(n.matrixWorld),R.matrixWorld.copy(n.matrixWorld),C.onBeforeRender(x,I,S),R.onBeforeRender(x,I,S),n.visible=!0}}};let uu=Wa;M(uu,"WaterShader",{uniforms:{color:{value:null},reflectivity:{value:0},tReflectionMap:{value:null},tRefractionMap:{value:null},tNormalMap0:{value:null},tNormalMap1:{value:null},textureMatrix:{value:null},config:{value:new vn}},vertexShader:`

		#include <common>
		#include <fog_pars_vertex>
		#include <logdepthbuf_pars_vertex>

		uniform mat4 textureMatrix;

		varying vec4 vCoord;
		varying vec2 vUv;
		varying vec3 vToEye;

		void main() {

			vUv = uv;
			vCoord = textureMatrix * vec4( position, 1.0 );

			vec4 worldPosition = modelMatrix * vec4( position, 1.0 );
			vToEye = cameraPosition - worldPosition.xyz;

			vec4 mvPosition =  viewMatrix * worldPosition; // used in fog_vertex
			gl_Position = projectionMatrix * mvPosition;

			#include <logdepthbuf_vertex>
			#include <fog_vertex>

		}`,fragmentShader:`

		#include <common>
		#include <fog_pars_fragment>
		#include <logdepthbuf_pars_fragment>

		uniform sampler2D tReflectionMap;
		uniform sampler2D tRefractionMap;
		uniform sampler2D tNormalMap0;
		uniform sampler2D tNormalMap1;

		#ifdef USE_FLOWMAP
			uniform sampler2D tFlowMap;
		#else
			uniform vec2 flowDirection;
		#endif

		uniform vec3 color;
		uniform float reflectivity;
		uniform vec4 config;

		varying vec4 vCoord;
		varying vec2 vUv;
		varying vec3 vToEye;

		void main() {

			#include <logdepthbuf_fragment>

			float flowMapOffset0 = config.x;
			float flowMapOffset1 = config.y;
			float halfCycle = config.z;
			float scale = config.w;

			vec3 toEye = normalize( vToEye );

			// determine flow direction
			vec2 flow;
			#ifdef USE_FLOWMAP
				flow = texture2D( tFlowMap, vUv ).rg * 2.0 - 1.0;
			#else
				flow = flowDirection;
			#endif
			flow.x *= - 1.0;

			// sample normal maps (distort uvs with flowdata)
			vec4 normalColor0 = texture2D( tNormalMap0, ( vUv * scale ) + flow * flowMapOffset0 );
			vec4 normalColor1 = texture2D( tNormalMap1, ( vUv * scale ) + flow * flowMapOffset1 );

			// linear interpolate to get the final normal color
			float flowLerp = abs( halfCycle - flowMapOffset0 ) / halfCycle;
			vec4 normalColor = mix( normalColor0, normalColor1, flowLerp );

			// calculate normal vector
			vec3 normal = normalize( vec3( normalColor.r * 2.0 - 1.0, normalColor.b,  normalColor.g * 2.0 - 1.0 ) );

			// calculate the fresnel term to blend reflection and refraction maps
			float theta = max( dot( toEye, normal ), 0.0 );
			float reflectance = reflectivity + ( 1.0 - reflectivity ) * pow( ( 1.0 - theta ), 5.0 );

			// calculate final uv coords
			vec3 coord = vCoord.xyz / vCoord.w;
			vec2 uv = coord.xy + coord.z * normal.xz * 0.05;

			vec4 reflectColor = texture2D( tReflectionMap, vec2( 1.0 - uv.x, uv.y ) );
			vec4 refractColor = texture2D( tRefractionMap, uv );

			// multiply water color with the mix of both textures
			gl_FragColor = vec4( color, 1.0 ) * mix( refractColor, reflectColor, reflectance );

			#include <tonemapping_fragment>
			#include <${parseInt(or.replace(/\D+/g,""))>=154?"colorspace_fragment":"encodings_fragment"}>
			#include <fog_fragment>

		}`});const wi={uniforms:{tDiffuse:{value:null},opacity:{value:1}},vertexShader:["varying vec2 vUv;","void main() {","	vUv = uv;","	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join(`
`),fragmentShader:["uniform float opacity;","uniform sampler2D tDiffuse;","varying vec2 vUv;","#include <packing>","void main() {","	float depth = 1.0 - unpackRGBAToDepth( texture2D( tDiffuse, vUv ) );","	gl_FragColor = vec4( vec3( depth ), opacity );","}"].join(`
`)},Br=new lc,eo=new tr,hu=Math.cos(70*An.DEG2RAD),to=(t,e)=>(t%e+e)%e;class Nv extends ac{constructor(e,n){super(),M(this,"object"),M(this,"domElement"),M(this,"enabled",!0),M(this,"target",new P),M(this,"minDistance",0),M(this,"maxDistance",1/0),M(this,"minZoom",0),M(this,"maxZoom",1/0),M(this,"minPolarAngle",0),M(this,"maxPolarAngle",Math.PI),M(this,"minAzimuthAngle",-1/0),M(this,"maxAzimuthAngle",1/0),M(this,"enableDamping",!1),M(this,"dampingFactor",.05),M(this,"enableZoom",!0),M(this,"zoomSpeed",1),M(this,"enableRotate",!0),M(this,"rotateSpeed",1),M(this,"enablePan",!0),M(this,"panSpeed",1),M(this,"screenSpacePanning",!0),M(this,"keyPanSpeed",7),M(this,"zoomToCursor",!1),M(this,"autoRotate",!1),M(this,"autoRotateSpeed",2),M(this,"reverseOrbit",!1),M(this,"reverseHorizontalOrbit",!1),M(this,"reverseVerticalOrbit",!1),M(this,"keys",{LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"}),M(this,"mouseButtons",{LEFT:fn.ROTATE,MIDDLE:fn.DOLLY,RIGHT:fn.PAN}),M(this,"touches",{ONE:dn.ROTATE,TWO:dn.DOLLY_PAN}),M(this,"target0"),M(this,"position0"),M(this,"zoom0"),M(this,"_domElementKeyEvents",null),M(this,"getPolarAngle"),M(this,"getAzimuthalAngle"),M(this,"setPolarAngle"),M(this,"setAzimuthalAngle"),M(this,"getDistance"),M(this,"listenToKeyEvents"),M(this,"stopListenToKeyEvents"),M(this,"saveState"),M(this,"reset"),M(this,"update"),M(this,"connect"),M(this,"dispose"),this.object=e,this.domElement=n,this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this.getPolarAngle=()=>u.phi,this.getAzimuthalAngle=()=>u.theta,this.setPolarAngle=E=>{let _=to(E,2*Math.PI),D=u.phi;D<0&&(D+=2*Math.PI),_<0&&(_+=2*Math.PI);let K=Math.abs(_-D);2*Math.PI-K<K&&(_<D?_+=2*Math.PI:D+=2*Math.PI),h.phi=_-D,r.update()},this.setAzimuthalAngle=E=>{let _=to(E,2*Math.PI),D=u.theta;D<0&&(D+=2*Math.PI),_<0&&(_+=2*Math.PI);let K=Math.abs(_-D);2*Math.PI-K<K&&(_<D?_+=2*Math.PI:D+=2*Math.PI),h.theta=_-D,r.update()},this.getDistance=()=>r.object.position.distanceTo(r.target),this.listenToKeyEvents=E=>{E.addEventListener("keydown",Ut),this._domElementKeyEvents=E},this.stopListenToKeyEvents=()=>{this._domElementKeyEvents.removeEventListener("keydown",Ut),this._domElementKeyEvents=null},this.saveState=()=>{r.target0.copy(r.target),r.position0.copy(r.object.position),r.zoom0=r.object.zoom},this.reset=()=>{r.target.copy(r.target0),r.object.position.copy(r.position0),r.object.zoom=r.zoom0,r.object.updateProjectionMatrix(),r.dispatchEvent(i),r.update(),l=a.NONE},this.update=(()=>{const E=new P,_=new P(0,1,0),D=new er().setFromUnitVectors(e.up,_),K=D.clone().invert(),ie=new P,Se=new er,we=2*Math.PI;return function(){const Xs=r.object.position;D.setFromUnitVectors(e.up,_),K.copy(D).invert(),E.copy(Xs).sub(r.target),E.applyQuaternion(D),u.setFromVector3(E),r.autoRotate&&l===a.NONE&&k(O()),r.enableDamping?(u.theta+=h.theta*r.dampingFactor,u.phi+=h.phi*r.dampingFactor):(u.theta+=h.theta,u.phi+=h.phi);let pt=r.minAzimuthAngle,mt=r.maxAzimuthAngle;isFinite(pt)&&isFinite(mt)&&(pt<-Math.PI?pt+=we:pt>Math.PI&&(pt-=we),mt<-Math.PI?mt+=we:mt>Math.PI&&(mt-=we),pt<=mt?u.theta=Math.max(pt,Math.min(mt,u.theta)):u.theta=u.theta>(pt+mt)/2?Math.max(pt,u.theta):Math.min(mt,u.theta)),u.phi=Math.max(r.minPolarAngle,Math.min(r.maxPolarAngle,u.phi)),u.makeSafe(),r.enableDamping===!0?r.target.addScaledVector(T,r.dampingFactor):r.target.add(T),r.zoomToCursor&&I||r.object.isOrthographicCamera?u.radius=Ce(u.radius):u.radius=Ce(u.radius*f),E.setFromSpherical(u),E.applyQuaternion(K),Xs.copy(r.target).add(E),r.object.lookAt(r.target),r.enableDamping===!0?(h.theta*=1-r.dampingFactor,h.phi*=1-r.dampingFactor,T.multiplyScalar(1-r.dampingFactor)):(h.set(0,0,0),T.set(0,0,0));let Cr=!1;if(r.zoomToCursor&&I){let Dn=null;if(r.object instanceof bt&&r.object.isPerspectiveCamera){const Nn=E.length();Dn=Ce(Nn*f);const Er=Nn-Dn;r.object.position.addScaledVector(B,Er),r.object.updateMatrixWorld()}else if(r.object.isOrthographicCamera){const Nn=new P(x.x,x.y,0);Nn.unproject(r.object),r.object.zoom=Math.max(r.minZoom,Math.min(r.maxZoom,r.object.zoom/f)),r.object.updateProjectionMatrix(),Cr=!0;const Er=new P(x.x,x.y,0);Er.unproject(r.object),r.object.position.sub(Er).add(Nn),r.object.updateMatrixWorld(),Dn=E.length()}else console.warn("WARNING: OrbitControls.js encountered an unknown camera type - zoom to cursor disabled."),r.zoomToCursor=!1;Dn!==null&&(r.screenSpacePanning?r.target.set(0,0,-1).transformDirection(r.object.matrix).multiplyScalar(Dn).add(r.object.position):(Br.origin.copy(r.object.position),Br.direction.set(0,0,-1).transformDirection(r.object.matrix),Math.abs(r.object.up.dot(Br.direction))<hu?e.lookAt(r.target):(eo.setFromNormalAndCoplanarPoint(r.object.up,r.target),Br.intersectPlane(eo,r.target))))}else r.object instanceof mn&&r.object.isOrthographicCamera&&(r.object.zoom=Math.max(r.minZoom,Math.min(r.maxZoom,r.object.zoom/f)),r.object.updateProjectionMatrix(),Cr=!0);return f=1,I=!1,Cr||ie.distanceToSquared(r.object.position)>c||8*(1-Se.dot(r.object.quaternion))>c?(r.dispatchEvent(i),ie.copy(r.object.position),Se.copy(r.object.quaternion),Cr=!1,!0):!1}})(),this.connect=E=>{E===document&&console.error('THREE.OrbitControls: "document" should not be used as the target "domElement". Please use "renderer.domElement" instead.'),r.domElement=E,r.domElement.style.touchAction="none",r.domElement.addEventListener("contextmenu",yt),r.domElement.addEventListener("pointerdown",cn),r.domElement.addEventListener("pointercancel",un),r.domElement.addEventListener("wheel",hn)},this.dispose=()=>{var E,_,D,K,ie,Se;(E=r.domElement)==null||E.removeEventListener("contextmenu",yt),(_=r.domElement)==null||_.removeEventListener("pointerdown",cn),(D=r.domElement)==null||D.removeEventListener("pointercancel",un),(K=r.domElement)==null||K.removeEventListener("wheel",hn),(ie=r.domElement)==null||ie.ownerDocument.removeEventListener("pointermove",Gt),(Se=r.domElement)==null||Se.ownerDocument.removeEventListener("pointerup",kt),r._domElementKeyEvents!==null&&r._domElementKeyEvents.removeEventListener("keydown",Ut)};const r=this,i={type:"change"},s={type:"start"},o={type:"end"},a={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6};let l=a.NONE;const c=1e-6,u=new Qs,h=new Qs;let f=1;const T=new P,g=new H,d=new H,A=new H,v=new H,m=new H,p=new H,C=new H,R=new H,y=new H,B=new P,x=new H;let I=!1;const S=[],b={};function O(){return 2*Math.PI/60/60*r.autoRotateSpeed}function w(){return Math.pow(.95,r.zoomSpeed)}function k(E){r.reverseOrbit||r.reverseHorizontalOrbit?h.theta+=E:h.theta-=E}function U(E){r.reverseOrbit||r.reverseVerticalOrbit?h.phi+=E:h.phi-=E}const j=(()=>{const E=new P;return function(D,K){E.setFromMatrixColumn(K,0),E.multiplyScalar(-D),T.add(E)}})(),V=(()=>{const E=new P;return function(D,K){r.screenSpacePanning===!0?E.setFromMatrixColumn(K,1):(E.setFromMatrixColumn(K,0),E.crossVectors(r.object.up,E)),E.multiplyScalar(D),T.add(E)}})(),X=(()=>{const E=new P;return function(D,K){const ie=r.domElement;if(ie&&r.object instanceof bt&&r.object.isPerspectiveCamera){const Se=r.object.position;E.copy(Se).sub(r.target);let we=E.length();we*=Math.tan(r.object.fov/2*Math.PI/180),j(2*D*we/ie.clientHeight,r.object.matrix),V(2*K*we/ie.clientHeight,r.object.matrix)}else ie&&r.object instanceof mn&&r.object.isOrthographicCamera?(j(D*(r.object.right-r.object.left)/r.object.zoom/ie.clientWidth,r.object.matrix),V(K*(r.object.top-r.object.bottom)/r.object.zoom/ie.clientHeight,r.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),r.enablePan=!1)}})();function Q(E){r.object instanceof bt&&r.object.isPerspectiveCamera||r.object instanceof mn&&r.object.isOrthographicCamera?f/=E:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),r.enableZoom=!1)}function z(E){r.object instanceof bt&&r.object.isPerspectiveCamera||r.object instanceof mn&&r.object.isOrthographicCamera?f*=E:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),r.enableZoom=!1)}function ve(E){if(!r.zoomToCursor||!r.domElement)return;I=!0;const _=r.domElement.getBoundingClientRect(),D=E.clientX-_.left,K=E.clientY-_.top,ie=_.width,Se=_.height;x.x=D/ie*2-1,x.y=-(K/Se)*2+1,B.set(x.x,x.y,1).unproject(r.object).sub(r.object.position).normalize()}function Ce(E){return Math.max(r.minDistance,Math.min(r.maxDistance,E))}function Pe(E){g.set(E.clientX,E.clientY)}function pe(E){ve(E),C.set(E.clientX,E.clientY)}function Xe(E){v.set(E.clientX,E.clientY)}function re(E){d.set(E.clientX,E.clientY),A.subVectors(d,g).multiplyScalar(r.rotateSpeed);const _=r.domElement;_&&(k(2*Math.PI*A.x/_.clientHeight),U(2*Math.PI*A.y/_.clientHeight)),g.copy(d),r.update()}function de(E){R.set(E.clientX,E.clientY),y.subVectors(R,C),y.y>0?Q(w()):y.y<0&&z(w()),C.copy(R),r.update()}function Te(E){m.set(E.clientX,E.clientY),p.subVectors(m,v).multiplyScalar(r.panSpeed),X(p.x,p.y),v.copy(m),r.update()}function ee(E){ve(E),E.deltaY<0?z(w()):E.deltaY>0&&Q(w()),r.update()}function ue(E){let _=!1;switch(E.code){case r.keys.UP:X(0,r.keyPanSpeed),_=!0;break;case r.keys.BOTTOM:X(0,-r.keyPanSpeed),_=!0;break;case r.keys.LEFT:X(r.keyPanSpeed,0),_=!0;break;case r.keys.RIGHT:X(-r.keyPanSpeed,0),_=!0;break}_&&(E.preventDefault(),r.update())}function he(){if(S.length==1)g.set(S[0].pageX,S[0].pageY);else{const E=.5*(S[0].pageX+S[1].pageX),_=.5*(S[0].pageY+S[1].pageY);g.set(E,_)}}function Re(){if(S.length==1)v.set(S[0].pageX,S[0].pageY);else{const E=.5*(S[0].pageX+S[1].pageX),_=.5*(S[0].pageY+S[1].pageY);v.set(E,_)}}function _e(){const E=S[0].pageX-S[1].pageX,_=S[0].pageY-S[1].pageY,D=Math.sqrt(E*E+_*_);C.set(0,D)}function dt(){r.enableZoom&&_e(),r.enablePan&&Re()}function Bt(){r.enableZoom&&_e(),r.enableRotate&&he()}function on(E){if(S.length==1)d.set(E.pageX,E.pageY);else{const D=Fn(E),K=.5*(E.pageX+D.x),ie=.5*(E.pageY+D.y);d.set(K,ie)}A.subVectors(d,g).multiplyScalar(r.rotateSpeed);const _=r.domElement;_&&(k(2*Math.PI*A.x/_.clientHeight),U(2*Math.PI*A.y/_.clientHeight)),g.copy(d)}function an(E){if(S.length==1)m.set(E.pageX,E.pageY);else{const _=Fn(E),D=.5*(E.pageX+_.x),K=.5*(E.pageY+_.y);m.set(D,K)}p.subVectors(m,v).multiplyScalar(r.panSpeed),X(p.x,p.y),v.copy(m)}function ln(E){const _=Fn(E),D=E.pageX-_.x,K=E.pageY-_.y,ie=Math.sqrt(D*D+K*K);R.set(0,ie),y.set(0,Math.pow(R.y/C.y,r.zoomSpeed)),Q(y.y),C.copy(R)}function Pn(E){r.enableZoom&&ln(E),r.enablePan&&an(E)}function _n(E){r.enableZoom&&ln(E),r.enableRotate&&on(E)}function cn(E){var _,D;r.enabled!==!1&&(S.length===0&&((_=r.domElement)==null||_.ownerDocument.addEventListener("pointermove",Gt),(D=r.domElement)==null||D.ownerDocument.addEventListener("pointerup",kt)),Jt(E),E.pointerType==="touch"?Ht(E):wn(E))}function Gt(E){r.enabled!==!1&&(E.pointerType==="touch"?Kt(E):On(E))}function kt(E){var _,D,K;Tr(E),S.length===0&&((_=r.domElement)==null||_.releasePointerCapture(E.pointerId),(D=r.domElement)==null||D.ownerDocument.removeEventListener("pointermove",Gt),(K=r.domElement)==null||K.ownerDocument.removeEventListener("pointerup",kt)),r.dispatchEvent(o),l=a.NONE}function un(E){Tr(E)}function wn(E){let _;switch(E.button){case 0:_=r.mouseButtons.LEFT;break;case 1:_=r.mouseButtons.MIDDLE;break;case 2:_=r.mouseButtons.RIGHT;break;default:_=-1}switch(_){case fn.DOLLY:if(r.enableZoom===!1)return;pe(E),l=a.DOLLY;break;case fn.ROTATE:if(E.ctrlKey||E.metaKey||E.shiftKey){if(r.enablePan===!1)return;Xe(E),l=a.PAN}else{if(r.enableRotate===!1)return;Pe(E),l=a.ROTATE}break;case fn.PAN:if(E.ctrlKey||E.metaKey||E.shiftKey){if(r.enableRotate===!1)return;Pe(E),l=a.ROTATE}else{if(r.enablePan===!1)return;Xe(E),l=a.PAN}break;default:l=a.NONE}l!==a.NONE&&r.dispatchEvent(s)}function On(E){if(r.enabled!==!1)switch(l){case a.ROTATE:if(r.enableRotate===!1)return;re(E);break;case a.DOLLY:if(r.enableZoom===!1)return;de(E);break;case a.PAN:if(r.enablePan===!1)return;Te(E);break}}function hn(E){r.enabled===!1||r.enableZoom===!1||l!==a.NONE&&l!==a.ROTATE||(E.preventDefault(),r.dispatchEvent(s),ee(E),r.dispatchEvent(o))}function Ut(E){r.enabled===!1||r.enablePan===!1||ue(E)}function Ht(E){switch(vr(E),S.length){case 1:switch(r.touches.ONE){case dn.ROTATE:if(r.enableRotate===!1)return;he(),l=a.TOUCH_ROTATE;break;case dn.PAN:if(r.enablePan===!1)return;Re(),l=a.TOUCH_PAN;break;default:l=a.NONE}break;case 2:switch(r.touches.TWO){case dn.DOLLY_PAN:if(r.enableZoom===!1&&r.enablePan===!1)return;dt(),l=a.TOUCH_DOLLY_PAN;break;case dn.DOLLY_ROTATE:if(r.enableZoom===!1&&r.enableRotate===!1)return;Bt(),l=a.TOUCH_DOLLY_ROTATE;break;default:l=a.NONE}break;default:l=a.NONE}l!==a.NONE&&r.dispatchEvent(s)}function Kt(E){switch(vr(E),l){case a.TOUCH_ROTATE:if(r.enableRotate===!1)return;on(E),r.update();break;case a.TOUCH_PAN:if(r.enablePan===!1)return;an(E),r.update();break;case a.TOUCH_DOLLY_PAN:if(r.enableZoom===!1&&r.enablePan===!1)return;Pn(E),r.update();break;case a.TOUCH_DOLLY_ROTATE:if(r.enableZoom===!1&&r.enableRotate===!1)return;_n(E),r.update();break;default:l=a.NONE}}function yt(E){r.enabled!==!1&&E.preventDefault()}function Jt(E){S.push(E)}function Tr(E){delete b[E.pointerId];for(let _=0;_<S.length;_++)if(S[_].pointerId==E.pointerId){S.splice(_,1);return}}function vr(E){let _=b[E.pointerId];_===void 0&&(_=new H,b[E.pointerId]=_),_.set(E.pageX,E.pageY)}function Fn(E){const _=E.pointerId===S[0].pointerId?S[1]:S[0];return b[_.pointerId]}n!==void 0&&this.connect(n),this.update()}}class si{constructor(){M(this,"enabled",!0),M(this,"needsSwap",!0),M(this,"clear",!1),M(this,"renderToScreen",!1)}setSize(e,n){}render(e,n,r,i,s){console.error("THREE.Pass: .render() must be implemented in derived pass.")}}class oi{constructor(e){M(this,"camera",new mn(-1,1,1,-1,0,1)),M(this,"geometry",new Vc(2,2)),M(this,"mesh"),this.mesh=new He(this.geometry,e)}get material(){return this.mesh.material}set material(e){this.mesh.material=e}dispose(){this.mesh.geometry.dispose()}render(e){e.render(this.mesh,this.camera)}}const it={uniforms:{tDiffuse:{value:null},opacity:{value:1}},vertexShader:["varying vec2 vUv;","void main() {","	vUv = uv;","	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join(`
`),fragmentShader:["uniform float opacity;","uniform sampler2D tDiffuse;","varying vec2 vUv;","void main() {","	vec4 texel = texture2D( tDiffuse, vUv );","	gl_FragColor = opacity * texel;","}"].join(`
`)},Ln={defines:{PERSPECTIVE_CAMERA:1,KERNEL_SIZE:32},uniforms:{tDiffuse:{value:null},tNormal:{value:null},tDepth:{value:null},tNoise:{value:null},kernel:{value:null},cameraNear:{value:null},cameraFar:{value:null},resolution:{value:new H},cameraProjectionMatrix:{value:new oe},cameraInverseProjectionMatrix:{value:new oe},kernelRadius:{value:8},minDistance:{value:.005},maxDistance:{value:.05}},vertexShader:["varying vec2 vUv;","void main() {","	vUv = uv;","	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join(`
`),fragmentShader:["uniform sampler2D tDiffuse;","uniform sampler2D tNormal;","uniform sampler2D tDepth;","uniform sampler2D tNoise;","uniform vec3 kernel[ KERNEL_SIZE ];","uniform vec2 resolution;","uniform float cameraNear;","uniform float cameraFar;","uniform mat4 cameraProjectionMatrix;","uniform mat4 cameraInverseProjectionMatrix;","uniform float kernelRadius;","uniform float minDistance;","uniform float maxDistance;","varying vec2 vUv;","#include <packing>","float getDepth( const in vec2 screenPosition ) {","	return texture2D( tDepth, screenPosition ).x;","}","float getLinearDepth( const in vec2 screenPosition ) {","	#if PERSPECTIVE_CAMERA == 1","		float fragCoordZ = texture2D( tDepth, screenPosition ).x;","		float viewZ = perspectiveDepthToViewZ( fragCoordZ, cameraNear, cameraFar );","		return viewZToOrthographicDepth( viewZ, cameraNear, cameraFar );","	#else","		return texture2D( tDepth, screenPosition ).x;","	#endif","}","float getViewZ( const in float depth ) {","	#if PERSPECTIVE_CAMERA == 1","		return perspectiveDepthToViewZ( depth, cameraNear, cameraFar );","	#else","		return orthographicDepthToViewZ( depth, cameraNear, cameraFar );","	#endif","}","vec3 getViewPosition( const in vec2 screenPosition, const in float depth, const in float viewZ ) {","	float clipW = cameraProjectionMatrix[2][3] * viewZ + cameraProjectionMatrix[3][3];","	vec4 clipPosition = vec4( ( vec3( screenPosition, depth ) - 0.5 ) * 2.0, 1.0 );","	clipPosition *= clipW; // unprojection.","	return ( cameraInverseProjectionMatrix * clipPosition ).xyz;","}","vec3 getViewNormal( const in vec2 screenPosition ) {","	return unpackRGBToNormal( texture2D( tNormal, screenPosition ).xyz );","}","void main() {","	float depth = getDepth( vUv );","	float viewZ = getViewZ( depth );","	vec3 viewPosition = getViewPosition( vUv, depth, viewZ );","	vec3 viewNormal = getViewNormal( vUv );"," vec2 noiseScale = vec2( resolution.x / 4.0, resolution.y / 4.0 );","	vec3 random = texture2D( tNoise, vUv * noiseScale ).xyz;","	vec3 tangent = normalize( random - viewNormal * dot( random, viewNormal ) );","	vec3 bitangent = cross( viewNormal, tangent );","	mat3 kernelMatrix = mat3( tangent, bitangent, viewNormal );"," float occlusion = 0.0;"," for ( int i = 0; i < KERNEL_SIZE; i ++ ) {","		vec3 sampleVector = kernelMatrix * kernel[ i ];","		vec3 samplePoint = viewPosition + ( sampleVector * kernelRadius );","		vec4 samplePointNDC = cameraProjectionMatrix * vec4( samplePoint, 1.0 );","		samplePointNDC /= samplePointNDC.w;","		vec2 samplePointUv = samplePointNDC.xy * 0.5 + 0.5;","		float realDepth = getLinearDepth( samplePointUv );","		float sampleDepth = viewZToOrthographicDepth( samplePoint.z, cameraNear, cameraFar );","		float delta = sampleDepth - realDepth;","		if ( delta > minDistance && delta < maxDistance ) {","			occlusion += 1.0;","		}","	}","	occlusion = clamp( occlusion / float( KERNEL_SIZE ), 0.0, 1.0 );","	gl_FragColor = vec4( vec3( 1.0 - occlusion ), 1.0 );","}"].join(`
`)},yr={defines:{PERSPECTIVE_CAMERA:1},uniforms:{tDepth:{value:null},cameraNear:{value:null},cameraFar:{value:null}},vertexShader:["varying vec2 vUv;","void main() {","	vUv = uv;","	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join(`
`),fragmentShader:["uniform sampler2D tDepth;","uniform float cameraNear;","uniform float cameraFar;","varying vec2 vUv;","#include <packing>","float getLinearDepth( const in vec2 screenPosition ) {","	#if PERSPECTIVE_CAMERA == 1","		float fragCoordZ = texture2D( tDepth, screenPosition ).x;","		float viewZ = perspectiveDepthToViewZ( fragCoordZ, cameraNear, cameraFar );","		return viewZToOrthographicDepth( viewZ, cameraNear, cameraFar );","	#else","		return texture2D( tDepth, screenPosition ).x;","	#endif","}","void main() {","	float depth = getLinearDepth( vUv );","	gl_FragColor = vec4( vec3( 1.0 - depth ), 1.0 );","}"].join(`
`)},Sr={uniforms:{tDiffuse:{value:null},resolution:{value:new H}},vertexShader:["varying vec2 vUv;","void main() {","	vUv = uv;","	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join(`
`),fragmentShader:["uniform sampler2D tDiffuse;","uniform vec2 resolution;","varying vec2 vUv;","void main() {","	vec2 texelSize = ( 1.0 / resolution );","	float result = 0.0;","	for ( int i = - 2; i <= 2; i ++ ) {","		for ( int j = - 2; j <= 2; j ++ ) {","			vec2 offset = ( vec2( float( i ), float( j ) ) ) * texelSize;","			result += texture2D( tDiffuse, vUv + offset ).r;","		}","	}","	gl_FragColor = vec4( vec3( result / ( 5.0 * 5.0 ) ), 1.0 );","}"].join(`
`)},Vt=class extends si{constructor(t,e,n,r){super(),this.width=n!==void 0?n:512,this.height=r!==void 0?r:512,this.clear=!0,this.camera=e,this.scene=t,this.kernelRadius=8,this.kernelSize=32,this.kernel=[],this.noiseTexture=null,this.output=0,this.minDistance=.005,this.maxDistance=.1,this._visibilityCache=new Map,this.generateSampleKernel(),this.generateRandomKernelRotations();const i=new ii;i.format=Xc,i.type=Qc,this.beautyRenderTarget=new Be(this.width,this.height),this.normalRenderTarget=new Be(this.width,this.height,{minFilter:ne,magFilter:ne,depthTexture:i}),this.ssaoRenderTarget=new Be(this.width,this.height),this.blurRenderTarget=this.ssaoRenderTarget.clone(),Ln===void 0&&console.error("THREE.SSAOPass: The pass relies on SSAOShader."),this.ssaoMaterial=new se({defines:Object.assign({},Ln.defines),uniforms:fe.clone(Ln.uniforms),vertexShader:Ln.vertexShader,fragmentShader:Ln.fragmentShader,blending:Y}),this.ssaoMaterial.uniforms.tDiffuse.value=this.beautyRenderTarget.texture,this.ssaoMaterial.uniforms.tNormal.value=this.normalRenderTarget.texture,this.ssaoMaterial.uniforms.tDepth.value=this.normalRenderTarget.depthTexture,this.ssaoMaterial.uniforms.tNoise.value=this.noiseTexture,this.ssaoMaterial.uniforms.kernel.value=this.kernel,this.ssaoMaterial.uniforms.cameraNear.value=this.camera.near,this.ssaoMaterial.uniforms.cameraFar.value=this.camera.far,this.ssaoMaterial.uniforms.resolution.value.set(this.width,this.height),this.ssaoMaterial.uniforms.cameraProjectionMatrix.value.copy(this.camera.projectionMatrix),this.ssaoMaterial.uniforms.cameraInverseProjectionMatrix.value.copy(this.camera.projectionMatrixInverse),this.normalMaterial=new Cs,this.normalMaterial.blending=Y,this.blurMaterial=new se({defines:Object.assign({},Sr.defines),uniforms:fe.clone(Sr.uniforms),vertexShader:Sr.vertexShader,fragmentShader:Sr.fragmentShader}),this.blurMaterial.uniforms.tDiffuse.value=this.ssaoRenderTarget.texture,this.blurMaterial.uniforms.resolution.value.set(this.width,this.height),this.depthRenderMaterial=new se({defines:Object.assign({},yr.defines),uniforms:fe.clone(yr.uniforms),vertexShader:yr.vertexShader,fragmentShader:yr.fragmentShader,blending:Y}),this.depthRenderMaterial.uniforms.tDepth.value=this.normalRenderTarget.depthTexture,this.depthRenderMaterial.uniforms.cameraNear.value=this.camera.near,this.depthRenderMaterial.uniforms.cameraFar.value=this.camera.far,this.copyMaterial=new se({uniforms:fe.clone(it.uniforms),vertexShader:it.vertexShader,fragmentShader:it.fragmentShader,transparent:!0,depthTest:!1,depthWrite:!1,blendSrc:xa,blendDst:Hr,blendEquation:En,blendSrcAlpha:Ma,blendDstAlpha:Hr,blendEquationAlpha:En}),this.fsQuad=new oi(null),this.originalClearColor=new q}dispose(){this.beautyRenderTarget.dispose(),this.normalRenderTarget.dispose(),this.ssaoRenderTarget.dispose(),this.blurRenderTarget.dispose(),this.normalMaterial.dispose(),this.blurMaterial.dispose(),this.copyMaterial.dispose(),this.depthRenderMaterial.dispose(),this.fsQuad.dispose()}render(t,e){switch(t.capabilities.isWebGL2===!1&&(this.noiseTexture.format=zc),t.setRenderTarget(this.beautyRenderTarget),t.clear(),t.render(this.scene,this.camera),this.overrideVisibility(),this.renderOverride(t,this.normalMaterial,this.normalRenderTarget,7829503,1),this.restoreVisibility(),this.ssaoMaterial.uniforms.kernelRadius.value=this.kernelRadius,this.ssaoMaterial.uniforms.minDistance.value=this.minDistance,this.ssaoMaterial.uniforms.maxDistance.value=this.maxDistance,this.renderPass(t,this.ssaoMaterial,this.ssaoRenderTarget),this.renderPass(t,this.blurMaterial,this.blurRenderTarget),this.output){case Vt.OUTPUT.SSAO:this.copyMaterial.uniforms.tDiffuse.value=this.ssaoRenderTarget.texture,this.copyMaterial.blending=Y,this.renderPass(t,this.copyMaterial,this.renderToScreen?null:e);break;case Vt.OUTPUT.Blur:this.copyMaterial.uniforms.tDiffuse.value=this.blurRenderTarget.texture,this.copyMaterial.blending=Y,this.renderPass(t,this.copyMaterial,this.renderToScreen?null:e);break;case Vt.OUTPUT.Beauty:this.copyMaterial.uniforms.tDiffuse.value=this.beautyRenderTarget.texture,this.copyMaterial.blending=Y,this.renderPass(t,this.copyMaterial,this.renderToScreen?null:e);break;case Vt.OUTPUT.Depth:this.renderPass(t,this.depthRenderMaterial,this.renderToScreen?null:e);break;case Vt.OUTPUT.Normal:this.copyMaterial.uniforms.tDiffuse.value=this.normalRenderTarget.texture,this.copyMaterial.blending=Y,this.renderPass(t,this.copyMaterial,this.renderToScreen?null:e);break;case Vt.OUTPUT.Default:this.copyMaterial.uniforms.tDiffuse.value=this.beautyRenderTarget.texture,this.copyMaterial.blending=Y,this.renderPass(t,this.copyMaterial,this.renderToScreen?null:e),this.copyMaterial.uniforms.tDiffuse.value=this.blurRenderTarget.texture,this.copyMaterial.blending=$i,this.renderPass(t,this.copyMaterial,this.renderToScreen?null:e);break;default:console.warn("THREE.SSAOPass: Unknown output type.")}}renderPass(t,e,n,r,i){t.getClearColor(this.originalClearColor);const s=t.getClearAlpha(),o=t.autoClear;t.setRenderTarget(n),t.autoClear=!1,r!=null&&(t.setClearColor(r),t.setClearAlpha(i||0),t.clear()),this.fsQuad.material=e,this.fsQuad.render(t),t.autoClear=o,t.setClearColor(this.originalClearColor),t.setClearAlpha(s)}renderOverride(t,e,n,r,i){t.getClearColor(this.originalClearColor);const s=t.getClearAlpha(),o=t.autoClear;t.setRenderTarget(n),t.autoClear=!1,r=e.clearColor||r,i=e.clearAlpha||i,r!=null&&(t.setClearColor(r),t.setClearAlpha(i||0),t.clear()),this.scene.overrideMaterial=e,t.render(this.scene,this.camera),this.scene.overrideMaterial=null,t.autoClear=o,t.setClearColor(this.originalClearColor),t.setClearAlpha(s)}setSize(t,e){this.width=t,this.height=e,this.beautyRenderTarget.setSize(t,e),this.ssaoRenderTarget.setSize(t,e),this.normalRenderTarget.setSize(t,e),this.blurRenderTarget.setSize(t,e),this.ssaoMaterial.uniforms.resolution.value.set(t,e),this.ssaoMaterial.uniforms.cameraProjectionMatrix.value.copy(this.camera.projectionMatrix),this.ssaoMaterial.uniforms.cameraInverseProjectionMatrix.value.copy(this.camera.projectionMatrixInverse),this.blurMaterial.uniforms.resolution.value.set(t,e)}generateSampleKernel(){const t=this.kernelSize,e=this.kernel;for(let n=0;n<t;n++){const r=new P;r.x=Math.random()*2-1,r.y=Math.random()*2-1,r.z=Math.random(),r.normalize();let i=n/t;i=An.lerp(.1,1,i*i),r.multiplyScalar(i),e.push(r)}}generateRandomKernelRotations(){$n===void 0&&console.error("THREE.SSAOPass: The pass relies on SimplexNoise.");const n=new $n,r=4*4,i=new Float32Array(r);for(let s=0;s<r;s++){const o=Math.random()*2-1,a=Math.random()*2-1,l=0;i[s]=n.noise3d(o,a,l)}this.noiseTexture=new Kr(i,4,4,Kn,Yn),this.noiseTexture.wrapS=Zt,this.noiseTexture.wrapT=Zt,this.noiseTexture.needsUpdate=!0}overrideVisibility(){const t=this.scene,e=this._visibilityCache;t.traverse(function(n){e.set(n,n.visible),(n.isPoints||n.isLine)&&(n.visible=!1)})}restoreVisibility(){const t=this.scene,e=this._visibilityCache;t.traverse(function(n){const r=e.get(n);n.visible=r}),e.clear()}};let fu=Vt;M(fu,"OUTPUT",{Default:0,SSAO:1,Blur:2,Beauty:3,Depth:4,Normal:5});const du={shaderID:"luminosityHighPass",uniforms:{tDiffuse:{value:null},luminosityThreshold:{value:1},smoothWidth:{value:1},defaultColor:{value:new q(0)},defaultOpacity:{value:0}},vertexShader:["varying vec2 vUv;","void main() {","	vUv = uv;","	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join(`
`),fragmentShader:["uniform sampler2D tDiffuse;","uniform vec3 defaultColor;","uniform float defaultOpacity;","uniform float luminosityThreshold;","uniform float smoothWidth;","varying vec2 vUv;","void main() {","	vec4 texel = texture2D( tDiffuse, vUv );","	vec3 luma = vec3( 0.299, 0.587, 0.114 );","	float v = dot( texel.xyz, luma );","	vec4 outputColor = vec4( defaultColor.rgb, defaultOpacity );","	float alpha = smoothstep( luminosityThreshold, luminosityThreshold + smoothWidth, v );","	gl_FragColor = mix( outputColor, texel, alpha );","}"].join(`
`)},ns=class extends si{constructor(t,e,n,r){super(),this.strength=e!==void 0?e:1,this.radius=n,this.threshold=r,this.resolution=t!==void 0?new H(t.x,t.y):new H(256,256),this.clearColor=new q(0,0,0),this.renderTargetsHorizontal=[],this.renderTargetsVertical=[],this.nMips=5;let i=Math.round(this.resolution.x/2),s=Math.round(this.resolution.y/2);this.renderTargetBright=new Be(i,s,{type:Me}),this.renderTargetBright.texture.name="UnrealBloomPass.bright",this.renderTargetBright.texture.generateMipmaps=!1;for(let u=0;u<this.nMips;u++){const h=new Be(i,s,{type:Me});h.texture.name="UnrealBloomPass.h"+u,h.texture.generateMipmaps=!1,this.renderTargetsHorizontal.push(h);const f=new Be(i,s,{type:Me});f.texture.name="UnrealBloomPass.v"+u,f.texture.generateMipmaps=!1,this.renderTargetsVertical.push(f),i=Math.round(i/2),s=Math.round(s/2)}const o=du;this.highPassUniforms=fe.clone(o.uniforms),this.highPassUniforms.luminosityThreshold.value=r,this.highPassUniforms.smoothWidth.value=.01,this.materialHighPassFilter=new se({uniforms:this.highPassUniforms,vertexShader:o.vertexShader,fragmentShader:o.fragmentShader,defines:{}}),this.separableBlurMaterials=[];const a=[3,5,7,9,11];i=Math.round(this.resolution.x/2),s=Math.round(this.resolution.y/2);for(let u=0;u<this.nMips;u++)this.separableBlurMaterials.push(this.getSeperableBlurMaterial(a[u])),this.separableBlurMaterials[u].uniforms.texSize.value=new H(i,s),i=Math.round(i/2),s=Math.round(s/2);this.compositeMaterial=this.getCompositeMaterial(this.nMips),this.compositeMaterial.uniforms.blurTexture1.value=this.renderTargetsVertical[0].texture,this.compositeMaterial.uniforms.blurTexture2.value=this.renderTargetsVertical[1].texture,this.compositeMaterial.uniforms.blurTexture3.value=this.renderTargetsVertical[2].texture,this.compositeMaterial.uniforms.blurTexture4.value=this.renderTargetsVertical[3].texture,this.compositeMaterial.uniforms.blurTexture5.value=this.renderTargetsVertical[4].texture,this.compositeMaterial.uniforms.bloomStrength.value=e,this.compositeMaterial.uniforms.bloomRadius.value=.1,this.compositeMaterial.needsUpdate=!0;const l=[1,.8,.6,.4,.2];this.compositeMaterial.uniforms.bloomFactors.value=l,this.bloomTintColors=[new P(1,1,1),new P(1,1,1),new P(1,1,1),new P(1,1,1),new P(1,1,1)],this.compositeMaterial.uniforms.bloomTintColors.value=this.bloomTintColors;const c=it;this.copyUniforms=fe.clone(c.uniforms),this.copyUniforms.opacity.value=1,this.materialCopy=new se({uniforms:this.copyUniforms,vertexShader:c.vertexShader,fragmentShader:c.fragmentShader,blending:ba,depthTest:!1,depthWrite:!1,transparent:!0}),this.enabled=!0,this.needsSwap=!1,this._oldClearColor=new q,this.oldClearAlpha=1,this.basic=new gt,this.fsQuad=new oi(null)}dispose(){for(let t=0;t<this.renderTargetsHorizontal.length;t++)this.renderTargetsHorizontal[t].dispose();for(let t=0;t<this.renderTargetsVertical.length;t++)this.renderTargetsVertical[t].dispose();this.renderTargetBright.dispose();for(let t=0;t<this.separableBlurMaterials.length;t++)this.separableBlurMaterials[t].dispose();this.compositeMaterial.dispose(),this.materialCopy.dispose(),this.basic.dispose(),this.fsQuad.dispose()}setSize(t,e){let n=Math.round(t/2),r=Math.round(e/2);this.renderTargetBright.setSize(n,r);for(let i=0;i<this.nMips;i++)this.renderTargetsHorizontal[i].setSize(n,r),this.renderTargetsVertical[i].setSize(n,r),this.separableBlurMaterials[i].uniforms.texSize.value=new H(n,r),n=Math.round(n/2),r=Math.round(r/2)}render(t,e,n,r,i){t.getClearColor(this._oldClearColor),this.oldClearAlpha=t.getClearAlpha();const s=t.autoClear;t.autoClear=!1,t.setClearColor(this.clearColor,0),i&&t.state.buffers.stencil.setTest(!1),this.renderToScreen&&(this.fsQuad.material=this.basic,this.basic.map=n.texture,t.setRenderTarget(null),t.clear(),this.fsQuad.render(t)),this.highPassUniforms.tDiffuse.value=n.texture,this.highPassUniforms.luminosityThreshold.value=this.threshold,this.fsQuad.material=this.materialHighPassFilter,t.setRenderTarget(this.renderTargetBright),t.clear(),this.fsQuad.render(t);let o=this.renderTargetBright;for(let a=0;a<this.nMips;a++)this.fsQuad.material=this.separableBlurMaterials[a],this.separableBlurMaterials[a].uniforms.colorTexture.value=o.texture,this.separableBlurMaterials[a].uniforms.direction.value=ns.BlurDirectionX,t.setRenderTarget(this.renderTargetsHorizontal[a]),t.clear(),this.fsQuad.render(t),this.separableBlurMaterials[a].uniforms.colorTexture.value=this.renderTargetsHorizontal[a].texture,this.separableBlurMaterials[a].uniforms.direction.value=ns.BlurDirectionY,t.setRenderTarget(this.renderTargetsVertical[a]),t.clear(),this.fsQuad.render(t),o=this.renderTargetsVertical[a];this.fsQuad.material=this.compositeMaterial,this.compositeMaterial.uniforms.bloomStrength.value=this.strength,this.compositeMaterial.uniforms.bloomRadius.value=this.radius,this.compositeMaterial.uniforms.bloomTintColors.value=this.bloomTintColors,t.setRenderTarget(this.renderTargetsHorizontal[0]),t.clear(),this.fsQuad.render(t),this.fsQuad.material=this.materialCopy,this.copyUniforms.tDiffuse.value=this.renderTargetsHorizontal[0].texture,i&&t.state.buffers.stencil.setTest(!0),this.renderToScreen?(t.setRenderTarget(null),this.fsQuad.render(t)):(t.setRenderTarget(n),this.fsQuad.render(t)),t.setClearColor(this._oldClearColor,this.oldClearAlpha),t.autoClear=s}getSeperableBlurMaterial(t){return new se({defines:{KERNEL_RADIUS:t,SIGMA:t},uniforms:{colorTexture:{value:null},texSize:{value:new H(.5,.5)},direction:{value:new H(.5,.5)}},vertexShader:`varying vec2 vUv;
				void main() {
					vUv = uv;
					gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
				}`,fragmentShader:`#include <common>
				varying vec2 vUv;
				uniform sampler2D colorTexture;
				uniform vec2 texSize;
				uniform vec2 direction;

				float gaussianPdf(in float x, in float sigma) {
					return 0.39894 * exp( -0.5 * x * x/( sigma * sigma))/sigma;
				}
				void main() {
					vec2 invSize = 1.0 / texSize;
					float fSigma = float(SIGMA);
					float weightSum = gaussianPdf(0.0, fSigma);
					vec3 diffuseSum = texture2D( colorTexture, vUv).rgb * weightSum;
					for( int i = 1; i < KERNEL_RADIUS; i ++ ) {
						float x = float(i);
						float w = gaussianPdf(x, fSigma);
						vec2 uvOffset = direction * invSize * x;
						vec3 sample1 = texture2D( colorTexture, vUv + uvOffset).rgb;
						vec3 sample2 = texture2D( colorTexture, vUv - uvOffset).rgb;
						diffuseSum += (sample1 + sample2) * w;
						weightSum += 2.0 * w;
					}
					gl_FragColor = vec4(diffuseSum/weightSum, 1.0);
				}`})}getCompositeMaterial(t){return new se({defines:{NUM_MIPS:t},uniforms:{blurTexture1:{value:null},blurTexture2:{value:null},blurTexture3:{value:null},blurTexture4:{value:null},blurTexture5:{value:null},bloomStrength:{value:1},bloomFactors:{value:null},bloomTintColors:{value:null},bloomRadius:{value:0}},vertexShader:`varying vec2 vUv;
				void main() {
					vUv = uv;
					gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
				}`,fragmentShader:`varying vec2 vUv;
				uniform sampler2D blurTexture1;
				uniform sampler2D blurTexture2;
				uniform sampler2D blurTexture3;
				uniform sampler2D blurTexture4;
				uniform sampler2D blurTexture5;
				uniform float bloomStrength;
				uniform float bloomRadius;
				uniform float bloomFactors[NUM_MIPS];
				uniform vec3 bloomTintColors[NUM_MIPS];

				float lerpBloomFactor(const in float factor) {
					float mirrorFactor = 1.2 - factor;
					return mix(factor, mirrorFactor, bloomRadius);
				}

				void main() {
					gl_FragColor = bloomStrength * ( lerpBloomFactor(bloomFactors[0]) * vec4(bloomTintColors[0], 1.0) * texture2D(blurTexture1, vUv) +
						lerpBloomFactor(bloomFactors[1]) * vec4(bloomTintColors[1], 1.0) * texture2D(blurTexture2, vUv) +
						lerpBloomFactor(bloomFactors[2]) * vec4(bloomTintColors[2], 1.0) * texture2D(blurTexture3, vUv) +
						lerpBloomFactor(bloomFactors[3]) * vec4(bloomTintColors[3], 1.0) * texture2D(blurTexture4, vUv) +
						lerpBloomFactor(bloomFactors[4]) * vec4(bloomTintColors[4], 1.0) * texture2D(blurTexture5, vUv) );
				}`})}};let Va=ns;M(Va,"BlurDirectionX",new H(1,0));M(Va,"BlurDirectionY",new H(0,1));const xr={defines:{NUM_SAMPLES:7,NUM_RINGS:4,NORMAL_TEXTURE:0,DIFFUSE_TEXTURE:0,DEPTH_PACKING:1,PERSPECTIVE_CAMERA:1},uniforms:{tDepth:{value:null},tDiffuse:{value:null},tNormal:{value:null},size:{value:new H(512,512)},cameraNear:{value:1},cameraFar:{value:100},cameraProjectionMatrix:{value:new oe},cameraInverseProjectionMatrix:{value:new oe},scale:{value:1},intensity:{value:.1},bias:{value:.5},minResolution:{value:0},kernelRadius:{value:100},randomSeed:{value:0}},vertexShader:["varying vec2 vUv;","void main() {","	vUv = uv;","	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join(`
`),fragmentShader:["#include <common>","varying vec2 vUv;","#if DIFFUSE_TEXTURE == 1","uniform sampler2D tDiffuse;","#endif","uniform sampler2D tDepth;","#if NORMAL_TEXTURE == 1","uniform sampler2D tNormal;","#endif","uniform float cameraNear;","uniform float cameraFar;","uniform mat4 cameraProjectionMatrix;","uniform mat4 cameraInverseProjectionMatrix;","uniform float scale;","uniform float intensity;","uniform float bias;","uniform float kernelRadius;","uniform float minResolution;","uniform vec2 size;","uniform float randomSeed;","// RGBA depth","#include <packing>","vec4 getDefaultColor( const in vec2 screenPosition ) {","	#if DIFFUSE_TEXTURE == 1","	return texture2D( tDiffuse, vUv );","	#else","	return vec4( 1.0 );","	#endif","}","float getDepth( const in vec2 screenPosition ) {","	#if DEPTH_PACKING == 1","	return unpackRGBAToDepth( texture2D( tDepth, screenPosition ) );","	#else","	return texture2D( tDepth, screenPosition ).x;","	#endif","}","float getViewZ( const in float depth ) {","	#if PERSPECTIVE_CAMERA == 1","	return perspectiveDepthToViewZ( depth, cameraNear, cameraFar );","	#else","	return orthographicDepthToViewZ( depth, cameraNear, cameraFar );","	#endif","}","vec3 getViewPosition( const in vec2 screenPosition, const in float depth, const in float viewZ ) {","	float clipW = cameraProjectionMatrix[2][3] * viewZ + cameraProjectionMatrix[3][3];","	vec4 clipPosition = vec4( ( vec3( screenPosition, depth ) - 0.5 ) * 2.0, 1.0 );","	clipPosition *= clipW; // unprojection.","	return ( cameraInverseProjectionMatrix * clipPosition ).xyz;","}","vec3 getViewNormal( const in vec3 viewPosition, const in vec2 screenPosition ) {","	#if NORMAL_TEXTURE == 1","	return unpackRGBToNormal( texture2D( tNormal, screenPosition ).xyz );","	#else","	return normalize( cross( dFdx( viewPosition ), dFdy( viewPosition ) ) );","	#endif","}","float scaleDividedByCameraFar;","float minResolutionMultipliedByCameraFar;","float getOcclusion( const in vec3 centerViewPosition, const in vec3 centerViewNormal, const in vec3 sampleViewPosition ) {","	vec3 viewDelta = sampleViewPosition - centerViewPosition;","	float viewDistance = length( viewDelta );","	float scaledScreenDistance = scaleDividedByCameraFar * viewDistance;","	return max(0.0, (dot(centerViewNormal, viewDelta) - minResolutionMultipliedByCameraFar) / scaledScreenDistance - bias) / (1.0 + pow2( scaledScreenDistance ) );","}","// moving costly divides into consts","const float ANGLE_STEP = PI2 * float( NUM_RINGS ) / float( NUM_SAMPLES );","const float INV_NUM_SAMPLES = 1.0 / float( NUM_SAMPLES );","float getAmbientOcclusion( const in vec3 centerViewPosition ) {","	// precompute some variables require in getOcclusion.","	scaleDividedByCameraFar = scale / cameraFar;","	minResolutionMultipliedByCameraFar = minResolution * cameraFar;","	vec3 centerViewNormal = getViewNormal( centerViewPosition, vUv );","	// jsfiddle that shows sample pattern: https://jsfiddle.net/a16ff1p7/","	float angle = rand( vUv + randomSeed ) * PI2;","	vec2 radius = vec2( kernelRadius * INV_NUM_SAMPLES ) / size;","	vec2 radiusStep = radius;","	float occlusionSum = 0.0;","	float weightSum = 0.0;","	for( int i = 0; i < NUM_SAMPLES; i ++ ) {","		vec2 sampleUv = vUv + vec2( cos( angle ), sin( angle ) ) * radius;","		radius += radiusStep;","		angle += ANGLE_STEP;","		float sampleDepth = getDepth( sampleUv );","		if( sampleDepth >= ( 1.0 - EPSILON ) ) {","			continue;","		}","		float sampleViewZ = getViewZ( sampleDepth );","		vec3 sampleViewPosition = getViewPosition( sampleUv, sampleDepth, sampleViewZ );","		occlusionSum += getOcclusion( centerViewPosition, centerViewNormal, sampleViewPosition );","		weightSum += 1.0;","	}","	if( weightSum == 0.0 ) discard;","	return occlusionSum * ( intensity / weightSum );","}","void main() {","	float centerDepth = getDepth( vUv );","	if( centerDepth >= ( 1.0 - EPSILON ) ) {","		discard;","	}","	float centerViewZ = getViewZ( centerDepth );","	vec3 viewPosition = getViewPosition( vUv, centerDepth, centerViewZ );","	float ambientOcclusion = getAmbientOcclusion( viewPosition );","	gl_FragColor = getDefaultColor( vUv );","	gl_FragColor.xyz *=  1.0 - ambientOcclusion;","}"].join(`
`)},St={defines:{KERNEL_RADIUS:4,DEPTH_PACKING:1,PERSPECTIVE_CAMERA:1},uniforms:{tDiffuse:{value:null},size:{value:new H(512,512)},sampleUvOffsets:{value:[new H(0,0)]},sampleWeights:{value:[1]},tDepth:{value:null},cameraNear:{value:10},cameraFar:{value:1e3},depthCutoff:{value:10}},vertexShader:["#include <common>","uniform vec2 size;","varying vec2 vUv;","varying vec2 vInvSize;","void main() {","	vUv = uv;","	vInvSize = 1.0 / size;","	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join(`
`),fragmentShader:["#include <common>","#include <packing>","uniform sampler2D tDiffuse;","uniform sampler2D tDepth;","uniform float cameraNear;","uniform float cameraFar;","uniform float depthCutoff;","uniform vec2 sampleUvOffsets[ KERNEL_RADIUS + 1 ];","uniform float sampleWeights[ KERNEL_RADIUS + 1 ];","varying vec2 vUv;","varying vec2 vInvSize;","float getDepth( const in vec2 screenPosition ) {","	#if DEPTH_PACKING == 1","	return unpackRGBAToDepth( texture2D( tDepth, screenPosition ) );","	#else","	return texture2D( tDepth, screenPosition ).x;","	#endif","}","float getViewZ( const in float depth ) {","	#if PERSPECTIVE_CAMERA == 1","	return perspectiveDepthToViewZ( depth, cameraNear, cameraFar );","	#else","	return orthographicDepthToViewZ( depth, cameraNear, cameraFar );","	#endif","}","void main() {","	float depth = getDepth( vUv );","	if( depth >= ( 1.0 - EPSILON ) ) {","		discard;","	}","	float centerViewZ = -getViewZ( depth );","	bool rBreak = false, lBreak = false;","	float weightSum = sampleWeights[0];","	vec4 diffuseSum = texture2D( tDiffuse, vUv ) * weightSum;","	for( int i = 1; i <= KERNEL_RADIUS; i ++ ) {","		float sampleWeight = sampleWeights[i];","		vec2 sampleUvOffset = sampleUvOffsets[i] * vInvSize;","		vec2 sampleUv = vUv + sampleUvOffset;","		float viewZ = -getViewZ( getDepth( sampleUv ) );","		if( abs( viewZ - centerViewZ ) > depthCutoff ) rBreak = true;","		if( ! rBreak ) {","			diffuseSum += texture2D( tDiffuse, sampleUv ) * sampleWeight;","			weightSum += sampleWeight;","		}","		sampleUv = vUv - sampleUvOffset;","		viewZ = -getViewZ( getDepth( sampleUv ) );","		if( abs( viewZ - centerViewZ ) > depthCutoff ) lBreak = true;","		if( ! lBreak ) {","			diffuseSum += texture2D( tDiffuse, sampleUv ) * sampleWeight;","			weightSum += sampleWeight;","		}","	}","	gl_FragColor = diffuseSum / weightSum;","}"].join(`
`)},jr={createSampleWeights:(t,e)=>{const n=(i,s)=>Math.exp(-(i*i)/(2*(s*s)))/(Math.sqrt(2*Math.PI)*s),r=[];for(let i=0;i<=t;i++)r.push(n(i,e));return r},createSampleOffsets:(t,e)=>{const n=[];for(let r=0;r<=t;r++)n.push(e.clone().multiplyScalar(r));return n},configure:(t,e,n,r)=>{t.defines.KERNEL_RADIUS=e,t.uniforms.sampleUvOffsets.value=jr.createSampleOffsets(e,r),t.uniforms.sampleWeights.value=jr.createSampleWeights(e,n),t.needsUpdate=!0}};class pu extends si{constructor(e,n,r=!1,i=!1,s=new H(256,256)){super(),this.scene=e,this.camera=n,this.clear=!0,this.needsSwap=!1,this.supportsDepthTextureExtension=r,this.supportsNormalTexture=i,this.originalClearColor=new q,this._oldClearColor=new q,this.oldClearAlpha=1,this.params={output:0,saoBias:.5,saoIntensity:.18,saoScale:1,saoKernelRadius:100,saoMinResolution:0,saoBlur:!0,saoBlurRadius:8,saoBlurStdDev:4,saoBlurDepthCutoff:.01},this.resolution=new H(s.x,s.y),this.saoRenderTarget=new Be(this.resolution.x,this.resolution.y,{type:Me}),this.blurIntermediateRenderTarget=this.saoRenderTarget.clone(),this.beautyRenderTarget=this.saoRenderTarget.clone(),this.normalRenderTarget=new Be(this.resolution.x,this.resolution.y,{minFilter:ne,magFilter:ne,type:Me}),this.depthRenderTarget=this.normalRenderTarget.clone();let o;this.supportsDepthTextureExtension&&(o=new ii,o.type=vs,this.beautyRenderTarget.depthTexture=o,this.beautyRenderTarget.depthBuffer=!0),this.depthMaterial=new Pc,this.depthMaterial.depthPacking=_c,this.depthMaterial.blending=Y,this.normalMaterial=new Cs,this.normalMaterial.blending=Y,this.saoMaterial=new se({defines:Object.assign({},xr.defines),fragmentShader:xr.fragmentShader,vertexShader:xr.vertexShader,uniforms:fe.clone(xr.uniforms)}),this.saoMaterial.extensions.derivatives=!0,this.saoMaterial.defines.DEPTH_PACKING=this.supportsDepthTextureExtension?0:1,this.saoMaterial.defines.NORMAL_TEXTURE=this.supportsNormalTexture?1:0,this.saoMaterial.defines.PERSPECTIVE_CAMERA=this.camera.isPerspectiveCamera?1:0,this.saoMaterial.uniforms.tDepth.value=this.supportsDepthTextureExtension?o:this.depthRenderTarget.texture,this.saoMaterial.uniforms.tNormal.value=this.normalRenderTarget.texture,this.saoMaterial.uniforms.size.value.set(this.resolution.x,this.resolution.y),this.saoMaterial.uniforms.cameraInverseProjectionMatrix.value.copy(this.camera.projectionMatrixInverse),this.saoMaterial.uniforms.cameraProjectionMatrix.value=this.camera.projectionMatrix,this.saoMaterial.blending=Y,this.vBlurMaterial=new se({uniforms:fe.clone(St.uniforms),defines:Object.assign({},St.defines),vertexShader:St.vertexShader,fragmentShader:St.fragmentShader}),this.vBlurMaterial.defines.DEPTH_PACKING=this.supportsDepthTextureExtension?0:1,this.vBlurMaterial.defines.PERSPECTIVE_CAMERA=this.camera.isPerspectiveCamera?1:0,this.vBlurMaterial.uniforms.tDiffuse.value=this.saoRenderTarget.texture,this.vBlurMaterial.uniforms.tDepth.value=this.supportsDepthTextureExtension?o:this.depthRenderTarget.texture,this.vBlurMaterial.uniforms.size.value.set(this.resolution.x,this.resolution.y),this.vBlurMaterial.blending=Y,this.hBlurMaterial=new se({uniforms:fe.clone(St.uniforms),defines:Object.assign({},St.defines),vertexShader:St.vertexShader,fragmentShader:St.fragmentShader}),this.hBlurMaterial.defines.DEPTH_PACKING=this.supportsDepthTextureExtension?0:1,this.hBlurMaterial.defines.PERSPECTIVE_CAMERA=this.camera.isPerspectiveCamera?1:0,this.hBlurMaterial.uniforms.tDiffuse.value=this.blurIntermediateRenderTarget.texture,this.hBlurMaterial.uniforms.tDepth.value=this.supportsDepthTextureExtension?o:this.depthRenderTarget.texture,this.hBlurMaterial.uniforms.size.value.set(this.resolution.x,this.resolution.y),this.hBlurMaterial.blending=Y,this.materialCopy=new se({uniforms:fe.clone(it.uniforms),vertexShader:it.vertexShader,fragmentShader:it.fragmentShader,blending:Y}),this.materialCopy.transparent=!0,this.materialCopy.depthTest=!1,this.materialCopy.depthWrite=!1,this.materialCopy.blending=$i,this.materialCopy.blendSrc=xa,this.materialCopy.blendDst=Hr,this.materialCopy.blendEquation=En,this.materialCopy.blendSrcAlpha=Ma,this.materialCopy.blendDstAlpha=Hr,this.materialCopy.blendEquationAlpha=En,this.depthCopy=new se({uniforms:fe.clone(wi.uniforms),vertexShader:wi.vertexShader,fragmentShader:wi.fragmentShader,blending:Y}),this.fsQuad=new oi(null)}render(e,n,r){if(this.renderToScreen&&(this.materialCopy.blending=Y,this.materialCopy.uniforms.tDiffuse.value=r.texture,this.materialCopy.needsUpdate=!0,this.renderPass(e,this.materialCopy,null)),this.params.output===1)return;e.getClearColor(this._oldClearColor),this.oldClearAlpha=e.getClearAlpha();const i=e.autoClear;e.autoClear=!1,e.setRenderTarget(this.depthRenderTarget),e.clear(),this.saoMaterial.uniforms.bias.value=this.params.saoBias,this.saoMaterial.uniforms.intensity.value=this.params.saoIntensity,this.saoMaterial.uniforms.scale.value=this.params.saoScale,this.saoMaterial.uniforms.kernelRadius.value=this.params.saoKernelRadius,this.saoMaterial.uniforms.minResolution.value=this.params.saoMinResolution,this.saoMaterial.uniforms.cameraNear.value=this.camera.near,this.saoMaterial.uniforms.cameraFar.value=this.camera.far;const s=this.params.saoBlurDepthCutoff*(this.camera.far-this.camera.near);this.vBlurMaterial.uniforms.depthCutoff.value=s,this.hBlurMaterial.uniforms.depthCutoff.value=s,this.vBlurMaterial.uniforms.cameraNear.value=this.camera.near,this.vBlurMaterial.uniforms.cameraFar.value=this.camera.far,this.hBlurMaterial.uniforms.cameraNear.value=this.camera.near,this.hBlurMaterial.uniforms.cameraFar.value=this.camera.far,this.params.saoBlurRadius=Math.floor(this.params.saoBlurRadius),(this.prevStdDev!==this.params.saoBlurStdDev||this.prevNumSamples!==this.params.saoBlurRadius)&&(jr.configure(this.vBlurMaterial,this.params.saoBlurRadius,this.params.saoBlurStdDev,new H(0,1)),jr.configure(this.hBlurMaterial,this.params.saoBlurRadius,this.params.saoBlurStdDev,new H(1,0)),this.prevStdDev=this.params.saoBlurStdDev,this.prevNumSamples=this.params.saoBlurRadius),e.setClearColor(0),e.setRenderTarget(this.beautyRenderTarget),e.clear(),e.render(this.scene,this.camera),this.supportsDepthTextureExtension||this.renderOverride(e,this.depthMaterial,this.depthRenderTarget,0,1),this.supportsNormalTexture&&this.renderOverride(e,this.normalMaterial,this.normalRenderTarget,7829503,1),this.renderPass(e,this.saoMaterial,this.saoRenderTarget,16777215,1),this.params.saoBlur&&(this.renderPass(e,this.vBlurMaterial,this.blurIntermediateRenderTarget,16777215,1),this.renderPass(e,this.hBlurMaterial,this.saoRenderTarget,16777215,1));let o=this.materialCopy;this.params.output===3?this.supportsDepthTextureExtension?(this.materialCopy.uniforms.tDiffuse.value=this.beautyRenderTarget.depthTexture,this.materialCopy.needsUpdate=!0):(this.depthCopy.uniforms.tDiffuse.value=this.depthRenderTarget.texture,this.depthCopy.needsUpdate=!0,o=this.depthCopy):this.params.output===4?(this.materialCopy.uniforms.tDiffuse.value=this.normalRenderTarget.texture,this.materialCopy.needsUpdate=!0):(this.materialCopy.uniforms.tDiffuse.value=this.saoRenderTarget.texture,this.materialCopy.needsUpdate=!0),this.params.output===0?o.blending=$i:o.blending=Y,this.renderPass(e,o,this.renderToScreen?null:r),e.setClearColor(this._oldClearColor,this.oldClearAlpha),e.autoClear=i}renderPass(e,n,r,i,s){e.getClearColor(this.originalClearColor);const o=e.getClearAlpha(),a=e.autoClear;e.setRenderTarget(r),e.autoClear=!1,i!=null&&(e.setClearColor(i),e.setClearAlpha(s||0),e.clear()),this.fsQuad.material=n,this.fsQuad.render(e),e.autoClear=a,e.setClearColor(this.originalClearColor),e.setClearAlpha(o)}renderOverride(e,n,r,i,s){e.getClearColor(this.originalClearColor);const o=e.getClearAlpha(),a=e.autoClear;e.setRenderTarget(r),e.autoClear=!1,i=n.clearColor||i,s=n.clearAlpha||s,i!=null&&(e.setClearColor(i),e.setClearAlpha(s||0),e.clear()),this.scene.overrideMaterial=n,e.render(this.scene,this.camera),this.scene.overrideMaterial=null,e.autoClear=a,e.setClearColor(this.originalClearColor),e.setClearAlpha(o)}setSize(e,n){this.beautyRenderTarget.setSize(e,n),this.saoRenderTarget.setSize(e,n),this.blurIntermediateRenderTarget.setSize(e,n),this.normalRenderTarget.setSize(e,n),this.depthRenderTarget.setSize(e,n),this.saoMaterial.uniforms.size.value.set(e,n),this.saoMaterial.uniforms.cameraInverseProjectionMatrix.value.copy(this.camera.projectionMatrixInverse),this.saoMaterial.uniforms.cameraProjectionMatrix.value=this.camera.projectionMatrix,this.saoMaterial.needsUpdate=!0,this.vBlurMaterial.uniforms.size.value.set(e,n),this.vBlurMaterial.needsUpdate=!0,this.hBlurMaterial.uniforms.size.value.set(e,n),this.hBlurMaterial.needsUpdate=!0}dispose(){this.saoRenderTarget.dispose(),this.blurIntermediateRenderTarget.dispose(),this.beautyRenderTarget.dispose(),this.normalRenderTarget.dispose(),this.depthRenderTarget.dispose(),this.depthMaterial.dispose(),this.normalMaterial.dispose(),this.saoMaterial.dispose(),this.vBlurMaterial.dispose(),this.hBlurMaterial.dispose(),this.materialCopy.dispose(),this.depthCopy.dispose(),this.fsQuad.dispose()}}M(pu,"OUTPUT",{Beauty:1,Default:0,SAO:2,Depth:3,Normal:4});const tt={defines:{MAX_STEP:0,isPerspectiveCamera:!0,isDistanceAttenuation:!0,isFresnel:!0,isInfiniteThick:!1,isSelective:!1},uniforms:{tDiffuse:{value:null},tNormal:{value:null},tMetalness:{value:null},tDepth:{value:null},cameraNear:{value:null},cameraFar:{value:null},resolution:{value:new H},cameraProjectionMatrix:{value:new oe},cameraInverseProjectionMatrix:{value:new oe},opacity:{value:.5},maxDistance:{value:180},cameraRange:{value:0},surfDist:{value:.007},thickTolerance:{value:.03}},vertexShader:`

    varying vec2 vUv;

    void main() {

			vUv = uv;

			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

    }

  `,fragmentShader:`
		// precision highp float;
		precision highp sampler2D;
		varying vec2 vUv;
		uniform sampler2D tDepth;
		uniform sampler2D tNormal;
		uniform sampler2D tMetalness;
		uniform sampler2D tDiffuse;
		uniform float cameraRange;
		uniform vec2 resolution;
		uniform float opacity;
		uniform float cameraNear;
		uniform float cameraFar;
		uniform float maxDistance;
		uniform float surfDist;
		uniform mat4 cameraProjectionMatrix;
		uniform mat4 cameraInverseProjectionMatrix;
		uniform float thickTolerance;
		#include <packing>
		float pointToLineDistance(vec3 x0, vec3 x1, vec3 x2) {
			//x0: point, x1: linePointA, x2: linePointB
			//https://mathworld.wolfram.com/Point-LineDistance3-Dimensional.html
			return length(cross(x0-x1,x0-x2))/length(x2-x1);
		}
		float pointPlaneDistance(vec3 point,vec3 planePoint,vec3 planeNormal){
			// https://mathworld.wolfram.com/Point-PlaneDistance.html
			//// https://en.wikipedia.org/wiki/Plane_(geometry)
			//// http://paulbourke.net/geometry/pointlineplane/
			float a=planeNormal.x,b=planeNormal.y,c=planeNormal.z;
			float x0=point.x,y0=point.y,z0=point.z;
			float x=planePoint.x,y=planePoint.y,z=planePoint.z;
			float d=-(a*x+b*y+c*z);
			float distance=(a*x0+b*y0+c*z0+d)/sqrt(a*a+b*b+c*c);
			return distance;
		}
		float getDepth( const in vec2 uv ) {
			return texture2D( tDepth, uv ).x;
		}
		float getViewZ( const in float depth ) {
			#ifdef isPerspectiveCamera
				return perspectiveDepthToViewZ( depth, cameraNear, cameraFar );
			#else
				return orthographicDepthToViewZ( depth, cameraNear, cameraFar );
			#endif
		}
		vec3 getViewPosition( const in vec2 uv, const in float depth/*clip space*/, const in float clipW ) {
			vec4 clipPosition = vec4( ( vec3( uv, depth ) - 0.5 ) * 2.0, 1.0 );//ndc
			clipPosition *= clipW; //clip
			return ( cameraInverseProjectionMatrix * clipPosition ).xyz;//view
		}
		vec3 getViewNormal( const in vec2 uv ) {
			return unpackRGBToNormal( texture2D( tNormal, uv ).xyz );
		}
		vec2 viewPositionToXY(vec3 viewPosition){
			vec2 xy;
			vec4 clip=cameraProjectionMatrix*vec4(viewPosition,1);
			xy=clip.xy;//clip
			float clipW=clip.w;
			xy/=clipW;//NDC
			xy=(xy+1.)/2.;//uv
			xy*=resolution;//screen
			return xy;
		}
		void main(){
			#ifdef isSelective
				float metalness=texture2D(tMetalness,vUv).r;
				if(metalness==0.) return;
			#endif

			float depth = getDepth( vUv );
			float viewZ = getViewZ( depth );
			if(-viewZ>=cameraFar) return;

			float clipW = cameraProjectionMatrix[2][3] * viewZ+cameraProjectionMatrix[3][3];
			vec3 viewPosition=getViewPosition( vUv, depth, clipW );

			vec2 d0=gl_FragCoord.xy;
			vec2 d1;

			vec3 viewNormal=getViewNormal( vUv );

			#ifdef isPerspectiveCamera
				vec3 viewIncidenceDir=normalize(viewPosition);
				vec3 viewReflectDir=reflect(viewIncidenceDir,viewNormal);
			#else
				vec3 viewIncidenceDir=vec3(0,0,-1);
				vec3 viewReflectDir=reflect(viewIncidenceDir,viewNormal);
			#endif

			float maxReflectRayLen=maxDistance/dot(-viewIncidenceDir,viewNormal);
			// dot(a,b)==length(a)*length(b)*cos(theta) // https://www.mathsisfun.com/algebra/vectors-dot-product.html
			// if(a.isNormalized&&b.isNormalized) dot(a,b)==cos(theta)
			// maxDistance/maxReflectRayLen=cos(theta)
			// maxDistance/maxReflectRayLen==dot(a,b)
			// maxReflectRayLen==maxDistance/dot(a,b)

			vec3 d1viewPosition=viewPosition+viewReflectDir*maxReflectRayLen;
			#ifdef isPerspectiveCamera
				if(d1viewPosition.z>-cameraNear){
					//https://tutorial.math.lamar.edu/Classes/CalcIII/EqnsOfLines.aspx
					float t=(-cameraNear-viewPosition.z)/viewReflectDir.z;
					d1viewPosition=viewPosition+viewReflectDir*t;
				}
			#endif
			d1=viewPositionToXY(d1viewPosition);

			float totalLen=length(d1-d0);
			float xLen=d1.x-d0.x;
			float yLen=d1.y-d0.y;
			float totalStep=max(abs(xLen),abs(yLen));
			float xSpan=xLen/totalStep;
			float ySpan=yLen/totalStep;
			for(float i=0.;i<MAX_STEP;i++){
				if(i>=totalStep) break;
				vec2 xy=vec2(d0.x+i*xSpan,d0.y+i*ySpan);
				if(xy.x<0.||xy.x>resolution.x||xy.y<0.||xy.y>resolution.y) break;
				float s=length(xy-d0)/totalLen;
				vec2 uv=xy/resolution;

				float d = getDepth(uv);
				float vZ = getViewZ( d );
				if(-vZ>=cameraFar) continue;
				float cW = cameraProjectionMatrix[2][3] * vZ+cameraProjectionMatrix[3][3];
				vec3 vP=getViewPosition( uv, d, cW );

				#ifdef isPerspectiveCamera
					// https://www.comp.nus.edu.sg/~lowkl/publications/lowk_persp_interp_techrep.pdf
					float recipVPZ=1./viewPosition.z;
					float viewReflectRayZ=1./(recipVPZ+s*(1./d1viewPosition.z-recipVPZ));
					float sD=surfDist*cW;
				#else
					float viewReflectRayZ=viewPosition.z+s*(d1viewPosition.z-viewPosition.z);
					float sD=surfDist;
				#endif
				if(viewReflectRayZ-sD>vZ) continue;

				#ifdef isInfiniteThick
					if(viewReflectRayZ+thickTolerance*clipW<vP.z) break;
				#endif
				float away=pointToLineDistance(vP,viewPosition,d1viewPosition);

				float op=opacity;

				if(away<sD){
					vec3 vN=getViewNormal( uv );
					if(dot(viewReflectDir,vN)>=0.) continue;
					float distance=pointPlaneDistance(vP,viewPosition,viewNormal);
					if(distance>maxDistance) break;
					#ifdef isDistanceAttenuation
						float ratio=1.-(distance/maxDistance);
						float attenuation=ratio*ratio;
						op=opacity*attenuation;
					#endif
					#ifdef isFresnel
						float fresnel=(dot(viewIncidenceDir,viewReflectDir)+1.)/2.;
						op*=fresnel;
					#endif
					vec4 reflectColor=texture2D(tDiffuse,uv);
					gl_FragColor.xyz=reflectColor.xyz;
					gl_FragColor.a=op;
					break;
				}
			}
		}
	`},Mr={defines:{PERSPECTIVE_CAMERA:1},uniforms:{tDepth:{value:null},cameraNear:{value:null},cameraFar:{value:null}},vertexShader:`

    varying vec2 vUv;

    void main() {

    	vUv = uv;
    	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

    }

  `,fragmentShader:`

    uniform sampler2D tDepth;

    uniform float cameraNear;
    uniform float cameraFar;

    varying vec2 vUv;

    #include <packing>

		float getLinearDepth( const in vec2 uv ) {

			#if PERSPECTIVE_CAMERA == 1

				float fragCoordZ = texture2D( tDepth, uv ).x;
				float viewZ = perspectiveDepthToViewZ( fragCoordZ, cameraNear, cameraFar );
				return viewZToOrthographicDepth( viewZ, cameraNear, cameraFar );

			#else

				return texture2D( tDepth, uv ).x;

			#endif

		}

    void main() {

    	float depth = getLinearDepth( vUv );
			float d = 1.0 - depth;
			// d=(d-.999)*1000.;
    	gl_FragColor = vec4( vec3( d ), 1.0 );

    }

  `},xt={uniforms:{tDiffuse:{value:null},resolution:{value:new H},opacity:{value:.5}},vertexShader:`

    varying vec2 vUv;

    void main() {

    	vUv = uv;
    	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

    }

  `,fragmentShader:`

    uniform sampler2D tDiffuse;
    uniform vec2 resolution;
    varying vec2 vUv;
    void main() {
			//reverse engineering from PhotoShop blur filter, then change coefficient

    	vec2 texelSize = ( 1.0 / resolution );

			vec4 c=texture2D(tDiffuse,vUv);

			vec2 offset;

			offset=(vec2(-1,0))*texelSize;
			vec4 cl=texture2D(tDiffuse,vUv+offset);

			offset=(vec2(1,0))*texelSize;
			vec4 cr=texture2D(tDiffuse,vUv+offset);

			offset=(vec2(0,-1))*texelSize;
			vec4 cb=texture2D(tDiffuse,vUv+offset);

			offset=(vec2(0,1))*texelSize;
			vec4 ct=texture2D(tDiffuse,vUv+offset);

			// float coeCenter=.5;
			// float coeSide=.125;
			float coeCenter=.2;
			float coeSide=.2;
			float a=c.a*coeCenter+cl.a*coeSide+cr.a*coeSide+cb.a*coeSide+ct.a*coeSide;
			vec3 rgb=(c.rgb*c.a*coeCenter+cl.rgb*cl.a*coeSide+cr.rgb*cr.a*coeSide+cb.rgb*cb.a*coeSide+ct.rgb*ct.a*coeSide)/a;
			gl_FragColor=vec4(rgb,a);

		}
	`},Xt=class extends si{constructor({renderer:t,scene:e,camera:n,width:r,height:i,selects:s,bouncing:o=!1,groundReflector:a}){super(),this.width=r!==void 0?r:512,this.height=i!==void 0?i:512,this.clear=!0,this.renderer=t,this.scene=e,this.camera=n,this.groundReflector=a,this.opacity=tt.uniforms.opacity.value,this.output=0,this.maxDistance=tt.uniforms.maxDistance.value,this.thickness=tt.uniforms.thickness.value,this.tempColor=new q,this._selects=s,this.selective=Array.isArray(this._selects),Object.defineProperty(this,"selects",{get(){return this._selects},set(c){this._selects!==c&&(this._selects=c,Array.isArray(c)?(this.selective=!0,this.ssrMaterial.defines.SELECTIVE=!0,this.ssrMaterial.needsUpdate=!0):(this.selective=!1,this.ssrMaterial.defines.SELECTIVE=!1,this.ssrMaterial.needsUpdate=!0))}}),this._bouncing=o,Object.defineProperty(this,"bouncing",{get(){return this._bouncing},set(c){this._bouncing!==c&&(this._bouncing=c,c?this.ssrMaterial.uniforms.tDiffuse.value=this.prevRenderTarget.texture:this.ssrMaterial.uniforms.tDiffuse.value=this.beautyRenderTarget.texture)}}),this.blur=!0,this._distanceAttenuation=tt.defines.DISTANCE_ATTENUATION,Object.defineProperty(this,"distanceAttenuation",{get(){return this._distanceAttenuation},set(c){this._distanceAttenuation!==c&&(this._distanceAttenuation=c,this.ssrMaterial.defines.DISTANCE_ATTENUATION=c,this.ssrMaterial.needsUpdate=!0)}}),this._fresnel=tt.defines.FRESNEL,Object.defineProperty(this,"fresnel",{get(){return this._fresnel},set(c){this._fresnel!==c&&(this._fresnel=c,this.ssrMaterial.defines.FRESNEL=c,this.ssrMaterial.needsUpdate=!0)}}),this._infiniteThick=tt.defines.INFINITE_THICK,Object.defineProperty(this,"infiniteThick",{get(){return this._infiniteThick},set(c){this._infiniteThick!==c&&(this._infiniteThick=c,this.ssrMaterial.defines.INFINITE_THICK=c,this.ssrMaterial.needsUpdate=!0)}});const l=new ii;l.type=vs,l.minFilter=ne,l.magFilter=ne,this.beautyRenderTarget=new Be(this.width,this.height,{minFilter:ne,magFilter:ne,type:Me,depthTexture:l,depthBuffer:!0}),this.prevRenderTarget=new Be(this.width,this.height,{minFilter:ne,magFilter:ne}),this.normalRenderTarget=new Be(this.width,this.height,{minFilter:ne,magFilter:ne,type:Me}),this.metalnessRenderTarget=new Be(this.width,this.height,{minFilter:ne,magFilter:ne,type:Me}),this.ssrRenderTarget=new Be(this.width,this.height,{minFilter:ne,magFilter:ne}),this.blurRenderTarget=this.ssrRenderTarget.clone(),this.blurRenderTarget2=this.ssrRenderTarget.clone(),this.ssrMaterial=new se({defines:Object.assign({},tt.defines,{MAX_STEP:Math.sqrt(this.width*this.width+this.height*this.height)}),uniforms:fe.clone(tt.uniforms),vertexShader:tt.vertexShader,fragmentShader:tt.fragmentShader,blending:Y}),this.ssrMaterial.uniforms.tDiffuse.value=this.beautyRenderTarget.texture,this.ssrMaterial.uniforms.tNormal.value=this.normalRenderTarget.texture,this.ssrMaterial.defines.SELECTIVE=this.selective,this.ssrMaterial.needsUpdate=!0,this.ssrMaterial.uniforms.tMetalness.value=this.metalnessRenderTarget.texture,this.ssrMaterial.uniforms.tDepth.value=this.beautyRenderTarget.depthTexture,this.ssrMaterial.uniforms.cameraNear.value=this.camera.near,this.ssrMaterial.uniforms.cameraFar.value=this.camera.far,this.ssrMaterial.uniforms.thickness.value=this.thickness,this.ssrMaterial.uniforms.resolution.value.set(this.width,this.height),this.ssrMaterial.uniforms.cameraProjectionMatrix.value.copy(this.camera.projectionMatrix),this.ssrMaterial.uniforms.cameraInverseProjectionMatrix.value.copy(this.camera.projectionMatrixInverse),this.normalMaterial=new Cs,this.normalMaterial.blending=Y,this.metalnessOnMaterial=new gt({color:"white"}),this.metalnessOffMaterial=new gt({color:"black"}),this.blurMaterial=new se({defines:Object.assign({},xt.defines),uniforms:fe.clone(xt.uniforms),vertexShader:xt.vertexShader,fragmentShader:xt.fragmentShader}),this.blurMaterial.uniforms.tDiffuse.value=this.ssrRenderTarget.texture,this.blurMaterial.uniforms.resolution.value.set(this.width,this.height),this.blurMaterial2=new se({defines:Object.assign({},xt.defines),uniforms:fe.clone(xt.uniforms),vertexShader:xt.vertexShader,fragmentShader:xt.fragmentShader}),this.blurMaterial2.uniforms.tDiffuse.value=this.blurRenderTarget.texture,this.blurMaterial2.uniforms.resolution.value.set(this.width,this.height),this.depthRenderMaterial=new se({defines:Object.assign({},Mr.defines),uniforms:fe.clone(Mr.uniforms),vertexShader:Mr.vertexShader,fragmentShader:Mr.fragmentShader,blending:Y}),this.depthRenderMaterial.uniforms.tDepth.value=this.beautyRenderTarget.depthTexture,this.depthRenderMaterial.uniforms.cameraNear.value=this.camera.near,this.depthRenderMaterial.uniforms.cameraFar.value=this.camera.far,this.copyMaterial=new se({uniforms:fe.clone(it.uniforms),vertexShader:it.vertexShader,fragmentShader:it.fragmentShader,transparent:!0,depthTest:!1,depthWrite:!1,blendSrc:Ys,blendDst:$s,blendEquation:En,blendSrcAlpha:Ys,blendDstAlpha:$s,blendEquationAlpha:En}),this.fsQuad=new oi(null),this.originalClearColor=new q}dispose(){this.beautyRenderTarget.dispose(),this.prevRenderTarget.dispose(),this.normalRenderTarget.dispose(),this.metalnessRenderTarget.dispose(),this.ssrRenderTarget.dispose(),this.blurRenderTarget.dispose(),this.blurRenderTarget2.dispose(),this.normalMaterial.dispose(),this.metalnessOnMaterial.dispose(),this.metalnessOffMaterial.dispose(),this.blurMaterial.dispose(),this.blurMaterial2.dispose(),this.copyMaterial.dispose(),this.depthRenderMaterial.dispose(),this.fsQuad.dispose()}render(t,e){switch(t.setRenderTarget(this.beautyRenderTarget),t.clear(),this.groundReflector&&(this.groundReflector.visible=!1,this.groundReflector.doRender(this.renderer,this.scene,this.camera),this.groundReflector.visible=!0),t.render(this.scene,this.camera),this.groundReflector&&(this.groundReflector.visible=!1),this.renderOverride(t,this.normalMaterial,this.normalRenderTarget,0,0),this.selective&&this.renderMetalness(t,this.metalnessOnMaterial,this.metalnessRenderTarget,0,0),this.ssrMaterial.uniforms.opacity.value=this.opacity,this.ssrMaterial.uniforms.maxDistance.value=this.maxDistance,this.ssrMaterial.uniforms.thickness.value=this.thickness,this.renderPass(t,this.ssrMaterial,this.ssrRenderTarget),this.blur&&(this.renderPass(t,this.blurMaterial,this.blurRenderTarget),this.renderPass(t,this.blurMaterial2,this.blurRenderTarget2)),this.output){case Xt.OUTPUT.Default:this.bouncing?(this.copyMaterial.uniforms.tDiffuse.value=this.beautyRenderTarget.texture,this.copyMaterial.blending=Y,this.renderPass(t,this.copyMaterial,this.prevRenderTarget),this.blur?this.copyMaterial.uniforms.tDiffuse.value=this.blurRenderTarget2.texture:this.copyMaterial.uniforms.tDiffuse.value=this.ssrRenderTarget.texture,this.copyMaterial.blending=_i,this.renderPass(t,this.copyMaterial,this.prevRenderTarget),this.copyMaterial.uniforms.tDiffuse.value=this.prevRenderTarget.texture,this.copyMaterial.blending=Y,this.renderPass(t,this.copyMaterial,this.renderToScreen?null:e)):(this.copyMaterial.uniforms.tDiffuse.value=this.beautyRenderTarget.texture,this.copyMaterial.blending=Y,this.renderPass(t,this.copyMaterial,this.renderToScreen?null:e),this.blur?this.copyMaterial.uniforms.tDiffuse.value=this.blurRenderTarget2.texture:this.copyMaterial.uniforms.tDiffuse.value=this.ssrRenderTarget.texture,this.copyMaterial.blending=_i,this.renderPass(t,this.copyMaterial,this.renderToScreen?null:e));break;case Xt.OUTPUT.SSR:this.blur?this.copyMaterial.uniforms.tDiffuse.value=this.blurRenderTarget2.texture:this.copyMaterial.uniforms.tDiffuse.value=this.ssrRenderTarget.texture,this.copyMaterial.blending=Y,this.renderPass(t,this.copyMaterial,this.renderToScreen?null:e),this.bouncing&&(this.blur?this.copyMaterial.uniforms.tDiffuse.value=this.blurRenderTarget2.texture:this.copyMaterial.uniforms.tDiffuse.value=this.beautyRenderTarget.texture,this.copyMaterial.blending=Y,this.renderPass(t,this.copyMaterial,this.prevRenderTarget),this.copyMaterial.uniforms.tDiffuse.value=this.ssrRenderTarget.texture,this.copyMaterial.blending=_i,this.renderPass(t,this.copyMaterial,this.prevRenderTarget));break;case Xt.OUTPUT.Beauty:this.copyMaterial.uniforms.tDiffuse.value=this.beautyRenderTarget.texture,this.copyMaterial.blending=Y,this.renderPass(t,this.copyMaterial,this.renderToScreen?null:e);break;case Xt.OUTPUT.Depth:this.renderPass(t,this.depthRenderMaterial,this.renderToScreen?null:e);break;case Xt.OUTPUT.Normal:this.copyMaterial.uniforms.tDiffuse.value=this.normalRenderTarget.texture,this.copyMaterial.blending=Y,this.renderPass(t,this.copyMaterial,this.renderToScreen?null:e);break;case Xt.OUTPUT.Metalness:this.copyMaterial.uniforms.tDiffuse.value=this.metalnessRenderTarget.texture,this.copyMaterial.blending=Y,this.renderPass(t,this.copyMaterial,this.renderToScreen?null:e);break;default:console.warn("THREE.SSRPass: Unknown output type.")}}renderPass(t,e,n,r,i){this.originalClearColor.copy(t.getClearColor(this.tempColor));const s=t.getClearAlpha(this.tempColor),o=t.autoClear;t.setRenderTarget(n),t.autoClear=!1,r!=null&&(t.setClearColor(r),t.setClearAlpha(i||0),t.clear()),this.fsQuad.material=e,this.fsQuad.render(t),t.autoClear=o,t.setClearColor(this.originalClearColor),t.setClearAlpha(s)}renderOverride(t,e,n,r,i){this.originalClearColor.copy(t.getClearColor(this.tempColor));const s=t.getClearAlpha(this.tempColor),o=t.autoClear;t.setRenderTarget(n),t.autoClear=!1,r=e.clearColor||r,i=e.clearAlpha||i,r!=null&&(t.setClearColor(r),t.setClearAlpha(i||0),t.clear()),this.scene.overrideMaterial=e,t.render(this.scene,this.camera),this.scene.overrideMaterial=null,t.autoClear=o,t.setClearColor(this.originalClearColor),t.setClearAlpha(s)}renderMetalness(t,e,n,r,i){this.originalClearColor.copy(t.getClearColor(this.tempColor));const s=t.getClearAlpha(this.tempColor),o=t.autoClear;t.setRenderTarget(n),t.autoClear=!1,r=e.clearColor||r,i=e.clearAlpha||i,r!=null&&(t.setClearColor(r),t.setClearAlpha(i||0),t.clear()),this.scene.traverseVisible(a=>{a._SSRPassBackupMaterial=a.material,this._selects.includes(a)?a.material=this.metalnessOnMaterial:a.material=this.metalnessOffMaterial}),t.render(this.scene,this.camera),this.scene.traverseVisible(a=>{a.material=a._SSRPassBackupMaterial}),t.autoClear=o,t.setClearColor(this.originalClearColor),t.setClearAlpha(s)}setSize(t,e){this.width=t,this.height=e,this.ssrMaterial.defines.MAX_STEP=Math.sqrt(t*t+e*e),this.ssrMaterial.needsUpdate=!0,this.beautyRenderTarget.setSize(t,e),this.prevRenderTarget.setSize(t,e),this.ssrRenderTarget.setSize(t,e),this.normalRenderTarget.setSize(t,e),this.metalnessRenderTarget.setSize(t,e),this.blurRenderTarget.setSize(t,e),this.blurRenderTarget2.setSize(t,e),this.ssrMaterial.uniforms.resolution.value.set(t,e),this.ssrMaterial.uniforms.cameraProjectionMatrix.value.copy(this.camera.projectionMatrix),this.ssrMaterial.uniforms.cameraInverseProjectionMatrix.value.copy(this.camera.projectionMatrixInverse),this.blurMaterial.uniforms.resolution.value.set(t,e),this.blurMaterial2.uniforms.resolution.value.set(t,e)}};let mu=Xt;M(mu,"OUTPUT",{Default:0,SSR:1,Beauty:3,Depth:4,Normal:5,Metalness:7});class Lv extends ni{constructor(e){super(e),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(n){return new Cu(n)}),this.register(function(n){return new Iu(n)}),this.register(function(n){return new bu(n)}),this.register(function(n){return new Pu(n)}),this.register(function(n){return new Ru(n)}),this.register(function(n){return new Bu(n)}),this.register(function(n){return new yu(n)}),this.register(function(n){return new Su(n)}),this.register(function(n){return new vu(n)}),this.register(function(n){return new xu(n)}),this.register(function(n){return new Eu(n)}),this.register(function(n){return new Mu(n)}),this.register(function(n){return new gu(n)}),this.register(function(n){return new _u(n)}),this.register(function(n){return new wu(n)})}load(e,n,r,i){const s=this;let o;this.resourcePath!==""?o=this.resourcePath:this.path!==""?o=this.path:o=$t.extractUrlBase(e),this.manager.itemStart(e);const a=function(c){i?i(c):console.error(c),s.manager.itemError(e),s.manager.itemEnd(e)},l=new rt(this.manager);l.setPath(this.path),l.setResponseType("arraybuffer"),l.setRequestHeader(this.requestHeader),l.setWithCredentials(this.withCredentials),l.load(e,function(c){try{s.parse(c,o,function(u){n(u),s.manager.itemEnd(e)},a)}catch(u){a(u)}},r,a)}setDRACOLoader(e){return this.dracoLoader=e,this}setDDSLoader(){throw new Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}setKTX2Loader(e){return this.ktx2Loader=e,this}setMeshoptDecoder(e){return this.meshoptDecoder=e,this}register(e){return this.pluginCallbacks.indexOf(e)===-1&&this.pluginCallbacks.push(e),this}unregister(e){return this.pluginCallbacks.indexOf(e)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,n,r,i){let s;const o={},a={};if(typeof e=="string")s=JSON.parse(e);else if(e instanceof ArrayBuffer)if($t.decodeText(new Uint8Array(e.slice(0,4)))===Xa){try{o[J.KHR_BINARY_GLTF]=new Ou(e)}catch(u){i&&i(u);return}s=JSON.parse(o[J.KHR_BINARY_GLTF].content)}else s=JSON.parse($t.decodeText(new Uint8Array(e)));else s=e;if(s.asset===void 0||s.asset.version[0]<2){i&&i(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));return}const l=new Vu(s,{path:n||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});l.fileLoader.setRequestHeader(this.requestHeader);for(let c=0;c<this.pluginCallbacks.length;c++){const u=this.pluginCallbacks[c](l);a[u.name]=u,o[u.name]=!0}if(s.extensionsUsed)for(let c=0;c<s.extensionsUsed.length;++c){const u=s.extensionsUsed[c],h=s.extensionsRequired||[];switch(u){case J.KHR_MATERIALS_UNLIT:o[u]=new Tu;break;case J.KHR_DRACO_MESH_COMPRESSION:o[u]=new Fu(s,this.dracoLoader);break;case J.KHR_TEXTURE_TRANSFORM:o[u]=new Du;break;case J.KHR_MESH_QUANTIZATION:o[u]=new Nu;break;default:h.indexOf(u)>=0&&a[u]===void 0&&console.warn('THREE.GLTFLoader: Unknown extension "'+u+'".')}}l.setExtensions(o),l.setPlugins(a),l.parse(r,i)}parseAsync(e,n){const r=this;return new Promise(function(i,s){r.parse(e,n,i,s)})}}function Au(){let t={};return{get:function(e){return t[e]},add:function(e,n){t[e]=n},remove:function(e){delete t[e]},removeAll:function(){t={}}}}const J={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_ANISOTROPY:"KHR_materials_anisotropy",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_TEXTURE_AVIF:"EXT_texture_avif",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression",EXT_MESH_GPU_INSTANCING:"EXT_mesh_gpu_instancing"};class gu{constructor(e){this.parser=e,this.name=J.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const e=this.parser,n=this.parser.json.nodes||[];for(let r=0,i=n.length;r<i;r++){const s=n[r];s.extensions&&s.extensions[this.name]&&s.extensions[this.name].light!==void 0&&e._addNodeRef(this.cache,s.extensions[this.name].light)}}_loadLight(e){const n=this.parser,r="light:"+e;let i=n.cache.get(r);if(i)return i;const s=n.json,l=((s.extensions&&s.extensions[this.name]||{}).lights||[])[e];let c;const u=new q(16777215);l.color!==void 0&&u.fromArray(l.color);const h=l.range!==void 0?l.range:0;switch(l.type){case"directional":c=new hc(u),c.target.position.set(0,0,-1),c.add(c.target);break;case"point":c=new uc(u),c.distance=h;break;case"spot":c=new cc(u),c.distance=h,l.spot=l.spot||{},l.spot.innerConeAngle=l.spot.innerConeAngle!==void 0?l.spot.innerConeAngle:0,l.spot.outerConeAngle=l.spot.outerConeAngle!==void 0?l.spot.outerConeAngle:Math.PI/4,c.angle=l.spot.outerConeAngle,c.penumbra=1-l.spot.innerConeAngle/l.spot.outerConeAngle,c.target.position.set(0,0,-1),c.add(c.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+l.type)}return c.position.set(0,0,0),c.decay=2,It(c,l),l.intensity!==void 0&&(c.intensity=l.intensity),c.name=n.createUniqueName(l.name||"light_"+e),i=Promise.resolve(c),n.cache.add(r,i),i}getDependency(e,n){if(e==="light")return this._loadLight(n)}createNodeAttachment(e){const n=this,r=this.parser,s=r.json.nodes[e],a=(s.extensions&&s.extensions[this.name]||{}).light;return a===void 0?null:this._loadLight(a).then(function(l){return r._getNodeRef(n.cache,a,l)})}}class Tu{constructor(){this.name=J.KHR_MATERIALS_UNLIT}getMaterialType(){return gt}extendParams(e,n,r){const i=[];e.color=new q(1,1,1),e.opacity=1;const s=n.pbrMetallicRoughness;if(s){if(Array.isArray(s.baseColorFactor)){const o=s.baseColorFactor;e.color.fromArray(o),e.opacity=o[3]}s.baseColorTexture!==void 0&&i.push(r.assignTexture(e,"map",s.baseColorTexture,3001))}return Promise.all(i)}}class vu{constructor(e){this.parser=e,this.name=J.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(e,n){const i=this.parser.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const s=i.extensions[this.name].emissiveStrength;return s!==void 0&&(n.emissiveIntensity=s),Promise.resolve()}}class Cu{constructor(e){this.parser=e,this.name=J.KHR_MATERIALS_CLEARCOAT}getMaterialType(e){const r=this.parser.json.materials[e];return!r.extensions||!r.extensions[this.name]?null:Ft}extendMaterialParams(e,n){const r=this.parser,i=r.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const s=[],o=i.extensions[this.name];if(o.clearcoatFactor!==void 0&&(n.clearcoat=o.clearcoatFactor),o.clearcoatTexture!==void 0&&s.push(r.assignTexture(n,"clearcoatMap",o.clearcoatTexture)),o.clearcoatRoughnessFactor!==void 0&&(n.clearcoatRoughness=o.clearcoatRoughnessFactor),o.clearcoatRoughnessTexture!==void 0&&s.push(r.assignTexture(n,"clearcoatRoughnessMap",o.clearcoatRoughnessTexture)),o.clearcoatNormalTexture!==void 0&&(s.push(r.assignTexture(n,"clearcoatNormalMap",o.clearcoatNormalTexture)),o.clearcoatNormalTexture.scale!==void 0)){const a=o.clearcoatNormalTexture.scale;n.clearcoatNormalScale=new H(a,a)}return Promise.all(s)}}class Eu{constructor(e){this.parser=e,this.name=J.KHR_MATERIALS_IRIDESCENCE}getMaterialType(e){const r=this.parser.json.materials[e];return!r.extensions||!r.extensions[this.name]?null:Ft}extendMaterialParams(e,n){const r=this.parser,i=r.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const s=[],o=i.extensions[this.name];return o.iridescenceFactor!==void 0&&(n.iridescence=o.iridescenceFactor),o.iridescenceTexture!==void 0&&s.push(r.assignTexture(n,"iridescenceMap",o.iridescenceTexture)),o.iridescenceIor!==void 0&&(n.iridescenceIOR=o.iridescenceIor),n.iridescenceThicknessRange===void 0&&(n.iridescenceThicknessRange=[100,400]),o.iridescenceThicknessMinimum!==void 0&&(n.iridescenceThicknessRange[0]=o.iridescenceThicknessMinimum),o.iridescenceThicknessMaximum!==void 0&&(n.iridescenceThicknessRange[1]=o.iridescenceThicknessMaximum),o.iridescenceThicknessTexture!==void 0&&s.push(r.assignTexture(n,"iridescenceThicknessMap",o.iridescenceThicknessTexture)),Promise.all(s)}}class Ru{constructor(e){this.parser=e,this.name=J.KHR_MATERIALS_SHEEN}getMaterialType(e){const r=this.parser.json.materials[e];return!r.extensions||!r.extensions[this.name]?null:Ft}extendMaterialParams(e,n){const r=this.parser,i=r.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const s=[];n.sheenColor=new q(0,0,0),n.sheenRoughness=0,n.sheen=1;const o=i.extensions[this.name];return o.sheenColorFactor!==void 0&&n.sheenColor.fromArray(o.sheenColorFactor),o.sheenRoughnessFactor!==void 0&&(n.sheenRoughness=o.sheenRoughnessFactor),o.sheenColorTexture!==void 0&&s.push(r.assignTexture(n,"sheenColorMap",o.sheenColorTexture,3001)),o.sheenRoughnessTexture!==void 0&&s.push(r.assignTexture(n,"sheenRoughnessMap",o.sheenRoughnessTexture)),Promise.all(s)}}class Bu{constructor(e){this.parser=e,this.name=J.KHR_MATERIALS_TRANSMISSION}getMaterialType(e){const r=this.parser.json.materials[e];return!r.extensions||!r.extensions[this.name]?null:Ft}extendMaterialParams(e,n){const r=this.parser,i=r.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const s=[],o=i.extensions[this.name];return o.transmissionFactor!==void 0&&(n.transmission=o.transmissionFactor),o.transmissionTexture!==void 0&&s.push(r.assignTexture(n,"transmissionMap",o.transmissionTexture)),Promise.all(s)}}class yu{constructor(e){this.parser=e,this.name=J.KHR_MATERIALS_VOLUME}getMaterialType(e){const r=this.parser.json.materials[e];return!r.extensions||!r.extensions[this.name]?null:Ft}extendMaterialParams(e,n){const r=this.parser,i=r.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const s=[],o=i.extensions[this.name];n.thickness=o.thicknessFactor!==void 0?o.thicknessFactor:0,o.thicknessTexture!==void 0&&s.push(r.assignTexture(n,"thicknessMap",o.thicknessTexture)),n.attenuationDistance=o.attenuationDistance||1/0;const a=o.attenuationColor||[1,1,1];return n.attenuationColor=new q(a[0],a[1],a[2]),Promise.all(s)}}class Su{constructor(e){this.parser=e,this.name=J.KHR_MATERIALS_IOR}getMaterialType(e){const r=this.parser.json.materials[e];return!r.extensions||!r.extensions[this.name]?null:Ft}extendMaterialParams(e,n){const i=this.parser.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const s=i.extensions[this.name];return n.ior=s.ior!==void 0?s.ior:1.5,Promise.resolve()}}class xu{constructor(e){this.parser=e,this.name=J.KHR_MATERIALS_SPECULAR}getMaterialType(e){const r=this.parser.json.materials[e];return!r.extensions||!r.extensions[this.name]?null:Ft}extendMaterialParams(e,n){const r=this.parser,i=r.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const s=[],o=i.extensions[this.name];n.specularIntensity=o.specularFactor!==void 0?o.specularFactor:1,o.specularTexture!==void 0&&s.push(r.assignTexture(n,"specularIntensityMap",o.specularTexture));const a=o.specularColorFactor||[1,1,1];return n.specularColor=new q(a[0],a[1],a[2]),o.specularColorTexture!==void 0&&s.push(r.assignTexture(n,"specularColorMap",o.specularColorTexture,3001)),Promise.all(s)}}class Mu{constructor(e){this.parser=e,this.name=J.KHR_MATERIALS_ANISOTROPY}getMaterialType(e){const r=this.parser.json.materials[e];return!r.extensions||!r.extensions[this.name]?null:Ft}extendMaterialParams(e,n){const r=this.parser,i=r.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const s=[],o=i.extensions[this.name];return o.anisotropyStrength!==void 0&&(n.anisotropy=o.anisotropyStrength),o.anisotropyRotation!==void 0&&(n.anisotropyRotation=o.anisotropyRotation),o.anisotropyTexture!==void 0&&s.push(r.assignTexture(n,"anisotropyMap",o.anisotropyTexture)),Promise.all(s)}}class Iu{constructor(e){this.parser=e,this.name=J.KHR_TEXTURE_BASISU}loadTexture(e){const n=this.parser,r=n.json,i=r.textures[e];if(!i.extensions||!i.extensions[this.name])return null;const s=i.extensions[this.name],o=n.options.ktx2Loader;if(!o){if(r.extensionsRequired&&r.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return n.loadTextureImage(e,s.source,o)}}class bu{constructor(e){this.parser=e,this.name=J.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(e){const n=this.name,r=this.parser,i=r.json,s=i.textures[e];if(!s.extensions||!s.extensions[n])return null;const o=s.extensions[n],a=i.images[o.source];let l=r.textureLoader;if(a.uri){const c=r.options.manager.getHandler(a.uri);c!==null&&(l=c)}return this.detectSupport().then(function(c){if(c)return r.loadTextureImage(e,o.source,l);if(i.extensionsRequired&&i.extensionsRequired.indexOf(n)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return r.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){const n=new Image;n.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",n.onload=n.onerror=function(){e(n.height===1)}})),this.isSupported}}class Pu{constructor(e){this.parser=e,this.name=J.EXT_TEXTURE_AVIF,this.isSupported=null}loadTexture(e){const n=this.name,r=this.parser,i=r.json,s=i.textures[e];if(!s.extensions||!s.extensions[n])return null;const o=s.extensions[n],a=i.images[o.source];let l=r.textureLoader;if(a.uri){const c=r.options.manager.getHandler(a.uri);c!==null&&(l=c)}return this.detectSupport().then(function(c){if(c)return r.loadTextureImage(e,o.source,l);if(i.extensionsRequired&&i.extensionsRequired.indexOf(n)>=0)throw new Error("THREE.GLTFLoader: AVIF required by asset but unsupported.");return r.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){const n=new Image;n.src="data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAABcAAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAEAAAABAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQAMAAAAABNjb2xybmNseAACAAIABoAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAAB9tZGF0EgAKCBgABogQEDQgMgkQAAAAB8dSLfI=",n.onload=n.onerror=function(){e(n.height===1)}})),this.isSupported}}class _u{constructor(e){this.name=J.EXT_MESHOPT_COMPRESSION,this.parser=e}loadBufferView(e){const n=this.parser.json,r=n.bufferViews[e];if(r.extensions&&r.extensions[this.name]){const i=r.extensions[this.name],s=this.parser.getDependency("buffer",i.buffer),o=this.parser.options.meshoptDecoder;if(!o||!o.supported){if(n.extensionsRequired&&n.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return s.then(function(a){const l=i.byteOffset||0,c=i.byteLength||0,u=i.count,h=i.byteStride,f=new Uint8Array(a,l,c);return o.decodeGltfBufferAsync?o.decodeGltfBufferAsync(u,h,f,i.mode,i.filter).then(function(T){return T.buffer}):o.ready.then(function(){const T=new ArrayBuffer(u*h);return o.decodeGltfBuffer(new Uint8Array(T),u,h,f,i.mode,i.filter),T})})}else return null}}class wu{constructor(e){this.name=J.EXT_MESH_GPU_INSTANCING,this.parser=e}createNodeMesh(e){const n=this.parser.json,r=n.nodes[e];if(!r.extensions||!r.extensions[this.name]||r.mesh===void 0)return null;const i=n.meshes[r.mesh];for(const c of i.primitives)if(c.mode!==Ue.TRIANGLES&&c.mode!==Ue.TRIANGLE_STRIP&&c.mode!==Ue.TRIANGLE_FAN&&c.mode!==void 0)return null;const o=r.extensions[this.name].attributes,a=[],l={};for(const c in o)a.push(this.parser.getDependency("accessor",o[c]).then(u=>(l[c]=u,l[c])));return a.length<1?null:(a.push(this.parser.createNodeMesh(e)),Promise.all(a).then(c=>{const u=c.pop(),h=u.isGroup?u.children:[u],f=c[0].count,T=[];for(const g of h){const d=new oe,A=new P,v=new er,m=new P(1,1,1),p=new fc(g.geometry,g.material,f);for(let C=0;C<f;C++)l.TRANSLATION&&A.fromBufferAttribute(l.TRANSLATION,C),l.ROTATION&&v.fromBufferAttribute(l.ROTATION,C),l.SCALE&&m.fromBufferAttribute(l.SCALE,C),p.setMatrixAt(C,d.compose(A,v,m));for(const C in l)C!=="TRANSLATION"&&C!=="ROTATION"&&C!=="SCALE"&&g.geometry.setAttribute(C,l[C]);fa.prototype.copy.call(p,g),this.parser.assignFinalMaterial(p),T.push(p)}return u.isGroup?(u.clear(),u.add(...T),u):T[0]}))}}const Xa="glTF",Gn=12,no={JSON:1313821514,BIN:5130562};class Ou{constructor(e){this.name=J.KHR_BINARY_GLTF,this.content=null,this.body=null;const n=new DataView(e,0,Gn);if(this.header={magic:$t.decodeText(new Uint8Array(e.slice(0,4))),version:n.getUint32(4,!0),length:n.getUint32(8,!0)},this.header.magic!==Xa)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const r=this.header.length-Gn,i=new DataView(e,Gn);let s=0;for(;s<r;){const o=i.getUint32(s,!0);s+=4;const a=i.getUint32(s,!0);if(s+=4,a===no.JSON){const l=new Uint8Array(e,Gn+s,o);this.content=$t.decodeText(l)}else if(a===no.BIN){const l=Gn+s;this.body=e.slice(l,l+o)}s+=o}if(this.content===null)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class Fu{constructor(e,n){if(!n)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=J.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=n,this.dracoLoader.preload()}decodePrimitive(e,n){const r=this.json,i=this.dracoLoader,s=e.extensions[this.name].bufferView,o=e.extensions[this.name].attributes,a={},l={},c={};for(const u in o){const h=rs[u]||u.toLowerCase();a[h]=o[u]}for(const u in e.attributes){const h=rs[u]||u.toLowerCase();if(o[u]!==void 0){const f=r.accessors[e.attributes[u]],T=gn[f.componentType];c[h]=T.name,l[h]=f.normalized===!0}}return n.getDependency("bufferView",s).then(function(u){return new Promise(function(h){i.decodeDracoFile(u,function(f){for(const T in f.attributes){const g=f.attributes[T],d=l[T];d!==void 0&&(g.normalized=d)}h(f)},a,c)})})}}class Du{constructor(){this.name=J.KHR_TEXTURE_TRANSFORM}extendTexture(e,n){return(n.texCoord===void 0||n.texCoord===e.channel)&&n.offset===void 0&&n.rotation===void 0&&n.scale===void 0||(e=e.clone(),n.texCoord!==void 0&&(e.channel=n.texCoord),n.offset!==void 0&&e.offset.fromArray(n.offset),n.rotation!==void 0&&(e.rotation=n.rotation),n.scale!==void 0&&e.repeat.fromArray(n.scale),e.needsUpdate=!0),e}}class Nu{constructor(){this.name=J.KHR_MESH_QUANTIZATION}}class Qa extends Yc{constructor(e,n,r,i){super(e,n,r,i)}copySampleValue_(e){const n=this.resultBuffer,r=this.sampleValues,i=this.valueSize,s=e*i*3+i;for(let o=0;o!==i;o++)n[o]=r[s+o];return n}interpolate_(e,n,r,i){const s=this.resultBuffer,o=this.sampleValues,a=this.valueSize,l=a*2,c=a*3,u=i-n,h=(r-n)/u,f=h*h,T=f*h,g=e*c,d=g-c,A=-2*T+3*f,v=T-f,m=1-A,p=v-f+h;for(let C=0;C!==a;C++){const R=o[d+C+a],y=o[d+C+l]*u,B=o[g+C+a],x=o[g+C]*u;s[C]=m*R+p*y+A*B+v*x}return s}}const Lu=new er;class Gu extends Qa{interpolate_(e,n,r,i){const s=super.interpolate_(e,n,r,i);return Lu.fromArray(s).normalize().toArray(s),s}}const Ue={FLOAT:5126,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,LINEAR:9729,REPEAT:10497,SAMPLER_2D:35678,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123},gn={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},ro={9728:ne,9729:Cn,9984:wc,9985:Oc,9986:Fc,9987:ri},io={33071:zt,33648:Dc,10497:Zt},Oi={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},rs={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",...or.replace(/\D+/g,"")>=152?{TEXCOORD_0:"uv",TEXCOORD_1:"uv1",TEXCOORD_2:"uv2",TEXCOORD_3:"uv3"}:{TEXCOORD_0:"uv",TEXCOORD_1:"uv2"},COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},Mt={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},ku={CUBICSPLINE:void 0,LINEAR:ma,STEP:Nc},Fi={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};function Uu(t){return t.DefaultMaterial===void 0&&(t.DefaultMaterial=new da({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:Lc})),t.DefaultMaterial}function jt(t,e,n){for(const r in n.extensions)t[r]===void 0&&(e.userData.gltfExtensions=e.userData.gltfExtensions||{},e.userData.gltfExtensions[r]=n.extensions[r])}function It(t,e){e.extras!==void 0&&(typeof e.extras=="object"?Object.assign(t.userData,e.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+e.extras))}function Hu(t,e,n){let r=!1,i=!1,s=!1;for(let c=0,u=e.length;c<u;c++){const h=e[c];if(h.POSITION!==void 0&&(r=!0),h.NORMAL!==void 0&&(i=!0),h.COLOR_0!==void 0&&(s=!0),r&&i&&s)break}if(!r&&!i&&!s)return Promise.resolve(t);const o=[],a=[],l=[];for(let c=0,u=e.length;c<u;c++){const h=e[c];if(r){const f=h.POSITION!==void 0?n.getDependency("accessor",h.POSITION):t.attributes.position;o.push(f)}if(i){const f=h.NORMAL!==void 0?n.getDependency("accessor",h.NORMAL):t.attributes.normal;a.push(f)}if(s){const f=h.COLOR_0!==void 0?n.getDependency("accessor",h.COLOR_0):t.attributes.color;l.push(f)}}return Promise.all([Promise.all(o),Promise.all(a),Promise.all(l)]).then(function(c){const u=c[0],h=c[1],f=c[2];return r&&(t.morphAttributes.position=u),i&&(t.morphAttributes.normal=h),s&&(t.morphAttributes.color=f),t.morphTargetsRelative=!0,t})}function Ku(t,e){if(t.updateMorphTargets(),e.weights!==void 0)for(let n=0,r=e.weights.length;n<r;n++)t.morphTargetInfluences[n]=e.weights[n];if(e.extras&&Array.isArray(e.extras.targetNames)){const n=e.extras.targetNames;if(t.morphTargetInfluences.length===n.length){t.morphTargetDictionary={};for(let r=0,i=n.length;r<i;r++)t.morphTargetDictionary[n[r]]=r}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function Ju(t){let e;const n=t.extensions&&t.extensions[J.KHR_DRACO_MESH_COMPRESSION];if(n?e="draco:"+n.bufferView+":"+n.indices+":"+Di(n.attributes):e=t.indices+":"+Di(t.attributes)+":"+t.mode,t.targets!==void 0)for(let r=0,i=t.targets.length;r<i;r++)e+=":"+Di(t.targets[r]);return e}function Di(t){let e="";const n=Object.keys(t).sort();for(let r=0,i=n.length;r<i;r++)e+=n[r]+":"+t[n[r]]+";";return e}function is(t){switch(t){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}function ju(t){return t.search(/\.jpe?g($|\?)/i)>0||t.search(/^data\:image\/jpeg/)===0?"image/jpeg":t.search(/\.webp($|\?)/i)>0||t.search(/^data\:image\/webp/)===0?"image/webp":"image/png"}const Wu=new oe;class Vu{constructor(e={},n={}){this.json=e,this.extensions={},this.plugins={},this.options=n,this.cache=new Au,this.associations=new Map,this.primitiveCache={},this.nodeCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};let r=!1,i=!1,s=-1;typeof navigator<"u"&&typeof navigator.userAgent<"u"&&(r=/^((?!chrome|android).)*safari/i.test(navigator.userAgent)===!0,i=navigator.userAgent.indexOf("Firefox")>-1,s=i?navigator.userAgent.match(/Firefox\/([0-9]+)\./)[1]:-1),typeof createImageBitmap>"u"||r||i&&s<98?this.textureLoader=new dc(this.options.manager):this.textureLoader=new pc(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new rt(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),this.options.crossOrigin==="use-credentials"&&this.fileLoader.setWithCredentials(!0)}setExtensions(e){this.extensions=e}setPlugins(e){this.plugins=e}parse(e,n){const r=this,i=this.json,s=this.extensions;this.cache.removeAll(),this.nodeCache={},this._invokeAll(function(o){return o._markDefs&&o._markDefs()}),Promise.all(this._invokeAll(function(o){return o.beforeRoot&&o.beforeRoot()})).then(function(){return Promise.all([r.getDependencies("scene"),r.getDependencies("animation"),r.getDependencies("camera")])}).then(function(o){const a={scene:o[0][i.scene||0],scenes:o[0],animations:o[1],cameras:o[2],asset:i.asset,parser:r,userData:{}};jt(s,a,i),It(a,i),Promise.all(r._invokeAll(function(l){return l.afterRoot&&l.afterRoot(a)})).then(function(){e(a)})}).catch(n)}_markDefs(){const e=this.json.nodes||[],n=this.json.skins||[],r=this.json.meshes||[];for(let i=0,s=n.length;i<s;i++){const o=n[i].joints;for(let a=0,l=o.length;a<l;a++)e[o[a]].isBone=!0}for(let i=0,s=e.length;i<s;i++){const o=e[i];o.mesh!==void 0&&(this._addNodeRef(this.meshCache,o.mesh),o.skin!==void 0&&(r[o.mesh].isSkinnedMesh=!0)),o.camera!==void 0&&this._addNodeRef(this.cameraCache,o.camera)}}_addNodeRef(e,n){n!==void 0&&(e.refs[n]===void 0&&(e.refs[n]=e.uses[n]=0),e.refs[n]++)}_getNodeRef(e,n,r){if(e.refs[n]<=1)return r;const i=r.clone(),s=(o,a)=>{const l=this.associations.get(o);l!=null&&this.associations.set(a,l);for(const[c,u]of o.children.entries())s(u,a.children[c])};return s(r,i),i.name+="_instance_"+e.uses[n]++,i}_invokeOne(e){const n=Object.values(this.plugins);n.push(this);for(let r=0;r<n.length;r++){const i=e(n[r]);if(i)return i}return null}_invokeAll(e){const n=Object.values(this.plugins);n.unshift(this);const r=[];for(let i=0;i<n.length;i++){const s=e(n[i]);s&&r.push(s)}return r}getDependency(e,n){const r=e+":"+n;let i=this.cache.get(r);if(!i){switch(e){case"scene":i=this.loadScene(n);break;case"node":i=this._invokeOne(function(s){return s.loadNode&&s.loadNode(n)});break;case"mesh":i=this._invokeOne(function(s){return s.loadMesh&&s.loadMesh(n)});break;case"accessor":i=this.loadAccessor(n);break;case"bufferView":i=this._invokeOne(function(s){return s.loadBufferView&&s.loadBufferView(n)});break;case"buffer":i=this.loadBuffer(n);break;case"material":i=this._invokeOne(function(s){return s.loadMaterial&&s.loadMaterial(n)});break;case"texture":i=this._invokeOne(function(s){return s.loadTexture&&s.loadTexture(n)});break;case"skin":i=this.loadSkin(n);break;case"animation":i=this._invokeOne(function(s){return s.loadAnimation&&s.loadAnimation(n)});break;case"camera":i=this.loadCamera(n);break;default:if(i=this._invokeOne(function(s){return s!=this&&s.getDependency&&s.getDependency(e,n)}),!i)throw new Error("Unknown type: "+e);break}this.cache.add(r,i)}return i}getDependencies(e){let n=this.cache.get(e);if(!n){const r=this,i=this.json[e+(e==="mesh"?"es":"s")]||[];n=Promise.all(i.map(function(s,o){return r.getDependency(e,o)})),this.cache.add(e,n)}return n}loadBuffer(e){const n=this.json.buffers[e],r=this.fileLoader;if(n.type&&n.type!=="arraybuffer")throw new Error("THREE.GLTFLoader: "+n.type+" buffer type is not supported.");if(n.uri===void 0&&e===0)return Promise.resolve(this.extensions[J.KHR_BINARY_GLTF].body);const i=this.options;return new Promise(function(s,o){r.load($t.resolveURL(n.uri,i.path),s,void 0,function(){o(new Error('THREE.GLTFLoader: Failed to load buffer "'+n.uri+'".'))})})}loadBufferView(e){const n=this.json.bufferViews[e];return this.getDependency("buffer",n.buffer).then(function(r){const i=n.byteLength||0,s=n.byteOffset||0;return r.slice(s,s+i)})}loadAccessor(e){const n=this,r=this.json,i=this.json.accessors[e];if(i.bufferView===void 0&&i.sparse===void 0){const o=Oi[i.type],a=gn[i.componentType],l=i.normalized===!0,c=new a(i.count*o);return Promise.resolve(new Qn(c,o,l))}const s=[];return i.bufferView!==void 0?s.push(this.getDependency("bufferView",i.bufferView)):s.push(null),i.sparse!==void 0&&(s.push(this.getDependency("bufferView",i.sparse.indices.bufferView)),s.push(this.getDependency("bufferView",i.sparse.values.bufferView))),Promise.all(s).then(function(o){const a=o[0],l=Oi[i.type],c=gn[i.componentType],u=c.BYTES_PER_ELEMENT,h=u*l,f=i.byteOffset||0,T=i.bufferView!==void 0?r.bufferViews[i.bufferView].byteStride:void 0,g=i.normalized===!0;let d,A;if(T&&T!==h){const v=Math.floor(f/T),m="InterleavedBuffer:"+i.bufferView+":"+i.componentType+":"+v+":"+i.count;let p=n.cache.get(m);p||(d=new c(a,v*T,i.count*T/u),p=new mc(d,T/u),n.cache.add(m,p)),A=new Gc(p,l,f%T/u,g)}else a===null?d=new c(i.count*l):d=new c(a,f,i.count*l),A=new Qn(d,l,g);if(i.sparse!==void 0){const v=Oi.SCALAR,m=gn[i.sparse.indices.componentType],p=i.sparse.indices.byteOffset||0,C=i.sparse.values.byteOffset||0,R=new m(o[1],p,i.sparse.count*v),y=new c(o[2],C,i.sparse.count*l);a!==null&&(A=new Qn(A.array.slice(),A.itemSize,A.normalized));for(let B=0,x=R.length;B<x;B++){const I=R[B];if(A.setX(I,y[B*l]),l>=2&&A.setY(I,y[B*l+1]),l>=3&&A.setZ(I,y[B*l+2]),l>=4&&A.setW(I,y[B*l+3]),l>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return A})}loadTexture(e){const n=this.json,r=this.options,s=n.textures[e].source,o=n.images[s];let a=this.textureLoader;if(o.uri){const l=r.manager.getHandler(o.uri);l!==null&&(a=l)}return this.loadTextureImage(e,s,a)}loadTextureImage(e,n,r){const i=this,s=this.json,o=s.textures[e],a=s.images[n],l=(a.uri||a.bufferView)+":"+o.sampler;if(this.textureCache[l])return this.textureCache[l];const c=this.loadImageSource(n,r).then(function(u){u.flipY=!1,u.name=o.name||a.name||"",u.name===""&&typeof a.uri=="string"&&a.uri.startsWith("data:image/")===!1&&(u.name=a.uri);const f=(s.samplers||{})[o.sampler]||{};return u.magFilter=ro[f.magFilter]||Cn,u.minFilter=ro[f.minFilter]||ri,u.wrapS=io[f.wrapS]||Zt,u.wrapT=io[f.wrapT]||Zt,i.associations.set(u,{textures:e}),u}).catch(function(){return null});return this.textureCache[l]=c,c}loadImageSource(e,n){const r=this,i=this.json,s=this.options;if(this.sourceCache[e]!==void 0)return this.sourceCache[e].then(h=>h.clone());const o=i.images[e],a=self.URL||self.webkitURL;let l=o.uri||"",c=!1;if(o.bufferView!==void 0)l=r.getDependency("bufferView",o.bufferView).then(function(h){c=!0;const f=new Blob([h],{type:o.mimeType});return l=a.createObjectURL(f),l});else if(o.uri===void 0)throw new Error("THREE.GLTFLoader: Image "+e+" is missing URI and bufferView");const u=Promise.resolve(l).then(function(h){return new Promise(function(f,T){let g=f;n.isImageBitmapLoader===!0&&(g=function(d){const A=new Zi(d);A.needsUpdate=!0,f(A)}),n.load($t.resolveURL(h,s.path),g,void 0,T)})}).then(function(h){return c===!0&&a.revokeObjectURL(l),h.userData.mimeType=o.mimeType||ju(o.uri),h}).catch(function(h){throw console.error("THREE.GLTFLoader: Couldn't load texture",l),h});return this.sourceCache[e]=u,u}assignTexture(e,n,r,i){const s=this;return this.getDependency("texture",r.index).then(function(o){if(!o)return null;if(r.texCoord!==void 0&&r.texCoord>0&&(o=o.clone(),o.channel=r.texCoord),s.extensions[J.KHR_TEXTURE_TRANSFORM]){const a=r.extensions!==void 0?r.extensions[J.KHR_TEXTURE_TRANSFORM]:void 0;if(a){const l=s.associations.get(o);o=s.extensions[J.KHR_TEXTURE_TRANSFORM].extendTexture(o,a),s.associations.set(o,l)}}return i!==void 0&&("colorSpace"in o?o.colorSpace=i===3001?"srgb":"srgb-linear":o.encoding=i),e[n]=o,o})}assignFinalMaterial(e){const n=e.geometry;let r=e.material;const i=n.attributes.tangent===void 0,s=n.attributes.color!==void 0,o=n.attributes.normal===void 0;if(e.isPoints){const a="PointsMaterial:"+r.uuid;let l=this.cache.get(a);l||(l=new Ac,Mi.prototype.copy.call(l,r),l.color.copy(r.color),l.map=r.map,l.sizeAttenuation=!1,this.cache.add(a,l)),r=l}else if(e.isLine){const a="LineBasicMaterial:"+r.uuid;let l=this.cache.get(a);l||(l=new gc,Mi.prototype.copy.call(l,r),l.color.copy(r.color),l.map=r.map,this.cache.add(a,l)),r=l}if(i||s||o){let a="ClonedMaterial:"+r.uuid+":";i&&(a+="derivative-tangents:"),s&&(a+="vertex-colors:"),o&&(a+="flat-shading:");let l=this.cache.get(a);l||(l=r.clone(),s&&(l.vertexColors=!0),o&&(l.flatShading=!0),i&&(l.normalScale&&(l.normalScale.y*=-1),l.clearcoatNormalScale&&(l.clearcoatNormalScale.y*=-1)),this.cache.add(a,l),this.associations.set(l,this.associations.get(r))),r=l}e.material=r}getMaterialType(){return da}loadMaterial(e){const n=this,r=this.json,i=this.extensions,s=r.materials[e];let o;const a={},l=s.extensions||{},c=[];if(l[J.KHR_MATERIALS_UNLIT]){const h=i[J.KHR_MATERIALS_UNLIT];o=h.getMaterialType(),c.push(h.extendParams(a,s,n))}else{const h=s.pbrMetallicRoughness||{};if(a.color=new q(1,1,1),a.opacity=1,Array.isArray(h.baseColorFactor)){const f=h.baseColorFactor;a.color.fromArray(f),a.opacity=f[3]}h.baseColorTexture!==void 0&&c.push(n.assignTexture(a,"map",h.baseColorTexture,3001)),a.metalness=h.metallicFactor!==void 0?h.metallicFactor:1,a.roughness=h.roughnessFactor!==void 0?h.roughnessFactor:1,h.metallicRoughnessTexture!==void 0&&(c.push(n.assignTexture(a,"metalnessMap",h.metallicRoughnessTexture)),c.push(n.assignTexture(a,"roughnessMap",h.metallicRoughnessTexture))),o=this._invokeOne(function(f){return f.getMaterialType&&f.getMaterialType(e)}),c.push(Promise.all(this._invokeAll(function(f){return f.extendMaterialParams&&f.extendMaterialParams(e,a)})))}s.doubleSided===!0&&(a.side=Tc);const u=s.alphaMode||Fi.OPAQUE;if(u===Fi.BLEND?(a.transparent=!0,a.depthWrite=!1):(a.transparent=!1,u===Fi.MASK&&(a.alphaTest=s.alphaCutoff!==void 0?s.alphaCutoff:.5)),s.normalTexture!==void 0&&o!==gt&&(c.push(n.assignTexture(a,"normalMap",s.normalTexture)),a.normalScale=new H(1,1),s.normalTexture.scale!==void 0)){const h=s.normalTexture.scale;a.normalScale.set(h,h)}return s.occlusionTexture!==void 0&&o!==gt&&(c.push(n.assignTexture(a,"aoMap",s.occlusionTexture)),s.occlusionTexture.strength!==void 0&&(a.aoMapIntensity=s.occlusionTexture.strength)),s.emissiveFactor!==void 0&&o!==gt&&(a.emissive=new q().fromArray(s.emissiveFactor)),s.emissiveTexture!==void 0&&o!==gt&&c.push(n.assignTexture(a,"emissiveMap",s.emissiveTexture,3001)),Promise.all(c).then(function(){const h=new o(a);return s.name&&(h.name=s.name),It(h,s),n.associations.set(h,{materials:e}),s.extensions&&jt(i,h,s),h})}createUniqueName(e){const n=vc.sanitizeNodeName(e||"");return n in this.nodeNamesUsed?n+"_"+ ++this.nodeNamesUsed[n]:(this.nodeNamesUsed[n]=0,n)}loadGeometries(e){const n=this,r=this.extensions,i=this.primitiveCache;function s(a){return r[J.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(a,n).then(function(l){return so(l,a,n)})}const o=[];for(let a=0,l=e.length;a<l;a++){const c=e[a],u=Ju(c),h=i[u];if(h)o.push(h.promise);else{let f;c.extensions&&c.extensions[J.KHR_DRACO_MESH_COMPRESSION]?f=s(c):f=so(new Mn,c,n),i[u]={primitive:c,promise:f},o.push(f)}}return Promise.all(o)}loadMesh(e){const n=this,r=this.json,i=this.extensions,s=r.meshes[e],o=s.primitives,a=[];for(let l=0,c=o.length;l<c;l++){const u=o[l].material===void 0?Uu(this.cache):this.getDependency("material",o[l].material);a.push(u)}return a.push(n.loadGeometries(o)),Promise.all(a).then(function(l){const c=l.slice(0,l.length-1),u=l[l.length-1],h=[];for(let T=0,g=u.length;T<g;T++){const d=u[T],A=o[T];let v;const m=c[T];if(A.mode===Ue.TRIANGLES||A.mode===Ue.TRIANGLE_STRIP||A.mode===Ue.TRIANGLE_FAN||A.mode===void 0)v=s.isSkinnedMesh===!0?new Cc(d,m):new He(d,m),v.isSkinnedMesh===!0&&v.normalizeSkinWeights(),A.mode===Ue.TRIANGLE_STRIP?v.geometry=qs(v.geometry,Sa):A.mode===Ue.TRIANGLE_FAN&&(v.geometry=qs(v.geometry,Yi));else if(A.mode===Ue.LINES)v=new Ec(d,m);else if(A.mode===Ue.LINE_STRIP)v=new Rc(d,m);else if(A.mode===Ue.LINE_LOOP)v=new Bc(d,m);else if(A.mode===Ue.POINTS)v=new pa(d,m);else throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+A.mode);Object.keys(v.geometry.morphAttributes).length>0&&Ku(v,s),v.name=n.createUniqueName(s.name||"mesh_"+e),It(v,s),A.extensions&&jt(i,v,A),n.assignFinalMaterial(v),h.push(v)}for(let T=0,g=h.length;T<g;T++)n.associations.set(h[T],{meshes:e,primitives:T});if(h.length===1)return s.extensions&&jt(i,h[0],s),h[0];const f=new Ii;s.extensions&&jt(i,f,s),n.associations.set(f,{meshes:e});for(let T=0,g=h.length;T<g;T++)f.add(h[T]);return f})}loadCamera(e){let n;const r=this.json.cameras[e],i=r[r.type];if(!i){console.warn("THREE.GLTFLoader: Missing camera parameters.");return}return r.type==="perspective"?n=new bt(An.radToDeg(i.yfov),i.aspectRatio||1,i.znear||1,i.zfar||2e6):r.type==="orthographic"&&(n=new mn(-i.xmag,i.xmag,i.ymag,-i.ymag,i.znear,i.zfar)),r.name&&(n.name=this.createUniqueName(r.name)),It(n,r),Promise.resolve(n)}loadSkin(e){const n=this.json.skins[e],r=[];for(let i=0,s=n.joints.length;i<s;i++)r.push(this._loadNodeShallow(n.joints[i]));return n.inverseBindMatrices!==void 0?r.push(this.getDependency("accessor",n.inverseBindMatrices)):r.push(null),Promise.all(r).then(function(i){const s=i.pop(),o=i,a=[],l=[];for(let c=0,u=o.length;c<u;c++){const h=o[c];if(h){a.push(h);const f=new oe;s!==null&&f.fromArray(s.array,c*16),l.push(f)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',n.joints[c])}return new yc(a,l)})}loadAnimation(e){const r=this.json.animations[e],i=r.name?r.name:"animation_"+e,s=[],o=[],a=[],l=[],c=[];for(let u=0,h=r.channels.length;u<h;u++){const f=r.channels[u],T=r.samplers[f.sampler],g=f.target,d=g.node,A=r.parameters!==void 0?r.parameters[T.input]:T.input,v=r.parameters!==void 0?r.parameters[T.output]:T.output;g.node!==void 0&&(s.push(this.getDependency("node",d)),o.push(this.getDependency("accessor",A)),a.push(this.getDependency("accessor",v)),l.push(T),c.push(g))}return Promise.all([Promise.all(s),Promise.all(o),Promise.all(a),Promise.all(l),Promise.all(c)]).then(function(u){const h=u[0],f=u[1],T=u[2],g=u[3],d=u[4],A=[];for(let v=0,m=h.length;v<m;v++){const p=h[v],C=f[v],R=T[v],y=g[v],B=d[v];if(p===void 0)continue;p.updateMatrix();let x;switch(Mt[B.path]){case Mt.weights:x=Uc;break;case Mt.rotation:x=zs;break;case Mt.position:case Mt.scale:default:x=kc;break}const I=p.name?p.name:p.uuid,S=y.interpolation!==void 0?ku[y.interpolation]:ma,b=[];Mt[B.path]===Mt.weights?p.traverse(function(w){w.morphTargetInfluences&&b.push(w.name?w.name:w.uuid)}):b.push(I);let O=R.array;if(R.normalized){const w=is(O.constructor),k=new Float32Array(O.length);for(let U=0,j=O.length;U<j;U++)k[U]=O[U]*w;O=k}for(let w=0,k=b.length;w<k;w++){const U=new x(b[w]+"."+Mt[B.path],C.array,O,S);y.interpolation==="CUBICSPLINE"&&(U.createInterpolant=function(V){const X=this instanceof zs?Gu:Qa;return new X(this.times,this.values,this.getValueSize()/3,V)},U.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0),A.push(U)}}return new Sc(i,void 0,A)})}createNodeMesh(e){const n=this.json,r=this,i=n.nodes[e];return i.mesh===void 0?null:r.getDependency("mesh",i.mesh).then(function(s){const o=r._getNodeRef(r.meshCache,i.mesh,s);return i.weights!==void 0&&o.traverse(function(a){if(a.isMesh)for(let l=0,c=i.weights.length;l<c;l++)a.morphTargetInfluences[l]=i.weights[l]}),o})}loadNode(e){const n=this.json,r=this,i=n.nodes[e],s=r._loadNodeShallow(e),o=[],a=i.children||[];for(let c=0,u=a.length;c<u;c++)o.push(r.getDependency("node",a[c]));const l=i.skin===void 0?Promise.resolve(null):r.getDependency("skin",i.skin);return Promise.all([s,Promise.all(o),l]).then(function(c){const u=c[0],h=c[1],f=c[2];f!==null&&u.traverse(function(T){T.isSkinnedMesh&&T.bind(f,Wu)});for(let T=0,g=h.length;T<g;T++)u.add(h[T]);return u})}_loadNodeShallow(e){const n=this.json,r=this.extensions,i=this;if(this.nodeCache[e]!==void 0)return this.nodeCache[e];const s=n.nodes[e],o=s.name?i.createUniqueName(s.name):"",a=[],l=i._invokeOne(function(c){return c.createNodeMesh&&c.createNodeMesh(e)});return l&&a.push(l),s.camera!==void 0&&a.push(i.getDependency("camera",s.camera).then(function(c){return i._getNodeRef(i.cameraCache,s.camera,c)})),i._invokeAll(function(c){return c.createNodeAttachment&&c.createNodeAttachment(e)}).forEach(function(c){a.push(c)}),this.nodeCache[e]=Promise.all(a).then(function(c){let u;if(s.isBone===!0?u=new xc:c.length>1?u=new Ii:c.length===1?u=c[0]:u=new fa,u!==c[0])for(let h=0,f=c.length;h<f;h++)u.add(c[h]);if(s.name&&(u.userData.name=s.name,u.name=o),It(u,s),s.extensions&&jt(r,u,s),s.matrix!==void 0){const h=new oe;h.fromArray(s.matrix),u.applyMatrix4(h)}else s.translation!==void 0&&u.position.fromArray(s.translation),s.rotation!==void 0&&u.quaternion.fromArray(s.rotation),s.scale!==void 0&&u.scale.fromArray(s.scale);return i.associations.has(u)||i.associations.set(u,{}),i.associations.get(u).nodes=e,u}),this.nodeCache[e]}loadScene(e){const n=this.extensions,r=this.json.scenes[e],i=this,s=new Ii;r.name&&(s.name=i.createUniqueName(r.name)),It(s,r),r.extensions&&jt(n,s,r);const o=r.nodes||[],a=[];for(let l=0,c=o.length;l<c;l++)a.push(i.getDependency("node",o[l]));return Promise.all(a).then(function(l){for(let u=0,h=l.length;u<h;u++)s.add(l[u]);const c=u=>{const h=new Map;for(const[f,T]of i.associations)(f instanceof Mi||f instanceof Zi)&&h.set(f,T);return u.traverse(f=>{const T=i.associations.get(f);T!=null&&h.set(f,T)}),h};return i.associations=c(s),s})}}function Xu(t,e,n){const r=e.attributes,i=new Hc;if(r.POSITION!==void 0){const a=n.json.accessors[r.POSITION],l=a.min,c=a.max;if(l!==void 0&&c!==void 0){if(i.set(new P(l[0],l[1],l[2]),new P(c[0],c[1],c[2])),a.normalized){const u=is(gn[a.componentType]);i.min.multiplyScalar(u),i.max.multiplyScalar(u)}}else{console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");return}}else return;const s=e.targets;if(s!==void 0){const a=new P,l=new P;for(let c=0,u=s.length;c<u;c++){const h=s[c];if(h.POSITION!==void 0){const f=n.json.accessors[h.POSITION],T=f.min,g=f.max;if(T!==void 0&&g!==void 0){if(l.setX(Math.max(Math.abs(T[0]),Math.abs(g[0]))),l.setY(Math.max(Math.abs(T[1]),Math.abs(g[1]))),l.setZ(Math.max(Math.abs(T[2]),Math.abs(g[2]))),f.normalized){const d=is(gn[f.componentType]);l.multiplyScalar(d)}a.max(l)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}i.expandByVector(a)}t.boundingBox=i;const o=new Kc;i.getCenter(o.center),o.radius=i.min.distanceTo(i.max)/2,t.boundingSphere=o}function so(t,e,n){const r=e.attributes,i=[];function s(o,a){return n.getDependency("accessor",o).then(function(l){t.setAttribute(a,l)})}for(const o in r){const a=rs[o]||o.toLowerCase();a in t.attributes||i.push(s(r[o],a))}if(e.indices!==void 0&&!t.index){const o=n.getDependency("accessor",e.indices).then(function(a){t.setIndex(a)});i.push(o)}return It(t,e),Xu(t,e,n),Promise.all(i).then(function(){return e.targets!==void 0?Hu(t,e.targets,n):t})}const ss=class{static createButton(t,e={}){const n=document.createElement("button");function r(){let a=null;async function l(u){u.addEventListener("end",c),await t.xr.setSession(u),n.textContent="EXIT VR",a=u}function c(){a.removeEventListener("end",c),n.textContent="ENTER VR",a=null}n.style.display="",n.style.cursor="pointer",n.style.left="calc(50% - 50px)",n.style.width="100px",n.textContent="ENTER VR",n.onmouseenter=()=>{n.style.opacity="1.0"},n.onmouseleave=()=>{n.style.opacity="0.5"},n.onclick=()=>{var u;if(a===null){const h=[e.optionalFeatures,"local-floor","bounded-floor","hand-tracking"].flat().filter(Boolean);(u=navigator.xr)==null||u.requestSession("immersive-vr",{...e,optionalFeatures:h}).then(l)}else a.end()}}function i(){n.style.display="",n.style.cursor="auto",n.style.left="calc(50% - 75px)",n.style.width="150px",n.onmouseenter=null,n.onmouseleave=null,n.onclick=null}function s(){i(),n.textContent="VR NOT SUPPORTED"}function o(a){a.style.position="absolute",a.style.bottom="20px",a.style.padding="12px 6px",a.style.border="1px solid #fff",a.style.borderRadius="4px",a.style.background="rgba(0,0,0,0.1)",a.style.color="#fff",a.style.font="normal 13px sans-serif",a.style.textAlign="center",a.style.opacity="0.5",a.style.outline="none",a.style.zIndex="999"}if("xr"in navigator)return o(n),n.id="VRButton",n.style.display="none",navigator.xr.isSessionSupported("immersive-vr").then(a=>{a?r():s(),a&&ss.xrSessionIsGranted&&n.click()}),n;{const a=document.createElement("a");return window.isSecureContext===!1?(a.href=document.location.href.replace(/^http:/,"https:"),a.innerHTML="WEBXR NEEDS HTTPS"):(a.href="https://immersiveweb.dev/",a.innerHTML="WEBXR NOT AVAILABLE"),a.style.left="calc(50% - 90px)",a.style.width="180px",a.style.textDecoration="none",o(a),a}}static registerSessionGrantedListener(){"xr"in navigator&&navigator.xr.addEventListener("sessiongranted",()=>{ss.xrSessionIsGranted=!0})}};let Qu=ss;M(Qu,"xrSessionIsGranted",!1);class Gv extends Mn{constructor(e,n,r,i){super();const s=[],o=[],a=[],l=new P,c=new oe;c.makeRotationFromEuler(r),c.setPosition(n);const u=new oe;u.copy(c).invert(),h(),this.setAttribute("position",new zn(s,3)),this.setAttribute("normal",new zn(o,3)),this.setAttribute("uv",new zn(a,2));function h(){let d,A=[];const v=new P,m=new P;if(e.geometry.isGeometry===!0){console.error("THREE.DecalGeometry no longer supports THREE.Geometry. Use BufferGeometry instead.");return}const p=e.geometry,C=p.attributes.position,R=p.attributes.normal;if(p.index!==null){const y=p.index;for(d=0;d<y.count;d++)v.fromBufferAttribute(C,y.getX(d)),m.fromBufferAttribute(R,y.getX(d)),f(A,v,m)}else for(d=0;d<C.count;d++)v.fromBufferAttribute(C,d),m.fromBufferAttribute(R,d),f(A,v,m);for(A=T(A,l.set(1,0,0)),A=T(A,l.set(-1,0,0)),A=T(A,l.set(0,1,0)),A=T(A,l.set(0,-1,0)),A=T(A,l.set(0,0,1)),A=T(A,l.set(0,0,-1)),d=0;d<A.length;d++){const y=A[d];a.push(.5+y.position.x/i.x,.5+y.position.y/i.y),y.position.applyMatrix4(c),s.push(y.position.x,y.position.y,y.position.z),o.push(y.normal.x,y.normal.y,y.normal.z)}}function f(d,A,v){A.applyMatrix4(e.matrixWorld),A.applyMatrix4(u),v.transformDirection(e.matrixWorld),d.push(new oo(A.clone(),v.clone()))}function T(d,A){const v=[],m=.5*Math.abs(i.dot(A));for(let p=0;p<d.length;p+=3){let C,R,y,B=0,x,I,S,b;const O=d[p+0].position.dot(A)-m,w=d[p+1].position.dot(A)-m,k=d[p+2].position.dot(A)-m;switch(C=O>0,R=w>0,y=k>0,B=(C?1:0)+(R?1:0)+(y?1:0),B){case 0:{v.push(d[p]),v.push(d[p+1]),v.push(d[p+2]);break}case 1:{if(C&&(x=d[p+1],I=d[p+2],S=g(d[p],x,A,m),b=g(d[p],I,A,m)),R){x=d[p],I=d[p+2],S=g(d[p+1],x,A,m),b=g(d[p+1],I,A,m),v.push(S),v.push(I.clone()),v.push(x.clone()),v.push(I.clone()),v.push(S.clone()),v.push(b);break}y&&(x=d[p],I=d[p+1],S=g(d[p+2],x,A,m),b=g(d[p+2],I,A,m)),v.push(x.clone()),v.push(I.clone()),v.push(S),v.push(b),v.push(S.clone()),v.push(I.clone());break}case 2:{C||(x=d[p].clone(),I=g(x,d[p+1],A,m),S=g(x,d[p+2],A,m),v.push(x),v.push(I),v.push(S)),R||(x=d[p+1].clone(),I=g(x,d[p+2],A,m),S=g(x,d[p],A,m),v.push(x),v.push(I),v.push(S)),y||(x=d[p+2].clone(),I=g(x,d[p],A,m),S=g(x,d[p+1],A,m),v.push(x),v.push(I),v.push(S));break}}}return v}function g(d,A,v,m){const p=d.position.dot(v)-m,C=A.position.dot(v)-m,R=p/(p-C);return new oo(new P(d.position.x+R*(A.position.x-d.position.x),d.position.y+R*(A.position.y-d.position.y),d.position.z+R*(A.position.z-d.position.z)),new P(d.normal.x+R*(A.normal.x-d.normal.x),d.normal.y+R*(A.normal.y-d.normal.y),d.normal.z+R*(A.normal.z-d.normal.z)))}}}class oo{constructor(e,n){this.position=e,this.normal=n}clone(){return new this.constructor(this.position.clone(),this.normal.clone())}}class za{constructor(e){M(this,"data"),this.data=e}generateShapes(e,n=100,r){const i=[],s={letterSpacing:0,lineHeight:1,...r},o=zu(e,n,this.data,s);for(let a=0,l=o.length;a<l;a++)Array.prototype.push.apply(i,o[a].toShapes(!1));return i}}M(za,"isFont");M(za,"type");function zu(t,e,n,r){const i=Array.from(t),s=e/n.resolution,o=(n.boundingBox.yMax-n.boundingBox.yMin+n.underlineThickness)*s,a=[];let l=0,c=0;for(let u=0;u<i.length;u++){const h=i[u];if(h===`
`)l=0,c-=o*r.lineHeight;else{const f=Yu(h,s,l,c,n);f&&(l+=f.offsetX+r.letterSpacing,a.push(f.path))}}return a}function Yu(t,e,n,r,i){const s=i.glyphs[t]||i.glyphs["?"];if(!s){console.error('THREE.Font: character "'+t+'" does not exists in font family '+i.familyName+".");return}const o=new $c;let a,l,c,u,h,f,T,g;if(s.o){const d=s._cachedOutline||(s._cachedOutline=s.o.split(" "));for(let A=0,v=d.length;A<v;)switch(d[A++]){case"m":a=parseInt(d[A++])*e+n,l=parseInt(d[A++])*e+r,o.moveTo(a,l);break;case"l":a=parseInt(d[A++])*e+n,l=parseInt(d[A++])*e+r,o.lineTo(a,l);break;case"q":c=parseInt(d[A++])*e+n,u=parseInt(d[A++])*e+r,h=parseInt(d[A++])*e+n,f=parseInt(d[A++])*e+r,o.quadraticCurveTo(h,f,c,u);break;case"b":c=parseInt(d[A++])*e+n,u=parseInt(d[A++])*e+r,h=parseInt(d[A++])*e+n,f=parseInt(d[A++])*e+r,T=parseInt(d[A++])*e+n,g=parseInt(d[A++])*e+r,o.bezierCurveTo(h,f,T,g,c,u);break}}return{offsetX:s.ha*e,path:o}}class $u extends Zi{constructor(e=null,n=1,r=1,i=1){super(null),this.isData3DTexture=!0,this.image={data:e,width:n,height:r,depth:i},this.magFilter=ne,this.minFilter=ne,this.wrapR=zt,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}var Zu=typeof global=="object"&&global&&global.Object===Object&&global;const Ya=Zu;var qu=typeof self=="object"&&self&&self.Object===Object&&self,eh=Ya||qu||Function("return this")();const at=eh;var th=at.Symbol;const je=th;var $a=Object.prototype,nh=$a.hasOwnProperty,rh=$a.toString,kn=je?je.toStringTag:void 0;function ih(t){var e=nh.call(t,kn),n=t[kn];try{t[kn]=void 0;var r=!0}catch{}var i=rh.call(t);return r&&(e?t[kn]=n:delete t[kn]),i}var sh=Object.prototype,oh=sh.toString;function ah(t){return oh.call(t)}var lh="[object Null]",ch="[object Undefined]",ao=je?je.toStringTag:void 0;function Nt(t){return t==null?t===void 0?ch:lh:ao&&ao in Object(t)?ih(t):ah(t)}function Ye(t){return t!=null&&typeof t=="object"}var uh="[object Symbol]";function ai(t){return typeof t=="symbol"||Ye(t)&&Nt(t)==uh}function ar(t,e){for(var n=-1,r=t==null?0:t.length,i=Array(r);++n<r;)i[n]=e(t[n],n,t);return i}var hh=Array.isArray;const W=hh;var fh=1/0,lo=je?je.prototype:void 0,co=lo?lo.toString:void 0;function Za(t){if(typeof t=="string")return t;if(W(t))return ar(t,Za)+"";if(ai(t))return co?co.call(t):"";var e=t+"";return e=="0"&&1/t==-fh?"-0":e}var dh=/\s/;function ph(t){for(var e=t.length;e--&&dh.test(t.charAt(e)););return e}var mh=/^\s+/;function Ah(t){return t&&t.slice(0,ph(t)+1).replace(mh,"")}function We(t){var e=typeof t;return t!=null&&(e=="object"||e=="function")}var uo=0/0,gh=/^[-+]0x[0-9a-f]+$/i,Th=/^0b[01]+$/i,vh=/^0o[0-7]+$/i,Ch=parseInt;function Eh(t){if(typeof t=="number")return t;if(ai(t))return uo;if(We(t)){var e=typeof t.valueOf=="function"?t.valueOf():t;t=We(e)?e+"":e}if(typeof t!="string")return t===0?t:+t;t=Ah(t);var n=Th.test(t);return n||vh.test(t)?Ch(t.slice(2),n?2:8):gh.test(t)?uo:+t}var ho=1/0,Rh=17976931348623157e292;function Bh(t){if(!t)return t===0?t:0;if(t=Eh(t),t===ho||t===-ho){var e=t<0?-1:1;return e*Rh}return t===t?t:0}function lr(t){var e=Bh(t),n=e%1;return e===e?n?e-n:e:0}function Rn(t){return t}var yh="[object AsyncFunction]",Sh="[object Function]",xh="[object GeneratorFunction]",Mh="[object Proxy]";function Ct(t){if(!We(t))return!1;var e=Nt(t);return e==Sh||e==xh||e==yh||e==Mh}var Ih=at["__core-js_shared__"];const Ni=Ih;var fo=function(){var t=/[^.]+$/.exec(Ni&&Ni.keys&&Ni.keys.IE_PROTO||"");return t?"Symbol(src)_1."+t:""}();function bh(t){return!!fo&&fo in t}var Ph=Function.prototype,_h=Ph.toString;function nn(t){if(t!=null){try{return _h.call(t)}catch{}try{return t+""}catch{}}return""}var wh=/[\\^$.*+?()[\]{}|]/g,Oh=/^\[object .+?Constructor\]$/,Fh=Function.prototype,Dh=Object.prototype,Nh=Fh.toString,Lh=Dh.hasOwnProperty,Gh=RegExp("^"+Nh.call(Lh).replace(wh,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function kh(t){if(!We(t)||bh(t))return!1;var e=Ct(t)?Gh:Oh;return e.test(nn(t))}function Uh(t,e){return t==null?void 0:t[e]}function rn(t,e){var n=Uh(t,e);return kh(n)?n:void 0}var Hh=rn(at,"WeakMap");const os=Hh;var po=Object.create,Kh=function(){function t(){}return function(e){if(!We(e))return{};if(po)return po(e);t.prototype=e;var n=new t;return t.prototype=void 0,n}}();const Jh=Kh;function jh(t,e,n){switch(n.length){case 0:return t.call(e);case 1:return t.call(e,n[0]);case 2:return t.call(e,n[0],n[1]);case 3:return t.call(e,n[0],n[1],n[2])}return t.apply(e,n)}function me(){}function Wh(t,e){var n=-1,r=t.length;for(e||(e=Array(r));++n<r;)e[n]=t[n];return e}var Vh=800,Xh=16,Qh=Date.now;function zh(t){var e=0,n=0;return function(){var r=Qh(),i=Xh-(r-n);if(n=r,i>0){if(++e>=Vh)return arguments[0]}else e=0;return t.apply(void 0,arguments)}}function Yh(t){return function(){return t}}var $h=function(){try{var t=rn(Object,"defineProperty");return t({},"",{}),t}catch{}}();const Wr=$h;var Zh=Wr?function(t,e){return Wr(t,"toString",{configurable:!0,enumerable:!1,value:Yh(e),writable:!0})}:Rn;const qh=Zh;var ef=zh(qh);const tf=ef;function qa(t,e){for(var n=-1,r=t==null?0:t.length;++n<r&&e(t[n],n,t)!==!1;);return t}function el(t,e,n,r){for(var i=t.length,s=n+(r?1:-1);r?s--:++s<i;)if(e(t[s],s,t))return s;return-1}function nf(t){return t!==t}function rf(t,e,n){for(var r=n-1,i=t.length;++r<i;)if(t[r]===e)return r;return-1}function ys(t,e,n){return e===e?rf(t,e,n):el(t,nf,n)}function tl(t,e){var n=t==null?0:t.length;return!!n&&ys(t,e,0)>-1}var sf=9007199254740991,of=/^(?:0|[1-9]\d*)$/;function li(t,e){var n=typeof t;return e=e??sf,!!e&&(n=="number"||n!="symbol"&&of.test(t))&&t>-1&&t%1==0&&t<e}function Ss(t,e,n){e=="__proto__"&&Wr?Wr(t,e,{configurable:!0,enumerable:!0,value:n,writable:!0}):t[e]=n}function cr(t,e){return t===e||t!==t&&e!==e}var af=Object.prototype,lf=af.hasOwnProperty;function ci(t,e,n){var r=t[e];(!(lf.call(t,e)&&cr(r,n))||n===void 0&&!(e in t))&&Ss(t,e,n)}function ur(t,e,n,r){var i=!n;n||(n={});for(var s=-1,o=e.length;++s<o;){var a=e[s],l=r?r(n[a],t[a],a,n,t):void 0;l===void 0&&(l=t[a]),i?Ss(n,a,l):ci(n,a,l)}return n}var mo=Math.max;function cf(t,e,n){return e=mo(e===void 0?t.length-1:e,0),function(){for(var r=arguments,i=-1,s=mo(r.length-e,0),o=Array(s);++i<s;)o[i]=r[e+i];i=-1;for(var a=Array(e+1);++i<e;)a[i]=r[i];return a[e]=n(o),jh(t,this,a)}}function xs(t,e){return tf(cf(t,e,Rn),t+"")}var uf=9007199254740991;function Ms(t){return typeof t=="number"&&t>-1&&t%1==0&&t<=uf}function lt(t){return t!=null&&Ms(t.length)&&!Ct(t)}function ui(t,e,n){if(!We(n))return!1;var r=typeof e;return(r=="number"?lt(n)&&li(e,n.length):r=="string"&&e in n)?cr(n[e],t):!1}function hf(t){return xs(function(e,n){var r=-1,i=n.length,s=i>1?n[i-1]:void 0,o=i>2?n[2]:void 0;for(s=t.length>3&&typeof s=="function"?(i--,s):void 0,o&&ui(n[0],n[1],o)&&(s=i<3?void 0:s,i=1),e=Object(e);++r<i;){var a=n[r];a&&t(e,a,r,s)}return e})}var ff=Object.prototype;function hr(t){var e=t&&t.constructor,n=typeof e=="function"&&e.prototype||ff;return t===n}function df(t,e){for(var n=-1,r=Array(t);++n<t;)r[n]=e(n);return r}var pf="[object Arguments]";function Ao(t){return Ye(t)&&Nt(t)==pf}var nl=Object.prototype,mf=nl.hasOwnProperty,Af=nl.propertyIsEnumerable,gf=Ao(function(){return arguments}())?Ao:function(t){return Ye(t)&&mf.call(t,"callee")&&!Af.call(t,"callee")};const hi=gf;function Tf(){return!1}var rl=typeof exports=="object"&&exports&&!exports.nodeType&&exports,go=rl&&typeof module=="object"&&module&&!module.nodeType&&module,vf=go&&go.exports===rl,To=vf?at.Buffer:void 0,Cf=To?To.isBuffer:void 0,Ef=Cf||Tf;const nr=Ef;var Rf="[object Arguments]",Bf="[object Array]",yf="[object Boolean]",Sf="[object Date]",xf="[object Error]",Mf="[object Function]",If="[object Map]",bf="[object Number]",Pf="[object Object]",_f="[object RegExp]",wf="[object Set]",Of="[object String]",Ff="[object WeakMap]",Df="[object ArrayBuffer]",Nf="[object DataView]",Lf="[object Float32Array]",Gf="[object Float64Array]",kf="[object Int8Array]",Uf="[object Int16Array]",Hf="[object Int32Array]",Kf="[object Uint8Array]",Jf="[object Uint8ClampedArray]",jf="[object Uint16Array]",Wf="[object Uint32Array]",te={};te[Lf]=te[Gf]=te[kf]=te[Uf]=te[Hf]=te[Kf]=te[Jf]=te[jf]=te[Wf]=!0;te[Rf]=te[Bf]=te[Df]=te[yf]=te[Nf]=te[Sf]=te[xf]=te[Mf]=te[If]=te[bf]=te[Pf]=te[_f]=te[wf]=te[Of]=te[Ff]=!1;function Vf(t){return Ye(t)&&Ms(t.length)&&!!te[Nt(t)]}function fr(t){return function(e){return t(e)}}var il=typeof exports=="object"&&exports&&!exports.nodeType&&exports,Zn=il&&typeof module=="object"&&module&&!module.nodeType&&module,Xf=Zn&&Zn.exports===il,Li=Xf&&Ya.process,Qf=function(){try{var t=Zn&&Zn.require&&Zn.require("util").types;return t||Li&&Li.binding&&Li.binding("util")}catch{}}();const _t=Qf;var vo=_t&&_t.isTypedArray,zf=vo?fr(vo):Vf;const Is=zf;var Yf=Object.prototype,$f=Yf.hasOwnProperty;function sl(t,e){var n=W(t),r=!n&&hi(t),i=!n&&!r&&nr(t),s=!n&&!r&&!i&&Is(t),o=n||r||i||s,a=o?df(t.length,String):[],l=a.length;for(var c in t)(e||$f.call(t,c))&&!(o&&(c=="length"||i&&(c=="offset"||c=="parent")||s&&(c=="buffer"||c=="byteLength"||c=="byteOffset")||li(c,l)))&&a.push(c);return a}function ol(t,e){return function(n){return t(e(n))}}var Zf=ol(Object.keys,Object);const qf=Zf;var ed=Object.prototype,td=ed.hasOwnProperty;function al(t){if(!hr(t))return qf(t);var e=[];for(var n in Object(t))td.call(t,n)&&n!="constructor"&&e.push(n);return e}function Ne(t){return lt(t)?sl(t):al(t)}var nd=Object.prototype,rd=nd.hasOwnProperty,id=hf(function(t,e){if(hr(e)||lt(e)){ur(e,Ne(e),t);return}for(var n in e)rd.call(e,n)&&ci(t,n,e[n])});const Le=id;function sd(t){var e=[];if(t!=null)for(var n in Object(t))e.push(n);return e}var od=Object.prototype,ad=od.hasOwnProperty;function ld(t){if(!We(t))return sd(t);var e=hr(t),n=[];for(var r in t)r=="constructor"&&(e||!ad.call(t,r))||n.push(r);return n}function fi(t){return lt(t)?sl(t,!0):ld(t)}var cd=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,ud=/^\w*$/;function bs(t,e){if(W(t))return!1;var n=typeof t;return n=="number"||n=="symbol"||n=="boolean"||t==null||ai(t)?!0:ud.test(t)||!cd.test(t)||e!=null&&t in Object(e)}var hd=rn(Object,"create");const rr=hd;function fd(){this.__data__=rr?rr(null):{},this.size=0}function dd(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e}var pd="__lodash_hash_undefined__",md=Object.prototype,Ad=md.hasOwnProperty;function gd(t){var e=this.__data__;if(rr){var n=e[t];return n===pd?void 0:n}return Ad.call(e,t)?e[t]:void 0}var Td=Object.prototype,vd=Td.hasOwnProperty;function Cd(t){var e=this.__data__;return rr?e[t]!==void 0:vd.call(e,t)}var Ed="__lodash_hash_undefined__";function Rd(t,e){var n=this.__data__;return this.size+=this.has(t)?0:1,n[t]=rr&&e===void 0?Ed:e,this}function qt(t){var e=-1,n=t==null?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}qt.prototype.clear=fd;qt.prototype.delete=dd;qt.prototype.get=gd;qt.prototype.has=Cd;qt.prototype.set=Rd;function Bd(){this.__data__=[],this.size=0}function di(t,e){for(var n=t.length;n--;)if(cr(t[n][0],e))return n;return-1}var yd=Array.prototype,Sd=yd.splice;function xd(t){var e=this.__data__,n=di(e,t);if(n<0)return!1;var r=e.length-1;return n==r?e.pop():Sd.call(e,n,1),--this.size,!0}function Md(t){var e=this.__data__,n=di(e,t);return n<0?void 0:e[n][1]}function Id(t){return di(this.__data__,t)>-1}function bd(t,e){var n=this.__data__,r=di(n,t);return r<0?(++this.size,n.push([t,e])):n[r][1]=e,this}function Et(t){var e=-1,n=t==null?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}Et.prototype.clear=Bd;Et.prototype.delete=xd;Et.prototype.get=Md;Et.prototype.has=Id;Et.prototype.set=bd;var Pd=rn(at,"Map");const ir=Pd;function _d(){this.size=0,this.__data__={hash:new qt,map:new(ir||Et),string:new qt}}function wd(t){var e=typeof t;return e=="string"||e=="number"||e=="symbol"||e=="boolean"?t!=="__proto__":t===null}function pi(t,e){var n=t.__data__;return wd(e)?n[typeof e=="string"?"string":"hash"]:n.map}function Od(t){var e=pi(this,t).delete(t);return this.size-=e?1:0,e}function Fd(t){return pi(this,t).get(t)}function Dd(t){return pi(this,t).has(t)}function Nd(t,e){var n=pi(this,t),r=n.size;return n.set(t,e),this.size+=n.size==r?0:1,this}function Rt(t){var e=-1,n=t==null?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}Rt.prototype.clear=_d;Rt.prototype.delete=Od;Rt.prototype.get=Fd;Rt.prototype.has=Dd;Rt.prototype.set=Nd;var Ld="Expected a function";function Ps(t,e){if(typeof t!="function"||e!=null&&typeof e!="function")throw new TypeError(Ld);var n=function(){var r=arguments,i=e?e.apply(this,r):r[0],s=n.cache;if(s.has(i))return s.get(i);var o=t.apply(this,r);return n.cache=s.set(i,o)||s,o};return n.cache=new(Ps.Cache||Rt),n}Ps.Cache=Rt;var Gd=500;function kd(t){var e=Ps(t,function(r){return n.size===Gd&&n.clear(),r}),n=e.cache;return e}var Ud=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,Hd=/\\(\\)?/g,Kd=kd(function(t){var e=[];return t.charCodeAt(0)===46&&e.push(""),t.replace(Ud,function(n,r,i,s){e.push(i?s.replace(Hd,"$1"):r||n)}),e});const Jd=Kd;function jd(t){return t==null?"":Za(t)}function mi(t,e){return W(t)?t:bs(t,e)?[t]:Jd(jd(t))}var Wd=1/0;function dr(t){if(typeof t=="string"||ai(t))return t;var e=t+"";return e=="0"&&1/t==-Wd?"-0":e}function _s(t,e){e=mi(e,t);for(var n=0,r=e.length;t!=null&&n<r;)t=t[dr(e[n++])];return n&&n==r?t:void 0}function Vd(t,e,n){var r=t==null?void 0:_s(t,e);return r===void 0?n:r}function ws(t,e){for(var n=-1,r=e.length,i=t.length;++n<r;)t[i+n]=e[n];return t}var Co=je?je.isConcatSpreadable:void 0;function Xd(t){return W(t)||hi(t)||!!(Co&&t&&t[Co])}function Ai(t,e,n,r,i){var s=-1,o=t.length;for(n||(n=Xd),i||(i=[]);++s<o;){var a=t[s];e>0&&n(a)?e>1?Ai(a,e-1,n,r,i):ws(i,a):r||(i[i.length]=a)}return i}function Qe(t){var e=t==null?0:t.length;return e?Ai(t,1):[]}var Qd=ol(Object.getPrototypeOf,Object);const ll=Qd;function cl(t,e,n){var r=-1,i=t.length;e<0&&(e=-e>i?0:i+e),n=n>i?i:n,n<0&&(n+=i),i=e>n?0:n-e>>>0,e>>>=0;for(var s=Array(i);++r<i;)s[r]=t[r+e];return s}function zd(t,e,n,r){var i=-1,s=t==null?0:t.length;for(r&&s&&(n=t[++i]);++i<s;)n=e(n,t[i],i,t);return n}function Yd(){this.__data__=new Et,this.size=0}function $d(t){var e=this.__data__,n=e.delete(t);return this.size=e.size,n}function Zd(t){return this.__data__.get(t)}function qd(t){return this.__data__.has(t)}var ep=200;function tp(t,e){var n=this.__data__;if(n instanceof Et){var r=n.__data__;if(!ir||r.length<ep-1)return r.push([t,e]),this.size=++n.size,this;n=this.__data__=new Rt(r)}return n.set(t,e),this.size=n.size,this}function st(t){var e=this.__data__=new Et(t);this.size=e.size}st.prototype.clear=Yd;st.prototype.delete=$d;st.prototype.get=Zd;st.prototype.has=qd;st.prototype.set=tp;function np(t,e){return t&&ur(e,Ne(e),t)}function rp(t,e){return t&&ur(e,fi(e),t)}var ul=typeof exports=="object"&&exports&&!exports.nodeType&&exports,Eo=ul&&typeof module=="object"&&module&&!module.nodeType&&module,ip=Eo&&Eo.exports===ul,Ro=ip?at.Buffer:void 0,Bo=Ro?Ro.allocUnsafe:void 0;function sp(t,e){if(e)return t.slice();var n=t.length,r=Bo?Bo(n):new t.constructor(n);return t.copy(r),r}function Os(t,e){for(var n=-1,r=t==null?0:t.length,i=0,s=[];++n<r;){var o=t[n];e(o,n,t)&&(s[i++]=o)}return s}function hl(){return[]}var op=Object.prototype,ap=op.propertyIsEnumerable,yo=Object.getOwnPropertySymbols,lp=yo?function(t){return t==null?[]:(t=Object(t),Os(yo(t),function(e){return ap.call(t,e)}))}:hl;const Fs=lp;function cp(t,e){return ur(t,Fs(t),e)}var up=Object.getOwnPropertySymbols,hp=up?function(t){for(var e=[];t;)ws(e,Fs(t)),t=ll(t);return e}:hl;const fl=hp;function fp(t,e){return ur(t,fl(t),e)}function dl(t,e,n){var r=e(t);return W(t)?r:ws(r,n(t))}function as(t){return dl(t,Ne,Fs)}function pl(t){return dl(t,fi,fl)}var dp=rn(at,"DataView");const ls=dp;var pp=rn(at,"Promise");const cs=pp;var mp=rn(at,"Set");const Tn=mp;var So="[object Map]",Ap="[object Object]",xo="[object Promise]",Mo="[object Set]",Io="[object WeakMap]",bo="[object DataView]",gp=nn(ls),Tp=nn(ir),vp=nn(cs),Cp=nn(Tn),Ep=nn(os),Qt=Nt;(ls&&Qt(new ls(new ArrayBuffer(1)))!=bo||ir&&Qt(new ir)!=So||cs&&Qt(cs.resolve())!=xo||Tn&&Qt(new Tn)!=Mo||os&&Qt(new os)!=Io)&&(Qt=function(t){var e=Nt(t),n=e==Ap?t.constructor:void 0,r=n?nn(n):"";if(r)switch(r){case gp:return bo;case Tp:return So;case vp:return xo;case Cp:return Mo;case Ep:return Io}return e});const Bn=Qt;var Rp=Object.prototype,Bp=Rp.hasOwnProperty;function yp(t){var e=t.length,n=new t.constructor(e);return e&&typeof t[0]=="string"&&Bp.call(t,"index")&&(n.index=t.index,n.input=t.input),n}var Sp=at.Uint8Array;const Vr=Sp;function Ds(t){var e=new t.constructor(t.byteLength);return new Vr(e).set(new Vr(t)),e}function xp(t,e){var n=e?Ds(t.buffer):t.buffer;return new t.constructor(n,t.byteOffset,t.byteLength)}var Mp=/\w*$/;function Ip(t){var e=new t.constructor(t.source,Mp.exec(t));return e.lastIndex=t.lastIndex,e}var Po=je?je.prototype:void 0,_o=Po?Po.valueOf:void 0;function bp(t){return _o?Object(_o.call(t)):{}}function Pp(t,e){var n=e?Ds(t.buffer):t.buffer;return new t.constructor(n,t.byteOffset,t.length)}var _p="[object Boolean]",wp="[object Date]",Op="[object Map]",Fp="[object Number]",Dp="[object RegExp]",Np="[object Set]",Lp="[object String]",Gp="[object Symbol]",kp="[object ArrayBuffer]",Up="[object DataView]",Hp="[object Float32Array]",Kp="[object Float64Array]",Jp="[object Int8Array]",jp="[object Int16Array]",Wp="[object Int32Array]",Vp="[object Uint8Array]",Xp="[object Uint8ClampedArray]",Qp="[object Uint16Array]",zp="[object Uint32Array]";function Yp(t,e,n){var r=t.constructor;switch(e){case kp:return Ds(t);case _p:case wp:return new r(+t);case Up:return xp(t,n);case Hp:case Kp:case Jp:case jp:case Wp:case Vp:case Xp:case Qp:case zp:return Pp(t,n);case Op:return new r;case Fp:case Lp:return new r(t);case Dp:return Ip(t);case Np:return new r;case Gp:return bp(t)}}function $p(t){return typeof t.constructor=="function"&&!hr(t)?Jh(ll(t)):{}}var Zp="[object Map]";function qp(t){return Ye(t)&&Bn(t)==Zp}var wo=_t&&_t.isMap,em=wo?fr(wo):qp;const tm=em;var nm="[object Set]";function rm(t){return Ye(t)&&Bn(t)==nm}var Oo=_t&&_t.isSet,im=Oo?fr(Oo):rm;const sm=im;var om=1,am=2,lm=4,ml="[object Arguments]",cm="[object Array]",um="[object Boolean]",hm="[object Date]",fm="[object Error]",Al="[object Function]",dm="[object GeneratorFunction]",pm="[object Map]",mm="[object Number]",gl="[object Object]",Am="[object RegExp]",gm="[object Set]",Tm="[object String]",vm="[object Symbol]",Cm="[object WeakMap]",Em="[object ArrayBuffer]",Rm="[object DataView]",Bm="[object Float32Array]",ym="[object Float64Array]",Sm="[object Int8Array]",xm="[object Int16Array]",Mm="[object Int32Array]",Im="[object Uint8Array]",bm="[object Uint8ClampedArray]",Pm="[object Uint16Array]",_m="[object Uint32Array]",$={};$[ml]=$[cm]=$[Em]=$[Rm]=$[um]=$[hm]=$[Bm]=$[ym]=$[Sm]=$[xm]=$[Mm]=$[pm]=$[mm]=$[gl]=$[Am]=$[gm]=$[Tm]=$[vm]=$[Im]=$[bm]=$[Pm]=$[_m]=!0;$[fm]=$[Al]=$[Cm]=!1;function Dr(t,e,n,r,i,s){var o,a=e&om,l=e&am,c=e&lm;if(n&&(o=i?n(t,r,i,s):n(t)),o!==void 0)return o;if(!We(t))return t;var u=W(t);if(u){if(o=yp(t),!a)return Wh(t,o)}else{var h=Bn(t),f=h==Al||h==dm;if(nr(t))return sp(t,a);if(h==gl||h==ml||f&&!i){if(o=l||f?{}:$p(t),!a)return l?fp(t,rp(o,t)):cp(t,np(o,t))}else{if(!$[h])return i?t:{};o=Yp(t,h,a)}}s||(s=new st);var T=s.get(t);if(T)return T;s.set(t,o),sm(t)?t.forEach(function(A){o.add(Dr(A,e,n,A,t,s))}):tm(t)&&t.forEach(function(A,v){o.set(v,Dr(A,e,n,v,t,s))});var g=c?l?pl:as:l?fi:Ne,d=u?void 0:g(t);return qa(d||t,function(A,v){d&&(v=A,A=t[v]),ci(o,v,Dr(A,e,n,v,t,s))}),o}var wm=4;function ye(t){return Dr(t,wm)}function pr(t){for(var e=-1,n=t==null?0:t.length,r=0,i=[];++e<n;){var s=t[e];s&&(i[r++]=s)}return i}var Om="__lodash_hash_undefined__";function Fm(t){return this.__data__.set(t,Om),this}function Dm(t){return this.__data__.has(t)}function yn(t){var e=-1,n=t==null?0:t.length;for(this.__data__=new Rt;++e<n;)this.add(t[e])}yn.prototype.add=yn.prototype.push=Fm;yn.prototype.has=Dm;function Tl(t,e){for(var n=-1,r=t==null?0:t.length;++n<r;)if(e(t[n],n,t))return!0;return!1}function Ns(t,e){return t.has(e)}var Nm=1,Lm=2;function vl(t,e,n,r,i,s){var o=n&Nm,a=t.length,l=e.length;if(a!=l&&!(o&&l>a))return!1;var c=s.get(t),u=s.get(e);if(c&&u)return c==e&&u==t;var h=-1,f=!0,T=n&Lm?new yn:void 0;for(s.set(t,e),s.set(e,t);++h<a;){var g=t[h],d=e[h];if(r)var A=o?r(d,g,h,e,t,s):r(g,d,h,t,e,s);if(A!==void 0){if(A)continue;f=!1;break}if(T){if(!Tl(e,function(v,m){if(!Ns(T,m)&&(g===v||i(g,v,n,r,s)))return T.push(m)})){f=!1;break}}else if(!(g===d||i(g,d,n,r,s))){f=!1;break}}return s.delete(t),s.delete(e),f}function Gm(t){var e=-1,n=Array(t.size);return t.forEach(function(r,i){n[++e]=[i,r]}),n}function Ls(t){var e=-1,n=Array(t.size);return t.forEach(function(r){n[++e]=r}),n}var km=1,Um=2,Hm="[object Boolean]",Km="[object Date]",Jm="[object Error]",jm="[object Map]",Wm="[object Number]",Vm="[object RegExp]",Xm="[object Set]",Qm="[object String]",zm="[object Symbol]",Ym="[object ArrayBuffer]",$m="[object DataView]",Fo=je?je.prototype:void 0,Gi=Fo?Fo.valueOf:void 0;function Zm(t,e,n,r,i,s,o){switch(n){case $m:if(t.byteLength!=e.byteLength||t.byteOffset!=e.byteOffset)return!1;t=t.buffer,e=e.buffer;case Ym:return!(t.byteLength!=e.byteLength||!s(new Vr(t),new Vr(e)));case Hm:case Km:case Wm:return cr(+t,+e);case Jm:return t.name==e.name&&t.message==e.message;case Vm:case Qm:return t==e+"";case jm:var a=Gm;case Xm:var l=r&km;if(a||(a=Ls),t.size!=e.size&&!l)return!1;var c=o.get(t);if(c)return c==e;r|=Um,o.set(t,e);var u=vl(a(t),a(e),r,i,s,o);return o.delete(t),u;case zm:if(Gi)return Gi.call(t)==Gi.call(e)}return!1}var qm=1,eA=Object.prototype,tA=eA.hasOwnProperty;function nA(t,e,n,r,i,s){var o=n&qm,a=as(t),l=a.length,c=as(e),u=c.length;if(l!=u&&!o)return!1;for(var h=l;h--;){var f=a[h];if(!(o?f in e:tA.call(e,f)))return!1}var T=s.get(t),g=s.get(e);if(T&&g)return T==e&&g==t;var d=!0;s.set(t,e),s.set(e,t);for(var A=o;++h<l;){f=a[h];var v=t[f],m=e[f];if(r)var p=o?r(m,v,f,e,t,s):r(v,m,f,t,e,s);if(!(p===void 0?v===m||i(v,m,n,r,s):p)){d=!1;break}A||(A=f=="constructor")}if(d&&!A){var C=t.constructor,R=e.constructor;C!=R&&"constructor"in t&&"constructor"in e&&!(typeof C=="function"&&C instanceof C&&typeof R=="function"&&R instanceof R)&&(d=!1)}return s.delete(t),s.delete(e),d}var rA=1,Do="[object Arguments]",No="[object Array]",Ir="[object Object]",iA=Object.prototype,Lo=iA.hasOwnProperty;function sA(t,e,n,r,i,s){var o=W(t),a=W(e),l=o?No:Bn(t),c=a?No:Bn(e);l=l==Do?Ir:l,c=c==Do?Ir:c;var u=l==Ir,h=c==Ir,f=l==c;if(f&&nr(t)){if(!nr(e))return!1;o=!0,u=!1}if(f&&!u)return s||(s=new st),o||Is(t)?vl(t,e,n,r,i,s):Zm(t,e,l,n,r,i,s);if(!(n&rA)){var T=u&&Lo.call(t,"__wrapped__"),g=h&&Lo.call(e,"__wrapped__");if(T||g){var d=T?t.value():t,A=g?e.value():e;return s||(s=new st),i(d,A,n,r,s)}}return f?(s||(s=new st),nA(t,e,n,r,i,s)):!1}function Gs(t,e,n,r,i){return t===e?!0:t==null||e==null||!Ye(t)&&!Ye(e)?t!==t&&e!==e:sA(t,e,n,r,Gs,i)}var oA=1,aA=2;function lA(t,e,n,r){var i=n.length,s=i,o=!r;if(t==null)return!s;for(t=Object(t);i--;){var a=n[i];if(o&&a[2]?a[1]!==t[a[0]]:!(a[0]in t))return!1}for(;++i<s;){a=n[i];var l=a[0],c=t[l],u=a[1];if(o&&a[2]){if(c===void 0&&!(l in t))return!1}else{var h=new st;if(r)var f=r(c,u,l,t,e,h);if(!(f===void 0?Gs(u,c,oA|aA,r,h):f))return!1}}return!0}function Cl(t){return t===t&&!We(t)}function cA(t){for(var e=Ne(t),n=e.length;n--;){var r=e[n],i=t[r];e[n]=[r,i,Cl(i)]}return e}function El(t,e){return function(n){return n==null?!1:n[t]===e&&(e!==void 0||t in Object(n))}}function uA(t){var e=cA(t);return e.length==1&&e[0][2]?El(e[0][0],e[0][1]):function(n){return n===t||lA(n,t,e)}}function hA(t,e){return t!=null&&e in Object(t)}function Rl(t,e,n){e=mi(e,t);for(var r=-1,i=e.length,s=!1;++r<i;){var o=dr(e[r]);if(!(s=t!=null&&n(t,o)))break;t=t[o]}return s||++r!=i?s:(i=t==null?0:t.length,!!i&&Ms(i)&&li(o,i)&&(W(t)||hi(t)))}function fA(t,e){return t!=null&&Rl(t,e,hA)}var dA=1,pA=2;function mA(t,e){return bs(t)&&Cl(e)?El(dr(t),e):function(n){var r=Vd(n,t);return r===void 0&&r===e?fA(n,t):Gs(e,r,dA|pA)}}function AA(t){return function(e){return e==null?void 0:e[t]}}function gA(t){return function(e){return _s(e,t)}}function TA(t){return bs(t)?AA(dr(t)):gA(t)}function ct(t){return typeof t=="function"?t:t==null?Rn:typeof t=="object"?W(t)?mA(t[0],t[1]):uA(t):TA(t)}function vA(t,e,n,r){for(var i=-1,s=t==null?0:t.length;++i<s;){var o=t[i];e(r,o,n(o),t)}return r}function CA(t){return function(e,n,r){for(var i=-1,s=Object(e),o=r(e),a=o.length;a--;){var l=o[t?a:++i];if(n(s[l],l,s)===!1)break}return e}}var EA=CA();const RA=EA;function BA(t,e){return t&&RA(t,e,Ne)}function yA(t,e){return function(n,r){if(n==null)return n;if(!lt(n))return t(n,r);for(var i=n.length,s=e?i:-1,o=Object(n);(e?s--:++s<i)&&r(o[s],s,o)!==!1;);return n}}var SA=yA(BA);const sn=SA;function xA(t,e,n,r){return sn(t,function(i,s,o){e(r,i,n(i),o)}),r}function MA(t,e){return function(n,r){var i=W(n)?vA:xA,s=e?e():{};return i(n,t,ct(r),s)}}var Bl=Object.prototype,IA=Bl.hasOwnProperty,bA=xs(function(t,e){t=Object(t);var n=-1,r=e.length,i=r>2?e[2]:void 0;for(i&&ui(e[0],e[1],i)&&(r=1);++n<r;)for(var s=e[n],o=fi(s),a=-1,l=o.length;++a<l;){var c=o[a],u=t[c];(u===void 0||cr(u,Bl[c])&&!IA.call(t,c))&&(t[c]=s[c])}return t});const ks=bA;function Go(t){return Ye(t)&&lt(t)}function yl(t,e,n){for(var r=-1,i=t==null?0:t.length;++r<i;)if(n(e,t[r]))return!0;return!1}var PA=200;function _A(t,e,n,r){var i=-1,s=tl,o=!0,a=t.length,l=[],c=e.length;if(!a)return l;n&&(e=ar(e,fr(n))),r?(s=yl,o=!1):e.length>=PA&&(s=Ns,o=!1,e=new yn(e));e:for(;++i<a;){var u=t[i],h=n==null?u:n(u);if(u=r||u!==0?u:0,o&&h===h){for(var f=c;f--;)if(e[f]===h)continue e;l.push(u)}else s(e,h,r)||l.push(u)}return l}var wA=xs(function(t,e){return Go(t)?_A(t,Ai(e,1,Go,!0)):[]});const gi=wA;function Sn(t){var e=t==null?0:t.length;return e?t[e-1]:void 0}function Ee(t,e,n){var r=t==null?0:t.length;return r?(e=n||e===void 0?1:lr(e),cl(t,e<0?0:e,r)):[]}function sr(t,e,n){var r=t==null?0:t.length;return r?(e=n||e===void 0?1:lr(e),e=r-e,cl(t,0,e<0?0:e)):[]}function OA(t){return typeof t=="function"?t:Rn}function L(t,e){var n=W(t)?qa:sn;return n(t,OA(e))}function FA(t,e){for(var n=-1,r=t==null?0:t.length;++n<r;)if(!e(t[n],n,t))return!1;return!0}function DA(t,e){var n=!0;return sn(t,function(r,i,s){return n=!!e(r,i,s),n}),n}function ze(t,e,n){var r=W(t)?FA:DA;return n&&ui(t,e,n)&&(e=void 0),r(t,ct(e))}function Sl(t,e){var n=[];return sn(t,function(r,i,s){e(r,i,s)&&n.push(r)}),n}function Ve(t,e){var n=W(t)?Os:Sl;return n(t,ct(e))}function NA(t){return function(e,n,r){var i=Object(e);if(!lt(e)){var s=ct(n);e=Ne(e),n=function(a){return s(i[a],a,i)}}var o=t(e,n,r);return o>-1?i[s?e[o]:o]:void 0}}var LA=Math.max;function GA(t,e,n){var r=t==null?0:t.length;if(!r)return-1;var i=n==null?0:lr(n);return i<0&&(i=LA(r+i,0)),el(t,ct(e),i)}var kA=NA(GA);const xn=kA;function $e(t){return t&&t.length?t[0]:void 0}function UA(t,e){var n=-1,r=lt(t)?Array(t.length):[];return sn(t,function(i,s,o){r[++n]=e(i,s,o)}),r}function F(t,e){var n=W(t)?ar:UA;return n(t,ct(e))}function Ke(t,e){return Ai(F(t,e),1)}var HA=Object.prototype,KA=HA.hasOwnProperty,JA=MA(function(t,e,n){KA.call(t,n)?t[n].push(e):Ss(t,n,[e])});const jA=JA;var WA=Object.prototype,VA=WA.hasOwnProperty;function XA(t,e){return t!=null&&VA.call(t,e)}function N(t,e){return t!=null&&Rl(t,e,XA)}var QA="[object String]";function Fe(t){return typeof t=="string"||!W(t)&&Ye(t)&&Nt(t)==QA}function zA(t,e){return ar(e,function(n){return t[n]})}function Ae(t){return t==null?[]:zA(t,Ne(t))}var YA=Math.max;function be(t,e,n,r){t=lt(t)?t:Ae(t),n=n&&!r?lr(n):0;var i=t.length;return n<0&&(n=YA(i+n,0)),Fe(t)?n<=i&&t.indexOf(e,n)>-1:!!i&&ys(t,e,n)>-1}var $A=Math.max;function ko(t,e,n){var r=t==null?0:t.length;if(!r)return-1;var i=n==null?0:lr(n);return i<0&&(i=$A(r+i,0)),ys(t,e,i)}var ZA="[object Map]",qA="[object Set]",eg=Object.prototype,tg=eg.hasOwnProperty;function Z(t){if(t==null)return!0;if(lt(t)&&(W(t)||typeof t=="string"||typeof t.splice=="function"||nr(t)||Is(t)||hi(t)))return!t.length;var e=Bn(t);if(e==ZA||e==qA)return!t.size;if(hr(t))return!al(t).length;for(var n in t)if(tg.call(t,n))return!1;return!0}var ng="[object RegExp]";function rg(t){return Ye(t)&&Nt(t)==ng}var Uo=_t&&_t.isRegExp,ig=Uo?fr(Uo):rg;const Tt=ig;function vt(t){return t===void 0}var sg="Expected a function";function og(t){if(typeof t!="function")throw new TypeError(sg);return function(){var e=arguments;switch(e.length){case 0:return!t.call(this);case 1:return!t.call(this,e[0]);case 2:return!t.call(this,e[0],e[1]);case 3:return!t.call(this,e[0],e[1],e[2])}return!t.apply(this,e)}}function ag(t,e,n,r){if(!We(t))return t;e=mi(e,t);for(var i=-1,s=e.length,o=s-1,a=t;a!=null&&++i<s;){var l=dr(e[i]),c=n;if(l==="__proto__"||l==="constructor"||l==="prototype")return t;if(i!=o){var u=a[l];c=r?r(u,l,a):void 0,c===void 0&&(c=We(u)?u:li(e[i+1])?[]:{})}ci(a,l,c),a=a[l]}return t}function lg(t,e,n){for(var r=-1,i=e.length,s={};++r<i;){var o=e[r],a=_s(t,o);n(a,o)&&ag(s,mi(o,t),a)}return s}function Ze(t,e){if(t==null)return{};var n=ar(pl(t),function(r){return[r]});return e=ct(e),lg(t,n,function(r,i){return e(r,i[0])})}function cg(t,e,n,r,i){return i(t,function(s,o,a){n=r?(r=!1,s):e(n,s,o,a)}),n}function Ge(t,e,n){var r=W(t)?zd:cg,i=arguments.length<3;return r(t,ct(e),n,i,sn)}function Ti(t,e){var n=W(t)?Os:Sl;return n(t,og(ct(e)))}function ug(t,e){var n;return sn(t,function(r,i,s){return n=e(r,i,s),!n}),!!n}function xl(t,e,n){var r=W(t)?Tl:ug;return n&&ui(t,e,n)&&(e=void 0),r(t,ct(e))}var hg=1/0,fg=Tn&&1/Ls(new Tn([,-0]))[1]==hg?function(t){return new Tn(t)}:me;const dg=fg;var pg=200;function mg(t,e,n){var r=-1,i=tl,s=t.length,o=!0,a=[],l=a;if(n)o=!1,i=yl;else if(s>=pg){var c=e?null:dg(t);if(c)return Ls(c);o=!1,i=Ns,l=new yn}else l=e?[]:a;e:for(;++r<s;){var u=t[r],h=e?e(u):u;if(u=n||u!==0?u:0,o&&h===h){for(var f=l.length;f--;)if(l[f]===h)continue e;e&&l.push(h),a.push(u)}else i(l,h,n)||(l!==a&&l.push(h),a.push(u))}return a}function Us(t){return t&&t.length?mg(t):[]}function us(t){console&&console.error&&console.error(`Error: ${t}`)}function Ml(t){console&&console.warn&&console.warn(`Warning: ${t}`)}function Il(t){const e=new Date().getTime(),n=t();return{time:new Date().getTime()-e,value:n}}function bl(t){function e(){}e.prototype=t;const n=new e;function r(){return typeof n.bar}return r(),r(),t}function Ag(t){return gg(t)?t.LABEL:t.name}function gg(t){return Fe(t.LABEL)&&t.LABEL!==""}class ut{get definition(){return this._definition}set definition(e){this._definition=e}constructor(e){this._definition=e}accept(e){e.visit(this),L(this.definition,n=>{n.accept(e)})}}class ke extends ut{constructor(e){super([]),this.idx=1,Le(this,Ze(e,n=>n!==void 0))}set definition(e){}get definition(){return this.referencedRule!==void 0?this.referencedRule.definition:[]}accept(e){e.visit(this)}}class In extends ut{constructor(e){super(e.definition),this.orgText="",Le(this,Ze(e,n=>n!==void 0))}}class De extends ut{constructor(e){super(e.definition),this.ignoreAmbiguities=!1,Le(this,Ze(e,n=>n!==void 0))}}class Oe extends ut{constructor(e){super(e.definition),this.idx=1,Le(this,Ze(e,n=>n!==void 0))}}class ht extends ut{constructor(e){super(e.definition),this.idx=1,Le(this,Ze(e,n=>n!==void 0))}}class ft extends ut{constructor(e){super(e.definition),this.idx=1,Le(this,Ze(e,n=>n!==void 0))}}class ge extends ut{constructor(e){super(e.definition),this.idx=1,Le(this,Ze(e,n=>n!==void 0))}}class qe extends ut{constructor(e){super(e.definition),this.idx=1,Le(this,Ze(e,n=>n!==void 0))}}class et extends ut{get definition(){return this._definition}set definition(e){this._definition=e}constructor(e){super(e.definition),this.idx=1,this.ignoreAmbiguities=!1,this.hasPredicates=!1,Le(this,Ze(e,n=>n!==void 0))}}class ae{constructor(e){this.idx=1,Le(this,Ze(e,n=>n!==void 0))}accept(e){e.visit(this)}}function Tg(t){return F(t,Nr)}function Nr(t){function e(n){return F(n,Nr)}if(t instanceof ke){const n={type:"NonTerminal",name:t.nonTerminalName,idx:t.idx};return Fe(t.label)&&(n.label=t.label),n}else{if(t instanceof De)return{type:"Alternative",definition:e(t.definition)};if(t instanceof Oe)return{type:"Option",idx:t.idx,definition:e(t.definition)};if(t instanceof ht)return{type:"RepetitionMandatory",idx:t.idx,definition:e(t.definition)};if(t instanceof ft)return{type:"RepetitionMandatoryWithSeparator",idx:t.idx,separator:Nr(new ae({terminalType:t.separator})),definition:e(t.definition)};if(t instanceof qe)return{type:"RepetitionWithSeparator",idx:t.idx,separator:Nr(new ae({terminalType:t.separator})),definition:e(t.definition)};if(t instanceof ge)return{type:"Repetition",idx:t.idx,definition:e(t.definition)};if(t instanceof et)return{type:"Alternation",idx:t.idx,definition:e(t.definition)};if(t instanceof ae){const n={type:"Terminal",name:t.terminalType.name,label:Ag(t.terminalType),idx:t.idx};Fe(t.label)&&(n.terminalLabel=t.label);const r=t.terminalType.PATTERN;return t.terminalType.PATTERN&&(n.pattern=Tt(r)?r.source:r),n}else{if(t instanceof In)return{type:"Rule",name:t.name,orgText:t.orgText,definition:e(t.definition)};throw Error("non exhaustive match")}}}class bn{visit(e){const n=e;switch(n.constructor){case ke:return this.visitNonTerminal(n);case De:return this.visitAlternative(n);case Oe:return this.visitOption(n);case ht:return this.visitRepetitionMandatory(n);case ft:return this.visitRepetitionMandatoryWithSeparator(n);case qe:return this.visitRepetitionWithSeparator(n);case ge:return this.visitRepetition(n);case et:return this.visitAlternation(n);case ae:return this.visitTerminal(n);case In:return this.visitRule(n);default:throw Error("non exhaustive match")}}visitNonTerminal(e){}visitAlternative(e){}visitOption(e){}visitRepetition(e){}visitRepetitionMandatory(e){}visitRepetitionMandatoryWithSeparator(e){}visitRepetitionWithSeparator(e){}visitAlternation(e){}visitTerminal(e){}visitRule(e){}}function vg(t){return t instanceof De||t instanceof Oe||t instanceof ge||t instanceof ht||t instanceof ft||t instanceof qe||t instanceof ae||t instanceof In}function Xr(t,e=[]){return t instanceof Oe||t instanceof ge||t instanceof qe?!0:t instanceof et?xl(t.definition,r=>Xr(r,e)):t instanceof ke&&be(e,t)?!1:t instanceof ut?(t instanceof ke&&e.push(t),ze(t.definition,r=>Xr(r,e))):!1}function Cg(t){return t instanceof et}function nt(t){if(t instanceof ke)return"SUBRULE";if(t instanceof Oe)return"OPTION";if(t instanceof et)return"OR";if(t instanceof ht)return"AT_LEAST_ONE";if(t instanceof ft)return"AT_LEAST_ONE_SEP";if(t instanceof qe)return"MANY_SEP";if(t instanceof ge)return"MANY";if(t instanceof ae)return"CONSUME";throw Error("non exhaustive match")}class vi{walk(e,n=[]){L(e.definition,(r,i)=>{const s=Ee(e.definition,i+1);if(r instanceof ke)this.walkProdRef(r,s,n);else if(r instanceof ae)this.walkTerminal(r,s,n);else if(r instanceof De)this.walkFlat(r,s,n);else if(r instanceof Oe)this.walkOption(r,s,n);else if(r instanceof ht)this.walkAtLeastOne(r,s,n);else if(r instanceof ft)this.walkAtLeastOneSep(r,s,n);else if(r instanceof qe)this.walkManySep(r,s,n);else if(r instanceof ge)this.walkMany(r,s,n);else if(r instanceof et)this.walkOr(r,s,n);else throw Error("non exhaustive match")})}walkTerminal(e,n,r){}walkProdRef(e,n,r){}walkFlat(e,n,r){const i=n.concat(r);this.walk(e,i)}walkOption(e,n,r){const i=n.concat(r);this.walk(e,i)}walkAtLeastOne(e,n,r){const i=[new Oe({definition:e.definition})].concat(n,r);this.walk(e,i)}walkAtLeastOneSep(e,n,r){const i=Ho(e,n,r);this.walk(e,i)}walkMany(e,n,r){const i=[new Oe({definition:e.definition})].concat(n,r);this.walk(e,i)}walkManySep(e,n,r){const i=Ho(e,n,r);this.walk(e,i)}walkOr(e,n,r){const i=n.concat(r);L(e.definition,s=>{const o=new De({definition:[s]});this.walk(o,i)})}}function Ho(t,e,n){return[new Oe({definition:[new ae({terminalType:t.separator})].concat(t.definition)})].concat(e,n)}function mr(t){if(t instanceof ke)return mr(t.referencedRule);if(t instanceof ae)return Bg(t);if(vg(t))return Eg(t);if(Cg(t))return Rg(t);throw Error("non exhaustive match")}function Eg(t){let e=[];const n=t.definition;let r=0,i=n.length>r,s,o=!0;for(;i&&o;)s=n[r],o=Xr(s),e=e.concat(mr(s)),r=r+1,i=n.length>r;return Us(e)}function Rg(t){const e=F(t.definition,n=>mr(n));return Us(Qe(e))}function Bg(t){return[t.terminalType]}const Pl="_~IN~_";class yg extends vi{constructor(e){super(),this.topProd=e,this.follows={}}startWalking(){return this.walk(this.topProd),this.follows}walkTerminal(e,n,r){}walkProdRef(e,n,r){const i=xg(e.referencedRule,e.idx)+this.topProd.name,s=n.concat(r),o=new De({definition:s}),a=mr(o);this.follows[i]=a}}function Sg(t){const e={};return L(t,n=>{const r=new yg(n).startWalking();Le(e,r)}),e}function xg(t,e){return t.name+e+Pl}function G(t){return t.charCodeAt(0)}function ki(t,e){Array.isArray(t)?t.forEach(function(n){e.push(n)}):e.push(t)}function Un(t,e){if(t[e]===!0)throw"duplicate flag "+e;t[e],t[e]=!0}function pn(t){if(t===void 0)throw Error("Internal Error - Should never get here!");return!0}function Mg(){throw Error("Internal Error - Should never get here!")}function Ko(t){return t.type==="Character"}const Qr=[];for(let t=G("0");t<=G("9");t++)Qr.push(t);const zr=[G("_")].concat(Qr);for(let t=G("a");t<=G("z");t++)zr.push(t);for(let t=G("A");t<=G("Z");t++)zr.push(t);const Jo=[G(" "),G("\f"),G(`
`),G("\r"),G("	"),G("\v"),G("	"),G(" "),G(" "),G(" "),G(" "),G(" "),G(" "),G(" "),G(" "),G(" "),G(" "),G(" "),G(" "),G(" "),G("\u2028"),G("\u2029"),G(" "),G(" "),G("　"),G("\uFEFF")],Ig=/[0-9a-fA-F]/,br=/[0-9]/,bg=/[1-9]/;class Pg{constructor(){this.idx=0,this.input="",this.groupIdx=0}saveState(){return{idx:this.idx,input:this.input,groupIdx:this.groupIdx}}restoreState(e){this.idx=e.idx,this.input=e.input,this.groupIdx=e.groupIdx}pattern(e){this.idx=0,this.input=e,this.groupIdx=0,this.consumeChar("/");const n=this.disjunction();this.consumeChar("/");const r={type:"Flags",loc:{begin:this.idx,end:e.length},global:!1,ignoreCase:!1,multiLine:!1,unicode:!1,sticky:!1};for(;this.isRegExpFlag();)switch(this.popChar()){case"g":Un(r,"global");break;case"i":Un(r,"ignoreCase");break;case"m":Un(r,"multiLine");break;case"u":Un(r,"unicode");break;case"y":Un(r,"sticky");break}if(this.idx!==this.input.length)throw Error("Redundant input: "+this.input.substring(this.idx));return{type:"Pattern",flags:r,value:n,loc:this.loc(0)}}disjunction(){const e=[],n=this.idx;for(e.push(this.alternative());this.peekChar()==="|";)this.consumeChar("|"),e.push(this.alternative());return{type:"Disjunction",value:e,loc:this.loc(n)}}alternative(){const e=[],n=this.idx;for(;this.isTerm();)e.push(this.term());return{type:"Alternative",value:e,loc:this.loc(n)}}term(){return this.isAssertion()?this.assertion():this.atom()}assertion(){const e=this.idx;switch(this.popChar()){case"^":return{type:"StartAnchor",loc:this.loc(e)};case"$":return{type:"EndAnchor",loc:this.loc(e)};case"\\":switch(this.popChar()){case"b":return{type:"WordBoundary",loc:this.loc(e)};case"B":return{type:"NonWordBoundary",loc:this.loc(e)}}throw Error("Invalid Assertion Escape");case"(":this.consumeChar("?");let n;switch(this.popChar()){case"=":n="Lookahead";break;case"!":n="NegativeLookahead";break}pn(n);const r=this.disjunction();return this.consumeChar(")"),{type:n,value:r,loc:this.loc(e)}}return Mg()}quantifier(e=!1){let n;const r=this.idx;switch(this.popChar()){case"*":n={atLeast:0,atMost:1/0};break;case"+":n={atLeast:1,atMost:1/0};break;case"?":n={atLeast:0,atMost:1};break;case"{":const i=this.integerIncludingZero();switch(this.popChar()){case"}":n={atLeast:i,atMost:i};break;case",":let s;this.isDigit()?(s=this.integerIncludingZero(),n={atLeast:i,atMost:s}):n={atLeast:i,atMost:1/0},this.consumeChar("}");break}if(e===!0&&n===void 0)return;pn(n);break}if(!(e===!0&&n===void 0)&&pn(n))return this.peekChar(0)==="?"?(this.consumeChar("?"),n.greedy=!1):n.greedy=!0,n.type="Quantifier",n.loc=this.loc(r),n}atom(){let e;const n=this.idx;switch(this.peekChar()){case".":e=this.dotAll();break;case"\\":e=this.atomEscape();break;case"[":e=this.characterClass();break;case"(":e=this.group();break}if(e===void 0&&this.isPatternCharacter()&&(e=this.patternCharacter()),pn(e))return e.loc=this.loc(n),this.isQuantifier()&&(e.quantifier=this.quantifier()),e}dotAll(){return this.consumeChar("."),{type:"Set",complement:!0,value:[G(`
`),G("\r"),G("\u2028"),G("\u2029")]}}atomEscape(){switch(this.consumeChar("\\"),this.peekChar()){case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":return this.decimalEscapeAtom();case"d":case"D":case"s":case"S":case"w":case"W":return this.characterClassEscape();case"f":case"n":case"r":case"t":case"v":return this.controlEscapeAtom();case"c":return this.controlLetterEscapeAtom();case"0":return this.nulCharacterAtom();case"x":return this.hexEscapeSequenceAtom();case"u":return this.regExpUnicodeEscapeSequenceAtom();default:return this.identityEscapeAtom()}}decimalEscapeAtom(){return{type:"GroupBackReference",value:this.positiveInteger()}}characterClassEscape(){let e,n=!1;switch(this.popChar()){case"d":e=Qr;break;case"D":e=Qr,n=!0;break;case"s":e=Jo;break;case"S":e=Jo,n=!0;break;case"w":e=zr;break;case"W":e=zr,n=!0;break}if(pn(e))return{type:"Set",value:e,complement:n}}controlEscapeAtom(){let e;switch(this.popChar()){case"f":e=G("\f");break;case"n":e=G(`
`);break;case"r":e=G("\r");break;case"t":e=G("	");break;case"v":e=G("\v");break}if(pn(e))return{type:"Character",value:e}}controlLetterEscapeAtom(){this.consumeChar("c");const e=this.popChar();if(/[a-zA-Z]/.test(e)===!1)throw Error("Invalid ");return{type:"Character",value:e.toUpperCase().charCodeAt(0)-64}}nulCharacterAtom(){return this.consumeChar("0"),{type:"Character",value:G("\0")}}hexEscapeSequenceAtom(){return this.consumeChar("x"),this.parseHexDigits(2)}regExpUnicodeEscapeSequenceAtom(){return this.consumeChar("u"),this.parseHexDigits(4)}identityEscapeAtom(){const e=this.popChar();return{type:"Character",value:G(e)}}classPatternCharacterAtom(){switch(this.peekChar()){case`
`:case"\r":case"\u2028":case"\u2029":case"\\":case"]":throw Error("TBD");default:const e=this.popChar();return{type:"Character",value:G(e)}}}characterClass(){const e=[];let n=!1;for(this.consumeChar("["),this.peekChar(0)==="^"&&(this.consumeChar("^"),n=!0);this.isClassAtom();){const r=this.classAtom();if(r.type,Ko(r)&&this.isRangeDash()){this.consumeChar("-");const i=this.classAtom();if(i.type,Ko(i)){if(i.value<r.value)throw Error("Range out of order in character class");e.push({from:r.value,to:i.value})}else ki(r.value,e),e.push(G("-")),ki(i.value,e)}else ki(r.value,e)}return this.consumeChar("]"),{type:"Set",complement:n,value:e}}classAtom(){switch(this.peekChar()){case"]":case`
`:case"\r":case"\u2028":case"\u2029":throw Error("TBD");case"\\":return this.classEscape();default:return this.classPatternCharacterAtom()}}classEscape(){switch(this.consumeChar("\\"),this.peekChar()){case"b":return this.consumeChar("b"),{type:"Character",value:G("\b")};case"d":case"D":case"s":case"S":case"w":case"W":return this.characterClassEscape();case"f":case"n":case"r":case"t":case"v":return this.controlEscapeAtom();case"c":return this.controlLetterEscapeAtom();case"0":return this.nulCharacterAtom();case"x":return this.hexEscapeSequenceAtom();case"u":return this.regExpUnicodeEscapeSequenceAtom();default:return this.identityEscapeAtom()}}group(){let e=!0;switch(this.consumeChar("("),this.peekChar(0)){case"?":this.consumeChar("?"),this.consumeChar(":"),e=!1;break;default:this.groupIdx++;break}const n=this.disjunction();this.consumeChar(")");const r={type:"Group",capturing:e,value:n};return e&&(r.idx=this.groupIdx),r}positiveInteger(){let e=this.popChar();if(bg.test(e)===!1)throw Error("Expecting a positive integer");for(;br.test(this.peekChar(0));)e+=this.popChar();return parseInt(e,10)}integerIncludingZero(){let e=this.popChar();if(br.test(e)===!1)throw Error("Expecting an integer");for(;br.test(this.peekChar(0));)e+=this.popChar();return parseInt(e,10)}patternCharacter(){const e=this.popChar();switch(e){case`
`:case"\r":case"\u2028":case"\u2029":case"^":case"$":case"\\":case".":case"*":case"+":case"?":case"(":case")":case"[":case"|":throw Error("TBD");default:return{type:"Character",value:G(e)}}}isRegExpFlag(){switch(this.peekChar(0)){case"g":case"i":case"m":case"u":case"y":return!0;default:return!1}}isRangeDash(){return this.peekChar()==="-"&&this.isClassAtom(1)}isDigit(){return br.test(this.peekChar(0))}isClassAtom(e=0){switch(this.peekChar(e)){case"]":case`
`:case"\r":case"\u2028":case"\u2029":return!1;default:return!0}}isTerm(){return this.isAtom()||this.isAssertion()}isAtom(){if(this.isPatternCharacter())return!0;switch(this.peekChar(0)){case".":case"\\":case"[":case"(":return!0;default:return!1}}isAssertion(){switch(this.peekChar(0)){case"^":case"$":return!0;case"\\":switch(this.peekChar(1)){case"b":case"B":return!0;default:return!1}case"(":return this.peekChar(1)==="?"&&(this.peekChar(2)==="="||this.peekChar(2)==="!");default:return!1}}isQuantifier(){const e=this.saveState();try{return this.quantifier(!0)!==void 0}catch{return!1}finally{this.restoreState(e)}}isPatternCharacter(){switch(this.peekChar()){case"^":case"$":case"\\":case".":case"*":case"+":case"?":case"(":case")":case"[":case"|":case"/":case`
`:case"\r":case"\u2028":case"\u2029":return!1;default:return!0}}parseHexDigits(e){let n="";for(let i=0;i<e;i++){const s=this.popChar();if(Ig.test(s)===!1)throw Error("Expecting a HexDecimal digits");n+=s}return{type:"Character",value:parseInt(n,16)}}peekChar(e=0){return this.input[this.idx+e]}popChar(){const e=this.peekChar(0);return this.consumeChar(void 0),e}consumeChar(e){if(e!==void 0&&this.input[this.idx]!==e)throw Error("Expected: '"+e+"' but found: '"+this.input[this.idx]+"' at offset: "+this.idx);if(this.idx>=this.input.length)throw Error("Unexpected end of input");this.idx++}loc(e){return{begin:e,end:this.idx}}}class Hs{visitChildren(e){for(const n in e){const r=e[n];e.hasOwnProperty(n)&&(r.type!==void 0?this.visit(r):Array.isArray(r)&&r.forEach(i=>{this.visit(i)},this))}}visit(e){switch(e.type){case"Pattern":this.visitPattern(e);break;case"Flags":this.visitFlags(e);break;case"Disjunction":this.visitDisjunction(e);break;case"Alternative":this.visitAlternative(e);break;case"StartAnchor":this.visitStartAnchor(e);break;case"EndAnchor":this.visitEndAnchor(e);break;case"WordBoundary":this.visitWordBoundary(e);break;case"NonWordBoundary":this.visitNonWordBoundary(e);break;case"Lookahead":this.visitLookahead(e);break;case"NegativeLookahead":this.visitNegativeLookahead(e);break;case"Character":this.visitCharacter(e);break;case"Set":this.visitSet(e);break;case"Group":this.visitGroup(e);break;case"GroupBackReference":this.visitGroupBackReference(e);break;case"Quantifier":this.visitQuantifier(e);break}this.visitChildren(e)}visitPattern(e){}visitFlags(e){}visitDisjunction(e){}visitAlternative(e){}visitStartAnchor(e){}visitEndAnchor(e){}visitWordBoundary(e){}visitNonWordBoundary(e){}visitLookahead(e){}visitNegativeLookahead(e){}visitCharacter(e){}visitSet(e){}visitGroup(e){}visitGroupBackReference(e){}visitQuantifier(e){}}let Lr={};const _g=new Pg;function Ci(t){const e=t.toString();if(Lr.hasOwnProperty(e))return Lr[e];{const n=_g.pattern(e);return Lr[e]=n,n}}function wg(){Lr={}}const _l="Complement Sets are not supported for first char optimization",Yr=`Unable to use "first char" lexer optimizations:
`;function Og(t,e=!1){try{const n=Ci(t);return hs(n.value,{},n.flags.ignoreCase)}catch(n){if(n.message===_l)e&&Ml(`${Yr}	Unable to optimize: < ${t.toString()} >
	Complement Sets cannot be automatically optimized.
	This will disable the lexer's first char optimizations.
	See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#COMPLEMENT for details.`);else{let r="";e&&(r=`
	This will disable the lexer's first char optimizations.
	See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#REGEXP_PARSING for details.`),us(`${Yr}
	Failed parsing: < ${t.toString()} >
	Using the @chevrotain/regexp-to-ast library
	Please open an issue at: https://github.com/chevrotain/chevrotain/issues`+r)}}return[]}function hs(t,e,n){switch(t.type){case"Disjunction":for(let i=0;i<t.value.length;i++)hs(t.value[i],e,n);break;case"Alternative":const r=t.value;for(let i=0;i<r.length;i++){const s=r[i];switch(s.type){case"EndAnchor":case"GroupBackReference":case"Lookahead":case"NegativeLookahead":case"StartAnchor":case"WordBoundary":case"NonWordBoundary":continue}const o=s;switch(o.type){case"Character":Pr(o.value,e,n);break;case"Set":if(o.complement===!0)throw Error(_l);L(o.value,l=>{if(typeof l=="number")Pr(l,e,n);else{const c=l;if(n===!0)for(let u=c.from;u<=c.to;u++)Pr(u,e,n);else{for(let u=c.from;u<=c.to&&u<jn;u++)Pr(u,e,n);if(c.to>=jn){const u=c.from>=jn?c.from:jn,h=c.to,f=wt(u),T=wt(h);for(let g=f;g<=T;g++)e[g]=g}}}});break;case"Group":hs(o.value,e,n);break;default:throw Error("Non Exhaustive Match")}const a=o.quantifier!==void 0&&o.quantifier.atLeast===0;if(o.type==="Group"&&fs(o)===!1||o.type!=="Group"&&a===!1)break}break;default:throw Error("non exhaustive match!")}return Ae(e)}function Pr(t,e,n){const r=wt(t);e[r]=r,n===!0&&Fg(t,e)}function Fg(t,e){const n=String.fromCharCode(t),r=n.toUpperCase();if(r!==n){const i=wt(r.charCodeAt(0));e[i]=i}else{const i=n.toLowerCase();if(i!==n){const s=wt(i.charCodeAt(0));e[s]=s}}}function jo(t,e){return xn(t.value,n=>{if(typeof n=="number")return be(e,n);{const r=n;return xn(e,i=>r.from<=i&&i<=r.to)!==void 0}})}function fs(t){const e=t.quantifier;return e&&e.atLeast===0?!0:t.value?W(t.value)?ze(t.value,fs):fs(t.value):!1}class Dg extends Hs{constructor(e){super(),this.targetCharCodes=e,this.found=!1}visitChildren(e){if(this.found!==!0){switch(e.type){case"Lookahead":this.visitLookahead(e);return;case"NegativeLookahead":this.visitNegativeLookahead(e);return}super.visitChildren(e)}}visitCharacter(e){be(this.targetCharCodes,e.value)&&(this.found=!0)}visitSet(e){e.complement?jo(e,this.targetCharCodes)===void 0&&(this.found=!0):jo(e,this.targetCharCodes)!==void 0&&(this.found=!0)}}function Ks(t,e){if(e instanceof RegExp){const n=Ci(e),r=new Dg(t);return r.visit(n),r.found}else return xn(e,n=>be(t,n.charCodeAt(0)))!==void 0}const en="PATTERN",Jn="defaultMode",_r="modes";let wl=typeof new RegExp("(?:)").sticky=="boolean";function Ng(t,e){e=ks(e,{useSticky:wl,debug:!1,safeMode:!1,positionTracking:"full",lineTerminatorCharacters:["\r",`
`],tracer:(m,p)=>p()});const n=e.tracer;n("initCharCodeToOptimizedIndexMap",()=>{sT()});let r;n("Reject Lexer.NA",()=>{r=Ti(t,m=>m[en]===Je.NA)});let i=!1,s;n("Transform Patterns",()=>{i=!1,s=F(r,m=>{const p=m[en];if(Tt(p)){const C=p.source;return C.length===1&&C!=="^"&&C!=="$"&&C!=="."&&!p.ignoreCase?C:C.length===2&&C[0]==="\\"&&!be(["d","D","s","S","t","r","n","t","0","c","b","B","f","v","w","W"],C[1])?C[1]:e.useSticky?Vo(p):Wo(p)}else{if(Ct(p))return i=!0,{exec:p};if(typeof p=="object")return i=!0,p;if(typeof p=="string"){if(p.length===1)return p;{const C=p.replace(/[\\^$.*+?()[\]{}|]/g,"\\$&"),R=new RegExp(C);return e.useSticky?Vo(R):Wo(R)}}else throw Error("non exhaustive match")}})});let o,a,l,c,u;n("misc mapping",()=>{o=F(r,m=>m.tokenTypeIdx),a=F(r,m=>{const p=m.GROUP;if(p!==Je.SKIPPED){if(Fe(p))return p;if(vt(p))return!1;throw Error("non exhaustive match")}}),l=F(r,m=>{const p=m.LONGER_ALT;if(p)return W(p)?F(p,R=>ko(r,R)):[ko(r,p)]}),c=F(r,m=>m.PUSH_MODE),u=F(r,m=>N(m,"POP_MODE"))});let h;n("Line Terminator Handling",()=>{const m=Dl(e.lineTerminatorCharacters);h=F(r,p=>!1),e.positionTracking!=="onlyOffset"&&(h=F(r,p=>N(p,"LINE_BREAKS")?!!p.LINE_BREAKS:Fl(p,m)===!1&&Ks(m,p.PATTERN)))});let f,T,g,d;n("Misc Mapping #2",()=>{f=F(r,Ol),T=F(s,nT),g=Ge(r,(m,p)=>{const C=p.GROUP;return Fe(C)&&C!==Je.SKIPPED&&(m[C]=[]),m},{}),d=F(s,(m,p)=>({pattern:s[p],longerAlt:l[p],canLineTerminator:h[p],isCustom:f[p],short:T[p],group:a[p],push:c[p],pop:u[p],tokenTypeIdx:o[p],tokenType:r[p]}))});let A=!0,v=[];return e.safeMode||n("First Char Optimization",()=>{v=Ge(r,(m,p,C)=>{if(typeof p.PATTERN=="string"){const R=p.PATTERN.charCodeAt(0),y=wt(R);Ui(m,y,d[C])}else if(W(p.START_CHARS_HINT)){let R;L(p.START_CHARS_HINT,y=>{const B=typeof y=="string"?y.charCodeAt(0):y,x=wt(B);R!==x&&(R=x,Ui(m,x,d[C]))})}else if(Tt(p.PATTERN))if(p.PATTERN.unicode)A=!1,e.ensureOptimizations&&us(`${Yr}	Unable to analyze < ${p.PATTERN.toString()} > pattern.
	The regexp unicode flag is not currently supported by the regexp-to-ast library.
	This will disable the lexer's first char optimizations.
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#UNICODE_OPTIMIZE`);else{const R=Og(p.PATTERN,e.ensureOptimizations);Z(R)&&(A=!1),L(R,y=>{Ui(m,y,d[C])})}else e.ensureOptimizations&&us(`${Yr}	TokenType: <${p.name}> is using a custom token pattern without providing <start_chars_hint> parameter.
	This will disable the lexer's first char optimizations.
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#CUSTOM_OPTIMIZE`),A=!1;return m},[])}),{emptyGroups:g,patternIdxToConfig:d,charCodeToPatternIdxToConfig:v,hasCustom:i,canBeOptimized:A}}function Lg(t,e){let n=[];const r=kg(t);n=n.concat(r.errors);const i=Ug(r.valid),s=i.valid;return n=n.concat(i.errors),n=n.concat(Gg(s)),n=n.concat(Qg(s)),n=n.concat(zg(s,e)),n=n.concat(Yg(s)),n}function Gg(t){let e=[];const n=Ve(t,r=>Tt(r[en]));return e=e.concat(Kg(n)),e=e.concat(Wg(n)),e=e.concat(Vg(n)),e=e.concat(Xg(n)),e=e.concat(Jg(n)),e}function kg(t){const e=Ve(t,i=>!N(i,en)),n=F(e,i=>({message:"Token Type: ->"+i.name+"<- missing static 'PATTERN' property",type:ce.MISSING_PATTERN,tokenTypes:[i]})),r=gi(t,e);return{errors:n,valid:r}}function Ug(t){const e=Ve(t,i=>{const s=i[en];return!Tt(s)&&!Ct(s)&&!N(s,"exec")&&!Fe(s)}),n=F(e,i=>({message:"Token Type: ->"+i.name+"<- static 'PATTERN' can only be a RegExp, a Function matching the {CustomPatternMatcherFunc} type or an Object matching the {ICustomPattern} interface.",type:ce.INVALID_PATTERN,tokenTypes:[i]})),r=gi(t,e);return{errors:n,valid:r}}const Hg=/[^\\][$]/;function Kg(t){class e extends Hs{constructor(){super(...arguments),this.found=!1}visitEndAnchor(s){this.found=!0}}const n=Ve(t,i=>{const s=i.PATTERN;try{const o=Ci(s),a=new e;return a.visit(o),a.found}catch{return Hg.test(s.source)}});return F(n,i=>({message:`Unexpected RegExp Anchor Error:
	Token Type: ->`+i.name+`<- static 'PATTERN' cannot contain end of input anchor '$'
	See chevrotain.io/docs/guide/resolving_lexer_errors.html#ANCHORS	for details.`,type:ce.EOI_ANCHOR_FOUND,tokenTypes:[i]}))}function Jg(t){const e=Ve(t,r=>r.PATTERN.test(""));return F(e,r=>({message:"Token Type: ->"+r.name+"<- static 'PATTERN' must not match an empty string",type:ce.EMPTY_MATCH_PATTERN,tokenTypes:[r]}))}const jg=/[^\\[][\^]|^\^/;function Wg(t){class e extends Hs{constructor(){super(...arguments),this.found=!1}visitStartAnchor(s){this.found=!0}}const n=Ve(t,i=>{const s=i.PATTERN;try{const o=Ci(s),a=new e;return a.visit(o),a.found}catch{return jg.test(s.source)}});return F(n,i=>({message:`Unexpected RegExp Anchor Error:
	Token Type: ->`+i.name+`<- static 'PATTERN' cannot contain start of input anchor '^'
	See https://chevrotain.io/docs/guide/resolving_lexer_errors.html#ANCHORS	for details.`,type:ce.SOI_ANCHOR_FOUND,tokenTypes:[i]}))}function Vg(t){const e=Ve(t,r=>{const i=r[en];return i instanceof RegExp&&(i.multiline||i.global)});return F(e,r=>({message:"Token Type: ->"+r.name+"<- static 'PATTERN' may NOT contain global('g') or multiline('m')",type:ce.UNSUPPORTED_FLAGS_FOUND,tokenTypes:[r]}))}function Xg(t){const e=[];let n=F(t,s=>Ge(t,(o,a)=>(s.PATTERN.source===a.PATTERN.source&&!be(e,a)&&a.PATTERN!==Je.NA&&(e.push(a),o.push(a)),o),[]));n=pr(n);const r=Ve(n,s=>s.length>1);return F(r,s=>{const o=F(s,l=>l.name);return{message:`The same RegExp pattern ->${$e(s).PATTERN}<-has been used in all of the following Token Types: ${o.join(", ")} <-`,type:ce.DUPLICATE_PATTERNS_FOUND,tokenTypes:s}})}function Qg(t){const e=Ve(t,r=>{if(!N(r,"GROUP"))return!1;const i=r.GROUP;return i!==Je.SKIPPED&&i!==Je.NA&&!Fe(i)});return F(e,r=>({message:"Token Type: ->"+r.name+"<- static 'GROUP' can only be Lexer.SKIPPED/Lexer.NA/A String",type:ce.INVALID_GROUP_TYPE_FOUND,tokenTypes:[r]}))}function zg(t,e){const n=Ve(t,i=>i.PUSH_MODE!==void 0&&!be(e,i.PUSH_MODE));return F(n,i=>({message:`Token Type: ->${i.name}<- static 'PUSH_MODE' value cannot refer to a Lexer Mode ->${i.PUSH_MODE}<-which does not exist`,type:ce.PUSH_MODE_DOES_NOT_EXIST,tokenTypes:[i]}))}function Yg(t){const e=[],n=Ge(t,(r,i,s)=>{const o=i.PATTERN;return o===Je.NA||(Fe(o)?r.push({str:o,idx:s,tokenType:i}):Tt(o)&&Zg(o)&&r.push({str:o.source,idx:s,tokenType:i})),r},[]);return L(t,(r,i)=>{L(n,({str:s,idx:o,tokenType:a})=>{if(i<o&&$g(s,r.PATTERN)){const l=`Token: ->${a.name}<- can never be matched.
Because it appears AFTER the Token Type ->${r.name}<-in the lexer's definition.
See https://chevrotain.io/docs/guide/resolving_lexer_errors.html#UNREACHABLE`;e.push({message:l,type:ce.UNREACHABLE_PATTERN,tokenTypes:[r,a]})}})}),e}function $g(t,e){if(Tt(e)){const n=e.exec(t);return n!==null&&n.index===0}else{if(Ct(e))return e(t,0,[],{});if(N(e,"exec"))return e.exec(t,0,[],{});if(typeof e=="string")return e===t;throw Error("non exhaustive match")}}function Zg(t){return xn([".","\\","[","]","|","^","$","(",")","?","*","+","{"],n=>t.source.indexOf(n)!==-1)===void 0}function Wo(t){const e=t.ignoreCase?"i":"";return new RegExp(`^(?:${t.source})`,e)}function Vo(t){const e=t.ignoreCase?"iy":"y";return new RegExp(`${t.source}`,e)}function qg(t,e,n){const r=[];return N(t,Jn)||r.push({message:"A MultiMode Lexer cannot be initialized without a <"+Jn+`> property in its definition
`,type:ce.MULTI_MODE_LEXER_WITHOUT_DEFAULT_MODE}),N(t,_r)||r.push({message:"A MultiMode Lexer cannot be initialized without a <"+_r+`> property in its definition
`,type:ce.MULTI_MODE_LEXER_WITHOUT_MODES_PROPERTY}),N(t,_r)&&N(t,Jn)&&!N(t.modes,t.defaultMode)&&r.push({message:`A MultiMode Lexer cannot be initialized with a ${Jn}: <${t.defaultMode}>which does not exist
`,type:ce.MULTI_MODE_LEXER_DEFAULT_MODE_VALUE_DOES_NOT_EXIST}),N(t,_r)&&L(t.modes,(i,s)=>{L(i,(o,a)=>{if(vt(o))r.push({message:`A Lexer cannot be initialized using an undefined Token Type. Mode:<${s}> at index: <${a}>
`,type:ce.LEXER_DEFINITION_CANNOT_CONTAIN_UNDEFINED});else if(N(o,"LONGER_ALT")){const l=W(o.LONGER_ALT)?o.LONGER_ALT:[o.LONGER_ALT];L(l,c=>{!vt(c)&&!be(i,c)&&r.push({message:`A MultiMode Lexer cannot be initialized with a longer_alt <${c.name}> on token <${o.name}> outside of mode <${s}>
`,type:ce.MULTI_MODE_LEXER_LONGER_ALT_NOT_IN_CURRENT_MODE})})}})}),r}function eT(t,e,n){const r=[];let i=!1;const s=pr(Qe(Ae(t.modes))),o=Ti(s,l=>l[en]===Je.NA),a=Dl(n);return e&&L(o,l=>{const c=Fl(l,a);if(c!==!1){const h={message:iT(l,c),type:c.issue,tokenType:l};r.push(h)}else N(l,"LINE_BREAKS")?l.LINE_BREAKS===!0&&(i=!0):Ks(a,l.PATTERN)&&(i=!0)}),e&&!i&&r.push({message:`Warning: No LINE_BREAKS Found.
	This Lexer has been defined to track line and column information,
	But none of the Token Types can be identified as matching a line terminator.
	See https://chevrotain.io/docs/guide/resolving_lexer_errors.html#LINE_BREAKS 
	for details.`,type:ce.NO_LINE_BREAKS_FLAGS}),r}function tT(t){const e={},n=Ne(t);return L(n,r=>{const i=t[r];if(W(i))e[r]=[];else throw Error("non exhaustive match")}),e}function Ol(t){const e=t.PATTERN;if(Tt(e))return!1;if(Ct(e))return!0;if(N(e,"exec"))return!0;if(Fe(e))return!1;throw Error("non exhaustive match")}function nT(t){return Fe(t)&&t.length===1?t.charCodeAt(0):!1}const rT={test:function(t){const e=t.length;for(let n=this.lastIndex;n<e;n++){const r=t.charCodeAt(n);if(r===10)return this.lastIndex=n+1,!0;if(r===13)return t.charCodeAt(n+1)===10?this.lastIndex=n+2:this.lastIndex=n+1,!0}return!1},lastIndex:0};function Fl(t,e){if(N(t,"LINE_BREAKS"))return!1;if(Tt(t.PATTERN)){try{Ks(e,t.PATTERN)}catch(n){return{issue:ce.IDENTIFY_TERMINATOR,errMsg:n.message}}return!1}else{if(Fe(t.PATTERN))return!1;if(Ol(t))return{issue:ce.CUSTOM_LINE_BREAK};throw Error("non exhaustive match")}}function iT(t,e){if(e.issue===ce.IDENTIFY_TERMINATOR)return`Warning: unable to identify line terminator usage in pattern.
	The problem is in the <${t.name}> Token Type
	 Root cause: ${e.errMsg}.
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#IDENTIFY_TERMINATOR`;if(e.issue===ce.CUSTOM_LINE_BREAK)return`Warning: A Custom Token Pattern should specify the <line_breaks> option.
	The problem is in the <${t.name}> Token Type
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#CUSTOM_LINE_BREAK`;throw Error("non exhaustive match")}function Dl(t){return F(t,n=>Fe(n)?n.charCodeAt(0):n)}function Ui(t,e,n){t[e]===void 0?t[e]=[n]:t[e].push(n)}const jn=256;let Gr=[];function wt(t){return t<jn?t:Gr[t]}function sT(){if(Z(Gr)){Gr=new Array(65536);for(let t=0;t<65536;t++)Gr[t]=t>255?255+~~(t/255):t}}function Ar(t,e){const n=t.tokenTypeIdx;return n===e.tokenTypeIdx?!0:e.isParent===!0&&e.categoryMatchesMap[n]===!0}function $r(t,e){return t.tokenTypeIdx===e.tokenTypeIdx}let Xo=1;const Nl={};function gr(t){const e=oT(t);aT(e),cT(e),lT(e),L(e,n=>{n.isParent=n.categoryMatches.length>0})}function oT(t){let e=ye(t),n=t,r=!0;for(;r;){n=pr(Qe(F(n,s=>s.CATEGORIES)));const i=gi(n,e);e=e.concat(i),Z(i)?r=!1:n=i}return e}function aT(t){L(t,e=>{Gl(e)||(Nl[Xo]=e,e.tokenTypeIdx=Xo++),Qo(e)&&!W(e.CATEGORIES)&&(e.CATEGORIES=[e.CATEGORIES]),Qo(e)||(e.CATEGORIES=[]),uT(e)||(e.categoryMatches=[]),hT(e)||(e.categoryMatchesMap={})})}function lT(t){L(t,e=>{e.categoryMatches=[],L(e.categoryMatchesMap,(n,r)=>{e.categoryMatches.push(Nl[r].tokenTypeIdx)})})}function cT(t){L(t,e=>{Ll([],e)})}function Ll(t,e){L(t,n=>{e.categoryMatchesMap[n.tokenTypeIdx]=!0}),L(e.CATEGORIES,n=>{const r=t.concat(e);be(r,n)||Ll(r,n)})}function Gl(t){return N(t,"tokenTypeIdx")}function Qo(t){return N(t,"CATEGORIES")}function uT(t){return N(t,"categoryMatches")}function hT(t){return N(t,"categoryMatchesMap")}function fT(t){return N(t,"tokenTypeIdx")}const dT={buildUnableToPopLexerModeMessage(t){return`Unable to pop Lexer Mode after encountering Token ->${t.image}<- The Mode Stack is empty`},buildUnexpectedCharactersMessage(t,e,n,r,i){return`unexpected character: ->${t.charAt(e)}<- at offset: ${e}, skipped ${n} characters.`}};var ce;(function(t){t[t.MISSING_PATTERN=0]="MISSING_PATTERN",t[t.INVALID_PATTERN=1]="INVALID_PATTERN",t[t.EOI_ANCHOR_FOUND=2]="EOI_ANCHOR_FOUND",t[t.UNSUPPORTED_FLAGS_FOUND=3]="UNSUPPORTED_FLAGS_FOUND",t[t.DUPLICATE_PATTERNS_FOUND=4]="DUPLICATE_PATTERNS_FOUND",t[t.INVALID_GROUP_TYPE_FOUND=5]="INVALID_GROUP_TYPE_FOUND",t[t.PUSH_MODE_DOES_NOT_EXIST=6]="PUSH_MODE_DOES_NOT_EXIST",t[t.MULTI_MODE_LEXER_WITHOUT_DEFAULT_MODE=7]="MULTI_MODE_LEXER_WITHOUT_DEFAULT_MODE",t[t.MULTI_MODE_LEXER_WITHOUT_MODES_PROPERTY=8]="MULTI_MODE_LEXER_WITHOUT_MODES_PROPERTY",t[t.MULTI_MODE_LEXER_DEFAULT_MODE_VALUE_DOES_NOT_EXIST=9]="MULTI_MODE_LEXER_DEFAULT_MODE_VALUE_DOES_NOT_EXIST",t[t.LEXER_DEFINITION_CANNOT_CONTAIN_UNDEFINED=10]="LEXER_DEFINITION_CANNOT_CONTAIN_UNDEFINED",t[t.SOI_ANCHOR_FOUND=11]="SOI_ANCHOR_FOUND",t[t.EMPTY_MATCH_PATTERN=12]="EMPTY_MATCH_PATTERN",t[t.NO_LINE_BREAKS_FLAGS=13]="NO_LINE_BREAKS_FLAGS",t[t.UNREACHABLE_PATTERN=14]="UNREACHABLE_PATTERN",t[t.IDENTIFY_TERMINATOR=15]="IDENTIFY_TERMINATOR",t[t.CUSTOM_LINE_BREAK=16]="CUSTOM_LINE_BREAK",t[t.MULTI_MODE_LEXER_LONGER_ALT_NOT_IN_CURRENT_MODE=17]="MULTI_MODE_LEXER_LONGER_ALT_NOT_IN_CURRENT_MODE"})(ce||(ce={}));const Wn={deferDefinitionErrorsHandling:!1,positionTracking:"full",lineTerminatorsPattern:/\n|\r\n?/g,lineTerminatorCharacters:[`
`,"\r"],ensureOptimizations:!1,safeMode:!1,errorMessageProvider:dT,traceInitPerf:!1,skipValidations:!1,recoveryEnabled:!0};Object.freeze(Wn);class Je{constructor(e,n=Wn){if(this.lexerDefinition=e,this.lexerDefinitionErrors=[],this.lexerDefinitionWarning=[],this.patternIdxToConfig={},this.charCodeToPatternIdxToConfig={},this.modes=[],this.emptyGroups={},this.trackStartLines=!0,this.trackEndLines=!0,this.hasCustom=!1,this.canModeBeOptimized={},this.TRACE_INIT=(i,s)=>{if(this.traceInitPerf===!0){this.traceInitIndent++;const o=new Array(this.traceInitIndent+1).join("	");this.traceInitIndent<this.traceInitMaxIdent&&console.log(`${o}--> <${i}>`);const{time:a,value:l}=Il(s),c=a>10?console.warn:console.log;return this.traceInitIndent<this.traceInitMaxIdent&&c(`${o}<-- <${i}> time: ${a}ms`),this.traceInitIndent--,l}else return s()},typeof n=="boolean")throw Error(`The second argument to the Lexer constructor is now an ILexerConfig Object.
a boolean 2nd argument is no longer supported`);this.config=Le({},Wn,n);const r=this.config.traceInitPerf;r===!0?(this.traceInitMaxIdent=1/0,this.traceInitPerf=!0):typeof r=="number"&&(this.traceInitMaxIdent=r,this.traceInitPerf=!0),this.traceInitIndent=-1,this.TRACE_INIT("Lexer Constructor",()=>{let i,s=!0;this.TRACE_INIT("Lexer Config handling",()=>{if(this.config.lineTerminatorsPattern===Wn.lineTerminatorsPattern)this.config.lineTerminatorsPattern=rT;else if(this.config.lineTerminatorCharacters===Wn.lineTerminatorCharacters)throw Error(`Error: Missing <lineTerminatorCharacters> property on the Lexer config.
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#MISSING_LINE_TERM_CHARS`);if(n.safeMode&&n.ensureOptimizations)throw Error('"safeMode" and "ensureOptimizations" flags are mutually exclusive.');this.trackStartLines=/full|onlyStart/i.test(this.config.positionTracking),this.trackEndLines=/full/i.test(this.config.positionTracking),W(e)?i={modes:{defaultMode:ye(e)},defaultMode:Jn}:(s=!1,i=ye(e))}),this.config.skipValidations===!1&&(this.TRACE_INIT("performRuntimeChecks",()=>{this.lexerDefinitionErrors=this.lexerDefinitionErrors.concat(qg(i,this.trackStartLines,this.config.lineTerminatorCharacters))}),this.TRACE_INIT("performWarningRuntimeChecks",()=>{this.lexerDefinitionWarning=this.lexerDefinitionWarning.concat(eT(i,this.trackStartLines,this.config.lineTerminatorCharacters))})),i.modes=i.modes?i.modes:{},L(i.modes,(a,l)=>{i.modes[l]=Ti(a,c=>vt(c))});const o=Ne(i.modes);if(L(i.modes,(a,l)=>{this.TRACE_INIT(`Mode: <${l}> processing`,()=>{if(this.modes.push(l),this.config.skipValidations===!1&&this.TRACE_INIT("validatePatterns",()=>{this.lexerDefinitionErrors=this.lexerDefinitionErrors.concat(Lg(a,o))}),Z(this.lexerDefinitionErrors)){gr(a);let c;this.TRACE_INIT("analyzeTokenTypes",()=>{c=Ng(a,{lineTerminatorCharacters:this.config.lineTerminatorCharacters,positionTracking:n.positionTracking,ensureOptimizations:n.ensureOptimizations,safeMode:n.safeMode,tracer:this.TRACE_INIT})}),this.patternIdxToConfig[l]=c.patternIdxToConfig,this.charCodeToPatternIdxToConfig[l]=c.charCodeToPatternIdxToConfig,this.emptyGroups=Le({},this.emptyGroups,c.emptyGroups),this.hasCustom=c.hasCustom||this.hasCustom,this.canModeBeOptimized[l]=c.canBeOptimized}})}),this.defaultMode=i.defaultMode,!Z(this.lexerDefinitionErrors)&&!this.config.deferDefinitionErrorsHandling){const l=F(this.lexerDefinitionErrors,c=>c.message).join(`-----------------------
`);throw new Error(`Errors detected in definition of Lexer:
`+l)}L(this.lexerDefinitionWarning,a=>{Ml(a.message)}),this.TRACE_INIT("Choosing sub-methods implementations",()=>{if(wl?(this.chopInput=Rn,this.match=this.matchWithTest):(this.updateLastIndex=me,this.match=this.matchWithExec),s&&(this.handleModes=me),this.trackStartLines===!1&&(this.computeNewColumn=Rn),this.trackEndLines===!1&&(this.updateTokenEndLineColumnLocation=me),/full/i.test(this.config.positionTracking))this.createTokenInstance=this.createFullToken;else if(/onlyStart/i.test(this.config.positionTracking))this.createTokenInstance=this.createStartOnlyToken;else if(/onlyOffset/i.test(this.config.positionTracking))this.createTokenInstance=this.createOffsetOnlyToken;else throw Error(`Invalid <positionTracking> config option: "${this.config.positionTracking}"`);this.hasCustom?(this.addToken=this.addTokenUsingPush,this.handlePayload=this.handlePayloadWithCustom):(this.addToken=this.addTokenUsingMemberAccess,this.handlePayload=this.handlePayloadNoCustom)}),this.TRACE_INIT("Failed Optimization Warnings",()=>{const a=Ge(this.canModeBeOptimized,(l,c,u)=>(c===!1&&l.push(u),l),[]);if(n.ensureOptimizations&&!Z(a))throw Error(`Lexer Modes: < ${a.join(", ")} > cannot be optimized.
	 Disable the "ensureOptimizations" lexer config flag to silently ignore this and run the lexer in an un-optimized mode.
	 Or inspect the console log for details on how to resolve these issues.`)}),this.TRACE_INIT("clearRegExpParserCache",()=>{wg()}),this.TRACE_INIT("toFastProperties",()=>{bl(this)})})}tokenize(e,n=this.defaultMode){if(!Z(this.lexerDefinitionErrors)){const i=F(this.lexerDefinitionErrors,s=>s.message).join(`-----------------------
`);throw new Error(`Unable to Tokenize because Errors detected in definition of Lexer:
`+i)}return this.tokenizeInternal(e,n)}tokenizeInternal(e,n){let r,i,s,o,a,l,c,u,h,f,T,g,d,A,v;const m=e,p=m.length;let C=0,R=0;const y=this.hasCustom?0:Math.floor(e.length/10),B=new Array(y),x=[];let I=this.trackStartLines?1:void 0,S=this.trackStartLines?1:void 0;const b=tT(this.emptyGroups),O=this.trackStartLines,w=this.config.lineTerminatorsPattern;let k=0,U=[],j=[];const V=[],X=[];Object.freeze(X);let Q;function z(){return U}function ve(re){const de=wt(re),Te=j[de];return Te===void 0?X:Te}const Ce=re=>{if(V.length===1&&re.tokenType.PUSH_MODE===void 0){const de=this.config.errorMessageProvider.buildUnableToPopLexerModeMessage(re);x.push({offset:re.startOffset,line:re.startLine,column:re.startColumn,length:re.image.length,message:de})}else{V.pop();const de=Sn(V);U=this.patternIdxToConfig[de],j=this.charCodeToPatternIdxToConfig[de],k=U.length;const Te=this.canModeBeOptimized[de]&&this.config.safeMode===!1;j&&Te?Q=ve:Q=z}};function Pe(re){V.push(re),j=this.charCodeToPatternIdxToConfig[re],U=this.patternIdxToConfig[re],k=U.length,k=U.length;const de=this.canModeBeOptimized[re]&&this.config.safeMode===!1;j&&de?Q=ve:Q=z}Pe.call(this,n);let pe;const Xe=this.config.recoveryEnabled;for(;C<p;){l=null;const re=m.charCodeAt(C),de=Q(re),Te=de.length;for(r=0;r<Te;r++){pe=de[r];const ee=pe.pattern;c=null;const ue=pe.short;if(ue!==!1?re===ue&&(l=ee):pe.isCustom===!0?(v=ee.exec(m,C,B,b),v!==null?(l=v[0],v.payload!==void 0&&(c=v.payload)):l=null):(this.updateLastIndex(ee,C),l=this.match(ee,e,C)),l!==null){if(a=pe.longerAlt,a!==void 0){const he=a.length;for(s=0;s<he;s++){const Re=U[a[s]],_e=Re.pattern;if(u=null,Re.isCustom===!0?(v=_e.exec(m,C,B,b),v!==null?(o=v[0],v.payload!==void 0&&(u=v.payload)):o=null):(this.updateLastIndex(_e,C),o=this.match(_e,e,C)),o&&o.length>l.length){l=o,c=u,pe=Re;break}}}break}}if(l!==null){if(h=l.length,f=pe.group,f!==void 0&&(T=pe.tokenTypeIdx,g=this.createTokenInstance(l,C,T,pe.tokenType,I,S,h),this.handlePayload(g,c),f===!1?R=this.addToken(B,R,g):b[f].push(g)),e=this.chopInput(e,h),C=C+h,S=this.computeNewColumn(S,h),O===!0&&pe.canLineTerminator===!0){let ee=0,ue,he;w.lastIndex=0;do ue=w.test(l),ue===!0&&(he=w.lastIndex-1,ee++);while(ue===!0);ee!==0&&(I=I+ee,S=h-he,this.updateTokenEndLineColumnLocation(g,f,he,ee,I,S,h))}this.handleModes(pe,Ce,Pe,g)}else{const ee=C,ue=I,he=S;let Re=Xe===!1;for(;Re===!1&&C<p;)for(e=this.chopInput(e,1),C++,i=0;i<k;i++){const _e=U[i],dt=_e.pattern,Bt=_e.short;if(Bt!==!1?m.charCodeAt(C)===Bt&&(Re=!0):_e.isCustom===!0?Re=dt.exec(m,C,B,b)!==null:(this.updateLastIndex(dt,C),Re=dt.exec(e)!==null),Re===!0)break}if(d=C-ee,S=this.computeNewColumn(S,d),A=this.config.errorMessageProvider.buildUnexpectedCharactersMessage(m,ee,d,ue,he),x.push({offset:ee,line:ue,column:he,length:d,message:A}),Xe===!1)break}}return this.hasCustom||(B.length=R),{tokens:B,groups:b,errors:x}}handleModes(e,n,r,i){if(e.pop===!0){const s=e.push;n(i),s!==void 0&&r.call(this,s)}else e.push!==void 0&&r.call(this,e.push)}chopInput(e,n){return e.substring(n)}updateLastIndex(e,n){e.lastIndex=n}updateTokenEndLineColumnLocation(e,n,r,i,s,o,a){let l,c;n!==void 0&&(l=r===a-1,c=l?-1:0,i===1&&l===!0||(e.endLine=s+c,e.endColumn=o-1+-c))}computeNewColumn(e,n){return e+n}createOffsetOnlyToken(e,n,r,i){return{image:e,startOffset:n,tokenTypeIdx:r,tokenType:i}}createStartOnlyToken(e,n,r,i,s,o){return{image:e,startOffset:n,startLine:s,startColumn:o,tokenTypeIdx:r,tokenType:i}}createFullToken(e,n,r,i,s,o,a){return{image:e,startOffset:n,endOffset:n+a-1,startLine:s,endLine:s,startColumn:o,endColumn:o+a-1,tokenTypeIdx:r,tokenType:i}}addTokenUsingPush(e,n,r){return e.push(r),n}addTokenUsingMemberAccess(e,n,r){return e[n]=r,n++,n}handlePayloadNoCustom(e,n){}handlePayloadWithCustom(e,n){n!==null&&(e.payload=n)}matchWithTest(e,n,r){return e.test(n)===!0?n.substring(r,e.lastIndex):null}matchWithExec(e,n){const r=e.exec(n);return r!==null?r[0]:null}}Je.SKIPPED="This marks a skipped Token pattern, this means each token identified by it willbe consumed and then thrown into oblivion, this can be used to for example to completely ignore whitespace.";Je.NA=/NOT_APPLICABLE/;function qn(t){return kl(t)?t.LABEL:t.name}function kl(t){return Fe(t.LABEL)&&t.LABEL!==""}const pT="parent",zo="categories",Yo="label",$o="group",Zo="push_mode",qo="pop_mode",ea="longer_alt",ta="line_breaks",na="start_chars_hint";function Ul(t){return mT(t)}function mT(t){const e=t.pattern,n={};if(n.name=t.name,vt(e)||(n.PATTERN=e),N(t,pT))throw`The parent property is no longer supported.
See: https://github.com/chevrotain/chevrotain/issues/564#issuecomment-349062346 for details.`;return N(t,zo)&&(n.CATEGORIES=t[zo]),gr([n]),N(t,Yo)&&(n.LABEL=t[Yo]),N(t,$o)&&(n.GROUP=t[$o]),N(t,qo)&&(n.POP_MODE=t[qo]),N(t,Zo)&&(n.PUSH_MODE=t[Zo]),N(t,ea)&&(n.LONGER_ALT=t[ea]),N(t,ta)&&(n.LINE_BREAKS=t[ta]),N(t,na)&&(n.START_CHARS_HINT=t[na]),n}const tn=Ul({name:"EOF",pattern:Je.NA});gr([tn]);function Js(t,e,n,r,i,s,o,a){return{image:e,startOffset:n,endOffset:r,startLine:i,endLine:s,startColumn:o,endColumn:a,tokenTypeIdx:t.tokenTypeIdx,tokenType:t}}function AT(t,e){return Ar(t,e)}const Hl={buildMismatchTokenMessage({expected:t,actual:e,previous:n,ruleName:r}){return`Expecting ${kl(t)?`--> ${qn(t)} <--`:`token of type --> ${t.name} <--`} but found --> '${e.image}' <--`},buildNotAllInputParsedMessage({firstRedundant:t,ruleName:e}){return"Redundant input, expecting EOF but found: "+t.image},buildNoViableAltMessage({expectedPathsPerAlt:t,actual:e,previous:n,customUserDescription:r,ruleName:i}){const s="Expecting: ",a=`
but found: '`+$e(e).image+"'";if(r)return s+r+a;{const l=Ge(t,(f,T)=>f.concat(T),[]),c=F(l,f=>`[${F(f,T=>qn(T)).join(", ")}]`),h=`one of these possible Token sequences:
${F(c,(f,T)=>`  ${T+1}. ${f}`).join(`
`)}`;return s+h+a}},buildEarlyExitMessage({expectedIterationPaths:t,actual:e,customUserDescription:n,ruleName:r}){const i="Expecting: ",o=`
but found: '`+$e(e).image+"'";if(n)return i+n+o;{const l=`expecting at least one iteration which starts with one of these possible Token sequences::
  <${F(t,c=>`[${F(c,u=>qn(u)).join(",")}]`).join(" ,")}>`;return i+l+o}}};Object.freeze(Hl);const gT={buildRuleNotFoundError(t,e){return"Invalid grammar, reference to a rule which is not defined: ->"+e.nonTerminalName+`<-
inside top level rule: ->`+t.name+"<-"}},Yt={buildDuplicateFoundError(t,e){function n(u){return u instanceof ae?u.terminalType.name:u instanceof ke?u.nonTerminalName:""}const r=t.name,i=$e(e),s=i.idx,o=nt(i),a=n(i),l=s>0;let c=`->${o}${l?s:""}<- ${a?`with argument: ->${a}<-`:""}
                  appears more than once (${e.length} times) in the top level rule: ->${r}<-.                  
                  For further details see: https://chevrotain.io/docs/FAQ.html#NUMERICAL_SUFFIXES 
                  `;return c=c.replace(/[ \t]+/g," "),c=c.replace(/\s\s+/g,`
`),c},buildNamespaceConflictError(t){return`Namespace conflict found in grammar.
The grammar has both a Terminal(Token) and a Non-Terminal(Rule) named: <${t.name}>.
To resolve this make sure each Terminal and Non-Terminal names are unique
This is easy to accomplish by using the convention that Terminal names start with an uppercase letter
and Non-Terminal names start with a lower case letter.`},buildAlternationPrefixAmbiguityError(t){const e=F(t.prefixPath,i=>qn(i)).join(", "),n=t.alternation.idx===0?"":t.alternation.idx;return`Ambiguous alternatives: <${t.ambiguityIndices.join(" ,")}> due to common lookahead prefix
in <OR${n}> inside <${t.topLevelRule.name}> Rule,
<${e}> may appears as a prefix path in all these alternatives.
See: https://chevrotain.io/docs/guide/resolving_grammar_errors.html#COMMON_PREFIX
For Further details.`},buildAlternationAmbiguityError(t){const e=F(t.prefixPath,i=>qn(i)).join(", "),n=t.alternation.idx===0?"":t.alternation.idx;let r=`Ambiguous Alternatives Detected: <${t.ambiguityIndices.join(" ,")}> in <OR${n}> inside <${t.topLevelRule.name}> Rule,
<${e}> may appears as a prefix path in all these alternatives.
`;return r=r+`See: https://chevrotain.io/docs/guide/resolving_grammar_errors.html#AMBIGUOUS_ALTERNATIVES
For Further details.`,r},buildEmptyRepetitionError(t){let e=nt(t.repetition);return t.repetition.idx!==0&&(e+=t.repetition.idx),`The repetition <${e}> within Rule <${t.topLevelRule.name}> can never consume any tokens.
This could lead to an infinite loop.`},buildTokenNameError(t){return"deprecated"},buildEmptyAlternationError(t){return`Ambiguous empty alternative: <${t.emptyChoiceIdx+1}> in <OR${t.alternation.idx}> inside <${t.topLevelRule.name}> Rule.
Only the last alternative may be an empty alternative.`},buildTooManyAlternativesError(t){return`An Alternation cannot have more than 256 alternatives:
<OR${t.alternation.idx}> inside <${t.topLevelRule.name}> Rule.
 has ${t.alternation.definition.length+1} alternatives.`},buildLeftRecursionError(t){const e=t.topLevelRule.name,n=F(t.leftRecursionPath,s=>s.name),r=`${e} --> ${n.concat([e]).join(" --> ")}`;return`Left Recursion found in grammar.
rule: <${e}> can be invoked from itself (directly or indirectly)
without consuming any Tokens. The grammar path that causes this is: 
 ${r}
 To fix this refactor your grammar to remove the left recursion.
see: https://en.wikipedia.org/wiki/LL_parser#Left_factoring.`},buildInvalidRuleNameError(t){return"deprecated"},buildDuplicateRuleNameError(t){let e;return t.topLevelRule instanceof In?e=t.topLevelRule.name:e=t.topLevelRule,`Duplicate definition, rule: ->${e}<- is already defined in the grammar: ->${t.grammarName}<-`}};function TT(t,e){const n=new vT(t,e);return n.resolveRefs(),n.errors}class vT extends bn{constructor(e,n){super(),this.nameToTopRule=e,this.errMsgProvider=n,this.errors=[]}resolveRefs(){L(Ae(this.nameToTopRule),e=>{this.currTopLevel=e,e.accept(this)})}visitNonTerminal(e){const n=this.nameToTopRule[e.nonTerminalName];if(n)e.referencedRule=n;else{const r=this.errMsgProvider.buildRuleNotFoundError(this.currTopLevel,e);this.errors.push({message:r,type:Ie.UNRESOLVED_SUBRULE_REF,ruleName:this.currTopLevel.name,unresolvedRefName:e.nonTerminalName})}}}class CT extends vi{constructor(e,n){super(),this.topProd=e,this.path=n,this.possibleTokTypes=[],this.nextProductionName="",this.nextProductionOccurrence=0,this.found=!1,this.isAtEndOfPath=!1}startWalking(){if(this.found=!1,this.path.ruleStack[0]!==this.topProd.name)throw Error("The path does not start with the walker's top Rule!");return this.ruleStack=ye(this.path.ruleStack).reverse(),this.occurrenceStack=ye(this.path.occurrenceStack).reverse(),this.ruleStack.pop(),this.occurrenceStack.pop(),this.updateExpectedNext(),this.walk(this.topProd),this.possibleTokTypes}walk(e,n=[]){this.found||super.walk(e,n)}walkProdRef(e,n,r){if(e.referencedRule.name===this.nextProductionName&&e.idx===this.nextProductionOccurrence){const i=n.concat(r);this.updateExpectedNext(),this.walk(e.referencedRule,i)}}updateExpectedNext(){Z(this.ruleStack)?(this.nextProductionName="",this.nextProductionOccurrence=0,this.isAtEndOfPath=!0):(this.nextProductionName=this.ruleStack.pop(),this.nextProductionOccurrence=this.occurrenceStack.pop())}}class ET extends CT{constructor(e,n){super(e,n),this.path=n,this.nextTerminalName="",this.nextTerminalOccurrence=0,this.nextTerminalName=this.path.lastTok.name,this.nextTerminalOccurrence=this.path.lastTokOccurrence}walkTerminal(e,n,r){if(this.isAtEndOfPath&&e.terminalType.name===this.nextTerminalName&&e.idx===this.nextTerminalOccurrence&&!this.found){const i=n.concat(r),s=new De({definition:i});this.possibleTokTypes=mr(s),this.found=!0}}}class Ei extends vi{constructor(e,n){super(),this.topRule=e,this.occurrence=n,this.result={token:void 0,occurrence:void 0,isEndOfRule:void 0}}startWalking(){return this.walk(this.topRule),this.result}}class RT extends Ei{walkMany(e,n,r){if(e.idx===this.occurrence){const i=$e(n.concat(r));this.result.isEndOfRule=i===void 0,i instanceof ae&&(this.result.token=i.terminalType,this.result.occurrence=i.idx)}else super.walkMany(e,n,r)}}class ra extends Ei{walkManySep(e,n,r){if(e.idx===this.occurrence){const i=$e(n.concat(r));this.result.isEndOfRule=i===void 0,i instanceof ae&&(this.result.token=i.terminalType,this.result.occurrence=i.idx)}else super.walkManySep(e,n,r)}}class BT extends Ei{walkAtLeastOne(e,n,r){if(e.idx===this.occurrence){const i=$e(n.concat(r));this.result.isEndOfRule=i===void 0,i instanceof ae&&(this.result.token=i.terminalType,this.result.occurrence=i.idx)}else super.walkAtLeastOne(e,n,r)}}class ia extends Ei{walkAtLeastOneSep(e,n,r){if(e.idx===this.occurrence){const i=$e(n.concat(r));this.result.isEndOfRule=i===void 0,i instanceof ae&&(this.result.token=i.terminalType,this.result.occurrence=i.idx)}else super.walkAtLeastOneSep(e,n,r)}}function ds(t,e,n=[]){n=ye(n);let r=[],i=0;function s(a){return a.concat(Ee(t,i+1))}function o(a){const l=ds(s(a),e,n);return r.concat(l)}for(;n.length<e&&i<t.length;){const a=t[i];if(a instanceof De)return o(a.definition);if(a instanceof ke)return o(a.definition);if(a instanceof Oe)r=o(a.definition);else if(a instanceof ht){const l=a.definition.concat([new ge({definition:a.definition})]);return o(l)}else if(a instanceof ft){const l=[new De({definition:a.definition}),new ge({definition:[new ae({terminalType:a.separator})].concat(a.definition)})];return o(l)}else if(a instanceof qe){const l=a.definition.concat([new ge({definition:[new ae({terminalType:a.separator})].concat(a.definition)})]);r=o(l)}else if(a instanceof ge){const l=a.definition.concat([new ge({definition:a.definition})]);r=o(l)}else{if(a instanceof et)return L(a.definition,l=>{Z(l.definition)===!1&&(r=o(l.definition))}),r;if(a instanceof ae)n.push(a.terminalType);else throw Error("non exhaustive match")}i++}return r.push({partialPath:n,suffixDef:Ee(t,i)}),r}function Kl(t,e,n,r){const i="EXIT_NONE_TERMINAL",s=[i],o="EXIT_ALTERNATIVE";let a=!1;const l=e.length,c=l-r-1,u=[],h=[];for(h.push({idx:-1,def:t,ruleStack:[],occurrenceStack:[]});!Z(h);){const f=h.pop();if(f===o){a&&Sn(h).idx<=c&&h.pop();continue}const T=f.def,g=f.idx,d=f.ruleStack,A=f.occurrenceStack;if(Z(T))continue;const v=T[0];if(v===i){const m={idx:g,def:Ee(T),ruleStack:sr(d),occurrenceStack:sr(A)};h.push(m)}else if(v instanceof ae)if(g<l-1){const m=g+1,p=e[m];if(n(p,v.terminalType)){const C={idx:m,def:Ee(T),ruleStack:d,occurrenceStack:A};h.push(C)}}else if(g===l-1)u.push({nextTokenType:v.terminalType,nextTokenOccurrence:v.idx,ruleStack:d,occurrenceStack:A}),a=!0;else throw Error("non exhaustive match");else if(v instanceof ke){const m=ye(d);m.push(v.nonTerminalName);const p=ye(A);p.push(v.idx);const C={idx:g,def:v.definition.concat(s,Ee(T)),ruleStack:m,occurrenceStack:p};h.push(C)}else if(v instanceof Oe){const m={idx:g,def:Ee(T),ruleStack:d,occurrenceStack:A};h.push(m),h.push(o);const p={idx:g,def:v.definition.concat(Ee(T)),ruleStack:d,occurrenceStack:A};h.push(p)}else if(v instanceof ht){const m=new ge({definition:v.definition,idx:v.idx}),p=v.definition.concat([m],Ee(T)),C={idx:g,def:p,ruleStack:d,occurrenceStack:A};h.push(C)}else if(v instanceof ft){const m=new ae({terminalType:v.separator}),p=new ge({definition:[m].concat(v.definition),idx:v.idx}),C=v.definition.concat([p],Ee(T)),R={idx:g,def:C,ruleStack:d,occurrenceStack:A};h.push(R)}else if(v instanceof qe){const m={idx:g,def:Ee(T),ruleStack:d,occurrenceStack:A};h.push(m),h.push(o);const p=new ae({terminalType:v.separator}),C=new ge({definition:[p].concat(v.definition),idx:v.idx}),R=v.definition.concat([C],Ee(T)),y={idx:g,def:R,ruleStack:d,occurrenceStack:A};h.push(y)}else if(v instanceof ge){const m={idx:g,def:Ee(T),ruleStack:d,occurrenceStack:A};h.push(m),h.push(o);const p=new ge({definition:v.definition,idx:v.idx}),C=v.definition.concat([p],Ee(T)),R={idx:g,def:C,ruleStack:d,occurrenceStack:A};h.push(R)}else if(v instanceof et)for(let m=v.definition.length-1;m>=0;m--){const p=v.definition[m],C={idx:g,def:p.definition.concat(Ee(T)),ruleStack:d,occurrenceStack:A};h.push(C),h.push(o)}else if(v instanceof De)h.push({idx:g,def:v.definition.concat(Ee(T)),ruleStack:d,occurrenceStack:A});else if(v instanceof In)h.push(yT(v,g,d,A));else throw Error("non exhaustive match")}return u}function yT(t,e,n,r){const i=ye(n);i.push(t.name);const s=ye(r);return s.push(1),{idx:e,def:t.definition,ruleStack:i,occurrenceStack:s}}var le;(function(t){t[t.OPTION=0]="OPTION",t[t.REPETITION=1]="REPETITION",t[t.REPETITION_MANDATORY=2]="REPETITION_MANDATORY",t[t.REPETITION_MANDATORY_WITH_SEPARATOR=3]="REPETITION_MANDATORY_WITH_SEPARATOR",t[t.REPETITION_WITH_SEPARATOR=4]="REPETITION_WITH_SEPARATOR",t[t.ALTERNATION=5]="ALTERNATION"})(le||(le={}));function Jl(t){if(t instanceof Oe||t==="Option")return le.OPTION;if(t instanceof ge||t==="Repetition")return le.REPETITION;if(t instanceof ht||t==="RepetitionMandatory")return le.REPETITION_MANDATORY;if(t instanceof ft||t==="RepetitionMandatoryWithSeparator")return le.REPETITION_MANDATORY_WITH_SEPARATOR;if(t instanceof qe||t==="RepetitionWithSeparator")return le.REPETITION_WITH_SEPARATOR;if(t instanceof et||t==="Alternation")return le.ALTERNATION;throw Error("non exhaustive match")}function ST(t,e,n,r,i,s){const o=js(t,e,n),a=Vl(o)?$r:Ar;return s(o,r,a,i)}function xT(t,e,n,r,i,s){const o=Ws(t,e,i,n),a=Vl(o)?$r:Ar;return s(o[0],a,r)}function MT(t,e,n,r){const i=t.length,s=ze(t,o=>ze(o,a=>a.length===1));if(e)return function(o){const a=F(o,l=>l.GATE);for(let l=0;l<i;l++){const c=t[l],u=c.length,h=a[l];if(!(h!==void 0&&h.call(this)===!1))e:for(let f=0;f<u;f++){const T=c[f],g=T.length;for(let d=0;d<g;d++){const A=this.LA(d+1);if(n(A,T[d])===!1)continue e}return l}}};if(s&&!r){const o=F(t,l=>Qe(l)),a=Ge(o,(l,c,u)=>(L(c,h=>{N(l,h.tokenTypeIdx)||(l[h.tokenTypeIdx]=u),L(h.categoryMatches,f=>{N(l,f)||(l[f]=u)})}),l),{});return function(){const l=this.LA(1);return a[l.tokenTypeIdx]}}else return function(){for(let o=0;o<i;o++){const a=t[o],l=a.length;e:for(let c=0;c<l;c++){const u=a[c],h=u.length;for(let f=0;f<h;f++){const T=this.LA(f+1);if(n(T,u[f])===!1)continue e}return o}}}}function IT(t,e,n){const r=ze(t,s=>s.length===1),i=t.length;if(r&&!n){const s=Qe(t);if(s.length===1&&Z(s[0].categoryMatches)){const a=s[0].tokenTypeIdx;return function(){return this.LA(1).tokenTypeIdx===a}}else{const o=Ge(s,(a,l,c)=>(a[l.tokenTypeIdx]=!0,L(l.categoryMatches,u=>{a[u]=!0}),a),[]);return function(){const a=this.LA(1);return o[a.tokenTypeIdx]===!0}}}else return function(){e:for(let s=0;s<i;s++){const o=t[s],a=o.length;for(let l=0;l<a;l++){const c=this.LA(l+1);if(e(c,o[l])===!1)continue e}return!0}return!1}}class bT extends vi{constructor(e,n,r){super(),this.topProd=e,this.targetOccurrence=n,this.targetProdType=r}startWalking(){return this.walk(this.topProd),this.restDef}checkIsTarget(e,n,r,i){return e.idx===this.targetOccurrence&&this.targetProdType===n?(this.restDef=r.concat(i),!0):!1}walkOption(e,n,r){this.checkIsTarget(e,le.OPTION,n,r)||super.walkOption(e,n,r)}walkAtLeastOne(e,n,r){this.checkIsTarget(e,le.REPETITION_MANDATORY,n,r)||super.walkOption(e,n,r)}walkAtLeastOneSep(e,n,r){this.checkIsTarget(e,le.REPETITION_MANDATORY_WITH_SEPARATOR,n,r)||super.walkOption(e,n,r)}walkMany(e,n,r){this.checkIsTarget(e,le.REPETITION,n,r)||super.walkOption(e,n,r)}walkManySep(e,n,r){this.checkIsTarget(e,le.REPETITION_WITH_SEPARATOR,n,r)||super.walkOption(e,n,r)}}class jl extends bn{constructor(e,n,r){super(),this.targetOccurrence=e,this.targetProdType=n,this.targetRef=r,this.result=[]}checkIsTarget(e,n){e.idx===this.targetOccurrence&&this.targetProdType===n&&(this.targetRef===void 0||e===this.targetRef)&&(this.result=e.definition)}visitOption(e){this.checkIsTarget(e,le.OPTION)}visitRepetition(e){this.checkIsTarget(e,le.REPETITION)}visitRepetitionMandatory(e){this.checkIsTarget(e,le.REPETITION_MANDATORY)}visitRepetitionMandatoryWithSeparator(e){this.checkIsTarget(e,le.REPETITION_MANDATORY_WITH_SEPARATOR)}visitRepetitionWithSeparator(e){this.checkIsTarget(e,le.REPETITION_WITH_SEPARATOR)}visitAlternation(e){this.checkIsTarget(e,le.ALTERNATION)}}function sa(t){const e=new Array(t);for(let n=0;n<t;n++)e[n]=[];return e}function Hi(t){let e=[""];for(let n=0;n<t.length;n++){const r=t[n],i=[];for(let s=0;s<e.length;s++){const o=e[s];i.push(o+"_"+r.tokenTypeIdx);for(let a=0;a<r.categoryMatches.length;a++){const l="_"+r.categoryMatches[a];i.push(o+l)}}e=i}return e}function PT(t,e,n){for(let r=0;r<t.length;r++){if(r===n)continue;const i=t[r];for(let s=0;s<e.length;s++){const o=e[s];if(i[o]===!0)return!1}}return!0}function Wl(t,e){const n=F(t,o=>ds([o],1)),r=sa(n.length),i=F(n,o=>{const a={};return L(o,l=>{const c=Hi(l.partialPath);L(c,u=>{a[u]=!0})}),a});let s=n;for(let o=1;o<=e;o++){const a=s;s=sa(a.length);for(let l=0;l<a.length;l++){const c=a[l];for(let u=0;u<c.length;u++){const h=c[u].partialPath,f=c[u].suffixDef,T=Hi(h);if(PT(i,T,l)||Z(f)||h.length===e){const d=r[l];if(ps(d,h)===!1){d.push(h);for(let A=0;A<T.length;A++){const v=T[A];i[l][v]=!0}}}else{const d=ds(f,o+1,h);s[l]=s[l].concat(d),L(d,A=>{const v=Hi(A.partialPath);L(v,m=>{i[l][m]=!0})})}}}}return r}function js(t,e,n,r){const i=new jl(t,le.ALTERNATION,r);return e.accept(i),Wl(i.result,n)}function Ws(t,e,n,r){const i=new jl(t,n);e.accept(i);const s=i.result,a=new bT(e,t,n).startWalking(),l=new De({definition:s}),c=new De({definition:a});return Wl([l,c],r)}function ps(t,e){e:for(let n=0;n<t.length;n++){const r=t[n];if(r.length===e.length){for(let i=0;i<r.length;i++){const s=e[i],o=r[i];if((s===o||o.categoryMatchesMap[s.tokenTypeIdx]!==void 0)===!1)continue e}return!0}}return!1}function _T(t,e){return t.length<e.length&&ze(t,(n,r)=>{const i=e[r];return n===i||i.categoryMatchesMap[n.tokenTypeIdx]})}function Vl(t){return ze(t,e=>ze(e,n=>ze(n,r=>Z(r.categoryMatches))))}function wT(t){const e=t.lookaheadStrategy.validate({rules:t.rules,tokenTypes:t.tokenTypes,grammarName:t.grammarName});return F(e,n=>Object.assign({type:Ie.CUSTOM_LOOKAHEAD_VALIDATION},n))}function OT(t,e,n,r){const i=Ke(t,l=>FT(l,n)),s=VT(t,e,n),o=Ke(t,l=>KT(l,n)),a=Ke(t,l=>LT(l,t,r,n));return i.concat(s,o,a)}function FT(t,e){const n=new NT;t.accept(n);const r=n.allProductions,i=jA(r,DT),s=Ze(i,a=>a.length>1);return F(Ae(s),a=>{const l=$e(a),c=e.buildDuplicateFoundError(t,a),u=nt(l),h={message:c,type:Ie.DUPLICATE_PRODUCTIONS,ruleName:t.name,dslName:u,occurrence:l.idx},f=Xl(l);return f&&(h.parameter=f),h})}function DT(t){return`${nt(t)}_#_${t.idx}_#_${Xl(t)}`}function Xl(t){return t instanceof ae?t.terminalType.name:t instanceof ke?t.nonTerminalName:""}class NT extends bn{constructor(){super(...arguments),this.allProductions=[]}visitNonTerminal(e){this.allProductions.push(e)}visitOption(e){this.allProductions.push(e)}visitRepetitionWithSeparator(e){this.allProductions.push(e)}visitRepetitionMandatory(e){this.allProductions.push(e)}visitRepetitionMandatoryWithSeparator(e){this.allProductions.push(e)}visitRepetition(e){this.allProductions.push(e)}visitAlternation(e){this.allProductions.push(e)}visitTerminal(e){this.allProductions.push(e)}}function LT(t,e,n,r){const i=[];if(Ge(e,(o,a)=>a.name===t.name?o+1:o,0)>1){const o=r.buildDuplicateRuleNameError({topLevelRule:t,grammarName:n});i.push({message:o,type:Ie.DUPLICATE_RULE_NAME,ruleName:t.name})}return i}function GT(t,e,n){const r=[];let i;return be(e,t)||(i=`Invalid rule override, rule: ->${t}<- cannot be overridden in the grammar: ->${n}<-as it is not defined in any of the super grammars `,r.push({message:i,type:Ie.INVALID_RULE_OVERRIDE,ruleName:t})),r}function Ql(t,e,n,r=[]){const i=[],s=kr(e.definition);if(Z(s))return[];{const o=t.name;be(s,t)&&i.push({message:n.buildLeftRecursionError({topLevelRule:t,leftRecursionPath:r}),type:Ie.LEFT_RECURSION,ruleName:o});const l=gi(s,r.concat([t])),c=Ke(l,u=>{const h=ye(r);return h.push(u),Ql(t,u,n,h)});return i.concat(c)}}function kr(t){let e=[];if(Z(t))return e;const n=$e(t);if(n instanceof ke)e.push(n.referencedRule);else if(n instanceof De||n instanceof Oe||n instanceof ht||n instanceof ft||n instanceof qe||n instanceof ge)e=e.concat(kr(n.definition));else if(n instanceof et)e=Qe(F(n.definition,s=>kr(s.definition)));else if(!(n instanceof ae))throw Error("non exhaustive match");const r=Xr(n),i=t.length>1;if(r&&i){const s=Ee(t);return e.concat(kr(s))}else return e}class Vs extends bn{constructor(){super(...arguments),this.alternations=[]}visitAlternation(e){this.alternations.push(e)}}function kT(t,e){const n=new Vs;t.accept(n);const r=n.alternations;return Ke(r,s=>{const o=sr(s.definition);return Ke(o,(a,l)=>{const c=Kl([a],[],Ar,1);return Z(c)?[{message:e.buildEmptyAlternationError({topLevelRule:t,alternation:s,emptyChoiceIdx:l}),type:Ie.NONE_LAST_EMPTY_ALT,ruleName:t.name,occurrence:s.idx,alternative:l+1}]:[]})})}function UT(t,e,n){const r=new Vs;t.accept(r);let i=r.alternations;return i=Ti(i,o=>o.ignoreAmbiguities===!0),Ke(i,o=>{const a=o.idx,l=o.maxLookahead||e,c=js(a,t,l,o),u=jT(c,o,t,n),h=WT(c,o,t,n);return u.concat(h)})}class HT extends bn{constructor(){super(...arguments),this.allProductions=[]}visitRepetitionWithSeparator(e){this.allProductions.push(e)}visitRepetitionMandatory(e){this.allProductions.push(e)}visitRepetitionMandatoryWithSeparator(e){this.allProductions.push(e)}visitRepetition(e){this.allProductions.push(e)}}function KT(t,e){const n=new Vs;t.accept(n);const r=n.alternations;return Ke(r,s=>s.definition.length>255?[{message:e.buildTooManyAlternativesError({topLevelRule:t,alternation:s}),type:Ie.TOO_MANY_ALTS,ruleName:t.name,occurrence:s.idx}]:[])}function JT(t,e,n){const r=[];return L(t,i=>{const s=new HT;i.accept(s);const o=s.allProductions;L(o,a=>{const l=Jl(a),c=a.maxLookahead||e,u=a.idx,f=Ws(u,i,l,c)[0];if(Z(Qe(f))){const T=n.buildEmptyRepetitionError({topLevelRule:i,repetition:a});r.push({message:T,type:Ie.NO_NON_EMPTY_LOOKAHEAD,ruleName:i.name})}})}),r}function jT(t,e,n,r){const i=[],s=Ge(t,(a,l,c)=>(e.definition[c].ignoreAmbiguities===!0||L(l,u=>{const h=[c];L(t,(f,T)=>{c!==T&&ps(f,u)&&e.definition[T].ignoreAmbiguities!==!0&&h.push(T)}),h.length>1&&!ps(i,u)&&(i.push(u),a.push({alts:h,path:u}))}),a),[]);return F(s,a=>{const l=F(a.alts,u=>u+1);return{message:r.buildAlternationAmbiguityError({topLevelRule:n,alternation:e,ambiguityIndices:l,prefixPath:a.path}),type:Ie.AMBIGUOUS_ALTS,ruleName:n.name,occurrence:e.idx,alternatives:a.alts}})}function WT(t,e,n,r){const i=Ge(t,(o,a,l)=>{const c=F(a,u=>({idx:l,path:u}));return o.concat(c)},[]);return pr(Ke(i,o=>{if(e.definition[o.idx].ignoreAmbiguities===!0)return[];const l=o.idx,c=o.path,u=Ve(i,f=>e.definition[f.idx].ignoreAmbiguities!==!0&&f.idx<l&&_T(f.path,c));return F(u,f=>{const T=[f.idx+1,l+1],g=e.idx===0?"":e.idx;return{message:r.buildAlternationPrefixAmbiguityError({topLevelRule:n,alternation:e,ambiguityIndices:T,prefixPath:f.path}),type:Ie.AMBIGUOUS_PREFIX_ALTS,ruleName:n.name,occurrence:g,alternatives:T}})}))}function VT(t,e,n){const r=[],i=F(e,s=>s.name);return L(t,s=>{const o=s.name;if(be(i,o)){const a=n.buildNamespaceConflictError(s);r.push({message:a,type:Ie.CONFLICT_TOKENS_RULES_NAMESPACE,ruleName:o})}}),r}function XT(t){const e=ks(t,{errMsgProvider:gT}),n={};return L(t.rules,r=>{n[r.name]=r}),TT(n,e.errMsgProvider)}function QT(t){return t=ks(t,{errMsgProvider:Yt}),OT(t.rules,t.tokenTypes,t.errMsgProvider,t.grammarName)}const zl="MismatchedTokenException",Yl="NoViableAltException",$l="EarlyExitException",Zl="NotAllInputParsedException",ql=[zl,Yl,$l,Zl];Object.freeze(ql);function Zr(t){return be(ql,t.name)}class Ri extends Error{constructor(e,n){super(e),this.token=n,this.resyncedTokens=[],Object.setPrototypeOf(this,new.target.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor)}}class ec extends Ri{constructor(e,n,r){super(e,n),this.previousToken=r,this.name=zl}}class zT extends Ri{constructor(e,n,r){super(e,n),this.previousToken=r,this.name=Yl}}class YT extends Ri{constructor(e,n){super(e,n),this.name=Zl}}class $T extends Ri{constructor(e,n,r){super(e,n),this.previousToken=r,this.name=$l}}const Ki={},tc="InRuleRecoveryException";class ZT extends Error{constructor(e){super(e),this.name=tc}}class qT{initRecoverable(e){this.firstAfterRepMap={},this.resyncFollows={},this.recoveryEnabled=N(e,"recoveryEnabled")?e.recoveryEnabled:Ot.recoveryEnabled,this.recoveryEnabled&&(this.attemptInRepetitionRecovery=ev)}getTokenToInsert(e){const n=Js(e,"",NaN,NaN,NaN,NaN,NaN,NaN);return n.isInsertedInRecovery=!0,n}canTokenTypeBeInsertedInRecovery(e){return!0}canTokenTypeBeDeletedInRecovery(e){return!0}tryInRepetitionRecovery(e,n,r,i){const s=this.findReSyncTokenType(),o=this.exportLexerState(),a=[];let l=!1;const c=this.LA(1);let u=this.LA(1);const h=()=>{const f=this.LA(0),T=this.errorMessageProvider.buildMismatchTokenMessage({expected:i,actual:c,previous:f,ruleName:this.getCurrRuleFullName()}),g=new ec(T,c,this.LA(0));g.resyncedTokens=sr(a),this.SAVE_ERROR(g)};for(;!l;)if(this.tokenMatcher(u,i)){h();return}else if(r.call(this)){h(),e.apply(this,n);return}else this.tokenMatcher(u,s)?l=!0:(u=this.SKIP_TOKEN(),this.addToResyncTokens(u,a));this.importLexerState(o)}shouldInRepetitionRecoveryBeTried(e,n,r){return!(r===!1||this.tokenMatcher(this.LA(1),e)||this.isBackTracking()||this.canPerformInRuleRecovery(e,this.getFollowsForInRuleRecovery(e,n)))}getFollowsForInRuleRecovery(e,n){const r=this.getCurrentGrammarPath(e,n);return this.getNextPossibleTokenTypes(r)}tryInRuleRecovery(e,n){if(this.canRecoverWithSingleTokenInsertion(e,n))return this.getTokenToInsert(e);if(this.canRecoverWithSingleTokenDeletion(e)){const r=this.SKIP_TOKEN();return this.consumeToken(),r}throw new ZT("sad sad panda")}canPerformInRuleRecovery(e,n){return this.canRecoverWithSingleTokenInsertion(e,n)||this.canRecoverWithSingleTokenDeletion(e)}canRecoverWithSingleTokenInsertion(e,n){if(!this.canTokenTypeBeInsertedInRecovery(e)||Z(n))return!1;const r=this.LA(1);return xn(n,s=>this.tokenMatcher(r,s))!==void 0}canRecoverWithSingleTokenDeletion(e){return this.canTokenTypeBeDeletedInRecovery(e)?this.tokenMatcher(this.LA(2),e):!1}isInCurrentRuleReSyncSet(e){const n=this.getCurrFollowKey(),r=this.getFollowSetFromFollowKey(n);return be(r,e)}findReSyncTokenType(){const e=this.flattenFollowSet();let n=this.LA(1),r=2;for(;;){const i=xn(e,s=>AT(n,s));if(i!==void 0)return i;n=this.LA(r),r++}}getCurrFollowKey(){if(this.RULE_STACK.length===1)return Ki;const e=this.getLastExplicitRuleShortName(),n=this.getLastExplicitRuleOccurrenceIndex(),r=this.getPreviousExplicitRuleShortName();return{ruleName:this.shortRuleNameToFullName(e),idxInCallingRule:n,inRule:this.shortRuleNameToFullName(r)}}buildFullFollowKeyStack(){const e=this.RULE_STACK,n=this.RULE_OCCURRENCE_STACK;return F(e,(r,i)=>i===0?Ki:{ruleName:this.shortRuleNameToFullName(r),idxInCallingRule:n[i],inRule:this.shortRuleNameToFullName(e[i-1])})}flattenFollowSet(){const e=F(this.buildFullFollowKeyStack(),n=>this.getFollowSetFromFollowKey(n));return Qe(e)}getFollowSetFromFollowKey(e){if(e===Ki)return[tn];const n=e.ruleName+e.idxInCallingRule+Pl+e.inRule;return this.resyncFollows[n]}addToResyncTokens(e,n){return this.tokenMatcher(e,tn)||n.push(e),n}reSyncTo(e){const n=[];let r=this.LA(1);for(;this.tokenMatcher(r,e)===!1;)r=this.SKIP_TOKEN(),this.addToResyncTokens(r,n);return sr(n)}attemptInRepetitionRecovery(e,n,r,i,s,o,a){}getCurrentGrammarPath(e,n){const r=this.getHumanReadableRuleStack(),i=ye(this.RULE_OCCURRENCE_STACK);return{ruleStack:r,occurrenceStack:i,lastTok:e,lastTokOccurrence:n}}getHumanReadableRuleStack(){return F(this.RULE_STACK,e=>this.shortRuleNameToFullName(e))}}function ev(t,e,n,r,i,s,o){const a=this.getKeyForAutomaticLookahead(r,i);let l=this.firstAfterRepMap[a];if(l===void 0){const f=this.getCurrRuleFullName(),T=this.getGAstProductions()[f];l=new s(T,i).startWalking(),this.firstAfterRepMap[a]=l}let c=l.token,u=l.occurrence;const h=l.isEndOfRule;this.RULE_STACK.length===1&&h&&c===void 0&&(c=tn,u=1),!(c===void 0||u===void 0)&&this.shouldInRepetitionRecoveryBeTried(c,u,o)&&this.tryInRepetitionRecovery(t,e,n,c)}const tv=4,Lt=8,nc=1<<Lt,rc=2<<Lt,ms=3<<Lt,As=4<<Lt,gs=5<<Lt,Ur=6<<Lt;function Ji(t,e,n){return n|e|t}class nv{constructor(e){var n;this.maxLookahead=(n=e==null?void 0:e.maxLookahead)!==null&&n!==void 0?n:Ot.maxLookahead}validate(e){const n=this.validateNoLeftRecursion(e.rules);if(Z(n)){const r=this.validateEmptyOrAlternatives(e.rules),i=this.validateAmbiguousAlternationAlternatives(e.rules,this.maxLookahead),s=this.validateSomeNonEmptyLookaheadPath(e.rules,this.maxLookahead);return[...n,...r,...i,...s]}return n}validateNoLeftRecursion(e){return Ke(e,n=>Ql(n,n,Yt))}validateEmptyOrAlternatives(e){return Ke(e,n=>kT(n,Yt))}validateAmbiguousAlternationAlternatives(e,n){return Ke(e,r=>UT(r,n,Yt))}validateSomeNonEmptyLookaheadPath(e,n){return JT(e,n,Yt)}buildLookaheadForAlternation(e){return ST(e.prodOccurrence,e.rule,e.maxLookahead,e.hasPredicates,e.dynamicTokensEnabled,MT)}buildLookaheadForOptional(e){return xT(e.prodOccurrence,e.rule,e.maxLookahead,e.dynamicTokensEnabled,Jl(e.prodType),IT)}}class rv{initLooksAhead(e){this.dynamicTokensEnabled=N(e,"dynamicTokensEnabled")?e.dynamicTokensEnabled:Ot.dynamicTokensEnabled,this.maxLookahead=N(e,"maxLookahead")?e.maxLookahead:Ot.maxLookahead,this.lookaheadStrategy=N(e,"lookaheadStrategy")?e.lookaheadStrategy:new nv({maxLookahead:this.maxLookahead}),this.lookAheadFuncsCache=new Map}preComputeLookaheadFunctions(e){L(e,n=>{this.TRACE_INIT(`${n.name} Rule Lookahead`,()=>{const{alternation:r,repetition:i,option:s,repetitionMandatory:o,repetitionMandatoryWithSeparator:a,repetitionWithSeparator:l}=sv(n);L(r,c=>{const u=c.idx===0?"":c.idx;this.TRACE_INIT(`${nt(c)}${u}`,()=>{const h=this.lookaheadStrategy.buildLookaheadForAlternation({prodOccurrence:c.idx,rule:n,maxLookahead:c.maxLookahead||this.maxLookahead,hasPredicates:c.hasPredicates,dynamicTokensEnabled:this.dynamicTokensEnabled}),f=Ji(this.fullRuleNameToShort[n.name],nc,c.idx);this.setLaFuncCache(f,h)})}),L(i,c=>{this.computeLookaheadFunc(n,c.idx,ms,"Repetition",c.maxLookahead,nt(c))}),L(s,c=>{this.computeLookaheadFunc(n,c.idx,rc,"Option",c.maxLookahead,nt(c))}),L(o,c=>{this.computeLookaheadFunc(n,c.idx,As,"RepetitionMandatory",c.maxLookahead,nt(c))}),L(a,c=>{this.computeLookaheadFunc(n,c.idx,Ur,"RepetitionMandatoryWithSeparator",c.maxLookahead,nt(c))}),L(l,c=>{this.computeLookaheadFunc(n,c.idx,gs,"RepetitionWithSeparator",c.maxLookahead,nt(c))})})})}computeLookaheadFunc(e,n,r,i,s,o){this.TRACE_INIT(`${o}${n===0?"":n}`,()=>{const a=this.lookaheadStrategy.buildLookaheadForOptional({prodOccurrence:n,rule:e,maxLookahead:s||this.maxLookahead,dynamicTokensEnabled:this.dynamicTokensEnabled,prodType:i}),l=Ji(this.fullRuleNameToShort[e.name],r,n);this.setLaFuncCache(l,a)})}getKeyForAutomaticLookahead(e,n){const r=this.getLastExplicitRuleShortName();return Ji(r,e,n)}getLaFuncFromCache(e){return this.lookAheadFuncsCache.get(e)}setLaFuncCache(e,n){this.lookAheadFuncsCache.set(e,n)}}class iv extends bn{constructor(){super(...arguments),this.dslMethods={option:[],alternation:[],repetition:[],repetitionWithSeparator:[],repetitionMandatory:[],repetitionMandatoryWithSeparator:[]}}reset(){this.dslMethods={option:[],alternation:[],repetition:[],repetitionWithSeparator:[],repetitionMandatory:[],repetitionMandatoryWithSeparator:[]}}visitOption(e){this.dslMethods.option.push(e)}visitRepetitionWithSeparator(e){this.dslMethods.repetitionWithSeparator.push(e)}visitRepetitionMandatory(e){this.dslMethods.repetitionMandatory.push(e)}visitRepetitionMandatoryWithSeparator(e){this.dslMethods.repetitionMandatoryWithSeparator.push(e)}visitRepetition(e){this.dslMethods.repetition.push(e)}visitAlternation(e){this.dslMethods.alternation.push(e)}}const wr=new iv;function sv(t){wr.reset(),t.accept(wr);const e=wr.dslMethods;return wr.reset(),e}function oa(t,e){isNaN(t.startOffset)===!0?(t.startOffset=e.startOffset,t.endOffset=e.endOffset):t.endOffset<e.endOffset&&(t.endOffset=e.endOffset)}function aa(t,e){isNaN(t.startOffset)===!0?(t.startOffset=e.startOffset,t.startColumn=e.startColumn,t.startLine=e.startLine,t.endOffset=e.endOffset,t.endColumn=e.endColumn,t.endLine=e.endLine):t.endOffset<e.endOffset&&(t.endOffset=e.endOffset,t.endColumn=e.endColumn,t.endLine=e.endLine)}function ov(t,e,n){t.children[n]===void 0?t.children[n]=[e]:t.children[n].push(e)}function av(t,e,n){t.children[e]===void 0?t.children[e]=[n]:t.children[e].push(n)}const lv="name";function ic(t,e){Object.defineProperty(t,lv,{enumerable:!1,configurable:!0,writable:!1,value:e})}function cv(t,e){const n=Ne(t),r=n.length;for(let i=0;i<r;i++){const s=n[i],o=t[s],a=o.length;for(let l=0;l<a;l++){const c=o[l];c.tokenTypeIdx===void 0&&this[c.name](c.children,e)}}}function uv(t,e){const n=function(){};ic(n,t+"BaseSemantics");const r={visit:function(i,s){if(W(i)&&(i=i[0]),!vt(i))return this[i.name](i.children,s)},validateVisitor:function(){const i=fv(this,e);if(!Z(i)){const s=F(i,o=>o.msg);throw Error(`Errors Detected in CST Visitor <${this.constructor.name}>:
	${s.join(`

`).replace(/\n/g,`
	`)}`)}}};return n.prototype=r,n.prototype.constructor=n,n._RULE_NAMES=e,n}function hv(t,e,n){const r=function(){};ic(r,t+"BaseSemanticsWithDefaults");const i=Object.create(n.prototype);return L(e,s=>{i[s]=cv}),r.prototype=i,r.prototype.constructor=r,r}var Ts;(function(t){t[t.REDUNDANT_METHOD=0]="REDUNDANT_METHOD",t[t.MISSING_METHOD=1]="MISSING_METHOD"})(Ts||(Ts={}));function fv(t,e){return dv(t,e)}function dv(t,e){const n=Ve(e,i=>Ct(t[i])===!1),r=F(n,i=>({msg:`Missing visitor method: <${i}> on ${t.constructor.name} CST Visitor.`,type:Ts.MISSING_METHOD,methodName:i}));return pr(r)}class pv{initTreeBuilder(e){if(this.CST_STACK=[],this.outputCst=e.outputCst,this.nodeLocationTracking=N(e,"nodeLocationTracking")?e.nodeLocationTracking:Ot.nodeLocationTracking,!this.outputCst)this.cstInvocationStateUpdate=me,this.cstFinallyStateUpdate=me,this.cstPostTerminal=me,this.cstPostNonTerminal=me,this.cstPostRule=me;else if(/full/i.test(this.nodeLocationTracking))this.recoveryEnabled?(this.setNodeLocationFromToken=aa,this.setNodeLocationFromNode=aa,this.cstPostRule=me,this.setInitialNodeLocation=this.setInitialNodeLocationFullRecovery):(this.setNodeLocationFromToken=me,this.setNodeLocationFromNode=me,this.cstPostRule=this.cstPostRuleFull,this.setInitialNodeLocation=this.setInitialNodeLocationFullRegular);else if(/onlyOffset/i.test(this.nodeLocationTracking))this.recoveryEnabled?(this.setNodeLocationFromToken=oa,this.setNodeLocationFromNode=oa,this.cstPostRule=me,this.setInitialNodeLocation=this.setInitialNodeLocationOnlyOffsetRecovery):(this.setNodeLocationFromToken=me,this.setNodeLocationFromNode=me,this.cstPostRule=this.cstPostRuleOnlyOffset,this.setInitialNodeLocation=this.setInitialNodeLocationOnlyOffsetRegular);else if(/none/i.test(this.nodeLocationTracking))this.setNodeLocationFromToken=me,this.setNodeLocationFromNode=me,this.cstPostRule=me,this.setInitialNodeLocation=me;else throw Error(`Invalid <nodeLocationTracking> config option: "${e.nodeLocationTracking}"`)}setInitialNodeLocationOnlyOffsetRecovery(e){e.location={startOffset:NaN,endOffset:NaN}}setInitialNodeLocationOnlyOffsetRegular(e){e.location={startOffset:this.LA(1).startOffset,endOffset:NaN}}setInitialNodeLocationFullRecovery(e){e.location={startOffset:NaN,startLine:NaN,startColumn:NaN,endOffset:NaN,endLine:NaN,endColumn:NaN}}setInitialNodeLocationFullRegular(e){const n=this.LA(1);e.location={startOffset:n.startOffset,startLine:n.startLine,startColumn:n.startColumn,endOffset:NaN,endLine:NaN,endColumn:NaN}}cstInvocationStateUpdate(e){const n={name:e,children:Object.create(null)};this.setInitialNodeLocation(n),this.CST_STACK.push(n)}cstFinallyStateUpdate(){this.CST_STACK.pop()}cstPostRuleFull(e){const n=this.LA(0),r=e.location;r.startOffset<=n.startOffset?(r.endOffset=n.endOffset,r.endLine=n.endLine,r.endColumn=n.endColumn):(r.startOffset=NaN,r.startLine=NaN,r.startColumn=NaN)}cstPostRuleOnlyOffset(e){const n=this.LA(0),r=e.location;r.startOffset<=n.startOffset?r.endOffset=n.endOffset:r.startOffset=NaN}cstPostTerminal(e,n){const r=this.CST_STACK[this.CST_STACK.length-1];ov(r,n,e),this.setNodeLocationFromToken(r.location,n)}cstPostNonTerminal(e,n){const r=this.CST_STACK[this.CST_STACK.length-1];av(r,n,e),this.setNodeLocationFromNode(r.location,e.location)}getBaseCstVisitorConstructor(){if(vt(this.baseCstVisitorConstructor)){const e=uv(this.className,Ne(this.gastProductionsCache));return this.baseCstVisitorConstructor=e,e}return this.baseCstVisitorConstructor}getBaseCstVisitorConstructorWithDefaults(){if(vt(this.baseCstVisitorWithDefaultsConstructor)){const e=hv(this.className,Ne(this.gastProductionsCache),this.getBaseCstVisitorConstructor());return this.baseCstVisitorWithDefaultsConstructor=e,e}return this.baseCstVisitorWithDefaultsConstructor}getLastExplicitRuleShortName(){const e=this.RULE_STACK;return e[e.length-1]}getPreviousExplicitRuleShortName(){const e=this.RULE_STACK;return e[e.length-2]}getLastExplicitRuleOccurrenceIndex(){const e=this.RULE_OCCURRENCE_STACK;return e[e.length-1]}}class mv{initLexerAdapter(){this.tokVector=[],this.tokVectorLength=0,this.currIdx=-1}set input(e){if(this.selfAnalysisDone!==!0)throw Error("Missing <performSelfAnalysis> invocation at the end of the Parser's constructor.");this.reset(),this.tokVector=e,this.tokVectorLength=e.length}get input(){return this.tokVector}SKIP_TOKEN(){return this.currIdx<=this.tokVector.length-2?(this.consumeToken(),this.LA(1)):ei}LA(e){const n=this.currIdx+e;return n<0||this.tokVectorLength<=n?ei:this.tokVector[n]}consumeToken(){this.currIdx++}exportLexerState(){return this.currIdx}importLexerState(e){this.currIdx=e}resetLexerState(){this.currIdx=-1}moveToTerminatedState(){this.currIdx=this.tokVector.length-1}getLexerPosition(){return this.exportLexerState()}}class Av{ACTION(e){return e.call(this)}consume(e,n,r){return this.consumeInternal(n,e,r)}subrule(e,n,r){return this.subruleInternal(n,e,r)}option(e,n){return this.optionInternal(n,e)}or(e,n){return this.orInternal(n,e)}many(e,n){return this.manyInternal(e,n)}atLeastOne(e,n){return this.atLeastOneInternal(e,n)}CONSUME(e,n){return this.consumeInternal(e,0,n)}CONSUME1(e,n){return this.consumeInternal(e,1,n)}CONSUME2(e,n){return this.consumeInternal(e,2,n)}CONSUME3(e,n){return this.consumeInternal(e,3,n)}CONSUME4(e,n){return this.consumeInternal(e,4,n)}CONSUME5(e,n){return this.consumeInternal(e,5,n)}CONSUME6(e,n){return this.consumeInternal(e,6,n)}CONSUME7(e,n){return this.consumeInternal(e,7,n)}CONSUME8(e,n){return this.consumeInternal(e,8,n)}CONSUME9(e,n){return this.consumeInternal(e,9,n)}SUBRULE(e,n){return this.subruleInternal(e,0,n)}SUBRULE1(e,n){return this.subruleInternal(e,1,n)}SUBRULE2(e,n){return this.subruleInternal(e,2,n)}SUBRULE3(e,n){return this.subruleInternal(e,3,n)}SUBRULE4(e,n){return this.subruleInternal(e,4,n)}SUBRULE5(e,n){return this.subruleInternal(e,5,n)}SUBRULE6(e,n){return this.subruleInternal(e,6,n)}SUBRULE7(e,n){return this.subruleInternal(e,7,n)}SUBRULE8(e,n){return this.subruleInternal(e,8,n)}SUBRULE9(e,n){return this.subruleInternal(e,9,n)}OPTION(e){return this.optionInternal(e,0)}OPTION1(e){return this.optionInternal(e,1)}OPTION2(e){return this.optionInternal(e,2)}OPTION3(e){return this.optionInternal(e,3)}OPTION4(e){return this.optionInternal(e,4)}OPTION5(e){return this.optionInternal(e,5)}OPTION6(e){return this.optionInternal(e,6)}OPTION7(e){return this.optionInternal(e,7)}OPTION8(e){return this.optionInternal(e,8)}OPTION9(e){return this.optionInternal(e,9)}OR(e){return this.orInternal(e,0)}OR1(e){return this.orInternal(e,1)}OR2(e){return this.orInternal(e,2)}OR3(e){return this.orInternal(e,3)}OR4(e){return this.orInternal(e,4)}OR5(e){return this.orInternal(e,5)}OR6(e){return this.orInternal(e,6)}OR7(e){return this.orInternal(e,7)}OR8(e){return this.orInternal(e,8)}OR9(e){return this.orInternal(e,9)}MANY(e){this.manyInternal(0,e)}MANY1(e){this.manyInternal(1,e)}MANY2(e){this.manyInternal(2,e)}MANY3(e){this.manyInternal(3,e)}MANY4(e){this.manyInternal(4,e)}MANY5(e){this.manyInternal(5,e)}MANY6(e){this.manyInternal(6,e)}MANY7(e){this.manyInternal(7,e)}MANY8(e){this.manyInternal(8,e)}MANY9(e){this.manyInternal(9,e)}MANY_SEP(e){this.manySepFirstInternal(0,e)}MANY_SEP1(e){this.manySepFirstInternal(1,e)}MANY_SEP2(e){this.manySepFirstInternal(2,e)}MANY_SEP3(e){this.manySepFirstInternal(3,e)}MANY_SEP4(e){this.manySepFirstInternal(4,e)}MANY_SEP5(e){this.manySepFirstInternal(5,e)}MANY_SEP6(e){this.manySepFirstInternal(6,e)}MANY_SEP7(e){this.manySepFirstInternal(7,e)}MANY_SEP8(e){this.manySepFirstInternal(8,e)}MANY_SEP9(e){this.manySepFirstInternal(9,e)}AT_LEAST_ONE(e){this.atLeastOneInternal(0,e)}AT_LEAST_ONE1(e){return this.atLeastOneInternal(1,e)}AT_LEAST_ONE2(e){this.atLeastOneInternal(2,e)}AT_LEAST_ONE3(e){this.atLeastOneInternal(3,e)}AT_LEAST_ONE4(e){this.atLeastOneInternal(4,e)}AT_LEAST_ONE5(e){this.atLeastOneInternal(5,e)}AT_LEAST_ONE6(e){this.atLeastOneInternal(6,e)}AT_LEAST_ONE7(e){this.atLeastOneInternal(7,e)}AT_LEAST_ONE8(e){this.atLeastOneInternal(8,e)}AT_LEAST_ONE9(e){this.atLeastOneInternal(9,e)}AT_LEAST_ONE_SEP(e){this.atLeastOneSepFirstInternal(0,e)}AT_LEAST_ONE_SEP1(e){this.atLeastOneSepFirstInternal(1,e)}AT_LEAST_ONE_SEP2(e){this.atLeastOneSepFirstInternal(2,e)}AT_LEAST_ONE_SEP3(e){this.atLeastOneSepFirstInternal(3,e)}AT_LEAST_ONE_SEP4(e){this.atLeastOneSepFirstInternal(4,e)}AT_LEAST_ONE_SEP5(e){this.atLeastOneSepFirstInternal(5,e)}AT_LEAST_ONE_SEP6(e){this.atLeastOneSepFirstInternal(6,e)}AT_LEAST_ONE_SEP7(e){this.atLeastOneSepFirstInternal(7,e)}AT_LEAST_ONE_SEP8(e){this.atLeastOneSepFirstInternal(8,e)}AT_LEAST_ONE_SEP9(e){this.atLeastOneSepFirstInternal(9,e)}RULE(e,n,r=ti){if(be(this.definedRulesNames,e)){const o={message:Yt.buildDuplicateRuleNameError({topLevelRule:e,grammarName:this.className}),type:Ie.DUPLICATE_RULE_NAME,ruleName:e};this.definitionErrors.push(o)}this.definedRulesNames.push(e);const i=this.defineRule(e,n,r);return this[e]=i,i}OVERRIDE_RULE(e,n,r=ti){const i=GT(e,this.definedRulesNames,this.className);this.definitionErrors=this.definitionErrors.concat(i);const s=this.defineRule(e,n,r);return this[e]=s,s}BACKTRACK(e,n){return function(){this.isBackTrackingStack.push(1);const r=this.saveRecogState();try{return e.apply(this,n),!0}catch(i){if(Zr(i))return!1;throw i}finally{this.reloadRecogState(r),this.isBackTrackingStack.pop()}}}getGAstProductions(){return this.gastProductionsCache}getSerializedGastProductions(){return Tg(Ae(this.gastProductionsCache))}}class gv{initRecognizerEngine(e,n){if(this.className=this.constructor.name,this.shortRuleNameToFull={},this.fullRuleNameToShort={},this.ruleShortNameIdx=256,this.tokenMatcher=$r,this.subruleIdx=0,this.definedRulesNames=[],this.tokensMap={},this.isBackTrackingStack=[],this.RULE_STACK=[],this.RULE_OCCURRENCE_STACK=[],this.gastProductionsCache={},N(n,"serializedGrammar"))throw Error(`The Parser's configuration can no longer contain a <serializedGrammar> property.
	See: https://chevrotain.io/docs/changes/BREAKING_CHANGES.html#_6-0-0
	For Further details.`);if(W(e)){if(Z(e))throw Error(`A Token Vocabulary cannot be empty.
	Note that the first argument for the parser constructor
	is no longer a Token vector (since v4.0).`);if(typeof e[0].startOffset=="number")throw Error(`The Parser constructor no longer accepts a token vector as the first argument.
	See: https://chevrotain.io/docs/changes/BREAKING_CHANGES.html#_4-0-0
	For Further details.`)}if(W(e))this.tokensMap=Ge(e,(s,o)=>(s[o.name]=o,s),{});else if(N(e,"modes")&&ze(Qe(Ae(e.modes)),fT)){const s=Qe(Ae(e.modes)),o=Us(s);this.tokensMap=Ge(o,(a,l)=>(a[l.name]=l,a),{})}else if(We(e))this.tokensMap=ye(e);else throw new Error("<tokensDictionary> argument must be An Array of Token constructors, A dictionary of Token constructors or an IMultiModeLexerDefinition");this.tokensMap.EOF=tn;const r=N(e,"modes")?Qe(Ae(e.modes)):Ae(e),i=ze(r,s=>Z(s.categoryMatches));this.tokenMatcher=i?$r:Ar,gr(Ae(this.tokensMap))}defineRule(e,n,r){if(this.selfAnalysisDone)throw Error(`Grammar rule <${e}> may not be defined after the 'performSelfAnalysis' method has been called'
Make sure that all grammar rule definitions are done before 'performSelfAnalysis' is called.`);const i=N(r,"resyncEnabled")?r.resyncEnabled:ti.resyncEnabled,s=N(r,"recoveryValueFunc")?r.recoveryValueFunc:ti.recoveryValueFunc,o=this.ruleShortNameIdx<<tv+Lt;this.ruleShortNameIdx++,this.shortRuleNameToFull[o]=e,this.fullRuleNameToShort[e]=o;let a;return this.outputCst===!0?a=function(...u){try{this.ruleInvocationStateUpdate(o,e,this.subruleIdx),n.apply(this,u);const h=this.CST_STACK[this.CST_STACK.length-1];return this.cstPostRule(h),h}catch(h){return this.invokeRuleCatch(h,i,s)}finally{this.ruleFinallyStateUpdate()}}:a=function(...u){try{return this.ruleInvocationStateUpdate(o,e,this.subruleIdx),n.apply(this,u)}catch(h){return this.invokeRuleCatch(h,i,s)}finally{this.ruleFinallyStateUpdate()}},Object.assign(a,{ruleName:e,originalGrammarAction:n})}invokeRuleCatch(e,n,r){const i=this.RULE_STACK.length===1,s=n&&!this.isBackTracking()&&this.recoveryEnabled;if(Zr(e)){const o=e;if(s){const a=this.findReSyncTokenType();if(this.isInCurrentRuleReSyncSet(a))if(o.resyncedTokens=this.reSyncTo(a),this.outputCst){const l=this.CST_STACK[this.CST_STACK.length-1];return l.recoveredNode=!0,l}else return r(e);else{if(this.outputCst){const l=this.CST_STACK[this.CST_STACK.length-1];l.recoveredNode=!0,o.partialCstResult=l}throw o}}else{if(i)return this.moveToTerminatedState(),r(e);throw o}}else throw e}optionInternal(e,n){const r=this.getKeyForAutomaticLookahead(rc,n);return this.optionInternalLogic(e,n,r)}optionInternalLogic(e,n,r){let i=this.getLaFuncFromCache(r),s;if(typeof e!="function"){s=e.DEF;const o=e.GATE;if(o!==void 0){const a=i;i=()=>o.call(this)&&a.call(this)}}else s=e;if(i.call(this)===!0)return s.call(this)}atLeastOneInternal(e,n){const r=this.getKeyForAutomaticLookahead(As,e);return this.atLeastOneInternalLogic(e,n,r)}atLeastOneInternalLogic(e,n,r){let i=this.getLaFuncFromCache(r),s;if(typeof n!="function"){s=n.DEF;const o=n.GATE;if(o!==void 0){const a=i;i=()=>o.call(this)&&a.call(this)}}else s=n;if(i.call(this)===!0){let o=this.doSingleRepetition(s);for(;i.call(this)===!0&&o===!0;)o=this.doSingleRepetition(s)}else throw this.raiseEarlyExitException(e,le.REPETITION_MANDATORY,n.ERR_MSG);this.attemptInRepetitionRecovery(this.atLeastOneInternal,[e,n],i,As,e,BT)}atLeastOneSepFirstInternal(e,n){const r=this.getKeyForAutomaticLookahead(Ur,e);this.atLeastOneSepFirstInternalLogic(e,n,r)}atLeastOneSepFirstInternalLogic(e,n,r){const i=n.DEF,s=n.SEP;if(this.getLaFuncFromCache(r).call(this)===!0){i.call(this);const a=()=>this.tokenMatcher(this.LA(1),s);for(;this.tokenMatcher(this.LA(1),s)===!0;)this.CONSUME(s),i.call(this);this.attemptInRepetitionRecovery(this.repetitionSepSecondInternal,[e,s,a,i,ia],a,Ur,e,ia)}else throw this.raiseEarlyExitException(e,le.REPETITION_MANDATORY_WITH_SEPARATOR,n.ERR_MSG)}manyInternal(e,n){const r=this.getKeyForAutomaticLookahead(ms,e);return this.manyInternalLogic(e,n,r)}manyInternalLogic(e,n,r){let i=this.getLaFuncFromCache(r),s;if(typeof n!="function"){s=n.DEF;const a=n.GATE;if(a!==void 0){const l=i;i=()=>a.call(this)&&l.call(this)}}else s=n;let o=!0;for(;i.call(this)===!0&&o===!0;)o=this.doSingleRepetition(s);this.attemptInRepetitionRecovery(this.manyInternal,[e,n],i,ms,e,RT,o)}manySepFirstInternal(e,n){const r=this.getKeyForAutomaticLookahead(gs,e);this.manySepFirstInternalLogic(e,n,r)}manySepFirstInternalLogic(e,n,r){const i=n.DEF,s=n.SEP;if(this.getLaFuncFromCache(r).call(this)===!0){i.call(this);const a=()=>this.tokenMatcher(this.LA(1),s);for(;this.tokenMatcher(this.LA(1),s)===!0;)this.CONSUME(s),i.call(this);this.attemptInRepetitionRecovery(this.repetitionSepSecondInternal,[e,s,a,i,ra],a,gs,e,ra)}}repetitionSepSecondInternal(e,n,r,i,s){for(;r();)this.CONSUME(n),i.call(this);this.attemptInRepetitionRecovery(this.repetitionSepSecondInternal,[e,n,r,i,s],r,Ur,e,s)}doSingleRepetition(e){const n=this.getLexerPosition();return e.call(this),this.getLexerPosition()>n}orInternal(e,n){const r=this.getKeyForAutomaticLookahead(nc,n),i=W(e)?e:e.DEF,o=this.getLaFuncFromCache(r).call(this,i);if(o!==void 0)return i[o].ALT.call(this);this.raiseNoAltException(n,e.ERR_MSG)}ruleFinallyStateUpdate(){if(this.RULE_STACK.pop(),this.RULE_OCCURRENCE_STACK.pop(),this.cstFinallyStateUpdate(),this.RULE_STACK.length===0&&this.isAtEndOfInput()===!1){const e=this.LA(1),n=this.errorMessageProvider.buildNotAllInputParsedMessage({firstRedundant:e,ruleName:this.getCurrRuleFullName()});this.SAVE_ERROR(new YT(n,e))}}subruleInternal(e,n,r){let i;try{const s=r!==void 0?r.ARGS:void 0;return this.subruleIdx=n,i=e.apply(this,s),this.cstPostNonTerminal(i,r!==void 0&&r.LABEL!==void 0?r.LABEL:e.ruleName),i}catch(s){throw this.subruleInternalError(s,r,e.ruleName)}}subruleInternalError(e,n,r){throw Zr(e)&&e.partialCstResult!==void 0&&(this.cstPostNonTerminal(e.partialCstResult,n!==void 0&&n.LABEL!==void 0?n.LABEL:r),delete e.partialCstResult),e}consumeInternal(e,n,r){let i;try{const s=this.LA(1);this.tokenMatcher(s,e)===!0?(this.consumeToken(),i=s):this.consumeInternalError(e,s,r)}catch(s){i=this.consumeInternalRecovery(e,n,s)}return this.cstPostTerminal(r!==void 0&&r.LABEL!==void 0?r.LABEL:e.name,i),i}consumeInternalError(e,n,r){let i;const s=this.LA(0);throw r!==void 0&&r.ERR_MSG?i=r.ERR_MSG:i=this.errorMessageProvider.buildMismatchTokenMessage({expected:e,actual:n,previous:s,ruleName:this.getCurrRuleFullName()}),this.SAVE_ERROR(new ec(i,n,s))}consumeInternalRecovery(e,n,r){if(this.recoveryEnabled&&r.name==="MismatchedTokenException"&&!this.isBackTracking()){const i=this.getFollowsForInRuleRecovery(e,n);try{return this.tryInRuleRecovery(e,i)}catch(s){throw s.name===tc?r:s}}else throw r}saveRecogState(){const e=this.errors,n=ye(this.RULE_STACK);return{errors:e,lexerState:this.exportLexerState(),RULE_STACK:n,CST_STACK:this.CST_STACK}}reloadRecogState(e){this.errors=e.errors,this.importLexerState(e.lexerState),this.RULE_STACK=e.RULE_STACK}ruleInvocationStateUpdate(e,n,r){this.RULE_OCCURRENCE_STACK.push(r),this.RULE_STACK.push(e),this.cstInvocationStateUpdate(n)}isBackTracking(){return this.isBackTrackingStack.length!==0}getCurrRuleFullName(){const e=this.getLastExplicitRuleShortName();return this.shortRuleNameToFull[e]}shortRuleNameToFullName(e){return this.shortRuleNameToFull[e]}isAtEndOfInput(){return this.tokenMatcher(this.LA(1),tn)}reset(){this.resetLexerState(),this.subruleIdx=0,this.isBackTrackingStack=[],this.errors=[],this.RULE_STACK=[],this.CST_STACK=[],this.RULE_OCCURRENCE_STACK=[]}}class Tv{initErrorHandler(e){this._errors=[],this.errorMessageProvider=N(e,"errorMessageProvider")?e.errorMessageProvider:Ot.errorMessageProvider}SAVE_ERROR(e){if(Zr(e))return e.context={ruleStack:this.getHumanReadableRuleStack(),ruleOccurrenceStack:ye(this.RULE_OCCURRENCE_STACK)},this._errors.push(e),e;throw Error("Trying to save an Error which is not a RecognitionException")}get errors(){return ye(this._errors)}set errors(e){this._errors=e}raiseEarlyExitException(e,n,r){const i=this.getCurrRuleFullName(),s=this.getGAstProductions()[i],a=Ws(e,s,n,this.maxLookahead)[0],l=[];for(let u=1;u<=this.maxLookahead;u++)l.push(this.LA(u));const c=this.errorMessageProvider.buildEarlyExitMessage({expectedIterationPaths:a,actual:l,previous:this.LA(0),customUserDescription:r,ruleName:i});throw this.SAVE_ERROR(new $T(c,this.LA(1),this.LA(0)))}raiseNoAltException(e,n){const r=this.getCurrRuleFullName(),i=this.getGAstProductions()[r],s=js(e,i,this.maxLookahead),o=[];for(let c=1;c<=this.maxLookahead;c++)o.push(this.LA(c));const a=this.LA(0),l=this.errorMessageProvider.buildNoViableAltMessage({expectedPathsPerAlt:s,actual:o,previous:a,customUserDescription:n,ruleName:this.getCurrRuleFullName()});throw this.SAVE_ERROR(new zT(l,this.LA(1),a))}}class vv{initContentAssist(){}computeContentAssist(e,n){const r=this.gastProductionsCache[e];if(vt(r))throw Error(`Rule ->${e}<- does not exist in this grammar.`);return Kl([r],n,this.tokenMatcher,this.maxLookahead)}getNextPossibleTokenTypes(e){const n=$e(e.ruleStack),i=this.getGAstProductions()[n];return new ET(i,e).startWalking()}}const Bi={description:"This Object indicates the Parser is during Recording Phase"};Object.freeze(Bi);const la=!0,ca=Math.pow(2,Lt)-1,sc=Ul({name:"RECORDING_PHASE_TOKEN",pattern:Je.NA});gr([sc]);const oc=Js(sc,`This IToken indicates the Parser is in Recording Phase
	See: https://chevrotain.io/docs/guide/internals.html#grammar-recording for details`,-1,-1,-1,-1,-1,-1);Object.freeze(oc);const Cv={name:`This CSTNode indicates the Parser is in Recording Phase
	See: https://chevrotain.io/docs/guide/internals.html#grammar-recording for details`,children:{}};class Ev{initGastRecorder(e){this.recordingProdStack=[],this.RECORDING_PHASE=!1}enableRecording(){this.RECORDING_PHASE=!0,this.TRACE_INIT("Enable Recording",()=>{for(let e=0;e<10;e++){const n=e>0?e:"";this[`CONSUME${n}`]=function(r,i){return this.consumeInternalRecord(r,e,i)},this[`SUBRULE${n}`]=function(r,i){return this.subruleInternalRecord(r,e,i)},this[`OPTION${n}`]=function(r){return this.optionInternalRecord(r,e)},this[`OR${n}`]=function(r){return this.orInternalRecord(r,e)},this[`MANY${n}`]=function(r){this.manyInternalRecord(e,r)},this[`MANY_SEP${n}`]=function(r){this.manySepFirstInternalRecord(e,r)},this[`AT_LEAST_ONE${n}`]=function(r){this.atLeastOneInternalRecord(e,r)},this[`AT_LEAST_ONE_SEP${n}`]=function(r){this.atLeastOneSepFirstInternalRecord(e,r)}}this.consume=function(e,n,r){return this.consumeInternalRecord(n,e,r)},this.subrule=function(e,n,r){return this.subruleInternalRecord(n,e,r)},this.option=function(e,n){return this.optionInternalRecord(n,e)},this.or=function(e,n){return this.orInternalRecord(n,e)},this.many=function(e,n){this.manyInternalRecord(e,n)},this.atLeastOne=function(e,n){this.atLeastOneInternalRecord(e,n)},this.ACTION=this.ACTION_RECORD,this.BACKTRACK=this.BACKTRACK_RECORD,this.LA=this.LA_RECORD})}disableRecording(){this.RECORDING_PHASE=!1,this.TRACE_INIT("Deleting Recording methods",()=>{const e=this;for(let n=0;n<10;n++){const r=n>0?n:"";delete e[`CONSUME${r}`],delete e[`SUBRULE${r}`],delete e[`OPTION${r}`],delete e[`OR${r}`],delete e[`MANY${r}`],delete e[`MANY_SEP${r}`],delete e[`AT_LEAST_ONE${r}`],delete e[`AT_LEAST_ONE_SEP${r}`]}delete e.consume,delete e.subrule,delete e.option,delete e.or,delete e.many,delete e.atLeastOne,delete e.ACTION,delete e.BACKTRACK,delete e.LA})}ACTION_RECORD(e){}BACKTRACK_RECORD(e,n){return()=>!0}LA_RECORD(e){return ei}topLevelRuleRecord(e,n){try{const r=new In({definition:[],name:e});return r.name=e,this.recordingProdStack.push(r),n.call(this),this.recordingProdStack.pop(),r}catch(r){if(r.KNOWN_RECORDER_ERROR!==!0)try{r.message=r.message+`
	 This error was thrown during the "grammar recording phase" For more info see:
	https://chevrotain.io/docs/guide/internals.html#grammar-recording`}catch{throw r}throw r}}optionInternalRecord(e,n){return Hn.call(this,Oe,e,n)}atLeastOneInternalRecord(e,n){Hn.call(this,ht,n,e)}atLeastOneSepFirstInternalRecord(e,n){Hn.call(this,ft,n,e,la)}manyInternalRecord(e,n){Hn.call(this,ge,n,e)}manySepFirstInternalRecord(e,n){Hn.call(this,qe,n,e,la)}orInternalRecord(e,n){return Rv.call(this,e,n)}subruleInternalRecord(e,n,r){if(qr(n),!e||N(e,"ruleName")===!1){const a=new Error(`<SUBRULE${ua(n)}> argument is invalid expecting a Parser method reference but got: <${JSON.stringify(e)}>
 inside top level rule: <${this.recordingProdStack[0].name}>`);throw a.KNOWN_RECORDER_ERROR=!0,a}const i=Sn(this.recordingProdStack),s=e.ruleName,o=new ke({idx:n,nonTerminalName:s,label:r==null?void 0:r.LABEL,referencedRule:void 0});return i.definition.push(o),this.outputCst?Cv:Bi}consumeInternalRecord(e,n,r){if(qr(n),!Gl(e)){const o=new Error(`<CONSUME${ua(n)}> argument is invalid expecting a TokenType reference but got: <${JSON.stringify(e)}>
 inside top level rule: <${this.recordingProdStack[0].name}>`);throw o.KNOWN_RECORDER_ERROR=!0,o}const i=Sn(this.recordingProdStack),s=new ae({idx:n,terminalType:e,label:r==null?void 0:r.LABEL});return i.definition.push(s),oc}}function Hn(t,e,n,r=!1){qr(n);const i=Sn(this.recordingProdStack),s=Ct(e)?e:e.DEF,o=new t({definition:[],idx:n});return r&&(o.separator=e.SEP),N(e,"MAX_LOOKAHEAD")&&(o.maxLookahead=e.MAX_LOOKAHEAD),this.recordingProdStack.push(o),s.call(this),i.definition.push(o),this.recordingProdStack.pop(),Bi}function Rv(t,e){qr(e);const n=Sn(this.recordingProdStack),r=W(t)===!1,i=r===!1?t:t.DEF,s=new et({definition:[],idx:e,ignoreAmbiguities:r&&t.IGNORE_AMBIGUITIES===!0});N(t,"MAX_LOOKAHEAD")&&(s.maxLookahead=t.MAX_LOOKAHEAD);const o=xl(i,a=>Ct(a.GATE));return s.hasPredicates=o,n.definition.push(s),L(i,a=>{const l=new De({definition:[]});s.definition.push(l),N(a,"IGNORE_AMBIGUITIES")?l.ignoreAmbiguities=a.IGNORE_AMBIGUITIES:N(a,"GATE")&&(l.ignoreAmbiguities=!0),this.recordingProdStack.push(l),a.ALT.call(this),this.recordingProdStack.pop()}),Bi}function ua(t){return t===0?"":`${t}`}function qr(t){if(t<0||t>ca){const e=new Error(`Invalid DSL Method idx value: <${t}>
	Idx value must be a none negative value smaller than ${ca+1}`);throw e.KNOWN_RECORDER_ERROR=!0,e}}class Bv{initPerformanceTracer(e){if(N(e,"traceInitPerf")){const n=e.traceInitPerf,r=typeof n=="number";this.traceInitMaxIdent=r?n:1/0,this.traceInitPerf=r?n>0:n}else this.traceInitMaxIdent=0,this.traceInitPerf=Ot.traceInitPerf;this.traceInitIndent=-1}TRACE_INIT(e,n){if(this.traceInitPerf===!0){this.traceInitIndent++;const r=new Array(this.traceInitIndent+1).join("	");this.traceInitIndent<this.traceInitMaxIdent&&console.log(`${r}--> <${e}>`);const{time:i,value:s}=Il(n),o=i>10?console.warn:console.log;return this.traceInitIndent<this.traceInitMaxIdent&&o(`${r}<-- <${e}> time: ${i}ms`),this.traceInitIndent--,s}else return n()}}function yv(t,e){e.forEach(n=>{const r=n.prototype;Object.getOwnPropertyNames(r).forEach(i=>{if(i==="constructor")return;const s=Object.getOwnPropertyDescriptor(r,i);s&&(s.get||s.set)?Object.defineProperty(t.prototype,i,s):t.prototype[i]=n.prototype[i]})})}const ei=Js(tn,"",NaN,NaN,NaN,NaN,NaN,NaN);Object.freeze(ei);const Ot=Object.freeze({recoveryEnabled:!1,maxLookahead:3,dynamicTokensEnabled:!1,outputCst:!0,errorMessageProvider:Hl,nodeLocationTracking:"none",traceInitPerf:!1,skipValidations:!1}),ti=Object.freeze({recoveryValueFunc:()=>{},resyncEnabled:!0});var Ie;(function(t){t[t.INVALID_RULE_NAME=0]="INVALID_RULE_NAME",t[t.DUPLICATE_RULE_NAME=1]="DUPLICATE_RULE_NAME",t[t.INVALID_RULE_OVERRIDE=2]="INVALID_RULE_OVERRIDE",t[t.DUPLICATE_PRODUCTIONS=3]="DUPLICATE_PRODUCTIONS",t[t.UNRESOLVED_SUBRULE_REF=4]="UNRESOLVED_SUBRULE_REF",t[t.LEFT_RECURSION=5]="LEFT_RECURSION",t[t.NONE_LAST_EMPTY_ALT=6]="NONE_LAST_EMPTY_ALT",t[t.AMBIGUOUS_ALTS=7]="AMBIGUOUS_ALTS",t[t.CONFLICT_TOKENS_RULES_NAMESPACE=8]="CONFLICT_TOKENS_RULES_NAMESPACE",t[t.INVALID_TOKEN_NAME=9]="INVALID_TOKEN_NAME",t[t.NO_NON_EMPTY_LOOKAHEAD=10]="NO_NON_EMPTY_LOOKAHEAD",t[t.AMBIGUOUS_PREFIX_ALTS=11]="AMBIGUOUS_PREFIX_ALTS",t[t.TOO_MANY_ALTS=12]="TOO_MANY_ALTS",t[t.CUSTOM_LOOKAHEAD_VALIDATION=13]="CUSTOM_LOOKAHEAD_VALIDATION"})(Ie||(Ie={}));class yi{static performSelfAnalysis(e){throw Error("The **static** `performSelfAnalysis` method has been deprecated.	\nUse the **instance** method with the same name instead.")}performSelfAnalysis(){this.TRACE_INIT("performSelfAnalysis",()=>{let e;this.selfAnalysisDone=!0;const n=this.className;this.TRACE_INIT("toFastProps",()=>{bl(this)}),this.TRACE_INIT("Grammar Recording",()=>{try{this.enableRecording(),L(this.definedRulesNames,i=>{const o=this[i].originalGrammarAction;let a;this.TRACE_INIT(`${i} Rule`,()=>{a=this.topLevelRuleRecord(i,o)}),this.gastProductionsCache[i]=a})}finally{this.disableRecording()}});let r=[];if(this.TRACE_INIT("Grammar Resolving",()=>{r=XT({rules:Ae(this.gastProductionsCache)}),this.definitionErrors=this.definitionErrors.concat(r)}),this.TRACE_INIT("Grammar Validations",()=>{if(Z(r)&&this.skipValidations===!1){const i=QT({rules:Ae(this.gastProductionsCache),tokenTypes:Ae(this.tokensMap),errMsgProvider:Yt,grammarName:n}),s=wT({lookaheadStrategy:this.lookaheadStrategy,rules:Ae(this.gastProductionsCache),tokenTypes:Ae(this.tokensMap),grammarName:n});this.definitionErrors=this.definitionErrors.concat(i,s)}}),Z(this.definitionErrors)&&(this.recoveryEnabled&&this.TRACE_INIT("computeAllProdsFollows",()=>{const i=Sg(Ae(this.gastProductionsCache));this.resyncFollows=i}),this.TRACE_INIT("ComputeLookaheadFunctions",()=>{var i,s;(s=(i=this.lookaheadStrategy).initialize)===null||s===void 0||s.call(i,{rules:Ae(this.gastProductionsCache)}),this.preComputeLookaheadFunctions(Ae(this.gastProductionsCache))})),!yi.DEFER_DEFINITION_ERRORS_HANDLING&&!Z(this.definitionErrors))throw e=F(this.definitionErrors,i=>i.message),new Error(`Parser Definition Errors detected:
 ${e.join(`
-------------------------------
`)}`)})}constructor(e,n){this.definitionErrors=[],this.selfAnalysisDone=!1;const r=this;if(r.initErrorHandler(n),r.initLexerAdapter(),r.initLooksAhead(n),r.initRecognizerEngine(e,n),r.initRecoverable(n),r.initTreeBuilder(n),r.initContentAssist(),r.initGastRecorder(n),r.initPerformanceTracer(n),N(n,"ignoredIssues"))throw new Error(`The <ignoredIssues> IParserConfig property has been deprecated.
	Please use the <IGNORE_AMBIGUITIES> flag on the relevant DSL method instead.
	See: https://chevrotain.io/docs/guide/resolving_grammar_errors.html#IGNORING_AMBIGUITIES
	For further details.`);this.skipValidations=N(n,"skipValidations")?n.skipValidations:Ot.skipValidations}}yi.DEFER_DEFINITION_ERRORS_HANDLING=!1;yv(yi,[qT,rv,pv,mv,gv,Av,Tv,vv,Ev,Bv]);class Sv{constructor(e=4){this.pool=e,this.queue=[],this.workers=[],this.workersResolve=[],this.workerStatus=0}_initWorker(e){if(!this.workers[e]){const n=this.workerCreator();n.addEventListener("message",this._onMessage.bind(this,e)),this.workers[e]=n}}_getIdleWorker(){for(let e=0;e<this.pool;e++)if(!(this.workerStatus&1<<e))return e;return-1}_onMessage(e,n){const r=this.workersResolve[e];if(r&&r(n),this.queue.length){const{resolve:i,msg:s,transfer:o}=this.queue.shift();this.workersResolve[e]=i,this.workers[e].postMessage(s,o)}else this.workerStatus^=1<<e}setWorkerCreator(e){this.workerCreator=e}setWorkerLimit(e){this.pool=e}postMessage(e,n){return new Promise(r=>{const i=this._getIdleWorker();i!==-1?(this._initWorker(i),this.workerStatus|=1<<i,this.workersResolve[i]=r,this.workers[i].postMessage(e,n)):this.queue.push({resolve:r,msg:e,transfer:n})})}dispose(){this.workers.forEach(e=>e.terminate()),this.workersResolve.length=0,this.workers.length=0,this.queue.length=0,this.workerStatus=0}}class xv extends Jr{constructor(e,n,r,i,s,o){super(e,n,r,s,o),this.isCompressedArrayTexture=!0,this.image.depth=i,this.wrapR=zt}}const ji=new WeakMap;let Wi=0,Vi;const Vn=class extends ni{constructor(t){super(t),this.transcoderPath="",this.transcoderBinary=null,this.transcoderPending=null,this.workerPool=new Sv,this.workerSourceURL="",this.workerConfig=null,typeof MSC_TRANSCODER<"u"&&console.warn('THREE.KTX2Loader: Please update to latest "basis_transcoder". "msc_basis_transcoder" is no longer supported in three.js r125+.')}setTranscoderPath(t){return this.transcoderPath=t,this}setWorkerLimit(t){return this.workerPool.setWorkerLimit(t),this}detectSupport(t){return this.workerConfig={astcSupported:t.extensions.has("WEBGL_compressed_texture_astc"),etc1Supported:t.extensions.has("WEBGL_compressed_texture_etc1"),etc2Supported:t.extensions.has("WEBGL_compressed_texture_etc"),dxtSupported:t.extensions.has("WEBGL_compressed_texture_s3tc"),bptcSupported:t.extensions.has("EXT_texture_compression_bptc"),pvrtcSupported:t.extensions.has("WEBGL_compressed_texture_pvrtc")||t.extensions.has("WEBKIT_WEBGL_compressed_texture_pvrtc")},t.capabilities.isWebGL2&&(this.workerConfig.etc1Supported=!1),this}init(){if(!this.transcoderPending){const t=new rt(this.manager);t.setPath(this.transcoderPath),t.setWithCredentials(this.withCredentials);const e=t.loadAsync("basis_transcoder.js"),n=new rt(this.manager);n.setPath(this.transcoderPath),n.setResponseType("arraybuffer"),n.setWithCredentials(this.withCredentials);const r=n.loadAsync("basis_transcoder.wasm");this.transcoderPending=Promise.all([e,r]).then(([i,s])=>{const o=Vn.BasisWorker.toString(),a=["/* constants */","let _EngineFormat = "+JSON.stringify(Vn.EngineFormat),"let _TranscoderFormat = "+JSON.stringify(Vn.TranscoderFormat),"let _BasisFormat = "+JSON.stringify(Vn.BasisFormat),"/* basis_transcoder.js */",i,"/* worker */",o.substring(o.indexOf("{")+1,o.lastIndexOf("}"))].join(`
`);this.workerSourceURL=URL.createObjectURL(new Blob([a])),this.transcoderBinary=s,this.workerPool.setWorkerCreator(()=>{const l=new Worker(this.workerSourceURL),c=this.transcoderBinary.slice(0);return l.postMessage({type:"init",config:this.workerConfig,transcoderBinary:c},[c]),l})}),Wi>0&&console.warn("THREE.KTX2Loader: Multiple active KTX2 loaders may cause performance issues. Use a single KTX2Loader instance, or call .dispose() on old instances."),Wi++}return this.transcoderPending}load(t,e,n,r){if(this.workerConfig===null)throw new Error("THREE.KTX2Loader: Missing initialization with `.detectSupport( renderer )`.");const i=new rt(this.manager);i.setResponseType("arraybuffer"),i.setWithCredentials(this.withCredentials),i.load(t,s=>{if(ji.has(s))return ji.get(s).promise.then(e).catch(r);this._createTexture(s).then(o=>e?e(o):null).catch(r)},n,r)}_createTextureFrom(t,e){const{mipmaps:n,width:r,height:i,format:s,type:o,error:a,dfdTransferFn:l,dfdFlags:c}=t;if(o==="error")return Promise.reject(a);const u=e.layerCount>1?new xv(n,r,i,e.layerCount,s,At):new Jr(n,r,i,s,At);return u.minFilter=n.length===1?Cn:ri,u.magFilter=Cn,u.generateMipmaps=!1,u.needsUpdate=!0,"colorSpace"in u?u.colorSpace=l===Zs?"srgb":"srgb-linear":u.encoding=l===Zs?3001:3e3,u.premultiplyAlpha=!!(c&qc),u}async _createTexture(t,e={}){const n=eu(new Uint8Array(t));if(n.vkFormat!==tu)return Iv(n);const r=e,i=this.init().then(()=>this.workerPool.postMessage({type:"transcode",buffer:t,taskConfig:r},[t])).then(s=>this._createTextureFrom(s.data,n));return ji.set(t,{promise:i}),i}dispose(){return this.workerPool.dispose(),this.workerSourceURL&&URL.revokeObjectURL(this.workerSourceURL),Wi--,this}};let Si=Vn;M(Si,"BasisFormat",{ETC1S:0,UASTC_4x4:1});M(Si,"TranscoderFormat",{ETC1:0,ETC2:1,BC1:2,BC3:3,BC4:4,BC5:5,BC7_M6_OPAQUE_ONLY:6,BC7_M5:7,PVRTC1_4_RGB:8,PVRTC1_4_RGBA:9,ASTC_4x4:10,ATC_RGB:11,ATC_RGBA_INTERPOLATED_ALPHA:12,RGBA32:13,RGB565:14,BGR565:15,RGBA4444:16});M(Si,"EngineFormat",{RGBAFormat:Pt,RGBA_ASTC_4x4_Format:Aa,RGBA_BPTC_Format:ga,RGBA_ETC2_EAC_Format:Ta,RGBA_PVRTC_4BPPV1_Format:va,RGBA_S3TC_DXT5_Format:Ca,RGB_ETC1_Format:Ea,RGB_ETC2_Format:Ra,RGB_PVRTC_4BPPV1_Format:Ba,RGB_S3TC_DXT1_Format:ya});M(Si,"BasisWorker",function(){let t,e,n;const r=_EngineFormat,i=_TranscoderFormat,s=_BasisFormat;self.addEventListener("message",function(g){const d=g.data;switch(d.type){case"init":t=d.config,o(d.transcoderBinary);break;case"transcode":e.then(()=>{try{const{width:A,height:v,hasAlpha:m,mipmaps:p,format:C,dfdTransferFn:R,dfdFlags:y}=a(d.buffer),B=[];for(let x=0;x<p.length;++x)B.push(p[x].data.buffer);self.postMessage({type:"transcode",id:d.id,width:A,height:v,hasAlpha:m,mipmaps:p,format:C,dfdTransferFn:R,dfdFlags:y},B)}catch(A){console.error(A),self.postMessage({type:"error",id:d.id,error:A.message})}});break}});function o(g){e=new Promise(d=>{n={wasmBinary:g,onRuntimeInitialized:d},BASIS(n)}).then(()=>{n.initializeBasis(),n.KTX2File===void 0&&console.warn("THREE.KTX2Loader: Please update Basis Universal transcoder.")})}function a(g){const d=new n.KTX2File(new Uint8Array(g));function A(){d.close(),d.delete()}if(!d.isValid())throw A(),new Error("THREE.KTX2Loader:	Invalid or unsupported .ktx2 file");const v=d.isUASTC()?s.UASTC_4x4:s.ETC1S,m=d.getWidth(),p=d.getHeight(),C=d.getLayers()||1,R=d.getLevels(),y=d.getHasAlpha(),B=d.getDFDTransferFunc(),x=d.getDFDFlags(),{transcoderFormat:I,engineFormat:S}=h(v,m,p,y);if(!m||!p||!R)throw A(),new Error("THREE.KTX2Loader:	Invalid texture");if(!d.startTranscoding())throw A(),new Error("THREE.KTX2Loader: .startTranscoding failed");const b=[];for(let O=0;O<R;O++){const w=[];let k,U;for(let j=0;j<C;j++){const V=d.getImageLevelInfo(O,j,0);k=V.origWidth<4?V.origWidth:V.width,U=V.origHeight<4?V.origHeight:V.height;const X=new Uint8Array(d.getImageTranscodedSizeInBytes(O,j,0,I));if(!d.transcodeImage(X,O,j,0,I,0,-1,-1))throw A(),new Error("THREE.KTX2Loader: .transcodeImage failed.");w.push(X)}b.push({data:T(w),width:k,height:U})}return A(),{width:m,height:p,hasAlpha:y,mipmaps:b,format:S,dfdTransferFn:B,dfdFlags:x}}const l=[{if:"astcSupported",basisFormat:[s.UASTC_4x4],transcoderFormat:[i.ASTC_4x4,i.ASTC_4x4],engineFormat:[r.RGBA_ASTC_4x4_Format,r.RGBA_ASTC_4x4_Format],priorityETC1S:1/0,priorityUASTC:1,needsPowerOfTwo:!1},{if:"bptcSupported",basisFormat:[s.ETC1S,s.UASTC_4x4],transcoderFormat:[i.BC7_M5,i.BC7_M5],engineFormat:[r.RGBA_BPTC_Format,r.RGBA_BPTC_Format],priorityETC1S:3,priorityUASTC:2,needsPowerOfTwo:!1},{if:"dxtSupported",basisFormat:[s.ETC1S,s.UASTC_4x4],transcoderFormat:[i.BC1,i.BC3],engineFormat:[r.RGB_S3TC_DXT1_Format,r.RGBA_S3TC_DXT5_Format],priorityETC1S:4,priorityUASTC:5,needsPowerOfTwo:!1},{if:"etc2Supported",basisFormat:[s.ETC1S,s.UASTC_4x4],transcoderFormat:[i.ETC1,i.ETC2],engineFormat:[r.RGB_ETC2_Format,r.RGBA_ETC2_EAC_Format],priorityETC1S:1,priorityUASTC:3,needsPowerOfTwo:!1},{if:"etc1Supported",basisFormat:[s.ETC1S,s.UASTC_4x4],transcoderFormat:[i.ETC1],engineFormat:[r.RGB_ETC1_Format],priorityETC1S:2,priorityUASTC:4,needsPowerOfTwo:!1},{if:"pvrtcSupported",basisFormat:[s.ETC1S,s.UASTC_4x4],transcoderFormat:[i.PVRTC1_4_RGB,i.PVRTC1_4_RGBA],engineFormat:[r.RGB_PVRTC_4BPPV1_Format,r.RGBA_PVRTC_4BPPV1_Format],priorityETC1S:5,priorityUASTC:6,needsPowerOfTwo:!0}],c=l.sort(function(g,d){return g.priorityETC1S-d.priorityETC1S}),u=l.sort(function(g,d){return g.priorityUASTC-d.priorityUASTC});function h(g,d,A,v){let m,p;const C=g===s.ETC1S?c:u;for(let R=0;R<C.length;R++){const y=C[R];if(t[y.if]&&y.basisFormat.includes(g)&&!(v&&y.transcoderFormat.length<2)&&!(y.needsPowerOfTwo&&!(f(d)&&f(A))))return m=y.transcoderFormat[v?1:0],p=y.engineFormat[v?1:0],{transcoderFormat:m,engineFormat:p}}return console.warn("THREE.KTX2Loader: No suitable compressed texture format found. Decoding to RGBA32."),m=i.RGBA32,p=r.RGBAFormat,{transcoderFormat:m,engineFormat:p}}function f(g){return g<=2?!0:(g&g-1)===0&&g!==0}function T(g){let d=0;for(let m=0;m<g.length;m++){const p=g[m];d+=p.byteLength}const A=new Uint8Array(d);let v=0;for(let m=0;m<g.length;m++){const p=g[m];A.set(p,v),v+=p.byteLength}return A}});const ha={[Pa]:Pt,[_a]:Pt,[wa]:Pt,[Es]:Pt,[Oa]:Rr,[Fa]:Rr,[Da]:Rr,[Rs]:Rr,[Na]:Kn,[La]:Kn,[Bs]:Kn,[Ga]:Kn},Xi={[Pa]:Yn,[_a]:Me,[wa]:At,[Es]:At,[Oa]:Yn,[Fa]:Me,[Da]:At,[Rs]:At,[Na]:Yn,[La]:Me,[Bs]:At,[Ga]:At},Mv={[Es]:3001,[Rs]:3001,[Bs]:3001};async function Iv(t){const{vkFormat:e,pixelWidth:n,pixelHeight:r,pixelDepth:i}=t;if(ha[e]===void 0)throw new Error("THREE.KTX2Loader: Unsupported vkFormat.");const s=t.levels[0];let o,a;if(t.supercompressionScheme===nu)o=s.levelData;else if(t.supercompressionScheme===ru)Vi||(Vi=new Promise(async c=>{const u=new iu;await u.init(),c(u)})),o=(await Vi).decode(s.levelData,s.uncompressedByteLength);else throw new Error("THREE.KTX2Loader: Unsupported supercompressionScheme.");Xi[e]===Yn?a=new Float32Array(o.buffer,o.byteOffset,o.byteLength/Float32Array.BYTES_PER_ELEMENT):Xi[e]===Me?a=new Uint16Array(o.buffer,o.byteOffset,o.byteLength/Uint16Array.BYTES_PER_ELEMENT):a=o;const l=i===0?new Kr(a,n,r):new $u(a,n,r,i);return l.type=Xi[e],l.format=ha[e],l.encoding=Mv[e]||3e3,l.needsUpdate=!0,Promise.resolve(l)}const Qi=new WeakMap,Xn=class extends ni{constructor(t){super(t),this.transcoderPath="",this.transcoderBinary=null,this.transcoderPending=null,this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.workerConfig=null}setTranscoderPath(t){return this.transcoderPath=t,this}setWorkerLimit(t){return this.workerLimit=t,this}detectSupport(t){return this.workerConfig={astcSupported:t.extensions.has("WEBGL_compressed_texture_astc"),etc1Supported:t.extensions.has("WEBGL_compressed_texture_etc1"),etc2Supported:t.extensions.has("WEBGL_compressed_texture_etc"),dxtSupported:t.extensions.has("WEBGL_compressed_texture_s3tc"),bptcSupported:t.extensions.has("EXT_texture_compression_bptc"),pvrtcSupported:t.extensions.has("WEBGL_compressed_texture_pvrtc")||t.extensions.has("WEBKIT_WEBGL_compressed_texture_pvrtc")},this}load(t,e,n,r){const i=new rt(this.manager);i.setResponseType("arraybuffer"),i.setWithCredentials(this.withCredentials);const s=new Jr;return i.load(t,o=>{if(Qi.has(o))return Qi.get(o).promise.then(e).catch(r);this._createTexture([o]).then(function(a){s.copy(a),s.needsUpdate=!0,e&&e(s)}).catch(r)},n,r),s}parseInternalAsync(t){const{levels:e}=t,n=new Set;for(let r=0;r<e.length;r++)n.add(e[r].data.buffer);return this._createTexture(Array.from(n),{...t,lowLevel:!0})}_createTexture(t,e={}){let n,r;const i=e;let s=0;for(let a=0;a<t.length;a++)s+=t[a].byteLength;const o=this._allocateWorker(s).then(a=>(n=a,r=this.workerNextTaskID++,new Promise((l,c)=>{n._callbacks[r]={resolve:l,reject:c},n.postMessage({type:"transcode",id:r,buffers:t,taskConfig:i},t)}))).then(a=>{const{mipmaps:l,width:c,height:u,format:h}=a,f=new Jr(l,c,u,h,At);return f.minFilter=l.length===1?Cn:ri,f.magFilter=Cn,f.generateMipmaps=!1,f.needsUpdate=!0,f});return o.catch(()=>!0).then(()=>{n&&r&&(n._taskLoad-=s,delete n._callbacks[r])}),Qi.set(t[0],{promise:o}),o}_initTranscoder(){if(!this.transcoderPending){const t=new rt(this.manager);t.setPath(this.transcoderPath),t.setWithCredentials(this.withCredentials);const e=new Promise((i,s)=>{t.load("basis_transcoder.js",i,void 0,s)}),n=new rt(this.manager);n.setPath(this.transcoderPath),n.setResponseType("arraybuffer"),n.setWithCredentials(this.withCredentials);const r=new Promise((i,s)=>{n.load("basis_transcoder.wasm",i,void 0,s)});this.transcoderPending=Promise.all([e,r]).then(([i,s])=>{const o=Xn.BasisWorker.toString(),a=["/* constants */","let _EngineFormat = "+JSON.stringify(Xn.EngineFormat),"let _TranscoderFormat = "+JSON.stringify(Xn.TranscoderFormat),"let _BasisFormat = "+JSON.stringify(Xn.BasisFormat),"/* basis_transcoder.js */",i,"/* worker */",o.substring(o.indexOf("{")+1,o.lastIndexOf("}"))].join(`
`);this.workerSourceURL=URL.createObjectURL(new Blob([a])),this.transcoderBinary=s})}return this.transcoderPending}_allocateWorker(t){return this._initTranscoder().then(()=>{if(this.workerPool.length<this.workerLimit){const n=new Worker(this.workerSourceURL);n._callbacks={},n._taskLoad=0,n.postMessage({type:"init",config:this.workerConfig,transcoderBinary:this.transcoderBinary}),n.onmessage=function(r){const i=r.data;switch(i.type){case"transcode":n._callbacks[i.id].resolve(i);break;case"error":n._callbacks[i.id].reject(i);break;default:console.error('THREE.BasisTextureLoader: Unexpected message, "'+i.type+'"')}},this.workerPool.push(n)}else this.workerPool.sort(function(n,r){return n._taskLoad>r._taskLoad?-1:1});const e=this.workerPool[this.workerPool.length-1];return e._taskLoad+=t,e})}dispose(){for(let t=0;t<this.workerPool.length;t++)this.workerPool[t].terminate();return this.workerPool.length=0,this}};let xi=Xn;M(xi,"BasisFormat",{ETC1S:0,UASTC_4x4:1});M(xi,"TranscoderFormat",{ETC1:0,ETC2:1,BC1:2,BC3:3,BC4:4,BC5:5,BC7_M6_OPAQUE_ONLY:6,BC7_M5:7,PVRTC1_4_RGB:8,PVRTC1_4_RGBA:9,ASTC_4x4:10,ATC_RGB:11,ATC_RGBA_INTERPOLATED_ALPHA:12,RGBA32:13,RGB565:14,BGR565:15,RGBA4444:16});M(xi,"EngineFormat",{RGBAFormat:Pt,RGBA_ASTC_4x4_Format:Aa,RGBA_BPTC_Format:ga,RGBA_ETC2_EAC_Format:Ta,RGBA_PVRTC_4BPPV1_Format:va,RGBA_S3TC_DXT5_Format:Ca,RGB_ETC1_Format:Ea,RGB_ETC2_Format:Ra,RGB_PVRTC_4BPPV1_Format:Ba,RGB_S3TC_DXT1_Format:ya});M(xi,"BasisWorker",function(){let t,e,n;const r=_EngineFormat,i=_TranscoderFormat,s=_BasisFormat;onmessage=function(m){const p=m.data;switch(p.type){case"init":t=p.config,o(p.transcoderBinary);break;case"transcode":e.then(()=>{try{const{width:C,height:R,hasAlpha:y,mipmaps:B,format:x}=p.taskConfig.lowLevel?a(p.taskConfig):l(p.buffers[0]),I=[];for(let S=0;S<B.length;++S)I.push(B[S].data.buffer);self.postMessage({type:"transcode",id:p.id,width:C,height:R,hasAlpha:y,mipmaps:B,format:x},I)}catch(C){console.error(C),self.postMessage({type:"error",id:p.id,error:C.message})}});break}};function o(m){e=new Promise(p=>{n={wasmBinary:m,onRuntimeInitialized:p},BASIS(n)}).then(()=>{n.initializeBasis()})}function a(m){const{basisFormat:p,width:C,height:R,hasAlpha:y}=m,{transcoderFormat:B,engineFormat:x}=f(p,C,R,y),I=n.getBytesPerBlockOrPixel(B);T(n.isFormatSupported(B),"THREE.BasisTextureLoader: Unsupported format.");const S=[];if(p===s.ETC1S){const b=new n.LowLevelETC1SImageTranscoder,{endpointCount:O,endpointsData:w,selectorCount:k,selectorsData:U,tablesData:j}=m.globalData;try{let V;V=b.decodePalettes(O,w,k,U),T(V,"THREE.BasisTextureLoader: decodePalettes() failed."),V=b.decodeTables(j),T(V,"THREE.BasisTextureLoader: decodeTables() failed.");for(let X=0;X<m.levels.length;X++){const Q=m.levels[X],z=m.globalData.imageDescs[X],ve=A(B,Q.width,Q.height),Ce=new Uint8Array(ve);V=b.transcodeImage(B,Ce,ve/I,Q.data,g(B,Q.width),d(B,Q.height),Q.width,Q.height,Q.index,z.rgbSliceByteOffset,z.rgbSliceByteLength,z.alphaSliceByteOffset,z.alphaSliceByteLength,z.imageFlags,y,!1,0,0),T(V,"THREE.BasisTextureLoader: transcodeImage() failed for level "+Q.index+"."),S.push({data:Ce,width:Q.width,height:Q.height})}}finally{b.delete()}}else for(let b=0;b<m.levels.length;b++){const O=m.levels[b],w=A(B,O.width,O.height),k=new Uint8Array(w),U=n.transcodeUASTCImage(B,k,w/I,O.data,g(B,O.width),d(B,O.height),O.width,O.height,O.index,0,O.data.byteLength,0,y,!1,0,0,-1,-1);T(U,"THREE.BasisTextureLoader: transcodeUASTCImage() failed for level "+O.index+"."),S.push({data:k,width:O.width,height:O.height})}return{width:C,height:R,hasAlpha:y,mipmaps:S,format:x}}function l(m){const p=new n.BasisFile(new Uint8Array(m)),C=p.isUASTC()?s.UASTC_4x4:s.ETC1S,R=p.getImageWidth(0,0),y=p.getImageHeight(0,0),B=p.getNumLevels(0),x=p.getHasAlpha();function I(){p.close(),p.delete()}const{transcoderFormat:S,engineFormat:b}=f(C,R,y,x);if(!R||!y||!B)throw I(),new Error("THREE.BasisTextureLoader:	Invalid texture");if(!p.startTranscoding())throw I(),new Error("THREE.BasisTextureLoader: .startTranscoding failed");const O=[];for(let w=0;w<B;w++){const k=p.getImageWidth(0,w),U=p.getImageHeight(0,w),j=new Uint8Array(p.getImageTranscodedSizeInBytes(0,w,S));if(!p.transcodeImage(j,0,w,S,0,x))throw I(),new Error("THREE.BasisTextureLoader: .transcodeImage failed.");O.push({data:j,width:k,height:U})}return I(),{width:R,height:y,hasAlpha:x,mipmaps:O,format:b}}const c=[{if:"astcSupported",basisFormat:[s.UASTC_4x4],transcoderFormat:[i.ASTC_4x4,i.ASTC_4x4],engineFormat:[r.RGBA_ASTC_4x4_Format,r.RGBA_ASTC_4x4_Format],priorityETC1S:1/0,priorityUASTC:1,needsPowerOfTwo:!1},{if:"bptcSupported",basisFormat:[s.ETC1S,s.UASTC_4x4],transcoderFormat:[i.BC7_M5,i.BC7_M5],engineFormat:[r.RGBA_BPTC_Format,r.RGBA_BPTC_Format],priorityETC1S:3,priorityUASTC:2,needsPowerOfTwo:!1},{if:"dxtSupported",basisFormat:[s.ETC1S,s.UASTC_4x4],transcoderFormat:[i.BC1,i.BC3],engineFormat:[r.RGB_S3TC_DXT1_Format,r.RGBA_S3TC_DXT5_Format],priorityETC1S:4,priorityUASTC:5,needsPowerOfTwo:!1},{if:"etc2Supported",basisFormat:[s.ETC1S,s.UASTC_4x4],transcoderFormat:[i.ETC1,i.ETC2],engineFormat:[r.RGB_ETC2_Format,r.RGBA_ETC2_EAC_Format],priorityETC1S:1,priorityUASTC:3,needsPowerOfTwo:!1},{if:"etc1Supported",basisFormat:[s.ETC1S,s.UASTC_4x4],transcoderFormat:[i.ETC1,i.ETC1],engineFormat:[r.RGB_ETC1_Format,r.RGB_ETC1_Format],priorityETC1S:2,priorityUASTC:4,needsPowerOfTwo:!1},{if:"pvrtcSupported",basisFormat:[s.ETC1S,s.UASTC_4x4],transcoderFormat:[i.PVRTC1_4_RGB,i.PVRTC1_4_RGBA],engineFormat:[r.RGB_PVRTC_4BPPV1_Format,r.RGBA_PVRTC_4BPPV1_Format],priorityETC1S:5,priorityUASTC:6,needsPowerOfTwo:!0}],u=c.sort(function(m,p){return m.priorityETC1S-p.priorityETC1S}),h=c.sort(function(m,p){return m.priorityUASTC-p.priorityUASTC});function f(m,p,C,R){let y,B;const x=m===s.ETC1S?u:h;for(let I=0;I<x.length;I++){const S=x[I];if(t[S.if]&&S.basisFormat.includes(m)&&!(S.needsPowerOfTwo&&!(v(p)&&v(C))))return y=S.transcoderFormat[R?1:0],B=S.engineFormat[R?1:0],{transcoderFormat:y,engineFormat:B}}return console.warn("THREE.BasisTextureLoader: No suitable compressed texture format found. Decoding to RGBA32."),y=i.RGBA32,B=r.RGBAFormat,{transcoderFormat:y,engineFormat:B}}function T(m,p){if(!m)throw new Error(p)}function g(m,p){return Math.ceil(p/n.getFormatBlockWidth(m))}function d(m,p){return Math.ceil(p/n.getFormatBlockHeight(m))}function A(m,p,C){const R=n.getBytesPerBlockOrPixel(m);if(n.formatIsUncompressed(m))return p*C*R;if(m===i.PVRTC1_4_RGB||m===i.PVRTC1_4_RGBA){const y=p+3&-4,B=C+3&-4;return(Math.max(8,y)*Math.max(8,B)*4+7)/8}return g(m,p)*d(m,C)*R}function v(m){return m<=2?!0:(m&m-1)===0&&m!==0}});const zi=new WeakMap;class kv extends ni{constructor(e){super(e),this.decoderPath="",this.decoderConfig={},this.decoderBinary=null,this.decoderPending=null,this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.defaultAttributeIDs={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"},this.defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array"}}setDecoderPath(e){return this.decoderPath=e,this}setDecoderConfig(e){return this.decoderConfig=e,this}setWorkerLimit(e){return this.workerLimit=e,this}load(e,n,r,i){const s=new rt(this.manager);s.setPath(this.path),s.setResponseType("arraybuffer"),s.setRequestHeader(this.requestHeader),s.setWithCredentials(this.withCredentials),s.load(e,o=>{const a={attributeIDs:this.defaultAttributeIDs,attributeTypes:this.defaultAttributeTypes,useUniqueIDs:!1};this.decodeGeometry(o,a).then(n).catch(i)},r,i)}decodeDracoFile(e,n,r,i){const s={attributeIDs:r||this.defaultAttributeIDs,attributeTypes:i||this.defaultAttributeTypes,useUniqueIDs:!!r};this.decodeGeometry(e,s).then(n)}decodeGeometry(e,n){for(const l in n.attributeTypes){const c=n.attributeTypes[l];c.BYTES_PER_ELEMENT!==void 0&&(n.attributeTypes[l]=c.name)}const r=JSON.stringify(n);if(zi.has(e)){const l=zi.get(e);if(l.key===r)return l.promise;if(e.byteLength===0)throw new Error("THREE.DRACOLoader: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")}let i;const s=this.workerNextTaskID++,o=e.byteLength,a=this._getWorker(s,o).then(l=>(i=l,new Promise((c,u)=>{i._callbacks[s]={resolve:c,reject:u},i.postMessage({type:"decode",id:s,taskConfig:n,buffer:e},[e])}))).then(l=>this._createGeometry(l.geometry));return a.catch(()=>!0).then(()=>{i&&s&&this._releaseTask(i,s)}),zi.set(e,{key:r,promise:a}),a}_createGeometry(e){const n=new Mn;e.index&&n.setIndex(new Qn(e.index.array,1));for(let r=0;r<e.attributes.length;r++){const i=e.attributes[r],s=i.name,o=i.array,a=i.itemSize;n.setAttribute(s,new Qn(o,a))}return n}_loadLibrary(e,n){const r=new rt(this.manager);return r.setPath(this.decoderPath),r.setResponseType(n),r.setWithCredentials(this.withCredentials),new Promise((i,s)=>{r.load(e,i,void 0,s)})}preload(){return this._initDecoder(),this}_initDecoder(){if(this.decoderPending)return this.decoderPending;const e=typeof WebAssembly!="object"||this.decoderConfig.type==="js",n=[];return e?n.push(this._loadLibrary("draco_decoder.js","text")):(n.push(this._loadLibrary("draco_wasm_wrapper.js","text")),n.push(this._loadLibrary("draco_decoder.wasm","arraybuffer"))),this.decoderPending=Promise.all(n).then(r=>{const i=r[0];e||(this.decoderConfig.wasmBinary=r[1]);const s=bv.toString(),o=["/* draco decoder */",i,"","/* worker */",s.substring(s.indexOf("{")+1,s.lastIndexOf("}"))].join(`
`);this.workerSourceURL=URL.createObjectURL(new Blob([o]))}),this.decoderPending}_getWorker(e,n){return this._initDecoder().then(()=>{if(this.workerPool.length<this.workerLimit){const i=new Worker(this.workerSourceURL);i._callbacks={},i._taskCosts={},i._taskLoad=0,i.postMessage({type:"init",decoderConfig:this.decoderConfig}),i.onmessage=function(s){const o=s.data;switch(o.type){case"decode":i._callbacks[o.id].resolve(o);break;case"error":i._callbacks[o.id].reject(o);break;default:console.error('THREE.DRACOLoader: Unexpected message, "'+o.type+'"')}},this.workerPool.push(i)}else this.workerPool.sort(function(i,s){return i._taskLoad>s._taskLoad?-1:1});const r=this.workerPool[this.workerPool.length-1];return r._taskCosts[e]=n,r._taskLoad+=n,r})}_releaseTask(e,n){e._taskLoad-=e._taskCosts[n],delete e._callbacks[n],delete e._taskCosts[n]}debug(){console.log("Task load: ",this.workerPool.map(e=>e._taskLoad))}dispose(){for(let e=0;e<this.workerPool.length;++e)this.workerPool[e].terminate();return this.workerPool.length=0,this}}function bv(){let t,e;onmessage=function(o){const a=o.data;switch(a.type){case"init":t=a.decoderConfig,e=new Promise(function(u){t.onModuleLoaded=function(h){u({draco:h})},DracoDecoderModule(t)});break;case"decode":const l=a.buffer,c=a.taskConfig;e.then(u=>{const h=u.draco,f=new h.Decoder,T=new h.DecoderBuffer;T.Init(new Int8Array(l),l.byteLength);try{const g=n(h,f,T,c),d=g.attributes.map(A=>A.array.buffer);g.index&&d.push(g.index.array.buffer),self.postMessage({type:"decode",id:a.id,geometry:g},d)}catch(g){console.error(g),self.postMessage({type:"error",id:a.id,error:g.message})}finally{h.destroy(T),h.destroy(f)}});break}};function n(o,a,l,c){const u=c.attributeIDs,h=c.attributeTypes;let f,T;const g=a.GetEncodedGeometryType(l);if(g===o.TRIANGULAR_MESH)f=new o.Mesh,T=a.DecodeBufferToMesh(l,f);else if(g===o.POINT_CLOUD)f=new o.PointCloud,T=a.DecodeBufferToPointCloud(l,f);else throw new Error("THREE.DRACOLoader: Unexpected geometry type.");if(!T.ok()||f.ptr===0)throw new Error("THREE.DRACOLoader: Decoding failed: "+T.error_msg());const d={index:null,attributes:[]};for(const A in u){const v=self[h[A]];let m,p;if(c.useUniqueIDs)p=u[A],m=a.GetAttributeByUniqueId(f,p);else{if(p=a.GetAttributeId(f,o[u[A]]),p===-1)continue;m=a.GetAttribute(f,p)}d.attributes.push(i(o,a,f,A,v,m))}return g===o.TRIANGULAR_MESH&&(d.index=r(o,a,f)),o.destroy(f),d}function r(o,a,l){const u=l.num_faces()*3,h=u*4,f=o._malloc(h);a.GetTrianglesUInt32Array(l,h,f);const T=new Uint32Array(o.HEAPF32.buffer,f,u).slice();return o._free(f),{array:T,itemSize:1}}function i(o,a,l,c,u,h){const f=h.num_components(),g=l.num_points()*f,d=g*u.BYTES_PER_ELEMENT,A=s(o,u),v=o._malloc(d);a.GetAttributeDataArrayForAllPoints(l,h,A,d,v);const m=new u(o.HEAPF32.buffer,v,g).slice();return o._free(v),{name:c,array:m,itemSize:f}}function s(o,a){switch(a){case Float32Array:return o.DT_FLOAT32;case Int8Array:return o.DT_INT8;case Int16Array:return o.DT_INT16;case Int32Array:return o.DT_INT32;case Uint8Array:return o.DT_UINT8;case Uint16Array:return o.DT_UINT16;case Uint32Array:return o.DT_UINT32}}}let Or;const Uv=()=>{if(Or)return Or;const t="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",e="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",n=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]),r=new Uint8Array([32,0,65,253,3,1,2,34,4,106,6,5,11,8,7,20,13,33,12,16,128,9,116,64,19,113,127,15,10,21,22,14,255,66,24,54,136,107,18,23,192,26,114,118,132,17,77,101,130,144,27,87,131,44,45,74,156,154,70,167]);if(typeof WebAssembly!="object")return{supported:!1};let i=t;WebAssembly.validate(n)&&(i=e);let s;const o=WebAssembly.instantiate(a(i),{}).then(h=>{s=h.instance,s.exports.__wasm_call_ctors()});function a(h){const f=new Uint8Array(h.length);for(let g=0;g<h.length;++g){const d=h.charCodeAt(g);f[g]=d>96?d-71:d>64?d-65:d>47?d+4:d>46?63:62}let T=0;for(let g=0;g<h.length;++g)f[T++]=f[g]<60?r[f[g]]:(f[g]-60)*64+f[++g];return f.buffer.slice(0,T)}function l(h,f,T,g,d,A){const v=s.exports.sbrk,m=T+3&-4,p=v(m*g),C=v(d.length),R=new Uint8Array(s.exports.memory.buffer);R.set(d,C);const y=h(p,T,g,C,d.length);if(y===0&&A&&A(p,m,g),f.set(R.subarray(p,p+T*g)),v(p-v(0)),y!==0)throw new Error(`Malformed buffer data: ${y}`)}const c={0:"",1:"meshopt_decodeFilterOct",2:"meshopt_decodeFilterQuat",3:"meshopt_decodeFilterExp",NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},u={0:"meshopt_decodeVertexBuffer",1:"meshopt_decodeIndexBuffer",2:"meshopt_decodeIndexSequence",ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return Or={ready:o,supported:!0,decodeVertexBuffer(h,f,T,g,d){l(s.exports.meshopt_decodeVertexBuffer,h,f,T,g,s.exports[c[d]])},decodeIndexBuffer(h,f,T,g){l(s.exports.meshopt_decodeIndexBuffer,h,f,T,g)},decodeIndexSequence(h,f,T,g){l(s.exports.meshopt_decodeIndexSequence,h,f,T,g)},decodeGltfBuffer(h,f,T,g,d,A){l(s.exports[u[d]],h,f,T,g,s.exports[c[A]])}},Or};export{Gv as D,Lv as G,Uv as M,Nv as O,kv as a};
